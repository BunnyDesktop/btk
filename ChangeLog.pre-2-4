Tue Mar 16 13:29:58 2004  Owen Taylor  <otaylor@redhat.com>

	* === Released 2.4.0 ===

	* configure.in: Version 2.4.0, interface age 0; 
	require bunnylib-2.4.0, bango-1.4.0.

	* configure.in: Change btk_binary_version to 2.4.0;
	there are some compatibility issues with older theme engines.
	
	* NEWS: Updates

	* README.in: Updates

Tue Mar 16 13:54:07 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkentry.c (btk_entry_completion_key_press): Block the
	::changed handler during the ::match-selected when done by
	keyboard.

Tue Mar 16 00:56:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (btk_entry_completion_list_button_press): 
	Block the ::changed handler during the emission of ::match-selected.
	Partial fix for #137226.

	* btk/btkfilechooserentry.c: Remove the no longer needed 
	no_pop_down flag.

Tue Mar 16 00:20:51 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserwidget.c (btk_file_chooser_widget_new_with_backend):
	Fix a typo in the docs.

2004-03-15  Tor Lillqvist  <tml@iki.fi>

	* README.win32: Updates.

2004-03-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (update_appearance): Only hide the
	"create folder" button in OPEN mode; all the others should show it
	it.
	(get_paths_foreach): Handle the editable row.

	* btk/btkfilesystemunix.c (btk_file_system_unix_create_folder):
	Force a re-get of the folder so that the new directory gets added
	to its hash table of file info.

2004-03-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (update_from_entry): In the Save
	modes, set the Name entry of the file chooser if we get a
	nonexistent filename from the file entry.  Fixes #135911.
	(btk_file_chooser_default_set_current_name): Oops, this should
	also work if we are in CREATE_FOLDER mode.

	* btk/btkfilesystem.c (btk_file_path_real_copy): Use
	btk_file_path_copy().

	* btk/btkfilechooserentry.c (check_completion_callback): Free the
	path that we got from the model.
	(completion_match_func): Use DISPLAY_NAME_COLUMN rather than a
	hard-coded constant.

Mon Mar 15 13:50:14 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_set_property):
	Don't leak the temporary font description. (Nils O. Selåsdal)

Mon Mar 15 12:51:17 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (location_popup_handler): Only show
	the title string in OPEN/SELECT_FOLDER mode as it's open-specific.
	Put a blank title for SAVE/CREATE_FOLDER; we are in string freeze,
	so we'll fix it for 2.4.1 as #137272.

	* btk/btkpathbar.c (btk_path_bar_scroll_down): calculate
	space_available correctly for RTL mode.  w/o this, you can't
	scroll down again.  Fixes #137021.

2004-03-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkpathbar.c (btk_path_bar_scroll_up): Queue a resize.
	(btk_path_bar_scroll_down): Likewise.

Mon Mar 15 11:40:43 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooserentry.c: Store the position of the 
	file part and use that in check_completion_callback()
	and match_selected_callback() to figure out where
	to operate on the text, rather than recomputing the
	information.

Mon Mar 15 10:35:19 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (shortcuts_add_volumes): set
	changing_folders to be true so we don't trigger a callback when we
	remove the selection
	(shortcuts_add_bookmarks): ditto

Mon Mar 15 10:47:18 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooserentry.c: s/seperator/separator/.

Mon Mar 15 09:54:36 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btklabel.c (btk_label_focus): Check for 
	Control-Tab or Control-Shift-Tab, not any Control-key
	as a current event ... handles the case where a dialog
	is triggered from a control accelerator better.

Mon Mar 15 08:48:48 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserentry.c (match_selected_callback): implement
	correctly.
	(completion_match_func): Allow surpressing popdowns.
	(maybe_append_seperator_to_path): New function to add a separator
	item to a display_name.  Bad hack.
	(check_completion_callback): Implement select-ahead as an idle.
	(add_completion_idle): new function to handle select-ahead
	(btk_file_chooser_entry_do_insert_text): starf the select-ahead
	idle.
	(btk_file_chooser_entry_focus): Override tab for completion.
	(btk_file_chooser_entry_activate): commit select_ahead when
	activated.

	* btk/btkfilechooserdefault.c (location_popup_handler): grab the
	appropriate widget for the mode.

2004-03-15  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkgc-win32.c (bdk_gc_copy): Don't just copy the whole
	BdkGCWin32 with a single assignment, that overwrites GObject's
	private data (for instance ref_count). (#137012, John Ehresman)

2004-03-15  Mark McLoughlin  <mark@skynet.ie>

	* btk/btkfilechooserdefault.c: remove the unused "lowest_folder"
	BtkFileChooserDefault member. Leftover from my original patch
	for bug #136987.

Mon Mar 15 01:50:28 2004  Jonathan Blandford  <jrb@bunny.org>

	* btkfilechooserentry.c: Rewritten to use the BtkEntryCompletion
	API more correctly.  Now pops down the dropdown well.

	* btkfilesystem.c (btk_file_path_get_type): New boxed type for the
	FilePath.

	* test/testfilechooser.c: disable preview widget temporarily.
	It's not representative of a good preview widget.

2004-03-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_find_current_folder):
	Renamed from shortcuts_unselect_all(); now selects the row that
	corresponds to the current folder, if any.  Fixes #135916.

	* btk/btkpathbar.h: Added prototypes for _btk_path_bar_up() and
	_btk_path_bar_down().

2004-03-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c: Surround the
	drag-outside-to-remove-bookmarks code with "#if 0" blocks; it's
	too unstable right now.

Sun Mar 14 23:36:15 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooserdefault.c: Implement local_only by
	filtering the shortcuts and bookmarks list by 
	btk_file_system_path_to_filename (file_system, path) != NULL.
	(#132894)

	* btk/btkfilesystem.c (btk_file_system_path_is_local): Add
	a convenience function, may by interesting to push to the 
	file system vtable later for performance.

2004-03-14  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystem.c (btk_file_folder_get_info): Allow the path
	to be NULL, so that people can ask for information about a
	parent-less file system root (e.g. get_info (get_folder ("/"), NULL)).

	* btk/btkfilesystemunix.c (btk_file_folder_unix_get_info): Allow
	the condition describe above.

	* btk/btkfilechooserdefault.c (get_file_info): Allow getting
	information of root paths.

	* btk/btkpathbar.c (_btk_path_bar_set_path): Handle root paths correctly.

Sun Mar 14 22:32:36 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktreeview.c (btk_tree_view_set_search_equal_func): Mention
	BtkTreeViewSearchEqualFunc return value oddity here as well.

	* btk/btktreeview.c (btk_tree_view_search_equal_func): On failure
	to get a string to compare to, return TRUE (no match), not 
	FALSE (match). Handle %NULL string values gracefully.
	Remove unused variable. (#135962, Mark McLoughlin)

2004-03-14  Morten Welinder  <terra@bunny.org>

	* btk/btkfilesystemunix.c: Kill some debug g_prints.

Sun Mar 14 21:03:15 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkpathbar.[ch]: Add _btk_path_bar_up()/
	_btk_path_bar_down().

	* btk/btkfilechooserdefault.c: Use _btk_path_bar_up()/
	_btk_path_bar_down() as bindings for Alt-Up
	and new Alt-Down. (Partly based on a patch by
	Mark McLoughlin, #136987)

2004-03-14  Federico Mena Quintero  <federico@ximian.com>

	Fixes #136185, patch by Morten Welinder, with some changes.

	* btk/btkfilechooserdefault.c (check_is_folder): New helper function.
	(shortcuts_insert_path): Check the path first with check_is_folder().
	(btk_file_chooser_default_set_current_folder): Likewise.
	(btk_file_chooser_default_add_shortcut_folder): Likewise.
	(browse_widgets_create): Unref the size group.

	* btk/btkfilesystemunix.c (btk_file_system_unix_get_folder):
	Handle the case where the file exists but it is not a directory.
	(IconType): Add value for ICON_UNDECIDED.
	(struct stat_info_entry): New structure to hold a file's struct
	stat, its MIME type and its icon type.
	(struct _BtkFileFolderUnix): Added a hash of struct
	stat_info_entry, and flags to remember which info types we've read
	so far.
	(get_icon_type): Use a helper function for the icons-from-stat
	types.
	(btk_file_system_unix_render_icon): Use the cached file info.
	(btk_file_folder_unix_get_info): Put the info in the cache.
	(btk_file_system_unix_get_folder): Create the cache of file info
	structures.

	* btk/btkfilesystem.c (btk_file_info_set_display_name): Handle the
	case where display_name is the same as the existing
	info->display_name.

Sun Mar 14 19:26:48 2004  Owen Taylor  <otaylor@redhat.com>

	#136672, reported by Christian Persch; fixes based
	on a patch by Soeren Sandmann.

	* btk/btkmenu.c: Change the handling of mixed gridded
	and non-gridded menu items; the old method was causing
	major performance problems even with the "avoid relayout
	on destruction" hack put in recently.

	Now we first lay out the gridded items and then put the 
	non-gridded items into empty rows / after the gridded items. 
	Layout is done in a central menu_shell_ensure_layout(). Also
	avoid emitting property notifications when we initially
	insert or attach items.
	
	* btk/btkmenushell.[ch] btk/btkmenu.c: Stop setting the
	unused menu_shell->menu_flag, and document it as unused
	in the header.

	* tests/testactions.c: Add a test of creating/removing
	lots of items.

	* test/testbtk.c: Add some more cruft to the menu test.

Mon Mar 15 02:36:07 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (btk_entry_completion_class_init): Add
	some signal docs.

Sun Mar 14 15:38:39 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkentrycompletion.c (btk_entry_completion_visible_func):
	always use the match_func, even if text_column is set.

2004-03-14  Morten Welinder  <terra@bunny.org>

	* btk/btkfilesystemunix.c (get_parent_dir): Don't turn "/" into
	"".
	(btk_file_system_unix_get_folder): Use the same value for lookup
	as for insertion.  Make sure we have a directory.

	* btk/btkfilechooserdefault.c (error_dialog): Don't crash on NULL
	path; don't crash on NULL error.

2004-03-14  Hans Breuer  <hans@breuer.org>

	btk/btkcombobox.c : prototype cell_view_sync_cells() before 
	first usage

	btk/makefile.msc.in : updated 'btk_public_h_sources'

	tests/makefile.msc : added testspinbutton

Sun Mar 14 01:01:18 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellview.c (btk_cell_view_set_cell_data): Align
	this function with btk_tree_view_column_set_cell_data();
	call the cell data func after setting the attributes.

Sun Mar 14 01:00:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellview.c (btk_cell_view_expose): One more try;
	make sure not to call btk_cell_view_set_cell_data() when
	displayed_row is NULL.

Sat Mar 13 18:13:13 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextlayout.c (btk_text_layout_get_line_display): When not
	wrapping, do the offset of the line for justification ourselves.
	(#120256, Felipe Heidrich)

Sun Mar 14 00:03:18 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellview.c (btk_cell_view_expose): Support the
	model-less use of BtkCellView shown in testcombo.c.

2004-03-13  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdisplay-win32.c: Don't undefine HAVE_MONITOR_INFO
	when compiling with gcc. Mingw's headers do have the required
	definitions.

	* bdk/win32/bdkdrawable-win32.c (draw_polygon): When drawing
	filled polygons, don't draw the outline, similarily as
	draw_rectangle(). Apparently BTK and GIMP don't use
	bdk_draw_polygon() much (or always draw the outline, too), as this
	has gone undetected for so long. Thanks to Bruce Hochstetler.

Sat Mar 13 15:19:17 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.c (btk_window_destroy): Remove
	the window from the toplevel_list here rather in destroy.
	While this is theoretically speaking wrong, it fits
	in better with the current reality that destroyed
	widgets are not reusable. (#126808, Michael Natterer)

Sat Mar 13 21:47:47 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellview.c (btk_cell_view_expose): Don't do anything
	beyond clearing to the background if there is no active row.
	(#137066, reported by Owen Taylor)

Sat Mar 13 21:37:44 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_list_key_press): Pop down the
	list when an item is selected via the keyboard.

2004-03-13  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilesystemunix.c: (remove_trailing_slash),
	(btk_file_system_unix_get_folder),
	(btk_file_system_unix_create_folder), (get_parent_dir),
	(btk_file_system_unix_get_parent), (btk_file_folder_unix_get_info):
	Remove trailing slashes in path names.
	
Sat Mar 13 12:17:16 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkwindow-x11.c (bdk_window_reparent): Make
	this a total no-op when the new or old parent is
	destroyed. (#134230, patch from Soeren Sandmann)

	* bdk/bdkwindow.c (_bdk_window_destroy_hierarchy):
	For foreign windows in our heirarchy, call
	_bdk_windowing_window_destroy_foreign (window) and skip
	all the normal destruction logic.

	* bdk/x11/bdkwindow-x11.c bdk/win32/bdkwindow-win32.c:
	Move code to request destruction of a foreign window
	code into a separate _bdk_windowing_window_destroy_foreign().

	* bdk/x11/bdkwindow-x11.c (bdk_window_impl_x11_finalize):
	Call BDK_WINDOW_DISPLAY() on the wrapper not on the
	impl. (Also from Soeren's patch)

Sat Mar 13 10:49:46 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkdnd.c (_btk_drag_dest_handle_event): For
	BTK_IS_PLUG toplevels, call bdk_window_get_origin() 
	not btk_window_get_position, as a hackround for not
	having accurate notification of window position for
	embedded windows. (#136112, Dan Winship)

Sat Mar 13 10:34:03 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextview.c btk/btktextbuffer.c: Revert last change;
	it causes problems for pastes from other applications; see
	comments in bugzilla for #81880.

Sat Mar 13 02:55:51 2004  Matthias Clasen  <maclas@gmx.de>

	Fix middle button pasting in the TextView  (#81880, reported
	by Evert Verhellen, patch by Paolo Borelli):
	
	* btk/btktextview.c (btk_text_view_button_press_event): Retrieve 
	the insert mark and move the cursor to it making sure of also 
	scroll the window if needed.
	
	* btk/btktextbuffer.c (pre_paste_prep): Move the insert mark
	to the insertion point.

Sat Mar 13 01:38:55 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_remove): Add a remove 
	implemenatation which restores the cell_view when the custom 
	child is removed.  (#136555, Owen Taylor)

Sat Mar 13 00:07:51 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_layout_clear): 
	Keep the cell_list in a consistent state while iterating over it, 
	since clear_attributes() also iterates over it.  (another instance
	of #136585, Morten Welinder)
	
Fri Mar 12 17:20:15 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkarrow.c (btk_arrow_expose): Swap BTK_ARROW_LEFT
	and BTK_ARROW_RIGHT for BTK_TEXT_DIR_LTR. (#129159,
	Semion Chichelnitsky)

	* btk/btkpathbar.c btk/btktoolbar.c: Remove no-longer-needed 
	btk_toolbar_direction-changed handlers and explicit
	flipping of BtkArrow widgets.

Fri Mar 12 23:37:15 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkfilechooserdialog.c
	(file_chooser_widget_default_realized_size_changed): Clamp the
	new size to the screen.

Fri Mar 12 15:06:44 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkexpander.c (btk_expander_realize): Create the
	event_window at the right size using the same logic as
	in size_allocate. (#136994, Niklas Knuttson)

2004-03-12  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkwindow.c (btk_window_activate_focus): Don't ignore the
	return value of btk_widget_activate().
	(btk_window_activate_default): Likewise.  Fixes #137008.

	* btk/btkfilechooserdialog.c (response_cb): Act on positive
	response IDs we recognize, rather than bailing out on cancellation
	ones.  Fixes #136237; patch by Olivier Andrieu
	<oliv__a@users.sourceforge.net>.
	(file_chooser_widget_file_activated): If the dialog doesn't have a
	default widget, try to find a suitable response widget on our own.
	People should *really* be using btk_dialog_set_default_response(),
	but this is to help lazy programmers.

	* btk/btkdialog.c (_btk_dialog_get_response_for_widget): New
	internal function.
	(get_response_data): Add a "create" argument so that we don't
	unconditionally create the response data.

2004-03-12  Morten Welinder  <terra@bunny.org>

	* tests/Makefile.am: Add new testspinbutton.c

2004-03-11  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_drag_set_delete_cursor):
	Put the trash icon on the right for LTR locales, or on the left
	for RTL.
	(shortcuts_drag_motion_cb): Cancel the idle handler here as well.
	(shortcuts_drag_leave_cb): Test whether the idle is present.
	(shortcuts_drag_data_received_cb): Ahem, don't assert here.

Thu Mar 11 17:51:10 2004  Owen Taylor  <otaylor@redhat.com>

	* modules/input/btkimcontextxim.c (preedit_done_callback):
	Clear preedit string and emit preedit_changed as needed
	on AIX. (#130617, Philip K Warren)

2004-03-11  Morten Welinder  <terra@bunny.org>

	* btk/btkpathbar.c (_btk_path_bar_set_file_system): Plug leak.

Thu Mar 11 16:28:15 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmenu.c (btk_menu_get_toplevel): Fix attach/attach->parent
	type. (#136919, Tim Mooney)

Thu Mar 11 16:18:51 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserdefault.c (shortcuts_insert_path): revert
	earlier change to insert_path so that we test that the directory
	exists.

	* btk/btkfilechooserdialog.c
	(btk_file_chooser_dialog_constructor): move focus.

Thu Mar 11 22:12:14 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkspinbutton.c (btk_spin_button_size_request): Use the same
	logic as BtkEntry when calculating border width.  (#116368, reported
	by Morten Welinder)

Thu Mar 11 15:59:05 2004  Owen Taylor  <otaylor@redhat.com>

	* tests/testbtk.c (create_spins): Use btk_entry_set_width_chars()
	rather than btk_widget_set_size_request().

2004-03-11  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (remove_settings_signal): New
	function, copied from btkpathbar.c.
	(btk_file_chooser_default_dispose): Use remove_settings_signal()
	rather than our own code.
	(btk_file_chooser_default_screen_changed): Use
	remove_settings_signal(); this should handle per-screen settings
	correctly.

Thu Mar 11 14:07:18 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btklabel.c (btk_label_focus): Fix a missing return
	value.

Thu Mar 11 13:58:24 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmessagedialog.c btk/btklabel.c: Back out the
	put-labels-into-the-standard-focus-chain patches 
	from bug #59707.

	* btk/btklabel.c (btk_label_focus): Only put the
	label in the tab chain when the control key is pressed.

2004-03-11  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (error_message_with_parent): Use a
	single OK button, not a Close button, as per the HIG.

	* btk/btkfilesel.c (btk_file_selection_fileop_error): Likewise.

2004-03-11  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_drag_motion_cb): Oops,
	initialize "action" before jumping.  Fixes #136900.

2004-03-11  Mark McLoughlin  <mark@skynet.ie>

	* btk/btksettings.c: (apply_queued_setting): don't overwrite
	application properties. Fixes bug #136802.

2004-03-11  Dov Grobgeld  <dov@imagic.weizmann.ac.il>

	* btk/btktextlayer.c: (btk_text_layout_set_buffer): Added
	call to btk_text_layout_update_cursor_line() to solve in 
	problem of switching keyboard direction at widget creation:
	bug #136680

Thu Mar 11 10:28:30 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooserembed.c (delegate_initial_focus): Remove
	stray 'return' statement. (#136855, David L. Cooper II)

2004-03-11  Mark McLoughlin  <mark@skynet.ie>

	* btk/btkstyle.c: (btk_default_draw_expander): Use the PRELIGHT
	fg color for drawing the expander when prelit. Fixes problem
	with the HighContrast theme: bug #136789.

2004-03-11  Federico Mena Quintero  <federico@ximian.com>

	Fix #135912 and #135913.

	* btk/btkfilechooserdefault.c
	(shortcuts_filter_model_row_draggable): Implement.
	(shortcuts_model_filter_new): New function, create a
	ShortcutsModelFilterClass derived from BtkTreeModelFilter, so that
	we can implement our own DnD interface methods.
	(shortcuts_model_create): Use shortcuts_model_filter_new().
	(shortcuts_list_create): Enable the shortcuts list as a drag
	source.
	(file_list_source_targets): Renamed from shortcuts_targets.
	(shortcuts_list_create): Change the options for
	btk_drag_dest_set().  Connect to more drag signals so that we can
	implement drops by hand.
	(shortcuts_drag_data_delete_cb): New handler; just stop the emission.
	(shortcuts_drag_motion_cb): New handler; validate the drop.
	(shortcuts_drag_leave_cb): New handler; unset the drag_dest_row.
	(shortcuts_drag_drop_cb): New handler; just stop the emission and
	remove the idle handler for the drag cursor.
	(shortcuts_add_bookmark_from_path): Add a position argument,
	return a boolean success code.
	(shortcuts_drag_data_received_cb): Handle two cases:  1) Insert
	the bookmarks at the proper position, rather than always appending
	them to the list; 2) alternatively, reorder the bookmarks.
	(struct _BtkFileChooserDefault): New field shortcuts_drag_outside.
	(shortcuts_drag_motion_cb): Turn off impl->shortcuts_drag_outside.
	(shortcuts_drag_leave_cb): Turn on impl->shortcuts_drag_outside in
	an idle handler.
	(shortcuts_drag_end_cb): New handler; remove the selected bookmark.

Thu Mar 11 01:08:25 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (location_entry_create): up the
	width of the entry a tad.

	* btk/btkfilechooserentry.c (btk_file_chooser_entry_init): use
	btk_entry_completion_selection_changed.  Also, unref the
	completion as we were leaking a reference to it.

2004-03-10  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkstyle.c (draw_dot): Remove spurious semicolon.  Thanks to
	Kjartan Maraas for pointing it out.

Wed Mar 10 23:40:15 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (_btk_entry_completion_popup): Set the
	background on the action view cell renderer here, not in init, so 
	that a) we catch style changes, and b) we get the real style, not 
	the default one. Partial fix for #127648, reported by Dave Bordoley.

2004-03-10  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (build_key_event_state): Set also
	the pointer button bits. (#136636, Dave Neary)

	* bdk/win32/bdkwindow-win32.c (show_window_internal): Show
	transparent (input only) windows using SetWindowPos(). (#132331,
	John Ehresman)

	(bdk_window_set_type_hint): For splash screens, remove the resize
	handles, menu, and minimize/maximize/close buttons. (#132896)

Wed Mar 10 22:30:23 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellview.c (btk_cell_view_cell_layout_clear): Keep the
	cell_list in a consistent state while iterating over it, since
	clear_attributes() also iterates over it.  (#136585, Morten Welinder)

2004-03-10  Mark McLoughlin  <mark@skynet.ie>

	* btk/btkexpander.c: (btk_expander_expose): don't propagate
	the expose to the label. The expose handler for BtkContainer
	already does that. Fixes bug #136719. Reported by Dennis
	Cranston, exact cause nailed down by Owen.

2004-03-10  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (list_mtime_data_func): Use an
	untranslatable "%x" for dates, rather than a custom format.  Fixes
	#136357.

2004-03-10  Morten Welinder  <terra@bunny.org>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_add_shortcut_folder): Test validity of
	path here.
	(shortcuts_insert_path): Don't check here.
	(get_file_info): Barf if name-only fails.

	* tests/testfilechooser.c (main): Add support for --multiple.

Wed Mar 10 02:41:05 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c: (btk_path_bar_init), (btk_path_bar_class_init),
	(remove_settings_signal), (btk_path_bar_dispose),
	(btk_path_bar_style_set), (btk_path_bar_screen_changed),
	(btk_path_bar_scroll_up), (reload_icons), (change_icon_theme),
	(settings_notify_cb), (btk_path_bar_check_icon_theme),
	(get_button_image), (btk_path_bar_update_button_appearance),
	(make_directory_button), (btk_path_bar_check_parent_path): Support
	changes in icon themes.

	* btk/btkpathbar.h: add two elements

	* tests/testfilechooser.c: (main): use bunny-vfs method again to
	get more testing.

Wed Mar 10 01:17:40 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c: added 'Desktop' to the list of volumes.  We
	don't have any more untranlated strings in the dialog.

Wed Mar 10 00:24:24 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (error_dialog): use uri instead of
	the pathname for UTF-8 safety.

Wed Mar 10 00:10:47 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (shortcuts_insert_path): Always
	check to see if the shortcuts exists.  We don't want to put
	invalid dirs in the shortcuts pane.

Tue Mar  9 16:40:34 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	remove unneeded shortuts_swin;

Wed Mar 10 01:49:27 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #136614 in a better way:
	
	* btk/btkoptionmenu.c (btk_option_menu_init): Undo the last change.
	* btk/btkbutton.c (struct _BtkButtonPrivate): Add a flag, align_set.
	* btk/btkbutton.c (btk_button_init): Initialize align_set to 0.
	* btk/btkbutton.c (maybe_set_alignment): Rework to only set the
	alignment if priv->align_set is set.
	* btk/btkbutton.c (btk_button_set_alignment): Set align_set to 1.

Wed Mar 10 01:21:05 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_position_below): Place
	grid mode popups left aligned, not right aligned.

Tue Mar  9 23:09:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkoptionmenu.c (btk_option_menu_init): Avoid centering 
	the label that is reparented from the menuitem.  (#136614, Dennis
	Cranston)

Tue Mar  9 16:19:09 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c (struct _ButtonData): Encapsulate all of the
	information about a button in a struct instead of ugly
	g_object_set_data.
	(btk_path_bar_size_request): Use ButtonData.
	(btk_path_bar_update_slider_buttons): ditto
	(btk_path_bar_size_allocate): ditto
	(btk_path_bar_remove): ditto
	(btk_path_bar_forall): ditto
	(btk_path_bar_scroll_down): ditto
	(btk_path_bar_clear_buttons): ditto
	(button_clicked_cb): ditto.  Also, add an ignore_changes variable
	(button_data_free): destroy ButtonData
	(update_button_appearance): Use ButtonData
	(make_directory_button): ditto
	(btk_path_bar_check_parent_path): ditto
	(_btk_path_bar_set_path): ditto

2004-03-09  Federico Mena Quintero  <federico@ximian.com>

	Fix #136533.

	* btk/btkfilechooserdefault.c (shortcuts_reload_icons): New
	function.
	(check_icon_theme): New helper function, installs a handler for
	changes in the icon theme.
	(btk_file_chooser_default_style_set): Use check_icon_theme().
	(btk_file_chooser_default_screen_changed): Use check_icon_theme().
	(btk_file_chooser_default_dispose): Disconnect from BtkSettings.
	(change_icon_theme): New function, updates impl->icon_size and
	reloads the icons.
	(struct _BtkFileChooserDefault): New field settings_signal_id.
	(struct _BtkFileChooserDefault): New field icon_size.
	(shortcuts_insert_path): Use impl->icon_size.
	(list_icon_data_func): Likewise.

2004-03-09  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (get_file_info): Handle the returned
	parent_path being NULL.  Fixes #136662.

2004-03-09  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_drag_data_received_cb):
	Stop the emission so that BtkTreeView's handler won't try to poke
	the filter model.  Fixes #136127.

Tue Mar  9 13:49:14 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkstyle.c (btk_paint_polygon): Fix 
	g_return_if_fail() that was checking draw_shadow.
	(#136669, Morten Welinder)

Tue Mar  9 09:57:25 2004  Owen Taylor  <otaylor@redhat.com>

	* === Released 2.3.6 ===

	* configure.in: Version 2.3.6, interface age 0.

	* NEWS: Updates

Tue Mar  9 11:01:45 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c (btk_path_bar_finalize): unref the correct
	icon.  Reported by Michael Natterer <mitch@gimp.org>.

2004-03-09  Morten Welinder  <terra@bunny.org>

	* tests/testfilechooser.c (main): Destroy widgets to reveal leaks.

Tue Mar  9 02:11:50 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c Fix bug 136446. [Marco Pesenti Gritti]
	(struct _BtkMenuPrivate): Add boolean destroying
	(btk_menu_destroy): Set priv->destroying
	(btk_menu_remove): don't update the table information when the
	menu is being destroyed.

	* btk/btkmenu.c (btk_menu_set_monitor): Formatting fix

	* btk/btktoolbar.[ch]: Some formatting fixes

Tue Mar  9 01:25:10 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkframe.c (btk_frame_paint): Fix a typo.

2004-03-08  Federico Mena Quintero  <federico@ximian.com>

	Fixes #136080.

	* btk/btkfilesystemunix.c: Only lstat() if stat() failed due to
	ENOENT.
	(filename_get_info): Likewise.

2004-03-08  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_initial_focus): Use
	btk_tree_view_set_cursor().

2004-03-08  Federico Mena Quintero  <federico@ximian.com>

	Patch "1a" from #136185, by Morten Welinder.

	* btk/btkfilechooserdefault.c (get_file_info): Take in an argument
	that says whether the caller just wants the display name.
	(shortcuts_insert_path): We only want the name in the call to
	get_file_info().

	* btk/btkpathbar.c (_btk_path_bar_set_path): Don't request more
	info than needed from the file_folder.

2004-03-08  Federico Mena Quintero  <federico@ximian.com>

	Fixes #136105.

	* btk/btkfilechooserembed.h (struct _BtkFileChooserEmbedIface):
	Added an ::initial_focus() method.

	* btk/btkfilechooserembed.c
	(_btk_file_chooser_embed_delegate_iface_init): Set the
	initial_focus method.
	(delegate_initial_focus): Implement.
	(_btk_file_chooser_embed_initial_focus): New function.

	* btk/btkfilechooserdialog.c
	(btk_file_chooser_dialog_constructor): Call
	_btk_file_chooser_embed_initial_focus().

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_init):
	Install the ::initial_focus() handler.
	(btk_file_chooser_default_initial_focus): Implement.

2004-03-08  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (update_from_entry): Return a
	boolean success code.
	(location_popup_handler): Refocus the file chooser if appropriate.
	Fixes #135905.
	(save_widgets_create): Don't set the text of the save_folder_label
	here.
	(update_appearance): Set the text here as appropriate for the save
	mode.  Also fixes #136387.
	(update_appearance): Don't show the Create Folder button in
	SELECT_FOLDER mode.
	(update_appearance): Show the extra widget in all Save modes
	correctly.

Mon Mar  8 11:57:27 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_unset_model): Don't
	call g_signal_handler_disonnect() if priv->model is
	NULL. (#136551, Damon Chaplin)

	* btk/btkcombobox.c (btk_combo_box_model_row_inserted):
	Back out code to set the active item when the first
	item is added to the model; this causes problems for
	BtkComboBoxText. (#136535)

	* btk/btkcombobox.c (btk_combo_box_menu_destroy)
	* btk/btkcombobox.c (btk_combo_box_list_destroy):
	* btk/btkcombobox.c (btk_combo_box_list_setup): 
	* btk/btkcombobox.c (btk_combo_box_menu_setup): 
	Remove calls to btk_combo_box_unset_model.

	* btk/btkcombobox.c (btk_combo_box_check_appearance): 
	Clean up handling of wrap->width > 0.

	* btk/btkcombobox.c (btk_combo_box_relayout): Don't
	switch list/menu mode here.

	* btk/btkcombobox.c (btk_combo_box_set_model): Protect
	against the same model being set back.

	* btk/btkcombobox.c (btk_combo_box_relayout): Call
	btk_combo_box_menu_fill() rather than duplicating
	a large chunk of code.

2004-03-08  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilesystemmodel.c (btk_file_system_model_get_flags): 
	If max_depth is 0 then we have a list.

2004-03-08  Morten Welinder  <terra@bunny.org>

	* btk/btkpathbar.c (_btk_path_bar_set_path): If we fail, leave
	widget unchanged.  Explicitly verify final directory.

	* btk/btkfilesystemunix.c (btk_file_system_unix_create_folder,
	get_icon_type, filename_get_info): Protect errno.

2004-03-08  Marco Pesenti Gritti  <marco@bunny.org>

	* btk/btkentry.c: (btk_entry_completion_key_press):

	When an action is selected stop the event to be propagated
	otherwise the activate signal is emitted too. (Bug #133394)

Mon Mar  8 04:50:12 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (create_path_bar): new function to
	consolidate creating the path_bar.
	(btk_file_chooser_default_set_current_folder): no longer need to
	pass in the filesystem.

	* btk/btkpathbar.h: Removed unused set_pixbuf functions in favor
	of just setting the filesystem.

	* btk/btkpathbar.c (btk_path_bar_finalize): Free root path and
	home_dir.
	(get_button_image): Add images to path_bar.
	(update_button_appearance): use images
	(make_directory_button): Clasify buttons based upon location.
	(_btk_path_bar_set_path): no longer need a file-system.  Also, add
	rerooting, #135845, #135914

	* tests/testfilechooser.c: Fix reused error handling.

2004-03-08  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilesystemunix.c: (get_icon_for_directory),
	(btk_file_system_unix_render_icon):
	Use better icons for home and desktop.

2004-03-08  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilechooserentry.c:
	(_btk_file_chooser_entry_set_base_folder):
	Set the base folder path in the entry.
	
2004-03-08  Christian Neumair  <chris@bunny-de.org>

	* tests/testentrycompletion.c: Fix typo.

2004-03-08  Tor Lillqvist  <tml@iki.fi>

	* README.win32: Update.

	* btk/btk.def: Small update. Thanks to J. Ali Harlow. Re-sorted.

	* tests/testfilechooser.c: Correct localtime_r() emulation on
	Win32. Remove a couple of unnecessary Win32-only includes.

Mon Mar  8 01:06:17 2004  Matthias Clasen  <maclas@gmx.de>

	* tests/testentrycompletion.c: Test dynamic addition/removal. 

Sun Mar  7 22:38:49 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkframe.c (btk_frame_paint): Use ythickness, not 
	xthickness in the calculation of vertical dimensions.

Sun Mar  7 17:38:03 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkbutton.c (btk_button_class_init): actually use
	btk_button_add.

	* btk/btkfilechooserdefault.c (error_building_filename_dialog):
	use the uri, not the path, #136317
	(renderer_edited_cb): ditto
	(shortcuts_add_bookmark_from_path): ditto
	(remove_bookmark_button_clicked_cb): ditto
	(btk_file_chooser_default_remove_shortcut): ditto
	(update_from_entry): ditto
	(up_folder_handler): ditto

Sun Mar  7 16:07:08 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_init): set
	redraw_on_allocate, #135902.

	* btk/btkfilesystemmodel.c (model_refilter_recurse): Patch from
	Damon Chaplin to set a node to be visible before emitting the
	inserted signal, #135555.

Sun Mar  7 22:24:28 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkbutton.c (_btk_button_paint): Don't use xthickness in the
	height calculation.

Sun Mar  7 14:34:04 2004  Jonathan Blandford  <jrb@bunny.org>

	Fixes #121500.

	* btk/btkfilechooserdefault.c (trap_activate_cb): stop activate
	from unselecting rows when pressed in multiple-selection mode.

2004-03-07  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkproperty-win32.c (bdk_screen_get_setting) :
	some more settings from system, also reflect some name changes
	done a while ago in the x11 backend

	* bdk/win32/makefile.msc : build bdkspawn-win32.c

	* btk/btkdnd.c : btk_drag_source_[gs]et_target_list, added "Since: 2.4"

	* btk/makefile.msc.in : build btkpathbar, link shell32.lib

	* tests/makefile.msc : some more tests get build

Sun Mar  7 03:03:57 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_paths): if action is
	SELECT_FOLDER, then return the currentd folder if none is
	selected.
	(btk_file_chooser_default_should_respond): Allow 'Ok' to be hit if
	no directory is selected in SELECT_FOLDER mode.

Sat Mar  6 23:31:18 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	remove unneeded elements.
	(tree_selection_changed): removed
	(tree_name_data_func): removed
	(btk_file_chooser_default_finalize): don't unref dir model
	(create_folder_tree): removed
	(get_selection): no longer need to abstract away the selection
	function.
	(create_file_list): We now create a tree for all actions.
	(file_pane_create): Make one tree.
	(update_appearance) We really change the mode only, now.

Sun Mar  7 02:38:00 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_size_request): Do a 
	size_request on the button and cell_view_frame, otherwise
	their style will still be the default here in the initial 
	size_request. (#136301, Mark McLoughlin)

2004-03-06  Gustavo J. A. M. Carneiro  <gustavo@users.sourceforge.net>

	* btk/btktoolbar.c (internal_insert_element): Check return value
	of btk_stock_lookup; if stock lookup fails, just use stock_id as
	label, instead of crashing. Fixes #136202.

2004-03-05  Federico Mena Quintero  <federico@ximian.com>

	* bdk/linux-fb/bdkglobals-fb.c: Make <config.h> the very first
	include.
	* bdk/linux-fb/bdkwindow-fb.c: Likewise.
	* bdk/linux-fb/bdkinput.c: Likewise.

2004-03-05  Federico Mena Quintero  <federico@ximian.com>

	Fixes #136082 and #135265, patch by Morten Welinder.

	* configure.in: Use AC_SYS_LARGEFILE.

	* */*.c: #include <config.h>

2004-03-05  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_select_path): No need to have a
	temporary error variable.

2004-03-05  Tor Lillqvist  <tml@iki.fi>

	* configure.in: Move check for native Win32 (mingw) a bit
	earlier. If Win32, disable static builds (as in GLib). Remove
	unnecessary AC_LIBTOOL_WIN32_DLL.

	* bdk/bdk.def: Add missing entries, thanks to J. Ali Harlow.

	* bdk/win32/bdkcursor-win32.c (color_is_white): const-correctness.

	(bdk_cursor_new_from_pixbuf): Copy of the non-Xcursor X11
	implementation.

	(bdk_display_supports_cursor_alpha,
	bdk_display_supports_cursor_color): Dummy implementations.

	(bdk_display_get_default_cursor_size,
	bdk_display_get_maximal_cursor_size): Implement.

	* bdk/win32/bdkdisplay-win32.c (bdk_display_get_default_group):
	Dummy implementation.

	* bdk/win32/bdkevents-win32.c (bdk_net_wm_supports): Dummy
	implementation.

	* bdk/win32/bdkfont-win32.c (bdk_font_get_display): Implement.

	* bdk/win32/bdkinput-win32.c (bdk_input_motion_events): Remove,
	not in API.

	* bdk/win32/bdkwindow-win32.c (bdk_window_get_group): Dummy
	implementation.

Fri Mar  5 18:00:36 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserdefault.c (new_folder_button_clicked): scroll
	to the new path.

	* btk/btktreeview.c (btk_tree_view_adjustment_changed): Update the
	allocation when scrolling instead of cancelling editing.

Fri Mar  5 23:52:34 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_set_modify_func): 
	Improve the docs.  (#127727, Murray Cumming)

Fri Mar  5 23:37:16 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_set_reorderable): Clarify the
	doc comment.  (#118602)

Fri Mar  5 22:37:15 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkbutton.c (btk_button_construct_child): Don't let
	the priv->image pointer dangle.  (#136259, Padraig O'Briain)

2004-03-05  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserprivate.h (struct _BtkFileChooserIface): Add
	gboolean return values and GError arguments to
	::set_current_folder() and ::select_path().

	* btk/btkfilechooser.c (btk_file_chooser_set_current_folder):
	Return a boolean value for success/failure.
	(btk_file_chooser_set_current_folder_uri): Likewise.
	(btk_file_chooser_select_filename): Likewise.
	(btk_file_chooser_select_uri): Likewise.
	(btk_file_chooser_set_filename): Likewise.
	(btk_file_chooser_set_uri): Likewise.
	(_btk_file_chooser_set_current_folder_path): Likewise, plus take
	in a GError.
	(_btk_file_chooser_select_path): Likewise.

	* btk/btkfilechooserutils.c (delegate_set_current_folder):
	Likewise.
	(delegate_select_path): Likewise.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_select_path): Likewise.
	(btk_file_chooser_default_set_current_folder): Likewise; this also
	fixes #136024.
	(error_changing_folder_dialog): New helper function.
	(change_folder_and_display_error): New helper function.
	(switch_to_selected_folder): Use change_folder_and_display_error().
	(tree_selection_changed): Likewise.
	(shortcuts_activate_volume): Likewise.
	(shortcuts_activate_item): Likewise.
	(list_row_activated): Likewise.
	(path_bar_clicked): Likewise.
	(update_from_entry): Likewise.
	(up_folder_handler): Likewise.
	(home_folder_handler): Get the home path from the shortcuts model,
	and use change_folder_and_display_error().

	* tests/testfilechooser.c (set_current_folder): New helper
	function; pops up a simple error dialog if necessary.
	(set_filename): Likewise.
	(set_folder_nonexistent_cb): Use set_current_folder().
	(set_folder_existing_nonexistent_cb): Likewise.
	(set_filename_nonexistent_cb): Use set_filename().
	(set_filename_existing_nonexistent_cb): Likewise.

Fri Mar  5 11:17:35 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktreemodel.c (btk_tree_row_reference_new_proxy): 
	Improve the docs (reported by Vitaly Tishkov, 
	#74362) Add some comments to the code about the 
	row reference handling that are hopefully not entirely
	wrong.

2004-03-05  Michael Natterer  <mitch@gimp.org>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_show_all):
	s/object/widget/. Makes it compile again.

Fri Mar  5 03:37:14 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_show_all):
	chain to the extra_widget.

Fri Mar  5 02:53:41 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_finalize):
	Patch from Damon Chaplin to free models when we're finalized,
	#134053

2004-03-05  Alexander Larsson  <alexl@redhat.com>

	* btk/btkfilesystem.c (btk_file_system_get_volume_for_path):
	Document the fact that there might not be a volume for all
	paths.

	* btk/btkfilechooserdefault.c (shortcuts_add_current_folder):
	Don't assume there is a volume for all paths.

Fri Mar  5 01:45:04 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (shortcuts_append_paths): insert in
	the correct place instead of naïvely appending.
	(shortcuts_add_volumes): refilter the model
	(shortcuts_add_bookmarks): refilter the model
	(btk_file_chooser_default_add_shortcut_folder): refilter the model

2004-03-04  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdialog.c (response_cb):  New handler.  Ask the
	BtkFileChooser widget if it wants to do something special rather
	than letting us terminate the dialog.
	(btk_file_chooser_dialog_init): Connect to "response"; see the
	comment in the sources to see why we don't override the method in
	class_init.

	* btk/btkfilechooserembed.h (struct _BtkFileChooserEmbedIface):
	Added a ::should_respond() method.

	* btk/btkfilechooserembed.c
	(_btk_file_chooser_embed_delegate_iface_init): Add a delegate for ::should_respond().
	(delegate_should_respond): New delegate.
	(_btk_file_chooser_embed_should_respond): New function.

	* btk/btkfilechooserdefault.c (set_list_model, create_file_list):
	Use dashes in signal names rather than underscores.
	(btk_file_chooser_default_init): Hook up our ::should_respond() implementation.
	(btk_file_chooser_default_should_respond): Implement.  go into a
	folder rather than responding if we are in File mode and the
	selected file is a folder.
	(get_selection): New helper function.
	(add_bookmark_button_clicked_cb): Use get_selection().
	(bookmarks_check_add_sensitivity): Likewise.
	(btk_file_chooser_default_get_paths): Likewise.
	(check_save_entry): New helper function.
	(btk_file_chooser_default_get_paths): Use check_save_entry().
	(selection_check): Renamed from selection_is_folders().  Now
	checks whether the selection is empty, all files, all folders.
	(bookmarks_check_add_sensitivity): Use selection_check().

Fri Mar  5 00:05:59 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_list_setup): 
	* btk/btkcombobox.c (btk_combo_box_menu_setup): Connect to 
	key_press_event and handle Alt-Down/Alt-Up to show or hide the
	list popup. Also handle Down/Up/PageDown/PageUp/Home/End and 
	make them change the active item without popping up the list.
	These keybindings are inherited from BtkCombo. 

Thu Mar  4 23:15:58 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_position): Initially 
	select the active item when using optionmenu-like positioning. 

Thu Mar  4 16:54:30 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkrc.c (btk_rc_check_pixmap_dir): Don't
	open/close the file, just check for existence
	with g_file_test(). This is considerably cheaper,
	and lack-of-permissions for pixmap dirs is 
	pathological.

Wed Mar  3 17:53:21 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btksocket.c (btk_socket_class_init): Overide
	show_all/hide_all to be btk_widget_show/btk_widget_hide,
	since we don't want to propagate to the in-process
	plug, if any. (#122949, Michael Meeks)

Thu Mar  4 15:20:55 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (update_appearance): show the 'New
	Folder' button in SAVE mode again.

Thu Mar  4 21:53:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconfactory.c (copy_cache): Increment the reference
	count of the style when copying the cached icon.  (#135890, Crispin
	Flowerday)

Thu Mar  4 21:45:43 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c: In list mode, set the background color 
	of the cell view to the base color of the style, instead of
	hardwiring white. (#136158)

Thu Mar  4 01:32:19 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c (btk_path_bar_set_path): Modified patch from
	muppet <scott@asofyet.org> to keep child directories around if we
	change to a child.

	* btk/btkpathbar.c (_btk_path_bar_set_home_icon): Start of
	icon-setting functions.  Not used yet.
	(_btk_path_bar_set_root_icon): Ditto.
	
Thu Mar  4 00:31:54 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (extend_selection): 
	* btk/btktextview.c (btk_text_view_move_cursor_internal): Allow
	to select the last word in the buffer.  (#135487, Paolo Borelli)

Wed Mar  3 23:54:31 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c: Doc update.

Wed Mar  3 17:30:18 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.c (btk_window_mnemonic_activate): Check
	whether widgets are viewable, not just if they are
	mapped. (#122912, reported by Tim Evans)

Wed Mar  3 23:28:48 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_set_active): Move the actual
	implementation into a new btk_combo_box_set_active_internal() 
	function, which doesn't do the short-circuiting. 
	* btk/btkcombobox.c (btk_combo_box_model_row_deleted): Use
	set_active_internal() here, since the active item may change here,
	although the index is unchanged.

Wed Mar  3 23:26:49 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_position): Reintroduce the
	traditional option menu placement of the popup for regular combo
	boxes. Grids and editable combo boxes use the combo-like placement 
	below the entry.  (#136021)
	* btk/btkcombobox.c (btk_combo_box_menu_button_press): 
	* btk/btkcombobox.c (btk_combo_box_popup): Call btk_menu_set_active()
	before popping up the menu, to make the placement work.
	
Wed Mar  3 17:20:15 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmain.c (btk_propagate_event): Special case
	scroll events so that they propagate up the widget
	heirarchy when received on insensitive widgets.
	(#101102, reported by Geoff Reedy)

Wed Mar  3 16:47:10 2004  Owen Taylor  <otaylor@redhat.com>

	 #109594, reported by Olivier Ripoll

	* btk/btkentry.c (btk_entry_size_request): Use max of 
	width and digit width for btk_entry_set_width_chars,
	and round up.

	* btk/btkcolorsel.c (btk_color_selection_init): Set the
	width of the entry to 7 chars.

Wed Mar  3 16:00:10 2004  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Strip out the "export-dynamic" libtool
	option from library link lines. (#124687, James Henstridge)

Wed Mar  3 16:06:03 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (save_folder_combo_changed_cb):
	Don't activate the combo if we're in the midst of changing
	folders.

2004-03-03  Mark McLoughlin  <mark@skynet.ie>

	* tests/testsocket_common.c: (print_hello): don't try and store
	pointers in ints. Fixes 64-bit build.

2004-03-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystem.c (btk_file_system_get_parent): Simplify by
	not using a temporary variable, and clarify the documentation.
	Fixes #136008.

2004-03-03  Mark McLoughlin  <mark@skynet.ie>

	* btk/btkexpander.c:
	(btk_expander_enter_notify), (btk_expander_leave_notify),
	(btk_expander_set_label_widget): Set the label widget's
	state to prelight if we're prelit. Fixes bug #136078.

2004-03-03  Murray Cumming  <murrayc@murrayc.com>

	* btk/btkradiobutton.h, radiomenuitem.h: Corrected the group_changed
	signal vfunc declaration, adding the first parameter, which is the
	widget emitting the signal.

2004-03-03  Morten Welinder  <terra@bunny.org>

	* tests/testfilechooser.c (update_preview_cb): Plug leak.

Tue Mar  2 23:39:55 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdialog.c
	(file_chooser_widget_default_realized_size_changed): Split
	function into realized and unrealized variants, and consolidate
	the handling fo size-changing and default changing.

	* btk/btkfilechooserembed.[ch] (btk_file_chooser_embed_class_init):
	remove resizable-hints-changed, as it just complicated things.

	* btk/btkfilechooserdefault.c (update_appearance): Don't emit
	resizable-hints-changed.
	
2004-03-03  Tor Lillqvist  <tml@iki.fi>

	* btk/btk.def: Add a missing entry. (#135982, J. Ali Harlow)

	* NEWS: Correct spelling of my name in one place.

2004-03-02  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_set_current_folder): Handle errors in
	setting the path bar's path.  Fixes #136000, based on a patch by
	Morten Welinder.

	* btk/btkfilesystemunix.c (btk_file_system_unix_insert_bookmark):
	Don't free our own propagated error.

	* btk/btkpathbar.c (btk_path_bar_set_path): Likewise, and free the
	parent_path upon error.  Fixes #136006, patch by Morten Welinder.
	(btk_path_bar_set_path): Unref the file_folder upon error.
	(btk_path_bar_set_path): Return a boolean success code.

Wed Mar  3 00:28:59 2004  Matthias Clasen  <maclas@gmx.de>

	* tests/testcombochange.c: Add an animation mode, to test 
	how the combobox behaves if the model changes while it is popped
	up.

Tue Mar  2 17:06:05 2004  Owen Taylor  <otaylor@redhat.com>

	* === Released 2.3.5 ===

	* NEWS: Updates

	* configure.in: Version 2.3.5, interface age 0.
	Require bunnylib-2.3.5, bango-1.3.5.

Tue Mar  2 23:08:12 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (_btk_entry_completion_popup): Avoid
	popping up the completions across the edge of the monitor.
	Part of #135561.

Tue Mar  2 16:47:40 2004  Owen Taylor  <otaylor@redhat.com>

	* tests/testfilechooser.c (set_filename_existing_nonexistent_cb): 
	Move the /nonexistant stuff out of the main window,
	keep the main window somewhat normal looking.

Tue Mar  2 16:18:43 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktreestore.c (btk_tree_store_reorder)
	* btk/btkliststore.c (btk_list_store_reorder): Fix
	up the interpretation of new_order to match what
	it means elsewhere, document the meaning of new_order.

	* btk/btkcombobox.c (btk_combo_box_model_rows_reordered):
	Fix interpretation of new_order.

	* tests/testcombochange.c (on_reorder): Fix interpretation
	of new_order.

	* tests/testcombochange.c (on_reorder): Fix hitting
	"reorder" with an empty list.

Tue Mar  2 21:23:30 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Patch from Frederic Crozat, test code from Jean-Philippe
	Chancelier. Fixes bug #120479.
	
	* btk/btkcombo.c (btk_combo_popup_list): Make sure popup belongs
	to the right window group.

	* btk/btkmenu.c (btk_menu_popup): Same

	* tests/testsocket.c (main): Pack the plugs into an hbox instead
	of a vbox.

	* tests/testsocket_common.c: Add a BtkMenuBar, a BtkCombo and a
	BtkComboBox to the children.

Tue Mar  2 14:38:23 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_model_row_inserted):
	If the model was empty before, select the first inserted
	item.

	* btk/btkcombobox.c (btk_combo_box_model_row_deleted):
	Fix up the logic for the new row to select.

	* btk/btkcombobox.c (btk_combo_box_class_init):
	Rename "appearance" property to "appears-as-list".

	* tests/testcombochange.c tests/Makefile.am: Test case
	for combos and dynamically changing models.

Tue Mar  2 15:19:52 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_resizable_hints): set the default
	value, spotted by Morten Welinder.

Tue Mar  2 15:03:15 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_resizable_hints): get the logic
	correct.  This will fix sizing on save dialogs.

	(save_widgets_create): set_mnemonic_widget.

2004-03-02  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_set_current_folder): Don't update the
	save folder combo if we are already switching folders; based on a
	patch by Jonathan Blandford.

	* btk/btkfilechooserdefault.c (shortcuts_add_current_folder):
	Handle failure to insert the path.  Based on a patch by Morten
	Welinder attached to bug #135380.

	* tests/testfilechooser.c (extra_widget_create): Add a bunch of
	buttons to test various things.

Tue Mar  2 20:59:23 2004  Matthias Clasen  <maclas@gmx.de>

	* tests/Makefile.am: Add testentrycompletion.

	* tests/testentrycompletion.c: New file to test some of the
	more bexotic BtkEntryCompletion features.

Tue Mar  2 14:38:10 2004  Jonathan Blandford  <jrb@redhat.com>

	* tests/testfilechooser.c (main): improve tests a little.

Tue Mar  2 11:45:50 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkcombobox.c: Always connect to the changed
	signals on the model, update the active item as
	appropriate when rows are inserted/deleted/reordered,
	re-layout the menu on ::rows-reordered.

	* btk/btkcellview.c (btk_cell_view_set_displayed_row):
	Allow %NULL for path to unset and leave no current
	path.

Tue Mar  2 19:54:53 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_list_position): Position
	the popup above the sample if there is not enough room below.
	Part of #135543.

Tue Mar  2 19:53:36 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_set_popup_widget): Make the 
	frame for the list mode etched in, to give the popup a slightly
	less flat appearance. 

Tue Mar  2 17:55:31 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btk.def: Add btk_combo_box_entry_new_text().  

2004-03-02  Morten Welinder  <terra@bunny.org>

	* tests/testfilechooser.c (size_prepared_cb): Don't scale images
	that are small enough to fit.  Avoid using incompatibly typed data
	pointer.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_resizable_hints): Test the
	resize_horizontally pointer, not the deferenced pointer.

2004-03-01  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault): New
	flag shortcuts_current_folder_is_volume.
	(shortcuts_add_current_folder): Set
	impl->shortcuts_current_folder_is_volume as appropriate.
	(remove_current_folder_cb): Handle the flag.
	(shortcuts_activate_item): Likewise.
	(shortcuts_update_current_folder): Handle the
	impl->shortcuts_current_folder_active flag; only add the folder if
	it doesn't already exist in the list.
	(shortcuts_model_create): Don't insert the current folder
	separator here.
	(shortcuts_add_current_folder): Insert the separator here.
	(shortcut_find_position): Renamed from shortcut_exists(); now
	returns an index.
	(shortcuts_add_current_folder): Set the active item in the combo.

2004-03-01  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_row_activated_cb): Eep,
	use btk_tree_model_filter_convert_iter_to_child_iter(), not the reverse.

2004-03-01  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_model_create): Don't
	unref an old model; there isn't one.  This was a leftover from
	when we recreated the model on every change.
	(save_widgets_create): Create the save folder combo.
	(shortcuts_model_create): Don't set the model on the tree view
	here.
	(btk_file_chooser_default_constructor): Create the shortcuts model
	here, before the rest of the widgets.
	(shortcuts_list_create): Don't call shortcuts_model_create() here;
	just set the model on the tree.
	(save_folder_combo_create): New function, provided by Jonathan
	Blandford.
	(update_appearance): Set the sensitivity of the folder combo.
	(shortcuts_activate_iter): New helper function; code moved from
	shortcuts_row_activated_cb().
	(shortcuts_activate_item): New helper function.
	(shortcuts_row_activated_cb): Use shortcuts_activate_iter().
	(ShortcutsIndex): Renamed SHORTCUTS_SEPARATOR to
	SHORTCUTS_BOOKMARKS_SEPARATOR.
	(struct _BtkFileChooserDefault): New field shortcuts_current_folder_active.
	(shortcuts_insert_separator): Add a position argument.
	(shortcuts_get_index): Handle the SHORTCUTS_CURRENT_FOLDER_SEPARATOR 
	and SHORTCUTS_CURRENT_FOLDER positions.
	(shortcut_exists): Ignore the current folder row.
	(struct _BtkFileChooserDefault): New field shortcuts_filter_model.
	(shortcuts_model_create): Create a filter model for the shortcuts list.
	(shortcuts_list_create): Set the model to the shortcuts_filter_model.
	(remove_bookmark_button_clicked_cb): Use the shortcuts_filter_model.
	(bookmarks_check_remove_sensitivity): Likewise.
	(shortcuts_row_activated_cb): Likewise.
	(btk_file_chooser_default_set_current_folder): New function.
	(btk_file_chooser_default_set_current_folder): Update the current
	folder row in the shortcuts list.

	* btk/btkfilechooserwidget.c
	(btk_file_chooser_widget_constructor): Cast correctly for
	_btk_file_chooser_embed_set_delegate().

Mon Mar  1 19:30:25 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkdnd.[ch]: Add btk_drag_source_set/get_target_list().
	(#127499, based on patch from Michael Natterer)

	* tests/testbtk.c: Fix bidi strings to display correctly
	with new auto-bidi.

Tue Mar  2 01:34:40 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btksettings.c: Remove the include of Xft.h, which is already
	dragged in via bangoxft.h.  (#135496, David Hawthorne)

Mon Mar  1 23:52:15 2004  Tim Janik  <timj@btk.org>

        * btk/btkbindings.[hc]: expose btk_bindings_activate_event(), changed
        callers.

        * btk/btkwindow.[hc]: added btk_window_propagate_key_event() to expose
        the key event propagation mechanism used for focus widgets.
        (btk_window_key_release_event): use the same key event propagation logic
        as btk_window_key_press_event().

2004-03-01  Simon Budig  <simon@gimp.org>

	* bdk/x11/bdkinput-x11.c: X11 R6.4 specifies 15 events
	for the XInput extension. We want to see them all.
	We now get Proximity Out events again. Fixes bug #135320.

Tue Mar  2 00:47:21 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkimmodule.c (match_locale): Use case-insensitive
	comparison. Fixes XIM module loading on AIX.  (#131277)

Mon Mar  1 23:59:18 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodelsort.c (btk_tree_model_sort_row_deleted): 
	Make it work correctly when the child model is cleared 
	completely. (#121633)

2004-03-01  Michael Natterer  <mitch@gimp.org>

	* btk/btkfilechooserwidget.h: removed accidentially committed char
	which broke the build.

Mon Mar  1 16:51:21 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserdialog.c
	(file_chooser_widget_default_size_changed): only store the size if
	we can resize in that direction.

Mon Mar  1 16:32:52 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserwidget.c
	(btk_file_chooser_widget_new_with_backend): new function.  Long
	name.

2004-03-01  Morten Welinder  <terra@bunny.org>

	* btk/btkfilesystemunix.c (filename_get_info): Only stat when
	needed.

	* btk/btkfilesystemmodel.c (file_model_node_is_visible): Simplify
	semantics and check for errors.

	* btk/btkpathbar.c (btk_path_bar_set_path): Propagate errors.

	* btk/btkfilefilter.c (btk_file_filter_filter): Don't crash if
	display_name is NULL.

Mon Mar  1 14:16:52 2004  Owen Taylor  <otaylor@redhat.com>

	Based on patch by Alex Larsson

	* btk/btkfilechooserdefault.c: Use btk-file-chooser-backend
	BtkSetting to set the backend if the app doesn't specify one.

	* bdk/x11/bdkevents-x11.c btk/btksettings.c:
	Add Btk/FileChooserBackend.

Mon Mar  1 20:32:06 2004  Tim Janik  <timj@btk.org>

        * autogen.sh:
        - exit with $? instead of 1 in case of failure
        - exit with $? if ./configure failed
          (that's so autogen.sh && make lines work)
        - removed --enable-btk-doc option
        - added $AUTOGEN_CONFIGURE_ARGS

2004-03-01  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (list_model_filter_func): Test for
	filter_info.uri correctly.  Fixes #135379, pointed out by Damon
	Chaplin.
	(shortcuts_get_index): Compute the bookmarks index correctly.
	Fixes #135714, pointed out by Damon Chaplin.
	(btk_file_chooser_default_list_shortcut_folders): Handle the case
	with no shortcuts, and don't run off the end of the list if there
	are no bookmarks and their separator.  Fixes #135572, patch by
	Damon Chaplin.

Mon Mar  1 12:23:06 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btklabel.c: Handle dynamically resolved bidi direction
	when drawing the cursor. (#118541)

	* btk/btkentry.c (get_better_cursor_x): Use entry->resolved_dir;

	* btk/btkentry.c (draw_insertion_cursor): Fix up
	some confusion in parameter ordering.

Mon Mar  1 12:05:54 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserdialog.c
	(file_chooser_widget_resizable_hints_changed): Handle
	shrinking/growing.

2004-03-01  Michael Natterer  <mitch@gimp.org>

	* btk/btktextbtree.c: removed underscores from calls to
	btk_text_btree_resolve_bidi().

Mon Mar  1 10:41:27 2004  Owen Taylor  <otaylor@redhat.com>

	Patch from Dov Grobgeld to implement auto-bidi-direction
	for BtkTextView (#118543)

	* btk/btktextbtree.[ch]: Resolve bidi base direction
	for each line by propagating backwards/forwards as
	necessary.

	* btk/btktextlayout.[ch] btk/btktextview.c: Set the 
	bidi base direction for the ;ine with the cursor from 
	the keyboard direction. Add btk_text_layout_set_keyboard_direction().
	
Mon Mar  1 10:31:11 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkentry.[ch]: Implement auto-bidi-direction,
	based on a patch from Dov Grobgeld. (#118540)

Sun Feb 29 22:01:49 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkentry.[ch]: Add btk_entry_set_alignment() 
	to allow right-aligned entries and a "xalign" 
	property. (#59799, patch from Egon Andersen and 
	Steffen Gutmann)

	* btk/btkmisc.c (btk_misc_class_init): Use improved
	xalign property description here too.

	* tests/testtext.c: UNDERLINE_ERROR test addition
	from Nicolas Settons' patch.

Sun Feb 29 20:34:06 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.[ch] btk/btkmenushell.c: export
	btk_window_activate_key() (Request from Tim Janik)

Mon Mar  1 01:00:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_drag_data_received): 
	Make DND operations within a buffer move the dragged 
	text instead of copying it; also make DND operations 
	a single user action for undo purposes.  (#135191, 
	#93139, reported by Tommi Komulainen, patch by Paolo Borelli
	and Paolo Maggi)

Mon Mar  1 00:51:11 2004  Matthias Clasen  <maclas@gmx.de>

	* NEWS: News for 2.3.5.

Sun Feb 29 23:25:35 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (btk_entry_completion_key_press): 
	Fix the Shift-Tab support to go backwards.

Sun Feb 29 16:40:40 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextview.c (btk_text_view_class_init): Fix 
	capitalization to match other style properties.

Sun Feb 29 16:38:53 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextview.c (btk_text_view_class_init): Fix a
	typo in property string.

Sun Feb 29 16:35:23 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkbango.c btk/btktextdisplay.c: Implement
	BANGO_UNDERLINE_ERROR (Based on a patch by
	Nicolas Setton, #114237)

	* btk/btktextview.c: Add a error-underline-color style
	property.

Sun Feb 29 19:04:33 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkrange.c (_btk_range_get_wheel_delta): New internal
	function returning a good step value for the mouse wheel. For
	scrollbars, base the step on page_size^(2/3), for other ranges,
	use 2 * step_increment.

	* btk/btkrange.c (btk_range_scroll_event): Use it here ...

	* btk/btkscrolledwindow.c (btk_scrolled_window_scroll_event): 
	... and here.

	* btk/btkmenu.c (btk_menu_leave_notify): Fix a warning.

Sun Feb 29 01:51:27 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserembed.c
	(_btk_file_chooser_embed_get_default_size):  Add g_return_if_fail()
	(_btk_file_chooser_embed_get_resizable_hints): Add g_return_if_fail()

	* btk/btkfilechooserdialog.c
	(file_chooser_widget_default_size_changed): Get the correct
	initial size for the dialog.  Also, don't bother with
	btk_window_set_default_size().  It's not really meaningful.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_default_size): Get the correct
	spacing for the preview_widget
	(update_preview_widget_visibility): Clear widget field after we
	destroy it.

2004-02-29  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_set_property): Handle
	BTK_FILE_CHOOSER_PROP_USE_PREVIEW_LABEL.
	(btk_file_chooser_default_get_property): Likewise.
	(struct _BtkFileChooserDefault): Added fields for preview_label,
	use_preview_label, preview_display_name, preview_box.  Removed
	preview_frame.
	(set_preview_widget): Reorder the widget in relation to the label.
	(update_preview_widget_visibility): Create or destroy the preview
	label.
	(check_preview_change): Update impl->preview_display_name and the
	label.
	(find_good_size_from_style): Use the preview_box.
	(btk_file_chooser_default_finalize): Free
	impl->preview_display_name.
	(btk_file_chooser_default_init): Initialize
	impl->use_preview_label.

	* btk/btkfilechooser.c (btk_file_chooser_class_init): Add a
	"use-preview-label" property.
	(btk_file_chooser_set_use_preview_label): New function.  This sets
	whether one wants the file chooser to display a stock label with
	the previewed filename.  Apps that do really fancy previews can
	turn this off and draw the name themselves.
	(btk_file_chooser_get_use_preview_label): New function.
	(btk_file_chooser_get_preview_widget_active): Documentation fix.

	* btk/btkfilechooserutils.h (BtkFileChooserProp): Add a
	BTK_FILE_CHOOSER_PROP_USE_PREVIEW_LABEL value.

	* btk/btkfilechooserutils.c
	(_btk_file_chooser_install_properties): Override the
	"use-preview-label" property.

Sun Feb 29 04:43:29 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (btk_entry_completion_key_press): Make Tab and
	Shift-Tab work when the completion popup is shown.

2004-02-28  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (create_folder_tree): Use "Name" for
	the title of the filename column.
	(create_file_list): Likewise.

Sun Feb 29 03:31:42 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (btk_entry_completion_key_press): Fix Page_Up 
	and Page_Down in the completion popup to move page-wise if we're
	scrolling.

2004-02-28  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (set_cell_text_bold_if_folder):
	Removed.
	(list_name_data_func): Don't call the function above.
	(list_mtime_data_func): Likewise.

Sun Feb 29 02:34:35 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_list_position): New 
	function which calculates position and size for the popup in
	list mode. Currently it only pushes the popup horizontally 
	into the screen.

Sun Feb 29 01:10:09 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c: Implement the previous fix in a better way,
	small cleanups.

2004-02-28  Hans Breuer  <hans@breuer.org>

	* btk/btkfilesystemwin32.c : applied patch from
	J. Ali Harlow <ali@juiblex.co.uk>, fixes bug #135641

Sat Feb 28 23:30:36 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_popup): Actually resize the
	popup window before popping up.  (#135651)

Sat Feb 28 23:29:35 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_class_init): 
	* btk/btkcombobox.c (btk_combo_box_init): Override the default
	handler for style_set in class_init instead of connecting to
	the signal in init. (noticed by Yosh).

Sat Feb 28 14:48:35 2004  Owen Taylor  <otaylor@redhat.com>

	* demos/btk-demo/main.c (read_line): #ifdef HAVE_FLOCKFILE, 
	not #ifndef HAVE_FLOCKFILE. (#135642, J. Ali Harlow)

2004-02-28  Hans Breuer  <hans@breuer.org>

	* btk/btkfilesystemwin32.c : adapt to add -> insert_bookmark
	change. Also merged some crossplatform code from 
	btkfilesystemunix.c
	* btk/btk.def : updated externals

	* btk/makefile.msc.in : added btkfilechooserembed.obj

2004-02-28  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkdnd-win32.c : set current_dest_drag to NULL
	when destroying, fixes bug #120007. Also removed the mirrored
	ref counting for deprecated bdk_drag_context_<ref|unref>()
	cause it wasn't reliable anymore anyway.

	* bdk/win32/bdkdisplay-win32.c : fix typo, which should
	have broken the win32 build for everyone not using msvc

	* bdk/win32/bdkevents-win32.c : WM_GETMINAMXINFO ensure not to
	return negative values for ptMaxTrackSize, it caused snapping
	windows to their minimum size

Sat Feb 28 01:39:01 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_set_wrap_width): Support
	switching back to non-gridded mode.  (#135169)

Fri Feb 27 22:29:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c (btk_widget_can_activate_accel): Add "Since: 2.4".

Fri Feb 27 18:52:19 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserdialog.c (btk_file_chooser_dialog_style_set):
	Whoops.  Didn't mean to commit the size change.

Fri Feb 27 18:46:27 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserembed.h: New private interface to help
	negotiate the default size of the widget.  Still a bit buggy, but
	better than the old behavior.

	* btk/btkfilechooserdefault.c: Implement the embed interface.

	* btk/btkfilechooserwidget.c: Proxy the embed interface.

	* btk/btkfilechooserdialog.c: Use the embed interface.

2004-02-27  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystem.c (btk_file_system_insert_bookmark): Added a
	"position" argument.

	* btk/btkfilesystem.h (BtkFileSystemError): Added value for 
	BTK_FILE_SYSTEM_ERROR_ALREADY_EXISTS.
	(struct _BtkFileSystemIface): Added a "position" argument to the
	::insert_bookmark() method.

	* btk/btkfilesystemunix.c (btk_file_system_unix_insert_bookmark):
	Updated; renamed from btk_file_system_unix_add_bookmark().  Return
	an error if the path already exists in the bookmarks list.
	(btk_file_system_unix_remove_bookmark): Return an error if the
	path does not exist in the bookmarks list.

	* btk/btkfilechooserdefault.c (shortcuts_add_bookmark_from_path):
	For now, use btk_file_system_insert_bookmark() with -1 for the
	position.  DnD will come next.

Fri Feb 27 21:42:28 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_relayout): 
	* btk/btkcombobox.c (btk_combo_box_style_set): Simplify, only 
	create a new setup if appearance actually changed.
	* btk/btkcombobox.c (btk_combo_box_cell_layout_clear): 
	* btk/btkcombobox.c (btk_combo_box_get_cell_info): Make 
	these more robust.  (#127623, Damon Chaplin)

Fri Feb 27 15:06:00 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooser.c (btk_file_chooser_class_init): remove
	folder-mode property.

	* btk/btkfilechooserutils.c
	(_btk_file_chooser_install_properties): remove FOLDER_MODE property.

Thu Feb 26 17:38:40 2004  Manish Singh  <yosh@gimp.org>

	* btk/btkcombobox.c: Add function declaration for
	btk_combo_box_list_remove_grabs().

Fri Feb 27 02:33:21 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (keyval_is_cursor_move): Classifiy Page Up/Down as
	cursor move, but not Home and End.

	* btk/btkentry.c (btk_entry_completion_key_press): Lets Page Up/Down
	jump to the ends of the list, not Home and End - since we're not 
	scrolling yet, a "page" is always the complete list.  (#127430, Marco
	Pesenti Gritti)

Fri Feb 27 00:39:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_list_destroy): 
	* btk/btkcombobox.c (btk_combo_box_menu_destroy): Don't let
	the priv pointers dangle.  (#127623, Damon Chaplin)

Thu Feb 26 17:31:34 2004  Manish Singh  <yosh@gimp.org>

	* bdk/x11/xsettings-client.c (read_settings): fix ytpo: s/eles/else/

Thu Feb 26 19:53:32 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/xsettings-common.h (xsettings_client_process_event): 
	Add xsettings_client_set_grab_func,
	Add xsettings_client_set_ungrab_func to the list of renames.

Thu Feb 26 19:48:39 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/xsettings-client.c (read_settings): Fix memory leak
	in case of mismatched property type.

Thu Feb 26 18:25:57 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooser.h (BtkFileChooserAction): Add two more folder
	modes to the enum.

	* btk/btkfilechooser.c (btk_file_chooser_set_folder_mode): Remove.
	(btk_file_chooser_get_folder_mode): Remove

Thu Feb 26 17:29:04 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkevents-x11.c (bdk_wm_protocols_filter): Return
	BDK_FILTER_CONTINUE for unhandled message types.

	* bdk/x11/bdkevents-x11.c (bdk_event_translate): Allow
	multiple filters for the same event type with the standard
	"BDK_FILTER_CONTINUE == pretend I wasn't here" semantics.

	* bdk/x11/bdkevents-x11.c (bdk_display_add_client_message_filter):
	Append to the filter list not prepend, since order now matters.

	* bdk/win32/bdkevents-win32.c (bdk_add_client_message_filter): 
	Append to the filter list not prepend, since order now matters.
	
Thu Feb 26 23:39:07 2004  Matthias Clasen  <maclas@gmx.de>

	Fixes for #135333, analysed by Damon Chaplin:
	
	* btk/btkcombobox.c (btk_combo_box_list_button_pressed): Don't
	grab here.
	* btk/btkcombobox.c (btk_combo_box_popup): Do the grabs here, 
	so that we don't forget to grab when the menu is popped via
	keynav.
	* btk/btkcombobox.c (btk_combo_box_list_button_released): Don't
	ungrab here.
	* btk/btkcombobox.c (btk_combo_box_popdown): Do the ungrabs here.

Thu Feb 26 23:26:00 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkstatusbar.c (set_grip_cursor): New function. Use resize
	cursors for resize grips. (Bug #129621)

	* btk/btktoolbar.c (btk_toolbar_get_relief_style): Documentation
	fix - patch by Torsten Schoenfeld.

	* btk/btkmenubar.c (btk_menu_bar_size_request): don't request
	space between the items. (Bug #110775)

	* btk/btkrc.c (_btk_rc_init): Provide extra horizontal padding
	inside menu items that are inside a menu bar. (Bug #110775)
	
	* configure.in (HAVE_XCURSOR): Make XCurosr part of BDK_EXTRA_,
	not BDK_PACKAGES, to prevent applications from getting linked to
	it (Bug #119804)

	* btk/btkmenubar.c (btk_menu_bar_size_allocate): Put the vertical
	ipadding inside the item. (Bug #61843)

Thu Feb 26 22:56:40 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c: Replace btk_widget_get_mnemonic_widgets() 
	by list_mnemonic_widgets() in doc comments as well.

Thu Feb 26 16:36:38 2004  Owen Taylor  <otaylor@redhat.com>

	Fixes from Torsten Schoenfeld.

	* btk/btkwidget.c (btk_widget_add_mnemonic_label): 
	Fix name in doc comment.

	* btk/btkwidget.h: btk_widget_list_mnemonic_labels(),
	not get_mnemonic_labels.

Thu Feb 26 22:20:44 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcomboboxentry.h:
	* btk/btkcomboboxentry.c (btk_combo_box_entry_new_text): New
	convenience API to construct simple text combos, implemented by
	Damon Chaplin.

	* tests/testcombo.c: Use btk_combo_box_entry_new_text.

Thu Feb 26 22:19:29 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_new_text): Improve the docs.

Thu Feb 26 15:43:43 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkstyle.[ch]: Export insertion cursor drawing functionality
	in a simplified form as btk_draw_insertion_cursor().
	(#99031, request from Alex Larsson)

	* btk/btktextdisplay.c btk/btkentry.c btk/btklabel.c:
	Adapt to new btk_draw_insertion_cursor().

	* btk/btkradiomenuitem.c (btk_radio_menu_item_class_init)
	btk/btkstyle.c (btk_style_class_init): Add some missed
	Since: 2.4.

	* btk/btkiconfactory.c (icon_size_settings_changed)
	  btk/btkicontheme.c (do_theme_change)
	  btk/btkrc.c (_btk_rc_context_get_default_font_name)
	* btk/btksettings.c (btk_settings_notify):
	_btk_rc_reset_styles => btk_rc_reset_styles.

Thu Feb 26 21:52:58 2004  Matthias Clasen  <maclas@gmx.de>

	Fixes for #127804 and #134722, Damon Chaplin:
	
	* btk/btkcombobox.c (btk_combo_box_cell_layout_pack_end): 
	* btk/btkcombobox.c (btk_combo_box_cell_layout_pack_start): 
	Ref and sink the cell renderers here.
	
	* btk/btkcombobox.c (btk_combo_box_finalize): Unref the cell
	renderers here, and free attributes and func_data. 

Thu Feb 26 21:41:38 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkrc.c (btk_rc_reset_styles): Mark as 2.4 API addition.

Thu Feb 26 14:47:22 2004  Dom Lachowicz <cinamod@hotmail.com>

	* btk/btk.def: Export btk_rc_reset_styles()

Thu Feb 26 14:47:22 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkrc.[ch]: Export btk_rc_reset_styles(). 
	(Request from Dom Lachowicz, #123769)

Wed Feb 25 19:11:31 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkradiobutton.[ch] btk/btkradiomenuitem.[ch]: Add a
	::group-changed signal emitted when the radio button/menu item 
	is moved from one group of radio buttons to another. 
	(#79563, based partially on a patch from Padraig O'Briain)

Thu Feb 26 13:23:47 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkwindow-x11.c (set_text_property): Use the right
	free() function. (#135511, George Bronnikov)

2004-02-26  Federico Mena Quintero  <federico@ximian.com>

	* configure.in: Added a comment to inform translators that they
	must add .po files to both po/ and po-properties/ when they add
	new languages to ALL_LINGUAS.

Wed Feb 25 15:36:50 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkselection-x11.c (bdk_utf8_to_compound_text_for_display):
	Call g_convert(), not g_convert() with fallback, since Emacs is
	happier if we reject the COMPOUND_TEXT request and it can
	then ask for UTF-8. (#114527)

	* btk/btkselection.c (btk_selection_data_set_text): When
	TEXT is requested, if COMPOUND_TEXT fails, fall back to STRING.

Wed Feb 25 22:35:00 2004  Tomasz Kłoczko <kloczek@pld.org.pl>

	* cinfigure.in: After changes in G_DEFINE_TYPE minimal required bunnylib
	vesion for build btk+ is now 2.3.3.

Wed Feb 25 16:00:40 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (update_appearance): move the
	expander code.

2004-02-25  Danilo Šegan  <dsegan@gmx.net>

	* configure.in (ALL_LINGUAS): po-properties/sr@ije.po added, so
	adding back sr@ije.

2004-02-25  Federico Mena Quintero  <federico@ximian.com>

	* configure.in (ALL_LINGUAS): Remove sr@ije until po-properties/
	is fixed for it.

Wed Feb 25 12:44:49 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkstyle.[ch]: Make realize and unrealize signals. (#73310)

Wed Feb 25 12:21:32 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwidget.[ch] btk/btklabel.c: Patch from
	Padraig O'Briain to add btk_widget_add/remove_mnemonic_label,
	btk_widget_get_mnemonic_labels(). (#103456)

2004-02-25  Danilo Šegan  <dsegan@gmx.net>

	* configure.in: Added sr@ije to ALL_LINGUAS.

Wed Feb 25 09:46:34 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkstyle.c (btk_style_finalize): Free 
	style->icon_factories (#130128)

Wed Feb 25 03:52:58 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c: use btk_widget_push/pop_composite_child around
	internal buttons.

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	rename some widgets to make it clear where they are packed.
	(update_appearance): New function to handle all the 'logic' of
	layout in one place.  We aren't trying to keep all our properties
	in sync.
	(btk_file_chooser_default_set_property): use update_appearance()

2004-02-24  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_model_create): Renamed
	from create_shortcuts_model().
	(struct _BtkFileChooserDefault): Renamed the shortcuts_tree field
	to shortcuts_list.
	(shortcuts_list_create): Renamed from shortcuts_tree_create().
	(create_file_list): Enable the tree view as a model drag source.
	(create_folder_tree): Likewise.

	* btk/btkfilesystemmodel.c (_btk_file_system_model_get_type):
	Register the drag source interface.
	(drag_source_iface_init): New function.
	(drag_source_row_draggable): New function.
	(drag_source_drag_data_get): New function.

Tue Feb 24 19:12:07 2004  Owen Taylor  <otaylor@redhat.com>

	* === Released 2.3.4 ===

	* configure.in: Bump version to 2.3.4, fix broken
	btk_binary_age value by copying the GLib logic
	to automatically set it to the right values.

Wed Feb 25 00:13:24 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_row_changed): 
	* btk/btkcombobox.c (btk_combo_box_list_row_changed): 
	Don't resize priv->cell_view if it is NULL.  (#127804, 
	Damon Chaplin)
	
Wed Feb 25 00:06:50 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c: Add a comment about the different 
	modi of this widget. Get rid of priv->hbox, and some other
	cleanups. Make sure that btk_combo_box_unset_model() is 
	always called before setting up a different mode. 

Tue Feb 24 17:51:49 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkaccellabel.c (btk_accel_label_refetch): Convert
	underscores in keyval names to spaces. (#131480)

Tue Feb 24 17:35:59 2004  Owen Taylor  <otaylor@redhat.com>

	* m4macros/btk-2.0.m4: Add some quotes around ***. (#130073,
	Uwe Zeisberger)

Tue Feb 24 14:45:03 2004  Owen Taylor  <otaylor@redhat.com>

	* === Released 2.3.3 ===

	* configure.in: Version 2.3.3, interface age 0.

	* NEWS: Finish updates for 2.3.3.

2004-02-24  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (save_widgets_create): Use a plain
	BtkEntry for the filename, not a BtkFileChooserEntry.
	(update_chooser_entry): Use btk_entry_set_text() rather than
	_btk_file_chooser_entry_set_file_part().
	(btk_file_chooser_default_set_current_name): Likewise.
	(btk_file_chooser_default_set_current_folder): Don't set the base
	folder of the entry, and don't call update_chooser_entry().
	(btk_file_chooser_default_get_paths): Use the plain entry.
	(save_widgets_create): Store the "Save in Folder" label in the
	impl structure.
	(expander_activate_cb): Set the sensitivity of the label and
	combo.
	(save_widgets_create): Connect to "notify::expanded" rather than
	"activate" on the expander.
	(expander_changed_cb): Renamed from expander_activate_cb().  Flip
	the conditions again...

Tue Feb 24 14:43:07 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c (btk_tree_view_bin_expose): only draw the sort
	column as different if there are 3 or more visible columns.

2004-02-24  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilechooserdefault.c: (shortcuts_insert_separator):
	Fix compilation (#135278, Padraig O'Briain).
	
2004-02-24  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilechooserdefault.c: (shortcuts_append_desktop):
	Translate the desktop label.
	
	(shortcuts_get_index), (shortcuts_add_bookmarks),
	(shortcuts_insert_separator), (create_shortcuts_model):
	Don't show the bookmark separator if there are no bookmarks.
	
Tue Feb 24 01:41:30 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (location_popup_handler): Make the
	dialog look like the nautilus dialog.
	(expander_activate_cb): get the order correct.

2004-02-23  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (list_selection_changed): Call
	bookmarks_check_add_sensitivity().
	(shortcut_exists): New helper function; moved the testing code
	over from bookmarks_check_add_sensitivity().
	(bookmarks_check_add_sensitivity): Check the contents of the
	selection in the file/folder list.  Use shortcut_exists().
	(shortcuts_add_bookmark_from_path): Don't insert the bookmark if
	the path is already in the shortcuts list.
	(add_bookmark_button_clicked_cb): Add the bookmarks from the list
	selection or from the current folder, as appropriate.

Mon Feb 23 21:09:06 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (shortcuts_pane_create): Add
	mnemonics.  Sorry translators.

Tue Feb 24 02:24:58 2004  Matthias Clasen  <maclas@gmx.de>

	* NEWS: Additions. This should be complete for the main ChangeLog
	now, still need to sift through bdk-pixbuf, docs, and translations.

Mon Feb 23 19:57:45 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkcellrendererseptext.c (btk_cell_renderer_sep_get_size):
	Add a get_size implementation so that we are no longer the same
	height as text.

2004-02-24  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilechooserdefault.c: (shortcuts_insert_path),
	(shortcuts_remove_rows), (shortcuts_append_bookmarks),
	(create_shortcuts_model), (shortcuts_tree_create),
	(btk_file_chooser_default_remove_shortcut_folder):
	Improve bookmark list rendering by controlling the visibility
	of the pixbuf cell so that it will be invisible for the separator
	row, also use a list store instead of a tree store for the model
	so we won't get unnecessary space for an expander.
	
Tue Feb 24 01:08:27 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c: Add a destroy implementation in order to
	set priv->cell_view to NULL before finalize stumbles over the 
	dangling pointer. This big array of pointers into the widget 
	tree in BtkComboBoxPrivate is really fragile and should be
	cleaned up.

Mon Feb 23 17:52:43 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (main_paned_create): use a size
	group when allocating space for the buttons at the bottom just in
	case.  Also, move the filter to below the file list.

Mon Feb 23 16:52:12 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_class_init): Seth was confused by
	keybindings.  They should be Alt, not Ctl.  Also, A-Home should go
	home, not up.

Mon Feb 23 15:23:23 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c (btk_path_bar_set_path): Display the root a bit
	more cleanly.

	* btk/btkpathbar.h (struct _BtkPathBarClass): fix the signal.

2004-02-23  Federico Mena Quintero  <federico@ximian.com>

	Rework the user interface of the file chooser, as per 
	Seth Nickell's design.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_class_init): Add binding signals and bindings:
		"location-popup" - C-l
		"up-folder"      - C-Up
		"home-folder"    - C-Home
	(up_folder_handler): New function; moved the code from up_button_clicked().
	(up_button_clicked_cb): Call up_folder_handler().
	(home_folder_handler): New function.
	(location_popup_handler): New function.
	(struct _BtkFileChooserDefault): Add an hpaned field.
	(btk_file_chooser_default_set_current_name): Check that we are in
	Save mode.
	(save_widgets_create): New function, create the widgets specific
	to Save mode.
	(main_paned_create): New function, create the hpaned's widgets here.
	(btk_file_chooser_default_constructor): Create the open and save
	widgets, and show only one set.
	(btk_file_chooser_default_set_property): Show/hide the save widgets.
	(btk_file_chooser_default_get_paths): Only pay attention to the
	entry in Save mode.
	(update_chooser_entry): Update the entry only in Save mode.
	(entry_activate): Removed.

Mon Feb 23 11:20:34 2004  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Remove the configure.in check for fontconfig 
	entirely; it's not needed, since BangoXft implies that sufficiently
	new fontconfig is present.

Mon Feb 23 02:26:53 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c (btk_path_bar_finalize):
	for (i = 0; i < 10; i++)
	  g_print ("I will compile before committing.\n");

Mon Feb 23 02:08:42 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (file_pane_create): Use the
	BtkPathBar by default now.

	* btk/btkpathbar.c (btk_path_bar_set_path): Correctly set the
	current path from the path.
	(btk_path_bar_class_init): new signal
	(button_clicked_cb): emit the signal when we're selected.
	(btk_path_bar_clear_buttons): Fix a crasher when we weren't
	clearing thr first_scrolled_button.

Mon Feb 23 02:26:15 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_size_allocate): Fix the 
	allocation for the toggle button so that it actually shows up 
	in LTR list mode.

	* btk/btkcombobox.c (btk_combo_box_set_column_span_column): 
	* btk/btkcombobox.c (btk_combo_box_set_row_span_column): 
	* btk/btkcombobox.c (btk_combo_box_set_wrap_width): Add
	notification, and avoid excessive relayouting. 

Mon Feb 23 00:38:21 2004  Matthias Clasen  <maclas@gmx.de>

	Fix bug 134982, reported by Morten Welinder:
	
	* btk/btkpathbar.c (btk_path_bar_destroy): 
	* btk/btktooltips.c (btk_tooltips_destroy): 
	* btk/btkinvisible.c (btk_invisible_destroy): Chain up to the 
	parent's ::destroy handler.
	
	* bdk/bdkdisplay.c (bdk_display_dispose): Chain up to the 
	parent's ::dispose handler.

Sat Feb 21 19:09:55 2004  Manish Singh  <yosh@gimp.org>

	* btk/btksettings.c (btk_default_substitute): Guard the FC_HINT_STYLE
	stuff with an #ifdef, so we still build with most fontconfig versions.

Sun Feb 22 03:03:29 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.c: (btk_action_finalize):
	* btk/btkclipboard.c: (btk_clipboard_finalize):
	* btk/btkentrycompletion.c: (btk_entry_completion_class_init),
	(btk_entry_completion_finalize):
	* btk/btkfilechooserwidget.c: (btk_file_chooser_widget_finalize):
	* btk/btkfilesystemmodel.c: (btk_file_system_model_class_init),
	(btk_file_system_model_finalize):
	* btk/btkicontheme.c: (btk_icon_theme_class_init),
	(btk_icon_theme_finalize):
	* btk/btktextchild.c: (btk_text_child_anchor_finalize):
	* btk/btkuimanager.c: (btk_ui_manager_class_init),
	(btk_ui_manager_finalize):
	* modules/input/btkimcontextxim.c: (btk_im_context_xim_finalize):
	Add chains to the parent's ::finalize() handler  (#134901, Morten Welinder,
	patch by Jan Arne Petersen)

Sun Feb 22 02:10:34 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (btk_entry_completion_default_completion_func): 
	Don't crash if item is NULL.  (#131542, Dan Damian)

Sun Feb 22 02:04:03 2004  Matthias Clasen  <maclas@gmx.de>

	* configure.in: Add a check for a new enough fontconfig, since
	we picked up a direct dependency on it with the Xft settings.

Sun Feb 22 00:23:40 2004  Matthias Clasen  <maclas@gmx.de>

	Bug 112647 (Bill Haneman, patch by Narayana Pattipati):
	
	* btk/btkcheckmenuitem.c: Introduce a new style property 
	indicator_size and use it instead of the hardcoded value.
	
	* btk/btkmenu.c (btk_menu_size_request): Make sure each menu 
	item gets enough vertical space for the label and the indicator.

Sat Feb 21 20:20:11 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btksettings.c (btk_settings_class_init): Use P_ instead of
	_ for the new Xft settings.

Sat Feb 21 20:09:53 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Bug 130790 (Federico Mena Quintero, Owen Taylor)
	
	* bdk/x11/bdkevents-x11.c: Add Xft XSETTINGS

	* btk/btksettings.c: Add new BtkSettings corresponding to the Xft
	XSETTINGS
	
Sat Feb 21 19:18:26 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Bug 132502
	
	* btk/btkmenu.c (btk_menu_motion_notify): Make sure we pop down
	if we enter a non-selectable menu item.

	* btk/btkmenu.c (btk_menu_leave_notify): Don't pop a submenu
	when the user has left the item.

Sat Feb 21 17:57:35 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/docs: Commit auto-generated changes

Fri Feb 20 18:20:22 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c: conditional compile for BtkPathBar

	* btk/btkpathbar.c (btk_path_bar_size_allocate): Clean up
	allocation code.  Works fully in RTL languages, I think.
	(btk_path_bar_scroll_up): Scroll up.
	(btk_path_bar_scroll_down): Scroll down.

2004-02-20  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "en_CA" to ALL_LINGUAS.

2004-02-20  Michael Meeks  <michael@ximian.com>

	* btk/btktoolitem.c (btk_tool_item_property_notify): impl.
	(btk_tool_item_class_init): hook it up.
	(btk_tool_item_set_proxy_menu_item): synchronize sensitivity.

	* btk/btktoolbutton.c (btk_tool_button_property_notify):
	chain to parent, fix strcmp bug.

	* tests/testtoolbar.c (main): re-arrange widgets to allow
	more overflowing toolbar goodness.

2004-02-20  Alexander Larsson  <alexl@redhat.com>

	* btk/btkfilechooserdefault.c: (shortcuts_append_desktop):
	Desktop directory is not translated.
	(set_tree_model):
	There might not be volumes for all paths.
	* btk/btkfilechooserwidget.c:
	(btk_file_chooser_widget_constructor):
	Use btk_file_chooser_set_current_folder to set cwd.

Thu Feb 19 19:58:53 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.[ch]: New widget to handle the path in the
	fileselector implementation.  Not hooked up to anything yet.

	* btk/Makefile.am: support the path bar.

Fri Feb 20 00:21:38 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkstyle.c (btk_default_draw_handle): 
	(btk_default_draw_box): Make the paned handles gray when the the 
	widget is_focus() but not HAS_FOCUS().  (#122751, Soeren Sandmann)

Thu Feb 19 23:41:06 2004  Matthias Clasen  <maclas@gmx.de>

	Fixes for #82099:
	
	* bdk/x11/bdkevents-x11.c: Introduce new XSettings "Btk/ButtonImages"
	and "Btk/MenuImages" and map them to "btk-button-images" and 
	"btk-menu-images".

	* btk/btkimagemenuitem.c: Add a boolean setting "btk-menu-images" and 
	use it to set the visibility of the embedded image.

	* btk/btkbutton.c: Add a boolean setting "btk-button-images" and use
	it to set the visibility of an embedded image.

Thu Feb 19 21:26:10 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_add_radio_actions_full): 
	Give each radio action its own value.  (#134889, Paolo Borelli)

2004-02-19  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdialog.c (btk_file_chooser_dialog_finalize):
	Chain to the parent's ::finalize() handler.  Fixes #134885; caught
	by Jan Arne Petersen.

2004-02-19  Mark McLoughlin  <mark@skynet.ie>

	Make the entire expander widget width prelight as suggested
	by Seth in bug #134263.

	* btk/btkexpander.c:
	(btk_expander_paint_prelight): impl.
	(btk_expander_paint): use it.
	(btk_expander_redraw_expander): don't only redraw the
	arrow when prelit.

2004-02-19  Alexander Larsson  <alexl@redhat.com>

	* btk/btkfilechooser.c: (btk_file_chooser_class_init):
	* btk/btkfilechooserutils.c:
	* btk/btkfilechooserutils.h:
	* btk/btkfilechooserwidget.c:
	Remove old file-system property.
	Add new file-system-backend string property
	
	* btk/btkfilechooserdefault.[ch]:
	Handle the file-system-backend property
	
	* btk/btkfilechooserdialog.[ch]:
	(btk_file_chooser_dialog_new_with_backend):
	Remove old file-system property.
	Add new file-system-backend string property
	Add new function btk_file_chooser_dialog_new_with_backend
	
	* btk/btkfilesystem.c: 
	* btk/btkfilesystem.h:
	Add filesystem module support.	

2004-02-18  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_tree_create): Renamed
	from create_shortcuts_tree().
	(shortcuts_pane_create): New function.
	(button_new): Renamed from toolbar_button_new().
	(shortcuts_pane_create): New function, create the whole shortcuts
	pane here.
	(current_folder_create): Renamed from toolbar_create().  Don't
	create the bookmarks buttons here.
	(file_pane_create): New function.
	(btk_file_chooser_default_constructor): Use the new helper
	functions, and don't use an extra vbox as BtkFileChooserDefault is
	already a vbox.

Thu Feb 19 01:39:30 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.h: 
	* btk/btkuimanager.c (btk_ui_manager_class_init): Add
	default handlers for all signals; for consistency and for the
	benefit of language bindings which still rely on header parsing
	to find the signals.  (#134269, Jeroen Zwartepoorte)
	
Thu Feb 19 00:45:02 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeselection.c (btk_tree_selection_get_selected_rows): 
	Improve the efficiency here by prepending on the list and reverting
	it after the loop.  (#134435, Christian Biere)

Thu Feb 19 00:32:21 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkplug.c (_btk_plug_remove_from_socket): Avoid errors when
	removing the plug from the socket.  (#128546, Christopher Blizzard)

Thu Feb 19 00:09:35 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkradiomenuitem.h:
	* btk/btkradiomenuitem.c (btk_radio_menu_item_new_from_widget): 
	(btk_radio_menu_item_new_with_label_from_widget): 
	(btk_radio_menu_item_new_with_mnemonic_from_widget): New
	convenience functions analogous to similar API on BtkRadioButton.
	(#51700, Vitaly Tishkov, patch by Soeren Sandmann)

Wed Feb 18 17:53:27 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/bdkwindow.c (bdk_window_get_bg_gc): Use a scratch GC in the
	case where the background is a solid color.
	(bdk_window_clear_backing_rect): Reset the clip rebunnyion after use.

	* bdk/bdkpixbuf-render.c (bdk_pixbuf_render_threshold_alpha): Go
	back to using a scratch GC. Pointed out by Owen Taylor
	
	* bdk/bdkdraw.c (bdk_drawable_real_draw_pixbuf): Only use a
	scratch GC if the passed-in one is NULL

Wed Feb 18 14:27:08 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/bdkwindow.c (bdk_window_get_composite_drawable): Reset clip
	rebunnyion back to NULL on cached GC (rest of #134728)

Wed Feb 18 13:28:57 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Fix bug reported by Nam SungHyun (#134728)
	
	* bdk/bdkpixbuf-render.c (bdk_pixbuf_render_threshold_alpha):
	Don't use a cached GC here since the function needs to modify the
	foreground color.

	* bdk/bdkwindow.c (bdk_window_end_paint): Reset clip rebunnyion back
	to NULL on the cached GC.

2004-02-17  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdialog.c
	(btk_file_chooser_dialog_style_set): Use HIG-compliant spacings.
	This sucks a lot.

Wed Feb 18 02:03:47 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextbuffer.c (btk_text_buffer_class_init): Document some
	peculiarities of the ::delete_range signal.  (#132135, Grant Gayed)

Wed Feb 18 01:44:59 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	GC caching, bug #125645 (based on patch by Brian Cameron)
	
	* bdk/bdkscreen.h (struct _BdkScreen): Add GC cache
	* bdk/bdkscreen.c (bdk_screen_dispose): New function. Unref the
	cached GC's here.
	* bdk/bdkdraw.c (_bdk_drawable_get_scratch_gc): New function to
	get a scratch gc.
	* bdk/bdkinternals.h: Declare the function here

	* bdk/bdkdraw.c (bdk_drawable_real_draw_pixbuf): Use
	_bdk_drawable_get_scratch_gc() instead of creating a new GC.
	* bdk/x11/bdkgeometry-x11.c (bdk_window_copy_area_scroll): same
	* bdk/x11/bdkdrawable-x11.c (draw_with_images): same
	* bdk/bdkwindow.c (bdk_window_get_composite_drawable): same
	* bdk/bdkwindow.c (bdk_window_end_paint): same
	* bdk/bdkpixmap.c (bdk_pixmap_colormap_new_from_pixbuf): same
	* bdk/bdkpixbuf-render.c (bdk_pixbuf_render_threshold_alpha): same
	* bdk/bdkpixbuf-render.c (bdk_pixbuf_render_pixmap_and_mask_for_colormap): same

Tue Feb 17 23:28:33 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenu.c (btk_menu_init): ...and don't forget to initalize
	priv->columns to 1.

Tue Feb 17 23:11:21 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenu.c (btk_menu_do_remove): Make sure that we keep
	priv->columns >= 1 even for empty menus, since we divide by it
	somewhere else.  (#133428, Vincent Noel)

Tue Feb 17 23:02:58 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Fix for #119722, reported by Olexiy Avramchenko, patch by Owen
	Taylor.

	* bdk/x11/bdkprivate-x11.h (struct _BdkGCX11): Add a depth field

	* bdk/x11/bdkgc-x11.c (_bdk_x11_gc_new): Keep track of the GC's
	depth.

	* bdk/x11/bdkgc-x11.c (_bdk_gc_x11_get_fg_xft_color): First query
	the colormap, if no colormap, special case depth 1, 

	* bdk/x11/bdkgc-x11.c (_bdk_x11_gc_get_fg_picture): Use
	_bdk_gc_x11_get_fg_xft_color() to get the foreground color.

	* bdk/x11/bdkdrawable-x11.c (bdk_x11_drawable_get_xft_draw):
	Special-case bitmaps without a colormap.

	* bdk/x11/bdkdrawable-x11.c (bdk_x11_draw_pixbuf): Use inherited
	draw_pixbuf() implementation in the bitmap case.

2004-02-17  Mark McLoughlin  <mark@skynet.ie>

	* modules/input/Makefile.am: only reference input method
	modules we've actually built. Fixes re-build failure with
	stale hangul module lying aroung. Bug #134518.

Mon Feb 16 19:13:21 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkdraw.c: Revert last commit, please don't commit patches
	without approval, this isn't the right way to do it.

2004-02-16  DindinX  <david@dindinx.org>

	* bdk/bdkdraw.c (bdk_draw_segments): don't try to draw more than 32767
	segments at a time, since XDrawSegments cannot handle more than this.

	fixes bug #122026.
	
Mon Feb 16 18:26:39 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_set_child_property): Call
	btk_tool_item_set_expand(), not btk_tool_item_set_homogeneous()
	in the CHILD_PROP_EXPAND branch. (#134543, Damon Chaplin)

Mon Feb 16 00:04:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_cell_layout_*): 
	Split declaration and assignment of combo_box.
	
	* btk/btkcombobox.c (btk_combo_box_list_setup): Remove a 
	pointless cast

Sun Feb 15 22:08:53 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkoptionmenu.c (btk_option_menu_get_history): Add 
	deprecation note pointing people to BtkComboBox.

Sun Feb 15 02:49:45 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreednd.c: 
	* btk/btktreeview.c: Document the tree DND API.

	* btk/btktreeview.c (btk_tree_view_unset_rows_drag_source): 
	Call btk_drag_source_unset().  
	
Sun Feb 15 00:49:59 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_class_init): 
	Make stock_size an uint property, to allow custom icon 
	sizes. Also clarify the blurb.  (#130047, Erik Grinaker)

Sat Feb 14 11:05:26 2004  Manish Singh  <yosh@gimp.org>

        * configure.in: Remove unnecessary STRIP_* definitions, and GNU
        make check.

2004-02-13  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystemunix.c (btk_file_system_unix_add_bookmark):
	Duh, duh, duh!  Don't bail out if the bookmarks file doesn't exist
	the very first time you try to save one.

2004-02-13  Federico Mena Quintero  <federico@ximian.com>

	Fix #129020.

	* btk/btkfilechooserdialog.c
	(set_default_size): New function, sets a reasonable default size
	for the window.
	(btk_file_chooser_dialog_realize): New function, call
	set_default_size().
	(btk_file_chooser_dialog_style_set): Likewise.
	(btk_file_chooser_dialog_screen_changed): Likewise.

	* tests/testfilechooser.c (main): Don't set a default size for the
	dialog.

Sat Feb 14 00:05:18 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodelfilter.c (bsearch_elt_with_offset): 
	Use do instead of while.  (#134031, Morten Welinder);

Sat Feb 14 00:00:52 2004  Matthias Clasen  <maclas@gmx.de>

	* configure.in: Suppress xsltproc and xmlcatalog checks
	if enable_man=no.  (#134162, Julio M. Merino Vidal)

Fri Feb 13 23:54:48 2004  Matthias Clasen  <maclas@gmx.de>

	* configure.in: Remove checks for sgml2html. It was once
	used for building the linuxdoc version of the tutorial.
	Nowadays, we use db2html.  (#134164, Julio M. Merino Vidal)

Fri Feb 13 08:17:43 2004  Owen Taylor  <otaylor@redhat.com>

	Fix various compilation problems (#134312, David
	Hawthorne)

	* btk/btkscale.c (btk_scale_get_layout_offsets): Use 
	g_return_if_fail(), not g_return_val_if_fail().

	* btk/btkvscale.c (btk_vscale_get_layout_offsets): 
	* btk/btkhscale.c (btk_hscale_get_layout_offsets): Use 
	g_return_if_reached(), not g_return_val_if_reached().
	
	* btk/btkvscale.c (btk_vscale_expose): Fix the types
	of some parameters.

	* btk/btkhscale.c (btk_hscale_get_layout_offsets): Remove
	extra 'scale' parameter.

Thu Feb 12 21:58:20 2004  Owen Taylor  <otaylor@redhat.com>

        Various reentrancy fixes for widgets being destroyed
	out of focus-out-event. (#128821, Grant Gayed)

	* btk/btkwindow.c (_btk_window_unset_focus_and_default): 
	Ref window and widget over callbacks.

	* btk/btkwidget.c (btk_widget_hide)
	  btk/btkwidget.c (btk_widget_set_child_visible):
	Ref the widget before calling _btk_window_unset_focus_and_default(),
	since that can call user callbacks.

	* btk/btkwidget.c (btk_widget_invalidate_widget_windows):
	Do nothing if the widget isn't realized.

Fri Feb 13 01:31:44 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkbutton.c (_btk_button_paint): Don't draw bevels around
	active, RELIEF_NONE buttons that aren't depressed. This improves
	the appearance of buttons in notebook tabs.  (#109213, reported
	by Benjamin Otte, patch by Rodney Dawes)

Fri Feb 13 01:06:08 2004  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/main.c (read_line): Protect getc_unlocked() by 
	HAVE_FLOCKFILE in all cases.  (#134205, Julio M. Merino Vidal)

Fri Feb 13 00:54:59 2004  Matthias Clasen  <maclas@gmx.de>

	Fix for #104811, Padraig O'Briain:

	* btk/btkscale.h:
	* btk/btkscale.c (_btk_scale_clear_layout): 
	* btk/btkscale.c (btk_scale_get_layout_offsets): 
	* btk/btkscale.c (btk_scale_get_layout): New functions to determine the
	text and its position from a BtkScale, to make it more accessible. 
	* btk/btkhscale.c (btk_hscale_get_layout_offsets):
	* btk/btkvscale.c (btk_vscale_get_layout_offsets): Implementations of the 
	new BtkScale vfunc.

Thu Feb 12 17:59:52 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkicontheme.c (btk_icon_theme_get_search_path): 
	Remove an extraneous + 1 (#134015, Torsten Schoenfeld)

Thu Feb 12 23:55:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktooltips.h:
	* btk/btktooltips.c (btk_tooltips_get_info_from_tip_window): New 
	function to improve the accessibility of tooltips.  (#114851, 
	Padraig O'Briain)

Thu Feb 12 23:16:04 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_popup): 
	* btk/btkcombobox.c (btk_combo_box_popdown): Make these public and
	add docs.  (#132847)

Thu Feb 12 11:05:16 2004  Manish Singh  <yosh@gimp.org>

	* bdk/x11/bdkproperty-x11.c (bdk_property_get): Assign xtype using
	bdk_x11_atom_to_xatom_for_display () when type != BDK_NONE.

	* btk/btkselection.c (_btk_selection_request): Use BDK_NONE in
	bdk_property_get call instead of 0.

	* docs/reference/bdk/tmpl/properties.sgml: Document the above
	as BDK_NONE instead of simply 0.

Thu Feb 12 15:46:26 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Fix up item_area
	correctly in RTL mode. (#133984, patch from Semion Chichelnitsky).

Thu Feb 12 02:22:02 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_set_modify_func): 
	Correct the docs.

Thu Feb 12 01:17:01 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_enable_model_drag_source): Call
	btk_drag_source_set(), so that things like btk_drag_set_icon_*() work
	for automatic DND.  (#133485, Tommi Komulainen)

Thu Feb 12 00:37:00 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkproperty-x11.c (bdk_property_change): Fix misleading
	debug output.

2004-02-11  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkmessagedialog.c (btk_message_dialog_map): New ::map()
	handler.  If no widget has the focus, try to give it to the
	default widget.  If there is no default widget, give it to the
	first button.  Fixes the cause for which #59707 was reopened.

2004-02-11  Federico Mena Quintero  <federico@ximian.com>

	Fixes #134051.

	* btk/btkicontheme.c (struct _BtkIconInfo): Remove the ref_count field.
	(icon_info_new): Don't initialize the ref_count field.

2004-02-11  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkicontheme.c (btk_icon_theme_prepend_search_path): Shift
	the array correctly.  Fixes #134055, patch by Tosten Schoenfeld
	<kaffeetisch@gmx.de>.

Wed Feb 11 02:23:39 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcontainer.c (btk_container_real_set_focus_child): Handle
	focus [hv]adjustment correctly when the focus is located deeper
	down in the hierarchy.  (#133489)

Wed Feb 11 02:06:38 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellrenderer.c (btk_cell_renderer_class_init): Remove 
	arbitrary low upper limits on the xpad, ypad, width and height
	properties.  (#129696, John Ellis)

Wed Feb 11 01:24:20 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_cell_layout_clear_attributes): 
	Ugh. Don't try to free ints, even if they're stored in pointers.
	(#133997, Morten Welinder)

2004-02-10  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_finalize):
	Free the filters.  Fixes #133547, patch by Morten Welinder
	<mortenw@bunny.org>.

Tue Feb 10 12:02:14 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/xsettings-client.c (read_settings): Avoid
	triggering an X error when the client->manager_window
	is None...makes logs look cleaner.

	* bdk/x11/bdkproperty-x11.c (bdk_property_get): Handle
	BDK_NONE to mean AnyPropertyType as documented. (Reported 
	by Yu Shao)

	* bdk/x11/bdkevents-x11.c (fetch_net_wm_check_window,
	bdk_x11_screen_get_window_manager_name): Fix error trap
	we've been leaking since 2002... (#129538)

2004-02-10  Federico Mena Quintero  <federico@ximian.com>

	Fixes the entry-related part of #133852.

	* btk/btkfilechooserdefault.c (update_chooser_entry): Don't change
	the file part of the entry if the selected item is a folder.

2004-02-10  Federico Mena Quintero  <federico@ximian.com>

	Fixes #133995, patch by Morten Welinder <mortenw@bunny.org>.

	* tests/prop-editor.c (create_prop_editor): Free the title.
	(object_changed): Free the children list.

Tue Feb 10 01:58:55 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcontainer.c (btk_container_set_focus_hadjustment): 
	* btk/btkcontainer.c (btk_container_set_focus_vadjustment): Document 
	these functions.

2004-02-09  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (set_list_model): Request
	BTK_FILE_INFO_ALL from the file system model, so that arbitrary
	filtering will work.  Perhaps we should have a way of aggregating
	info types to the model as filters get installed.

Mon Feb  9 22:22:19 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellview.c (btk_cell_view_cell_layout_clear_attributes): 
	Ugh. Don't try to free ints, even if they're stored in pointers.

2004-02-09  Federico Mena Quintero  <federico@ximian.com>

	Fix #132256.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_paths): Read the contents of the
	filename entry in both OPEN and SAVE mode.  In multiple-selection
	mode, add this to the selection from the file/folder list.
	(struct get_paths_closure): Add a path_from_entry field.
	(get_paths_foreach): Only add the iterated path if it is not the
	same as the path from the entry.

2004-02-09  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystemunix.c (btk_file_system_unix_get_folder): If
	the folder is already open, add the requested info types to it.

Sun Feb  8 01:28:02 2004  Manish Singh  <yosh@gimp.org>

	* btk/btkcombobox.c (btk_combo_box_set_popup_widget): Add appropriate
	type casts for the btk_window_set_screen() call.

Sun Feb  8 01:44:06 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_set_popup_widget): Make popups 
	come up on the same screen as the combo box.  (#133544, 
	Morten Welinder)

Fri Feb  6 23:40:24 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkfilechooserdefault.c (create_file_list): clean up the
	packing of the file selector.

Sat Feb  7 01:21:09 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodel.c (btk_tree_model_base_init): Don't use function 
	calls in array initializers, as some compilers seem to hate this.
	(#133216, Jonas Jonsson)

Sat Feb  7 00:06:44 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaccelmap.[hc]: Add change notification for BtkAccelMap,
	by on-demand instantiating a singleton object with a "changed" 
	signal. 

	* btk/btkmarshalers.list (VOID:STRING,UINT,FLAGS): Add marshaller
	for BtkAccelMap::changed.

Fri Feb  6 23:08:29 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextbtree.c (_btk_text_btree_check): 
	* btk/btkcombobox.c (btk_combo_box_cell_layout_clear_attributes): 
	* btk/btkcellview.c (btk_cell_view_cell_layout_clear_attributes): 
	Actually free the lists. Pointed out by Morten Welinder.
	
Fri Feb  6 22:38:54 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombo.c (btk_combo_entry_key_press): Handle character 
	positions in UTF-8 strings correctly.  (#133315, Theppitak 
	Karoonboonyanan)

2004-02-06  Morten Welinder  <terra@bunny.org>

	* btk/btktoolbar.c (show_menu): Cleanup using
	btk_menu_attach_to_widget.  Also fixes leak, see #133411.

2004-02-06  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_add_volumes): Free the
	list.  Fixes #133546.

2004-02-06  Federico Mena Quintero  <federico@ximian.com>

	Fix #132327.

	* btk/btkfilesystemunix.c (struct _BtkFileSystemUnix): Add a
	folder_hash field to keep a list of live folder objects.
	(btk_file_system_unix_init): Create the folder_hash.
	(btk_file_system_unix_finalize): Destroy the folder_hash.
	(btk_file_system_unix_get_folder): Ref and return an existing
	folder if we have it around, otherwise return a new folder object.
	(struct _BtkFileFolderUnix): Add a field for the parent file system.
	(btk_file_folder_unix_finalize): Remove the folder from the file
	system's hash table.
	(btk_file_system_unix_create_folder):  Emit "files-added" on the
	newly-created folder's parent.  Fixes #132327.

Fri Feb  6 00:51:57 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkstock.c (builtin_items): Change the labels of the 
	ZOOM_100 and ZOOM_FIT stock items to "_Normal Size" and
	"Best _Fit", to be HIG compliant.  (#124080, Mariano 
	Suárez-Alvarez)

Fri Feb  6 00:45:16 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_finalize): Add a finalize 
	function to plug a few memory leaks.  (#133544, Morten Welinder)

Fri Feb  6 00:15:38 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcomboboxentry.c (btk_combo_box_entry_mnemonic_activate): 
	Support mnemonic_activate here as well.
	
	* btk/btkcombobox.c (btk_combo_box_mnemonic_activate): Focus
	the button, not the tree_view.

Thu Feb  5 23:48:19 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_mnemonic_activate): Add this
	function, to make mnemonic_activate work for combo boxes.
	(#133443, Paolo Borelli)

Thu Feb  5 22:05:52 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilesystemunix.c (bookmark_list_read): Initialize result
	to FALSE.  (#133539, Morten Welinder)

Thu Feb  5 21:36:43 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_set_active_iter): Fix the logic
	of the depth one check.  (#133488, Christian Persch)

Thu Feb  5 01:50:19 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktearoffmenuitem.c (btk_tearoff_menu_item_paint): Fix
	the drawing of tearoff menu items which don't come first in their
	menu.  (#33311)

Thu Feb  5 00:59:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombo.c (btk_combo_entry_key_press): Use 
	g_completion_complete_utf8(). (#133313, Theppitak Karoonboonyanan)

2004-02-04  Federico Mena Quintero  <federico@ximian.com>

	Fix #59707.

	* btk/btklabel.c (btk_label_focus): Removed, so we don't ignore
	the focus chain.
	(btk_label_button_press): Fix prototype.
	(btk_label_button_release): Likewise.
	(btk_label_motion): Likewise.

	* tests/testbtk.c (create_message_dialog): For the dialog with
	only BTK_BUTTONS_CLOSE, make BTK_RESPONSE_CLOSE the default.

2004-02-04  Morten Welinder  <terra@bunny.org>

	* btk/btktoolbar.c (show_menu): Show on the right screen.  (Fixes
	bug 133411, apart from the leak.)

Tue Feb  3 13:39:27 2004  Manish Singh  <yosh@gimp.org>

	* btk/btkadjustment.c (btk_adjustment_new): pass value in last
	in g_object_new, since it depends on lower and upper being set.

2004-02-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkmessagedialog.c (btk_message_dialog_init): Make the
	window not resizable.  Fixes #114032.

2004-02-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkmessagedialog.c (btk_message_dialog_class_init): Add
	documentation for the use_separator style property.

2004-02-03  Federico Mena Quintero  <federico@ximian.com>

	Fix #68938.

	* btk/btkdialog.c (BtkDialogPrivate): New private structure for
	BtkDialog; right now it only contains an ignore_separator field.
	(btk_dialog_class_init): Register the private structure.
	(btk_dialog_init): Initialize the priv->ignore_separator field.
	(_btk_dialog_set_ignore_separator): New private function.
	(btk_dialog_set_has_separator): Ignore the setting if appropriate.

	* btk/btkmessagedialog.c (btk_message_dialog_class_init): Add a
	use_separator style property.
	(btk_message_dialog_style_set): Change the dialog's separator
	based on the style property.
	(btk_message_dialog_init): Set the dialog box to ignore the
	separator setting.

Tue Feb  3 02:35:09 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/Makefile.am: Build filesystemwin32.c if OS_WIN32 and
	also dist btkfilesystemwin32.[hc].

Tue Feb  3 02:04:44 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btklabel.c (btk_label_ensure_layout): Right-justify labels
	in rtl mode.  (#129071, chinen@jp.ibm.com)

Tue Feb  3 02:01:25 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenushell.c (btk_real_menu_shell_move_current): Exchange the
	meaning BTK_MENU_DIR_PARENT/CHILD and BTK_MENU_DIR_PREV/NEXT in rtl
	mode.  (#107528)

Tue Feb  3 01:38:06 2004  Matthias Clasen  <maclas@gmx.de>

	Clip narrow columns in rtl-oriented tree views (#128089,  
	chinen@jp.ibm.com):
	
	* btk/btkstyle.c (btk_default_draw_option): 
	* btk/btkstyle.c (btk_default_draw_check): Clip to the 
	given area.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action): 
	Use the right clip area when calling btk_cell_renderer_render().
	* btk/btktreeviewcolumn.c (_btk_tree_view_column_cell_draw_focus): 
	Use the right clip area when calling btk_paint_focus().
	* btk/btkcellrenderertoggle.c (btk_cell_renderer_toggle_render): 
	Use the right clip area when calling btk_paint_toggle() or
	btk_paint_check().
	* btk/btkcellrenderertext.c (btk_cell_renderer_text_render): 
	Clip to the expose_area when drawing the background rectangle.
	
Tue Feb  3 00:14:36 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/x11/bdkgeometry-x11.c (queue_item_free, bdk_window_queue):
	Use a weak reference instead of ref()/unref(). (#60857, reported
	by Joshua N Pritikin)

	* bdk/bdkimage.c (scratch_image_info_for_depth): Formatting fix.

Tue Feb  3 00:15:17 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeprivate.h (struct _BtkTreeViewPrivate): Add 
	init_hadjust_value and prev_width.
	* btk/btktreeview.c (btk_tree_view_init): Initialize 
	them here.
	* btk/btktreeview.c (btk_tree_view_update_size): ...and here.
	* btk/btktreeview.c (btk_tree_view_size_allocate): Use them
	here to properly handle the initial position of rtl-oriented
	tree views.  (#127581, chinen@jp.ibm.com)

2004-01-20  Federico Mena Quintero  <federico@ximian.com>

	Fix #130846, reported by R. McFarland <rwmcfa1@neces.com>.

	* btk/btktreeview.c (btk_tree_view_button_press): Return TRUE when
	we handle an event in the colums, and FALSE at the end if the
	event is not handled at all.

Mon Feb  2 23:41:48 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_row_changed): 
	Don't access the level after removing the node, since that may
	kill the level.  (#132615, Crispin Flowerday)

2004-02-02  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (bdk_pointer_grab): Set the cursor
	in all cases. If no grab cursor specified, use the grabbing
	window's cursor. If the grabbing window has no cursor, use the
	default arrow cursor. (#118025)

Mon Feb  2 22:05:36 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkseparatormenuitem.c (btk_separator_menu_item_init): The
	latest in menu separation technology.

Mon Feb  2 19:04:17 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/x11/bdkwindow-x11.c: Assume gravity works. (Anything else
	we have to take our chances with).
	
	(Bug 97510)

Mon Feb  2 18:45:28 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Fix bug 110224.

	* bdk/x11/bdkfont-x11.c (bdk_font_from_description_for_display):
	Remove unused variable 'result'

	* bdk/x11/xsettings-client.[ch]: Add new set_grab/ungrab_func() functions.

	* bdk/x11/bdkevents-x11.c (_bdk_x11_events_init_screen): Use them
	here.

Mon Feb  2 14:32:32 2004  Pablo Saratxaga  <pablo@mandrakesoft.com>

	* configure.in po/uz*.po: changed default for Uzbek; now just "uz"
	is in cyrillic and "uz@Latn" for latin; "uz@Cyrl" has been removed

Sun Feb  1 16:34:07 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Only start
	sliding when using the new API.

Sun Feb  1 16:03:39 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Make sure
	item_area is positioned correctly. Fix #133070, reported by Jeroen
	Zwartepoorte.

Sat Jan 31 23:13:43 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextchild.c (btk_text_child_anchor_finalize): Don't
	crash when finalizing an unused BtkTextChildAnchor.  (#132260,
	muppet)

Sat Jan 31 22:41:57 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodel.c (btk_tree_model_rows_reordered): Correct
	the documentation for new_order.  (#124790, Tim-Philipp Müller)

Sat Jan 31 22:38:07 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_set_fixed_width): 
	Reset use_resized_width when setting fixed_width.  (#108612, 
	Felipe Heidrich) 

Sat Jan 31 16:27:44 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmain.c (btk_key_snooper_remove): Don't leak the
	BtkKeySnooperData.  (#132038, R. McFarland)

2004-01-30  Federico Mena Quintero  <federico@ximian.com>

	Fixes #132975.

	* btk/btkfilesystem.c (btk_file_system_make_path): Return NULL,
	not FALSE.
	(btk_file_system_volume_render_icon): Likewise.

	* btk/btkfilesystemwin32.c (btk_file_system_win32_make_path):
	Likewise.

	* btk/btktreestore.c (btk_tree_store_iter_n_children): Return 0,
	not FALSE.

	* btk/btktoolbar.c (btk_toolbar_get_drop_index): Return -1, not
	FALSE.

	* btk/btktextiter.c (btk_text_iter_get_chars_in_line): Return 0,
	not FALSE.
	(btk_text_iter_get_bytes_in_line): Likewise.

	* bdk/x11/bdkcursor-x11.c (bdk_display_get_default_cursor_size):
	Likewise.

	* bdk/linux-fb/bdkcolor-fb.c (bdk_colors_alloc): Return FALSE, not
	0.

2004-01-30  Not Zed  <NotZed@Ximian.com>

	Fixes #132929.

	* btk/btktreeview.c (cancel_arrow_animation): remove the timeout
	handler when we clear the timeout id.

2004-01-30  Federico Mena Quintero  <federico@ximian.com>

	Fix #129872, based on a patch by Jan Arne Petersen
	<jpetersen@uni-bonn.de>

	* btk/btkfilesystemunix.c (btk_file_system_unix_list_bookmarks):
	Implement.
	(btk_file_system_unix_add_bookmark): Implement.
	(btk_file_system_unix_remove_bookmark): Implement.

2004-01-29  Federico Mena Quintero  <federico@ximian.com>

	Fixes #132693.

	* btk/btkfilesystemunix.c (btk_file_system_unix_get_parent): Don't
	use filename_from_path().  Also, check that the filename is
	absolute.
	(btk_file_system_unix_get_folder): Likewise.
	(btk_file_system_unix_create_folder): Likewise.
	(btk_file_system_unix_make_path): Likewise.
	(btk_file_system_unix_parse): Likewise.
	(btk_file_folder_unix_get_info): Likewise.
	(filename_from_path): Removed.

2004-01-30  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkcalendar.c (arrow_action): Remove C++ comment; reported
	by Damien Carbery <damien.carbery@sun.com>.  Fixes #132956.

Fri Jan 30 11:37:37 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdrawable-x11.c: Revert changes from
	#113476 and go back to using XftDrawSetClip, because
	XftDrawSetClipRectangles is buggy in XFree86-4.3.

Thu Jan 29 18:08:06 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextlayout.c (line_display_iter_to_index)
	* btk/btktextlayout.c (line_display_index_to_iter): Only
	adjust the preedit position for lines that include the
	preedit string. (#132353, Yao Zhang). How the heck
	did this work as well as it did?!?!

	* modules/input/btkimcontextxim.c (btk_im_context_xim_get_ic): 
	Reverse change to change of XNFilterEvents event mask from
	#110493 -- it's documented and in the Xlib code an
	unsigned long. 
	
	* modules/input/btkimcontextxim.c (preedit_start_callback): 
	Return -1 rather than void to indicate no length limit.
	(#129548)

Fri Jan 30 00:45:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkadjustment.c: Add properties to BtkAdjustment.
	(#64601, Murray Cumming)

Fri Jan 30 00:13:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombo.c (btk_combo_set_popdown_strings): Allow NULL
	for strings to clear the list.  (#105386, Marco Pesenti Gritti)
	
2004-01-28  Richard Hult  <richard@imendio.com>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_get_size):
	Free font_desc.  Fixes #132805.

2004-01-29  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkiconfactory.c (render_icon_name_pixbuf): Free the GError.
	Patch provided by Christian Persch <chpe@stud.uni-saarland.de>
	Fixes #132574.

Thu Jan 29 11:00:18 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkselection.c (btk_selection_default_handler): 
	nul-terminate the target atoms. (#132656, Christian Persch)

Thu Jan 29 00:59:03 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_rows_reordered):
	Don't leak path if we bail out early.  (#132505, Christian Persch)

Thu Jan 29 00:48:47 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_add_toggle_actions_full):
	* btk/btkactiongroup.c (btk_action_group_add_actions_full): Do
	reference counting on the user_data that is shared between
	multiple signal handlers, to avoid calling the destroy notify
	multiple times.  (#132447, Adam Hooper)

2004-01-28  Hans Breuer  <hans@breuer.org>

	* btk/stock-icons/stock_network_(16|24).png : new BTK_STOCK_NETWORK ...
	  btk/btkstock.[hc] : ... define ...
	  btk/btkiconfactory.c : ... register ...
	  btk/stock-icons/Makefile.am btk/stock-icons/makefile.msc : ... compile ...
	* btk/btkfilesystemwin32.c : ... and use. Also adapt to recent 
	IFace changes.

	* btk/btk.def : added a bunch of new exported symbols

	* tests/testfilechooser.c (no_backup_files_filter) : don't crash
	on filter_info->display_name being NULL

	* tests/testbtk.c : make testbtk --bench=all work again

Wed Jan 28 21:40:47 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (btk_entry_completion_action_data_func):
	Don't leak string.  (#132482, Christian Persch)

Tue Jan 27 18:45:47 2004  Manish Singh  <yosh@gimp.org>

        * m4macros/btk-2.0.m4: quote AC_DEFUN macro names so automake
        1.8 won't whine at us.

2004-01-28  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (synthesize_leave_event,
	synthesize_enter_event): Don' generate enter or leave events if
	the pointer is grabbed with owner_events off, and the grab event
	mask doesn't ask for them. (#129242)

	(bdk_event_translate): Ditto for focus change events.

2004-01-27  Federico Mena Quintero  <federico@ximian.com>

	Fix #132314.

	* btk/btkfilesystem.h: Removed the #ifdef-ed out, old icon API.

	* btk/btkfilesystem.c: Likewise.

	* btk/btkfilesystemunix.c (filename_get_info): Removed the old
	icon-type code.
	(btk_file_system_unix_render_icon): Moved the icon-rendering code
	from BtkFileInfo to here.
	(btk_file_system_unix_volume_render_icon): Implement.

2004-01-28  Changwoo Ryu  <cwryu@debian.org>

	* modules/input/imhangul-defs.h: 
	* modules/input/imhangul.c:
	* modules/input/Makefile.am: Remove broken hangul input module.
	
Tue Jan 27 01:56:46 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c: Remove obsolete comment.

	* btk/btktoolbar.c (DEFAULT_SPACE_SIZE, SPACE_LINE_START, 
	SPACE_LINE_END): Make separators wider and taller, so they are
	easier to pick up when editing the toolbar.

	* btk/btktoolbar.c (slide_idle_handler): Add a comment, simplify
	a bit, 

	* btk/btktoolbar.c (rect_within): Formatting fix

	* btk/btktoolbar.c (btk_toolbar_set_drop_highlight_item): Make
	sliding feel more responsive by only restarting sliding when the
	placeholder actually changes its goal allocation.

Tue Jan 27 02:00:37 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeitem.c (btk_tree_item_add_pixmaps): Avoid a 
	compiler warning.  (#122725, Kjartan Maraas)
	
Tue Jan 27 01:46:54 2004  Matthias Clasen  <maclas@gmx.de>

	Make menus work better on Xinerama (#126150):
	
	* btk/btkmenuitem.c (btk_menu_item_position_menu): Calculate the 
	monitor_num on the screen of the menu, not of the attach widget.

	* btk/btkmenu.c (menu_change_screen): Forget the stored monitor_num. 
	(btk_menu_window_size_request): Remember the monitor_num.

2004-01-26  Federico Mena Quintero  <federico@ximian.com>

	Fix #105497; constify uses of BdkColor.

	* bdk/bdkgc.c (bdk_gc_set_rgb_fg_color): Constify.
	(bdk_gc_set_rgb_bg_color): Constify.
	(bdk_gc_set_foreground): Constify.

	* bdk/x11/bdkcursor-x11.c (bdk_cursor_new_from_pixmap): Constify.
	* bdk/win32/bdkcursor-win32.c (bdk_cursor_new_from_pixmap): Constify.
	* bdk/linux-fb/bdkcursor-fb.c (bdk_cursor_new_from_pixmap): Constify.

	* bdk/x11/bdkpixmap-x11.c (bdk_pixmap_create_from_data): Constify.
	* bdk/win32/bdkpixmap-win32.c (bdk_pixmap_create_from_data): Constify.
	* bdk/linux-fb/bdkpixmap-fb.c (bdk_pixmap_create_from_data): Constify.

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_background): Constify.
	* bdk/win32/bdkwindow-win32.c (bdk_window_set_background): Constify.
	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_set_background): Constify.

	* bdk/bdkbango.c (bdk_draw_layout_line_with_colors): Constify.
	(bdk_draw_layout_with_colors): Constify.

	* bdk/bdkpixmap.c (bdk_pixmap_colormap_new_from_pixbuf): Constify.
	(bdk_pixmap_colormap_create_from_xpm): Constify.
	(bdk_pixmap_create_from_xpm): Constify.
	(bdk_pixmap_colormap_create_from_xpm_d): Constify.
	(bdk_pixmap_create_from_xpm_d): Constify.

	* btk/btkcellview.c (btk_cell_view_set_background_color): Constify.

	* btk/btkclist.c (btk_clist_set_foreground): Constify.
	(btk_clist_set_background): Constify.

	* btk/btkcolorbutton.c (btk_color_button_new_with_color): Constify.
	(btk_color_button_set_color): Constify.

	* btk/btkcolorsel.c (btk_color_selection_set_current_color):
	Constify and add a check for color != NULL.
	(btk_color_selection_get_current_color): Add a check for color != NULL.
	(btk_color_selection_set_previous_color): Constify and add a check
	for color != NULL.
	(btk_color_selection_get_previous_color): Add a check for color != NULL.

	* btk/btkctree.c (btk_ctree_node_set_foreground): Constify.
	(btk_ctree_node_set_background): Constify.

	* btk/btktext.c (btk_text_insert): Constify.
	(insert_text_property): Constify.
	(text_properties_equal): Constify.
	(new_text_property): Constify.

	* btk/btkwidget.c (btk_widget_modify_color_component): Constify.
	(btk_widget_modify_fg): Constify.
	(btk_widget_modify_bg): Constify.
	(btk_widget_modify_text): Constify.
	(btk_widget_modify_base): Constify.

2004-01-26  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "mi" to ALL_LINGUAS.

2004-01-25  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkproperty-win32.c (bdk_property_delete): If the
	WM_TRANSIENT_FOR property is being deleted, set the owner of the
	window to the root window (i.e., effectively unset it). (#132411)

	* bdk/win32/bdkprivate-win32.h
	* bdk/win32/bdkglobals-win32.c
	* bdk/win32/bdkmain-win32.c: Declare, define and initialize
	_wm_transient_for, a BdkAtom for WM_TRANSIENT_FOR.

	* acconfig.h: Remove HAVE_WINSOCK_H, not used any longer.

Sun Jan 25 15:14:46 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Base the decision
	to map/unmap items on whether they are actually allocated outside
	the toolbar, not on whether that will eventually happen. Improves
	animation in the presence of overflown items.

	* btk/btktoolbar.c (btk_toolbar_begin_sliding): Add a
	queue_resize() to so that the items will get their new goal
	values and the idle handler will not immediately return FALSE.

	* btk/btktoolbar.c (slide_idle_handler): simplify the logic and
	make sure that a placeholder becoming invisible doesn't cause a
	return TRUE.

	* btk/btktoolbar.c (get_item_size): Don't special case
	placeholders here.

Sat Jan 24 23:17:27 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbutton.c (btk_tool_button_construct_contents): Only
	try to pack icon if there actually is one.

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Make sure
	OVERFLOWN items get an allocation even when they are
	unmapped. This ensures they will slide in properly.

	* btk/btktoolbar.c (slide_idle_handler): Make sure we return TRUE
	when there are overflown items that need to slide in. Also add
	comments and make formatting more readable.

Sat Jan 24 17:38:48 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkradiotoolbutton.c (btk_radio_tool_button_class_init):
	Add a write-only property ::group to be consistent with
	BtkRadioAction and BtkRadioButton. (#132159, Patch from Olivier
	Andrieu)

Fri Jan 23 23:46:12 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfontbutton.c (btk_font_button_label_use_font): Don't leak the 
	font description.  (#132168)

2004-01-23  Federico Mena Quintero  <federico@ximian.com>

	Fix #132247.

	* btk/btkfilechooserdefault.c (set_select_multiple): Handle folder
	mode.
	(set_select_multiple): Optionally notify about changes to the
	select-multiple property.
	(list_selection_changed): Change the condition for the editable row to
	test for save mode; this is more clear than testing for not being
	in multiple selection mode.
	(btk_file_chooser_default_get_paths): Get impl->action directly
	rather than calling btk_file_chooser_get_action().
	(entry_activate): Likewise.
	(set_select_multiple): Annotate about #133255.
	(update_chooser_entry): Likewise.
	(check_preview_change): Likewise.
	(tree_selection_changed): Likewise.

Fri Jan 23 14:56:18 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c (btk_tree_view_get_path_at_pos): Don't crash
	when there are no columns, or all columns are hidden, #131402

Fri Jan 23 16:58:28 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c (DEFAULT_POPUP_DELAY): Changing to 200 was a
	mistake. Change back to 225.

Thu Jan 22 18:46:05 2004  Owen Taylor  <otaylor@redhat.com>

	* === Released 2.3.2 ===

Thu Jan 22 18:45:26 2004  Owen Taylor  <otaylor@redhat.com>

        * btk/btkicontheme.c: Patch from Christian Neumair
	to make warning string more translator friendly.

	* btk/btktreemodelfilter.h btkseparatortoolitem.[ch]
	btk/btktoolbar.c: Parameter name fixes to keep btk-doc
	happy.

	* configure.in: Require GLib-2.3.2, version 2.3.2,
	interface age 0, binary age 302.

	* NEWS: Organized, added some names.

Thu Jan 22 16:59:36 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkliststore.c (btk_list_store_reorder): Doc fix.

2004-01-22  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkwidget.c (btk_widget_class_init): Added documentation for
	BtkWidget::popup_menu.

Thu Jan 22 21:45:24 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenu.c (btk_menu_remove): Remove the attach 
	info after calling btk_menu_do_remove(), since that function
	uses the attach info. Doh!

	* btk/btkmenu.c (btk_menu_do_remove): Don't check priv->columns 
	for being 1 directly after setting it to 0.

Thu Jan 22 21:38:52 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* NEWS: Updates

2004-01-22  Alexander Larsson  <alexl@redhat.com>

	* bdk/x11/bdkwindow-x11.c (WINDOW_IS_TOPLEVEL):
	Fix typo

2004-01-21  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_finalize):
	Free the path fields.

	* btk/btkfilesystemmodel.c (btk_file_system_model_finalize): Free
	the root_path, reported by <scott@asofyet.org>
	(btk_file_system_model_finalize): Unref the file system.

	* btk/btkfilefilter.c (filter_rule_free): default:
	g_assert_not_reached().
	(btk_file_filter_finalize): Free the filter->name, reported by
	<scott@asofyet.org>
	(btk_file_filter_finalize): Free the rules list.

Wed Jan 21 18:10:40 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkcolorbutton.c (btk_color_button_set_color):redraw the
	color button when an alpha is set.
	(btk_color_button_set_alpha): redraw the color button when an
	alpha is set.

Wed Jan 21 23:27:14 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #131869: 
	
	* btk/btkaction.c (_btk_action_emit_activate): Hold
	a reference to the group while emitting the signals.

	* btk/btkactiongroup.c (btk_action_group_init): Use a 
	destroy notify which does not only unref, but also resets
	the action_group property of the action.

2004-01-20  Federico Mena Quintero  <federico@ximian.com>

	* NEWS: Added details about BtkFileChooser changes.

2004-01-20  Federico Mena Quintero  <federico@ximian.com>

	Fix #99425, add accessor functions for BtkPaned's children.

	* btk/btkpaned.c (btk_paned_get_child1): New function.
	(btk_paned_get_child2): New function.

Tue Jan 20 23:49:52 2004  Matthias Clasen  <maclas@gmx.de>

	* NEWS: Start of 2.3.2 section.

Tue Jan 20 22:11:31 2004  Matthias Clasen  <maclas@gmx.de>

	Fixes for #130370, based on a patch by Michael Meeks:
	
	* btk/btkmenu.c (btk_menu_do_remove): New auxiliary function to
	adjust cell positions and recalculate row and column counts after
	removing an item.

	* btk/btkmenu.c (btk_menu_remove): Call btk_menu_do_remove.

	* btk/btkmenu.c (btk_menu_do_insert): Don't leave empty rows when
	appending items.

	* btk/btkmenu.c (btk_menu_attach): Don't call btk_menu_shell_append,
	to avoid an unintended recursion.

2004-01-19  Federico Mena Quintero  <federico@ximian.com>

	Fix #131418.

	* btk/btkfilechooserdefault.c (set_select_multiple): New helper
	function.
	(btk_file_chooser_default_set_property): Use
	set_select_multiple().  Also, re-set this mode to single if the
	file chooser is set to Save mode.
	(entry_activate): Handle the case where the entry is completely
	empty *and* its current folder does exist.  Also, there is need to
	test for select_multiple here now that we ensure that it won't
	happen during Save mode.

Sun Jan 18 15:25:39 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.[ch]: Add _btk_toolbar_paint_space_line(),
	_btk_toolbar_get_default_space_size ();

	* btk/btkseparatortoolitem.c (btk_separator_tool_item_expose,
	get_space_size): Use them here.

Sun Jan 18 13:16:34 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* tests/testbtk.c (create_toolbar): Set a small size request and
	make the window resizable, to test mapping/unmapping of buttons.

	* btk/btktoolbar.c (btk_toolbar_remove_content,
	btk_toolbar_insert_tool_item): remove these functions.

	* btk/btktoolbar.c (btk_toolbar_show_all,
	toolbar_content_show_all, btk_toolbar_hide_all,
	toolbar_content_hide_all): New functions. 

	Ignore show_all/hide_all for buttons created in compatibility mode.

	* btk/btktoolbar.c (internal_insert_element, btk_toolbar_show_all,
	btk_toolbar_hide_all): Make sure buttons are ignored by
	btk_toolbar_show_all() and btk_toolbar_hide_all().
	
	* btk/btktoolbar.c: s/regular_widget/compatibility/g

	* btk/btktoolbar.c (struct _ToolbarContent): Allocate
	BtkToolbarChild inline. Get rid of BtkToolbarChildSpace.

	* btk/btktoolbar.c (toolbar_content_expose): Fix bug where widget
	could become NULL.

	* btk/btktoolbar.c (btk_toolbar_add): Append new tool items
	instead of prepending them.

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Use the same
	'elapsed' for all items.

	* btk/btktoolbar.c (struct _BtkToolbarPrivate): Turn booleans
	into bitfields.

	* btk/btktoolbar.c: Many formatting fixes
	
Sun Jan 18 01:51:12 2004  Matthias Clasen  <maclas@gmx.de>

	* configure.in: Add the necessary magic to create
	po-properties/Makefile.

Sat Jan 17 23:05:52 2004  Matthias Clasen  <maclas@gmx.de>

	The second part of the fix for #114351 (see also 
	bdk-pixbuf/ChangeLog and po/ChangeLog):

	* Makefile.am (SUBDIRS): Add po-properties.

	* configure.in (AC_CONFIG_FILES): Add po-properties/Makefile.in 

	* bdk/bdkintl.h (P_): 
	* btk/btkintl.h (P_): Use translation domain btk20-properties. 

	* btk/btkmain.c (btk_parse_args): Call bindtextdomain and
	bind_textdomain_codeset for btk20-properties as well.

Sat Jan 17 22:00:07 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c: 

	Fix rest of #128678: Implement all the toolbar_content()
	methods for the old API case.

Sat Jan 17 16:53:08 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c: 

	Phase 1 of fixing #128678: Only access ToolbarContent through a
	set of new functions:

	toolbar_content_expose, toolbar_content_visible,
	toolbar_content_size_request, toolbar_content_is_homogeneous,
	toolbar_content_get_child_requisition,
	toolbar_content_is_placeholder, toolbar_content_disappearing,
	toolbar_content_get_state, toolbar_content_child_visible,
	toolbar_content_get_goal_allocation,
	toolbar_content_get_allocation,
	toolbar_content_set_start_allocation,
	toolbar_content_get_start_allocation, toolbar_content_get_expand,
	toolbar_content_set_goal_allocation,
	toolbar_content_set_child_visible, toolbar_content_size_allocate,
	toolbar_content_set_state, toolbar_content_get_widget,
	toolbar_content_set_disappearing,
	toolbar_content_set_size_request,
	toolbar_content_toolbar_reconfigured,
	toolbar_content_retrieve_menu_item, 
	toolbar_content_new_tool_item, toolbar_content_destroy,
	toolbar_content_is_separator

	Also fix #127092.
	
Sat Jan 17 12:55:13 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolitem.c (btk_tool_item_finalize): don't leak the menu
	item ID.

Sat Jan 17 12:37:46 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_finalize): Don't leak the
	overflow menu.
	
	* btk/btktoolbar.h (struct _BtkToolbar): Make some fields public. 
	[#127726]

2004-01-16  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystemmodel.c (struct _BtkFileSystemModel): Added a
	has_editable field.
	(_btk_file_system_model_add_editable): New function.
	(_btk_file_system_model_remove_editable): New function.
	(btk_file_system_model_get_value): Return appropriate values for
	the temporary editable row.
	(_btk_file_system_model_get_info): Handle the editable row.
	(_btk_file_system_model_get_path): Likewise.

	* btk/btkfilechooserdefault.c (shortcuts_append_bookmarks):
	Removed an unused variable.
	(toolbar_button_new): Optionally show the button.
	(up_button_clicked_cb): Renamed from up_button_cb(), fixed prototype.
	(toolbar_create): Add a "New Folder" button for Save mode.
	(error_building_filename_dialog): New helper function.
	(btk_file_chooser_default_get_paths): Use error_building_filename_dialog().
	(create_file_list): Connect to the "edited" signal of the text
	cell renderer.  Store the name column and text renderer in the
	impl structure.
	(renderer_edited_cb): New callback.
	(btk_file_chooser_default_set_property): Show/hide the "New
	folder" button when the save action changes.
	(COMPARE_DIRECTORIES): Allow the info values to be NULL.
	(COMPARE_DIRECTORIES): Duh, use the list_model, not the
	tree_model.
	(get_list_file_info): Likewise!
	(list_icon_data_func): Handle the path being NULL.
	(new_folder_button_clicked): New callback.
	(list_name_data_func): If we are on the editable row, set the text
	to "Type name of new folder".
	(list_selection_changed): Handle the editable row.
	(list_mtime_data_func): Likewise.

	* btk/btkfilesystemunix.c (btk_file_system_unix_make_path): Return
	NULL, not FALSE.
	(btk_file_system_unix_create_folder): Test the result of mkdir() correctly.

Fri Jan 16 23:59:01 2004  Matthias Clasen  <maclas@gmx.de>

	The first part of the fix for #114351 (see also 
	bdk-pixbuf/ChangeLog and po/ChangeLog):
	
	* btk/btkintl.h: 
	* bdk/bdkintl.h: Define P_() for property blurbs and nicks.

	* bdk/bdkdisplaymanager.c:
	* modules/input/btkimcontextxim.c:
	* btk/*.c:  Mark property blurbs and nicks with P_().
	
2004-01-16  Federico Mena Quintero  <federico@ximian.com>

	Fix #130969.

	* btk/btkcellrenderer.h (struct _BtkCellRendererClass): Added an
	editing_canceled signal.

	* btk/btkcellrenderer.c (btk_cell_renderer_class_init): Create the
	"editing-canceled" signal.
	(btk_cell_renderer_editing_canceled): New function.

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_editing_done):
	Call btk_cell_renderer_editing_canceled().

2004-01-16  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_set_property): Do not allow setting
	select_multiple when in Save mode.
	(set_list_model): No need to nullify the list_model and
	sort_model.
	(btk_file_chooser_default_get_paths): Handle folder mode as well.
	(get_paths_foreach): Likewise.

	* btk/btkfilechooser.c (btk_file_chooser_get_filename): Clarify
	documentation about folder mode.
	(btk_file_chooser_get_uri): Likewise.

2004-01-16  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystem.h (struct _BtkFileSystemIface): New
	get_volume_for_path() method.
	(struct _BtkFileSystemIface): Finally removed the list_roots() and
	get_root_info() methods, and the "roots-changed" signal.

	* btk/btkfilesystem.c (btk_file_system_get_volume_for_path): New
	function.
	(btk_file_system_list_roots): Removed.
	(btk_file_system_get_root_info): Removed.

	* btk/btkfilesystemunix.c
	(btk_file_system_unix_get_volume_for_path): Implement.
	(get_root_volume): New helper function.
	(btk_file_system_unix_list_volumes): Use get_root_volume().
	(btk_file_system_unix_list_roots): Removed.
	(btk_file_system_unix_get_root_info): Removed.

	* btk/btkfilesystemmodel.c (_btk_file_system_model_new): Don't
	accept a NULL root_path.
	(struct _BtkFileSystemModel): Add a field to remember the
	root_path.
	(_btk_file_system_model_new): Store the root_path in the model
	structure.
	(find_and_ref_path): Stop going up the hierarchy at the root_path
	of the model.  Also, don't return prematurely when walking up the
	hierarchy.

	* btk/btkfilechooserdefault.c (create_file_list): Sigh, restore
	the rules_hint.
	(struct _BtkFileChooserDefault): Added a current_volume_path field.
	(set_tree_model): New function; create the folder tree model here.
	(create_folder_tree): Don't create the model here.
	(set_list_model): Set the show_hidden flag on the list model.

Fri Jan 16 00:04:43 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btknotebook.h:
	* btk/btknotebook.c (btk_notebook_append_page): 
	* btk/btknotebook.c (btk_notebook_append_page_menu): 
	* btk/btknotebook.c (btk_notebook_prepend_page): 
	* btk/btknotebook.c (btk_notebook_prepend_page_menu): 
	* btk/btknotebook.c (btk_notebook_insert_page): 
	* btk/btknotebook.c (btk_notebook_insert_page_menu): Return the
	index of the newly inserted page.  (#130986, Olexiy Avramchenko) 

Thu Jan 15 23:17:14 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (btk_ui_manager_get_toplevels): Inserting
	a 'newly-allocated' to hint that the list should be freed after
	use.

Wed Jan 14 18:01:52 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c (btk_tree_view_button_press): move grab_focus
	to after handling the button presses in the TreeView to avoid
	getting multiple selection_changes()

Wed Jan 14 21:16:20 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkimcontext.c: Documentation fix.  (#131335, Theppitak 
	Karoonboonyanan)

Wed Jan 14 21:00:49 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_add_action_with_accel): 
	Don't leak name and stock_id.  (#131358, Morten Welinder)

Wed Jan 14 13:07:30 GMT 2004  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Updates to Section 5

Wed Jan 14 02:34:57 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkradioaction.c: Add a writable group property to align
	with the BtkRadioButton API.  (#129166, Olivier Andrieu) 

Tue Jan 13 14:48:27 GMT 2004  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Update info on using autoconf

Mon Jan 12 23:40:34 2004  Matthias Clasen  <maclas@gmx.de>

	* tests/testmerge.c: Adjust to the new connect_proxy signals.

	* btk/btkuimanager.c
	* btk/btkactiongroup.c
	* btk/btkaction.c: Move the connect_proxy and disconnect_proxy signals
	from BtkAction to BtkActionGroup and proxy it on BtkUIManager. This
	removes the confusion between the disconnect_/connect_proxy signals 
	and the (unrelated) virtual functions of the same name and aligns
	the setup with the pre_/post_activate signals.

2004-01-12  Jody Goldberg <jody@bunny.org>

	* btk/btkaction.c (connect_proxy) : only connect activate for menus
	  with no submenus otherwise it looks like we activate every time a
	  submenu opens.

2004-01-12  Jody Goldberg <jody@bunny.org>

	* btk/btkuimanager.c: Remove accidentially committed debug spew.

Sun Jan 11 01:55:07 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaccelmap.c: Remove accidentally committed notification stuff. 
	(btk_accel_map_lock_path): 
	(btk_accel_map_unlock_path): Path locking can now be nested, a missing
	entry is silently created during lock_path(), and treated as an error 
	during unlock_path(). These changes have been requested by Tim Janik.

2004-01-10  Jody Goldberg <jody@bunny.org>

	* btk/btkuimanager.c (d) : Add a debug macro to quiet the spew.
	s/merge_signals/ui_manager_signals/ for readability.
	(btk_ui_manager_class_init) : add pre_activate and post_activate
	  signals.
	(cb_proxy_pre_activate) : new.
	(cb_proxy_post_activate) : new.
	(btk_ui_manager_insert_action_group) : connect the proxies for
	  BtkActionGroup::pre/post_activate
	(btk_ui_manager_remove_action_group) : disconnect them.

	* btk/btkactiongroup.c (btk_action_group_class_init) : add
	  'sensitive', and 'visible' properties.  Also add pre_activate and
	  post_activate signals to help deal with activations at a higher
	  level (eg BtkUIManager)
	(btk_action_group_init) : init sensitive and visible
	(btk_action_group_set_property) : add sensitive and visible
	(btk_action_group_get_property) : add sensitive and visible
	(btk_action_group_get_sensitive) : new.
	(btk_action_group_get_visible) : new.
	(cb_set_action_sensitivity) : new with minor optimization that only
	  signals sensitivity changes if the action could possibly change.
	(cb_set_action_visiblility) : ditto.
	(btk_action_group_set_sensitive) : new.  walk the actions directly
	  rather than using notify::sensitive because that is simpler, easier
	  to read, and more efficient.
	(btk_action_group_set_visible) : ditto.
	(btk_action_group_add_action) : Each action can only be in 1 group,
	  set BtkAction::action_group.
	(btk_action_group_remove_action) : clear it.
	(btk_action_group_add_toggle_actions_full) : warning suppression.
	(btk_action_group_add_radio_actions_full) : warning suppression.
	(_btk_action_group_emit_pre_activate) : new protected routine for use
	  by BtkAction.
	(_btk_action_group_emit_post_activate) : ditto.

	* btk/btkaction.c (btk_action_class_init) : add 'action_group' property.
	(btk_action_init) : initialize it.
	(btk_action_get_property) : get.
	(btk_action_set_property) : set it via
	(btk_action_set_action_group) : new function.
	(btk_action_sync_sensitivity) : new routine to sync proxy sensitivity
	  with the logical sensitivity (action & group) rather than the simple
	  action::sensitivity.
	(btk_action_sync_visible) : use btk_action_is_visible to handle
	  logical visibility (action & group) rather than the simple
	  action::visible.  Use widget show/hide directly.
	(connect_proxy) : handle the custom sensitivity handler.
	  Make the TOOL_BUTTON signals more general and support TOOL_ITEM
	  directly, with special cases for TOOL_BUTTON.  Still not especially
	  good it might be useful to handle label/use_underline by parmspec
	  lookup.  Those are likely to be implemented by custom types, and are
	  assumed to exist in BtkToolItem.
	(disconnect_proxy) : disconnect the new sensitivity handler.
	(_btk_action_emit_activate) : add pre/post signals.
	(btk_action_activate) : use logical sensitivity.
	(btk_action_is_sensitive) : logical sensitivity.
	(btk_action_get_sensitive) : actual sensitivity.
	(closure_accel_activate) : use logical sensitivity.

Fri Jan  9 22:23:45 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c: Introduce a new parser state for 
	accelerator elements to avoid misparsing files containing 
	such elements.  (#131035, Morten Welinder)

Fri Jan  9 11:58:47 2004  Manish Singh  <yosh@gimp.org>

	* bdk-pixbuf/bdk-pixbuf-io.c: #include <unistd.h> for unlink()

Fri Jan  9 15:28:21 GMT 2004  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: update BtkEntry filter code example

Fri Jan  9 00:34:57 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.h:
	* btk/btkuimanager.c (btk_ui_manager_get_toplevels): New function to
	obtain a list of toplevel widgets constructed by the ui manager.

	* btk/btkuimanager.h (BtkUIManagerItemType): Change to flags, so that 
	the values can be combined for btk_ui_manager_get_toplevels().

	* tests/testmerge.c: Add a "Dump toplevels" button to test 
	btk_ui_manager_get_toplevels().

Wed Jan  7 23:20:06 2004  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/Makefile.am (demos): Add entry_completion.c
	
	* demos/btk-demo/entry_completion.c: New demo for BtkEntryCompletion 
	by Anders Carlsson  (#130464).

Wed Jan  7 23:07:28 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmain.h: 
	* btk/btkmain.c (btk_events_pending): Change the return value from 
	gint to gboolean.  (#130718, reported by Johannes Weißl)

Wed Jan  7 23:03:32 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.h: 
	* btk/btkactiongroup.c (btk_action_group_add_action_with_accel): 
	Remove the redundant name and stock_id parameters, adjust all callers.

Wed Jan  7 22:20:20 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.h: 
	* btk/btkaction.c (btk_action_new):  
	* btk/btktoggleaction.h: 
	* btk/btktoggleaction.c (btk_toggle_action_new): 
	* btk/btkradioaction.h: 
	* btk/btkradioaction.c (btk_radio_action_new): Add creation 
	functions for actions.

	* btk/btkactiongroup.c (btk_action_group_add_actions_full): 
	(btk_action_group_add_toggle_actions_full): 
	(btk_action_group_add_radio_actions_full): and use the
	new functions here.  (#125322, Patch by Jeff Frank)

Wed Jan  7 21:42:49 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaccelmap.c (btk_accel_map_lock_path): Fix grammar of 
	docs.

2004-01-07  Jan Arne Petersen  <jpetersen@uni-bonn.de>

	* btk/btkfilechooserdefault.c: (shortcuts_insert_path),
	(shortcuts_append_home), (shortcuts_append_desktop),
	(shortcuts_append_paths), (shortcuts_add_volumes),
	(shortcuts_append_bookmarks), (create_shortcuts_model),
	(btk_file_chooser_default_add_shortcut_folder): add REMOVABLE column
	to the shortcuts_model.

	(remove_bookmark_button_clicked_cb),
	(bookmarks_check_remove_sensitivity): use REMOVABLE column to check if
	bookmarks can be removed. Fixes #129873

Wed Jan  7 02:50:55 2004  Matthias Clasen  <maclas@gmx.de>

	* demos/testpixbuf-save.c: Make s, S, Control-S, p, P, Control-P,
	i, I, Control-I test bdk_pixbuf_save(), bdk_pixbuf_save_to_buffer()
	and bdk_pixbuf_save_to_callback() with jpeg, png and ico formats, 
	respectively. Tests #82203.

2004-01-06  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesel.c (btk_file_selection_create_dir_confirmed): Use
	0777 as the mode for mkdir() and let the umask do the right
	thing.  Fixes #121819.

	* btk/btkfilesystemunix.c (filename_is_root): g_path_skip_root()
	can return NULL; handle this.  Fixes #129565.

2004-01-06  Alexander Winston  <alexander.winston@comcast.net>

	* btk/btkfilesel.c: (btk_file_selection_delete_file): Removed space
	that proceeded the end-of-sentence punctuation. Fixes: #130353.

2004-01-06  Jody Goldberg <jody@bunny.org>

	* btk/btktoolitem.c (btk_tool_item_set_property) : Call 
	  btk_tool_item_set_visible_vertical for PROP_VISIBLE_VERTICAL.

2004-01-05  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_append_bookmarks): Oops,
	call shortcuts_add_bookmarks() here.
	(remove_bookmark_button_clicked_cb): Ahem, fetch the selected
	iter.
	(shortcuts_append_paths): Don't display error dialogs here.
	(create_file_list): Remove the @#$% rules hint.

2004-01-05  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (toolbar_button_new): New helper
	function.
	(toolbar_create): Do not use a toolbar widget, just an hbox
	instead.  Add the bookmarks buttons and the current folder label
	here.
	(create_filename_entry_and_filter_combo): Create the filter combo
	here.
	(filter_create): Don't show the filter combo initially.
	(up_button_cb): Renamed from toolbar_up_cb().
	(create_shortcuts_buttons): Removed.

2004-01-05  Murray Cumming  <murrayc@usa.net>

	* bdk/bdkimage.h: Added <public> documentation to the struct, as
	suggested by Owen Taylor.

2004-01-05  Jody Goldberg <jody@bunny.org>

	* btk/btkiconfactory.c (get_default_icons) : add stock indent, unindent
	  I would have prefered outdent, but compatibility seems more
	  important.
	* btk/btkstock.c (builtin_items) : ditto.
	* btk/btkstock.h : ditto.
	* btk/stock-icons/Makefile.am : ditto.
	* btk/stock-icons/stock_text_indent_16.png :
	* btk/stock-icons/stock_text_indent_24.png :
	* btk/stock-icons/stock_text_unindent_16.png :
	* btk/stock-icons/stock_text_unindent_24.png : from bunny-icon-theme

Sun Jan  4 15:29:04 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkradiotoolbutton.[ch]
	(btk_radio_tool_button_new_with_stock_from_widget): Change API so
	group is a BtkRadioButton, not a BtkWidget.

2004-01-04  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkwindow-win32.c : use SWP_NOACTIVATE in 
	bdk_window_set_keep_(above|below) to make DND work again.
	Thanks to Alif Wahid for noticing.

	* bdk/bdk.def : update externals

	* btk/btkfilesystemwin32.c : adapt to BtkFileSystemIFace changes

	* btk/btk-stock.[hc] btk/btkiconfactory.c 
	  btk/stock-icons/Makefile.am btk/stock-icons/makefile.msc :
	  btk/stock-icons/stock_harddisk_16.png 
	  btk/stock-icons/stock_harddisk_24.png 
	Harddisk stock icons for file system implementations. Beside
	FLOPPY and CDROM there is now HARDDISK, probably some 
	BTK_STOCK_NETWORK would be useful, but I could not find one.

Sat Jan  3 11:39:42 2004  Manish Singh  <yosh@gimp.org>

	* btk/btkclipboard.c: Update freedesktop.org clipboard doc link.
	Patch from Andrew Moise (#130462).

2004-01-01  Jody Goldberg <jody@bunny.org>

	* btk/btkaction.c (_BtkActionPrivate) : add visible_horizontal,
	  visible_vertical.
	(btk_action_class_init) : here.
	(btk_action_init) : here.
	(btk_action_set_property) : here.
	(btk_action_get_property) : here.
	(connect_proxy) : and here.

2003-12-30  Jody Goldberg <jody@bunny.org>

	* btk/btkactiongroup.c (btk_action_group_add_action_with_accel) :  new
	  utility routine for use in derived BtkActions with the replicated code
	  from.
	(btk_action_group_add_actions_full) : here.
	(btk_action_group_add_toggle_actions_full) : here.
	(btk_action_group_add_radio_actions_full) : and here.

2004-01-01  Taneem Ahmed  <taneem@bengalinux.org>

	* configure.in: Added "bn" to ALL_LINGUAS.

2004-01-01  Taneem Ahmed  <taneem@bengalinux.org>

	* bn.po: Added Bangla translation by 
	of Ankur group <bunny-translation@bengalinux.org>.

Fri Jan  2 02:50:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c (btk_calendar_compute_days): 
	* btk/btkcalendar.c (btk_calendar_paint_day_names): 
	* btk/btkcalendar.c (btk_calendar_init): Changes to support 
	week_start values other than 0 and 1, e.g. 6 will let weeks start
	on Saturday.  (#130349, Roozbeh Pournader) 

2003-12-31 13:49 Daniel Rogers <dsrogers@phasevelocity.org>

	* bdk/x11/bdkinput-x11.c: (bdk_input_translate_coordinates)
        
	Fix to allow reasonable pointer behavior in window mode when an
	extended input device reports an incorrect resolution of 0.  Fixes
	bug #123546
	
2003-12-31  Christian Neumair  <chris@bunny-de.org>

	* bdk-pixbuf/bdk-pixdata.c: (bdk_pixbuf_from_pixdata):
	* btk/btkfilechooserdefault.c: (list_size_data_func): Use ngettext for
	plurals (#123847).

Wed Dec 31 02:05:39 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_add_actions_full): 
	(btk_action_group_add_toggle_actions_full):
	(btk_action_group_add_radio_actions_full): Pull accelerator key
	from the stock item if stock_id is given, but accelerator 
	not.  (Noticed by Jeff Franks and Jody Goldberg)

	* tests/testmerge.c: Remove the accelerator from the "Open" entry
	to test the above change.
	
2003-12-29  Federico Mena Quintero  <federico@ximian.com>

	Make show_all() work for the extra and preview widgets; reported
	by Paolo Maggi.

	* btk/btkfilechooserdefault.c (set_preview_widget): show_all() the
	preview widget.
	(set_extra_widget): show_all() the extra widget.

Mon Dec 29 12:22:22 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkuimanager.c (do_updates): 
	* btk/btktoolbar.c (slide_idle_handler): 
	* btk/btkdnd.c (btk_drag_update_idle): 

	Add BDK_THREADS_ENTER()/BDK_THREADS_LEAVE() pairs around idle
	functions. (#130157, patch from Olexiy Avramchenko).
	
2003-12-29  Anders Carlsson  <andersca@bunny.org>

	* btk/btkradiotoolbutton.c:
	* btk/btkradiotoolbutton.h:
	* btk/btkseparatortoolitem.c:
	* btk/btkseparatortoolitem.h:
	* btk/btktoggletoolbutton.c:
	* btk/btktoggletoolbutton.h:
	* btk/btktoolbar.c:
	* btk/btktoolbar.h:
	* btk/btktoolbutton.c:
	* btk/btktoolbutton.h:
	* btk/btktoolitem.c:
	* btk/btktoolitem.h:
	Update my e-mail address.
	
Mon Dec 29 01:36:22 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaccelmap.[hc]: (btk_accel_map_lock_path, 
	btk_accel_map_unlock_path): Add a way to lock individual accelerator
	paths.  (#73207, reported by Havoc Pennington)

Sat Dec 27 23:17:56 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (slide_idle_handler): use CHILD_VISIBLE
	instead of VISIBLE to determine whether we should stop
	sliding. (#130018, reported by Christian Persch).

Fri Dec 26 23:24:35 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_add_radio_actions_full): 
	Don't use first_action without initializing it if n_entries is 0.

Thu Dec 25 00:26:34 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkcursor-x11.c (bdk_display_get_default_cursor_size):
	Add the missing _get_ to the name of the non-Xcursor version of
	this function.  (noticed by Torsten Schoenfeld)

Tue Dec 23 22:34:50 2003  Manish Singh  <yosh@gimp.org>

	* btk/btkicontheme.h: fix BTK_TYPE_ICON_INFO macro, reported by
	muppet.

2003-12-24  Jody Goldberg <jody@bunny.org>

	* btk/btkactiongroup.h : Add some const to the char * in
	  BtkActionEntry*.  We're reccomending people pass static strings to
	  them, and not freeing them.  This stems to flood of warnings that
	  result.
	* btk/btkactiongroup.c (btk_action_group_add_actions_full) : change
	  temp vars to const to match above.
	(btk_action_group_add_toggle_actions_full) : ditto.
	(btk_action_group_add_radio_actions_full) : ditto.

Wed Dec 24 01:12:53 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkclipboard.[hc]: Add BtkClipboardTargetReceivedFunc,
	btk_clipboard_request_targets() and 
	btk_clipboard_wait_for_targets().  (#101774, Dom Lachowicz)

Mon Dec 22 00:40:39 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c (btk_calendar_paint_arrow): Use 
	btk_paint_arrow instead of draw_arrow_left/draw_arrow_right.
	* btk/btkcalendar.c (draw_arrow_left):
	(draw_arrow_right): Removed. 
	* btk/btkcalendar.c (btk_calendar_realize_arrows): 
	* btk/btkcalendar.c (btk_calendar_state_changed): Set the
	arrow_state to BTK_STATE_INSENSITIVE if the calendar is 
	insensitive.  (#97376)

Sun Dec 21 23:17:01 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (update_node): 
	(update_smart_separators): 
	(_btk_menu_is_empty): 
	(find_menu_position): 
	* btk/btktreeview.c (btk_tree_view_search_dialog_destroy): 
	* btk/btkcombobox.c (btk_combo_box_relayout_item): 
	(btk_combo_box_relayout): Fix memory leaks caused by the
	failure to free the result of btk_container_get_children().

Sun Dec 21 17:34:22 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/x11/bdkwindow-x11.c (bdk_window_reparent): Set the right
	properties when the window becomes a toplevel. When a window that
	was previously a toplevel becomes a toplevel again, restore its
	window type. Also make sure the focus window is removed from the
	XID hash when it is destroyed. (#117579, reported by Morten
	Welinder, patch reviewed by Owen Taylor).

Sun Dec 21 01:54:40 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenushell.h: 
	* btk/btkmenushell.c (btk_menu_shell_cancel): New function 
	to emit the "cancel" signal on a menu shell.

	* btk/btkmenu.c (btk_menu_key_press): 
	* btk/btkoptionmenu.c (btk_option_menu_remove_menu): 
	* btk/btkmenubar.c (_btk_menu_bar_cycle_focus): Use the 
	new function instead of directly emitting the 
	signal.  (#81803, Owen Taylor)

Sun Dec 21 00:39:50 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_class_init): 
	Fix the "language_set" blurb.  
	
Sat Dec 20 22:06:03 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_size_allocate): do not invalidate
	all of treeview when resizing (#110074, patch from Soeren Sandmann).

Fri Dec 19 23:36:00 2003  Kristian Rietveld  <kris@btk.org>

	Fixes #108458.

	* btk/btkcelllayout.[ch]: added a reorder method.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_layout_init),
	(btk_tree_view_column_cell_layout_reorder): implement reorder.

	* btk/btkcellview.c (btk_cell_view_cell_layout_init),
	(btk_cell_view_cell_layout_reorder): ditto.

	* btk/btkcombobox.c (btk_combo_box_cell_layout_init),
	(btk_combo_box_cell_layout_reorder): ditto.

	* btk/btkentrycompletion.c (btk_entry_completion_cell_layout_init),
	(btk_entry_completion_reorder): ditto.

Fri Dec 19 22:18:19 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_search_equal_func): use strstr
	instead of strcmp (#117127, suggestion from Soeren Sandmann).

Fri Dec 19 21:52:46 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkmenu.c (btk_menu_do_insert): move item insertion logic
	here from btk_menu_real_insert(),
	(btk_menu_real_insert): just call btk_menu_do_insert(),
	(btk_menu_reorder_child): run _do_insert after inserting the child
	(unbreaks _reorder_child, reported by Tim Janik).

2003-12-19  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (list_mtime_data_func): Use
	g_date_strftime() for UTF-8 correctness; use Julian dates to
	simplify the function.

Fri Dec 19 01:47:34 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkscrolledwindow.c (btk_scrolled_window_size_request): 
	Test extra_width, not extra_height, when determining whether to
	set extra_width.  (#129647, Jan Arne Petersen)

Fri Dec 19 01:35:34 2003  Matthias Clasen  <maclas@gmx.de>

	Fix the behaviour of insensitive actions, which was broken
	when btk_action_activate() was changed to pay attention to 
	sensitivity  (#129557, Christian Persch)
	
	* btk/btkaction.h: 
	* btk/btkaction.c (_btk_action_emit_activate): New auxiliary
	function to emit an activate signal without regard to sensitivity.

	* btk/btkradioaction.c: 
	* btk/btktoggleaction.c: Always use _btk_action_emit_activate()
	instead of btk_action_activate().

2003-12-18  Jody Goldberg <jody@bunny.org>

	* btk/btkicontheme.c (btk_icon_theme_lookup_icon)) : Add a sanity test
	  to ensure that the base hicolor theme is installed.  Silently
	  failing to produce icons that apps assume exist in the theme seems
	  like a bad idea.

Thu Dec 18 19:13:12 2003  Kristian Rietveld  <kris@btk.org>

	Fixes #110249, reworked patch from Joshua N Pritikin.

	* btk/btktreemodelsort.c (btk_tree_model_sort_get_type),
	(btk_tree_model_sort_tree_drag_source_init),
	(btk_tree_model_sort_row_draggable),
	(btk_tree_model_sort_drag_data_get),
	(btk_tree_model_sort_drag_data_delete): implement BtkTreeDragSource.

	* btk/btktreemodelfilter.c (btk_tree_model_filter_get_type),
	(btk_tree_model_filter_tree_drag_source_init),
	(btk_tree_model_filter_row_draggable),
	(btk_tree_model_filter_drag_data_get),
	(btk_tree_model_filter_drag_data_delete): ditto.

Thu Dec 18 18:01:01 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_class_init): add key bindings
	for "*" and "/" (expand/collapse all). (#110195, reported by
	Calum Benson).

Thu Dec 18 17:52:56 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_set_property):
	clear the extra_attrs list if we set "text" after "markup".
	(Fixes #121933, Federico Mena Quintero).

2003-12-18  Alexander Larsson  <alexl@redhat.com>

	* btk/btkicontheme.c (btk_icon_info_get_embedded_rect):
	Fix typo that used the wrong x/y values for the x1, y1 point
	(#129605)

Thu Dec 18 01:41:50 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_class_init),
	(btk_cell_renderer_text_finalize),
	(btk_cell_renderer_text_get_property),
	(btk_cell_renderer_text_set_property), (get_layout): added language
	and language_set properties like BtkTextTag has. (#103800, reported
	by Owen Taylor).

Thu Dec 18 01:37:59 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c (btk_widget_activate): Correct misleading docs.
	* btk/btkbutton.c (btk_button_class_init): Add docs for the 
	"activate" signal.  (#129358, Ka-Hing Cheung)

Thu Dec 18 01:21:59 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_class_init): Jonathan got
	the logical flag backwards in the expand_collapse_cursor_row
	bindings, fixing.
	(btk_tree_view_real_expand_collapse_cursor_row): invert expand
	flag when !logical and in RTL. (Fixes #107527, reported by
	Noah Levitt).

Thu Dec 18 01:10:16 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_button_press): only start
	editing when activated by the left mouse button. (#106869,
	patch from Evan Martin).

Thu Dec 18 00:57:18 2003  Kristian Rietveld  <kris@btk.org>

	Migrating all cell renderers to use the new instance private data
	construction.

	* btk/btktreeprivate.h: remove BtkCellRendererInfo, as it is no
	longer being used.

	* btk/btkcellrenderer.c (btk_cell_renderer_init),
	(btk_cell_renderer_class_init), (btk_cell_renderer_get_property),
	(set_cell_bg_color), (btk_cell_renderer_render): remove old
	BtkCellRendererInfo handling, migrate to instance private data.

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_editing_done),
	(btk_cell_renderer_text_start_editing): moved focus_out_id
	from BtkCellRendererInfo to text renderer private data.

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_init),
	(btk_cell_renderer_pixbuf_class_init),
	(btk_cell_renderer_pixbuf_finalize),
	(btk_cell_renderer_pixbuf_get_property),
	(btk_cell_renderer_pixbuf_set_property),
	(btk_cell_renderer_pixbuf_create_stock_pixbuf),
	(btk_cell_renderer_pixbuf_get_size), (btk_cell_renderer_pixbuf_render):
	migrate to instance private data.

	* btk/btkcellrenderertoggle.c (btk_cell_renderer_toggle_class_init),
	(btk_cell_renderer_toggle_get_property),
	(btk_cell_renderer_toggle_set_property),
	(btk_cell_renderer_toggle_render): migrate to instance private data.

Thu Dec 18 00:24:32 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_class_init),
	(btk_cell_renderer_text_get_property),
	(btk_cell_renderer_text_set_property), (get_layout): add a
	single-paragraph-mode property, use private instance data.
	(Fixes #114943, reported by Morten Welinder).

Thu Dec 18 00:07:01 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodel.h (btk_tree_path_new_root),
	(btk_tree_model_get_iter_root): now deprecated (#106953, reported
	by Matthias Clasen).

Wed Dec 17 23:50:56 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_set_property):
	if we set a new stock_id and there was a previous stock_id, unref
	the pixbuf (since it was used to renderer the previous stock_id
	and stock_id might have been set to NULL now). (Fixes #122966).

2003-12-17  Marco Pesenti Gritti  <marco@bunny.org>

	* btk/btktreemodelsort.c: (btk_tree_model_sort_get_iter):

	Check that index is not bigger than level array length
	also when depth is 1. Now get_iter_first correctly return
	FALSE when the model is empty (#129411).

Wed Dec 17 23:31:19 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_search_equal_func): only
	try to strcmp or strlen if we managed to normalize and casefold
	the string correctly. Fixes crashes with non-UTF8 strings.
	(#121617, Patch from Tim-Philipp Müller).

Wed Dec 17 23:20:23 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkexpander.c (btk_expander_animation_timeout): Add missing
	BDK_THREADS_ENTER()/BDK_THREADS_LEAVE().
	* btk/btkcalendar.c, btk/btkclist.c, btk/btkexpander.c, 
	btk/btklist.c, btk/btknotebook.c, btk/btkselection.c, 
	btk/btkspinbutton.c: Cast second argument to g_timeout_add() to
	GSourceFunc instead of BtkFunction.  (#129525, Olexiy Avramchenko) 

Wed Dec 17 23:16:45 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_button_press): fix compile warning.
	(#122727, patch from Kjartan Maraas).

Wed Dec 17 21:23:01 2003  Kristian Rietveld  <kris@btk.org>

	Yay! Fixed height mode! Hooray! (Part 2 of #80868).

	* btk/btktreeview.c (btk_tree_view_class_init),
	(btk_tree_view_init), (btk_tree_view_set_property),
	(btk_tree_view_get_property), (btk_tree_view_set_model): add a
	fixed_height_mode property,
	(intialize_fixed_height_mode), (do_validate_rows),
	(column_sizing_notify), (btk_tree_view_set_fixed_height_mode),
	(btk_tree_view_style_set), (btk_tree_view_row_changed),
	(btk_tree_view_row_inserted), (btk_tree_view_remove_column),
	(btk_tree_view_insert_column): implement fixed height mode,
	(btk_tree_view_append_column), (btk_tree_view_insert_column),
	(btk_tree_view_insert_column_with_attributes),
	(btk_tree_view_insert_column_with_data_func): update docs.

	* btk/btktreeprivate.h: add two fields to BtkTreePrivate.

2003-12-07  Murray Cumming  <murrayc@usa.net>
 
	* btk/btktreemodel.c:
	(row_inserted_marshal, row_deleted_marshal, rows_reorderered_marshal)
	Actually call the default signal handlers instead of calling the
	marshallers themselves in an endless loop. These default signal handler
	callbacks are not actually set so this is only noticed by btkmm at
	the moment. Bug 123923.

2003-12-16  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystem.h (struct _BtkFileSystemIface): Added a
	"volumes-changed" signal.  Added the following methods:
		list_volumes
		volume_free
		volume_get_base_path
		volume_get_is_mounted
		volume_mount
		volume_get_display_name
		volume_render_icon

	* btk/btkfilesystem.c (btk_file_system_base_init): Create the
	"volumes-changed" signal.
	(btk_file_system_list_volumes): New function.
	(btk_file_system_volume_free): New function.
	(btk_file_system_volume_get_base_path): New function.
	(btk_file_system_volume_get_is_mounted): New function.
	(btk_file_system_volume_mount): New function.
	(btk_file_system_volume_get_display_name): New function.
	(btk_file_system_volume_render_icon): New function.

	* btk/btkfilesystemunix.c (btk_file_system_unix_volume_free): Implement.
	(btk_file_system_unix_volume_get_base_path): Implement.
	(btk_file_system_unix_volume_get_is_mounted): Implement.
	(btk_file_system_unix_volume_mount): Implement.
	(btk_file_system_unix_volume_get_display_name): Implement.
	(btk_file_system_unix_volume_render_icon): Implement.

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	Added a field for the "volumes-changed" signal connection.
	(btk_file_chooser_default_set_property): Connect to
	"volumes-changed" on the file system.
	(btk_file_chooser_default_finalize): Disconnect from
	"volumes-changed".

	* btk/btkfilechooserdefault.c (shortcuts_remove_rows): New helper
	function.
	(shortcuts_get_index): New helper function.
	(shortcuts_insert_path): Can now insert volumes as well as paths.
	(shortcuts_append_paths): Don't take is_file_system_root.
	(shortcuts_add_volumes): New function.
	(shortcuts_append_file_system_roots): Removed.
	(create_shortcuts_model): Use shortcuts_add_volumes().
	(remove_bookmark_button_clicked_cb): Check that the index is
	within range.
	(bookmarks_check_add_sensitivity): Take volumes into account.
	(shortcuts_get_selected_index): New helper function.
	(remove_bookmark_button_clicked_cb): Use
	shortcuts_get_selected_index().
	(bookmarks_check_remove_sensitivity): Likewise.
	(shortcuts_select_func): Likewise.
	(shortcuts_row_activated_cb): Handle volumes as well as normal
	paths.
	(shortcuts_activate_volume): New function.
	(struct _BtkFileChooserDefault): Removed the bookmarks_set and
	bookmarks_iter fields.
	(shortcuts_append_bookmarks): Use shortcuts_remove_rows().
	(bookmarks_changed_cb): Use shortcuts_add_bookmarks().
	(remove_bookmark_rows): Removed.
	(shortcuts_add_bookmarks): New function; moved most of the code
	over from shortcuts_append_bookmarks().
	(shortcuts_append_bookmarks): Add the separator node here, and
	then call shortcuts_add_bookmarks().

Tue Dec 16 15:01:10 2003  Manish Singh  <yosh@gimp.org>

	* btk/btkfilechooserwidget.c: fix preprocessor conditional confusion.
	(G_OS_UNIX/G_OS_WIN32 stuff)

Tue Dec 16 01:46:46 2003  Matthias Clasen  <maclas@gmx.de>

	Do not interpret distant clicks as double-clicks  (#116541,
	Bernhard Walle):
	
	* bdk/bdkdisplay.h (struct BdkDisplay): Add new fields
	double_click_distance, button_x and button_y.
	* bdk/bdkdisplay.c (bdk_display_init): Initialize the new fields.

	* bdk/bdkdisplay.h: 
	* bdk/bdkevents.c (bdk_display_set_double_click_distance): 
	New function to set the double click distance on a display.

	* bdk/bdkevents.c: Take double click distance into account
	when generating single, double or triple clicks.

	* btk/btksettings.c: Add new setting "btk-double-click-distance".

	* bdk/x11/bdkevents-x11.c: Add the XSetting 
	"Net/DoubleClickDistance" and map it to "btk-double-click-distance".

2003-12-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkdialog.c: Sigh, revert the change.

2003-12-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkdialog.c (dialog_has_cancel): Removed.
	(btk_dialog_close): Don't call dialog_has_cancel().  At least
	allows sane behavior for #101293.

Mon Dec 15 00:56:54 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkbutton.[hc]: Add new properties, xalign and yalign, with
	getter and setter btk_button_[sg]et_alignment(), to set the
	alignment of the child.  (#70961, Jody Goldberg)

2003-12-14  Hans Breuer  <hans@breuer.org>

	* btk/btkprivate.h btk/btkmain.c : handle BTK_DATADIR
	similar as the other filesystem placement 'constants' (dynamic
	resolving on win32)

	* btk/btkfilechooserwidget.c : handle file system to win32
	renaming here as will
	* btk/btkfilesystemwin32.c : implement render_icon

	* btk/btk.def bdk/bdk.def : updated externals

	* bdk/win32/bdkdisplay-win32.c : make it compile without
	<multimon.h> - i.e. even older sdk

	* bdk/win32/bdkevents-win32.c : match resize_timer_proc
	with TIMERPROC prototype

	* bdk/win32/bdkwindow-win32.c : older msvc does not know
	BITMAPV5HEADER (from win xp) either

	* btk/btkimmodule.c : make it compile even if BTK_LOCALEDIR is
	not defined

	* tests/testfilechooser.c : recent GLib crashes on 
	g_print ("%s", NULL) so avoid this

2003-12-14  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkselection-win32.c: Calls to OpenClipboard() must be
	followed by calls to CloseClipboard(). Add a missing call to
	CloseClipboard(). Found by Adam Wright, fixes #104944. Use
	API_CALL macro in more places.

2003-12-14  Tor Lillqvist  <tml@iki.fi>

	Merge from stable:

	* bdk/bdkdisplaymanager.c: Mark default_display static.

	* bdk/win32/bdkdnd-win32.c: Mark current_dest_drag static.

	* bdk/win32/bdkkeys-win32.c: Disable some overly verbose debugging
	output.

	* bdk/win32/bdkevents-win32.c: Clean up the debugging output from
	--bdk-debug=events. In general, output just one line of debugging
	output for each Windows message, plus one line for each BDK event
	generated. Indent all lines according to window procedure nesting
	level.

	(inner_window_procedure): Rename from real_window_procedure.

	(find_real_window_for_grabbed_mouse_event): Don't get misled when
	the point is in the non-client (decoration) area of the window
	returned by WindowFromPoint(). Return the root window in that
	case.

	(build_pointer_event_state): Test also MK_XBUTTON1 and
	MK_XBUTTON2 (buttons 4 and 5).

	(synthesize_enter_event): Track the mouse leaving the window in
	the event being generated, not the one mentioned in the Windows
	message.

	(propagate): Test for NULL parent earlier. Improves event
	generation from a grabbed pointer. Part of fix for #107320.

	(handle_stuff_while_moving_or_resizing): New function, to
	dispatch the main loop (once).

	(resize_timer_proc): New function, set to be called by an inerval
	timer during resizes/moves. Calls handle_stuff_while_moving_or_resizing().

	(bdk_event_translate): Drop unused return_exposes parameter.

	Handle WM_XBUTTONDOWN and UP messages (buttons 4 and 5).

	On WM_SYSKEYUP, generate a key release event also for just the Alt
	key.

	On WM_MOUSELEAVE, generate a leave event of type
	BDK_NOTIFY_ANCESTOR (and not UNKNOWN) if the mouse left a
	top-level window, and left the app completely.

	On WM_ENTERSIZEMOVE, set a flag, and start an interval timer that
	calls resize_timer_proc() at regular intervals. On
	WM_EXITSIZEMOVE, kill the timer.

	On WM_WINDOWPOSCHANGED, generate a configure event if necessary,
	and dispatch the main loop (by calling
	handle_stuff_while_moving_or_resizing()). Fixes #99540, idea by
	Herman Bloggs.

	* bdk/win32/bdkmain-win32.c (_bdk_win32_message_to_string): Handle
	also wintab messages.

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_skip_taskbar_hint):
	Instead of using WS_EX_TOOLWINDOW, implement by setting/unsetting
	the window's owner. Fixes #118093, reported by Maxime Romano.

Tue Dec  8 09:41:00 2003  Tim Evans  <t.evans@aranz.com>

	* bdk/win32/bdkwindow-win32.[ch]: Implement
	bdk_window_set_icon_list() for Win32, with support for big and
	small icons and support for alpha-channel icons under Windows
	XP. Replaces the previous implementation of bdk_window_set_icon().
	(#128762)
	
Sun Dec 14 01:28:23 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkprivate-x11.h: 
	* bdk/x11/bdkx.h: 
	* bdk/x11/bdkevents-x11.c (bdk_x11_register_standard_event_type): 
	Rename from _bdk_x11_register_event_type(), added API docs.
	* bdk/x11/bdkinput-x11.c (_bdk_input_common_init): 
	* bdk/x11/bdkimage-x11.c (_bdk_windowing_image_init): Adjust
	all callers.  (#121471, Bill Haneman)

Sat Dec 13 23:37:50 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkdraw.c (bdk_draw_pixbuf): Document that the clip mask
	of gc is ignored.  (#101983, Sebastian Rittau)

Sat Dec 13 16:13:27 2003  Kristian Rietveld  <kris@btk.org>

	A trick for a faster treeview, step 1. Patch to short circuit
	_build_tree(), inspired by Jonathan (#80868).

	* btk/btktreeview.c (btk_tree_view_init): don't put _IS_LIST in
	flags by default,
	(btk_tree_view_build_tree): don't even try to recurse when the
	model says that it is a list, remove flag unsetter,
	(btk_tree_view_set_model): change flag setting logic.

	* btk/btktreemodelsort.c (btk_tree_model_sort_get_flags):
	propagate whether or not the child model has _IS_LIST set.

	* btk/btktreemodelfilter.c (btk_tree_model_filter_get_flags):
	ditto.

Sat Dec 13 02:33:17 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkrange.c (btk_range_scroll): Undo the last change, 
	since it broke logical keynav. 
	* btk/btkrange.c (range_get_scroll_for_grab): Fix stepper
	direction in inverted scrollbars here instead.

Sat Dec 13 00:39:24 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkviewport.c (viewport_set_hadjustment_values): Implement
	"gravity" for RTL mode in a better way: Keep the distance from 
	the upper end of the page to the upper bound constant. This also 
	fixes problems with the initial position of the viewport in RTL 
	mode.  (#129063)
	
Fri Dec 12 21:00:12 2003  Kristian Rietveld  <kris@btk.org>

	Combo box flipping support.

	* btk/btkcombobox.c (btk_combo_box_menu_position),
	(btk_combo_box_size_allocate): support RTL flipping (#126518,
	patch from Matthias Clasen),
	(btk_combo_box_popup): fix popup window alignment if there's a
	cell view frame visible (#126518, patch from Semion Chichelnitsky).

	* btk/btkcellview.c (btk_cell_view_expose): support RTL flipping
	(#128348, patch from Semion Chichelnitsky).

Fri Dec 12 01:13:34 2003  Matthias Clasen  <maclas@gmx.de>

	* examples/btkdial/btkdial.c:
	* examples/menu/menu.c:
	* examples/scribble-xinput/scribble-xinput.c:
	* examples/progressbar/progressbar.c:
	* docs/tutorial/btk-tut.sgml: Remove deprecated functions
	in examples. (#129074, Olexiy Avramchenko)
	* examples/calendar/Makefile:
	* examples/rangewidgets/Makefile:
	* examples/menu/Makefile: Allow deprecated functions in
	examples which use deprecated widgets.

Fri Dec 12 00:43:16 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdk.c (bdk_threads_set_lock_functions): 
	* bdk/x11/bdkspawn-x11.c: Add "Since: 2.4" to doc comments.

Fri Dec 12 00:05:31 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkrange.c (btk_range_scroll): Fix direction of 
	steppers in inverted scrollbars.  (#129084, Olexiy Avramchenko)

Thu Dec 11 23:50:30 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btknotebook.c (btk_notebook_pages_allocate): Don't 
	unnecessarily reserve space for arrows in RTL mode.  (#129075,
	Semion Chichelnitsky)

Thu Dec 11 00:35:12 2003  Matthias Clasen  <maclas@gmx.de>

	Changes to allow "no input" windows (#64613):
	
	* bdk/bdkwindow.h (struct _BdkWindowObject): Add a new boolean
	field accept_focus.
	
	* bdk/bdkwindow.h (bdk_window_set_accept_focus): New function to
	set it.

	* btk/btkwindow.[hc]: Add a boolean property "accept_focus"
	and btk_window_get_focus() and btk_window_set_focus().

	* bdk/win32/bdkwindow-win32.c (bdk_window_new): 
	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_new): 
	* bdk/x11/bdkwindow-x11.c (bdk_window_set_new):
	Initialize the accept_focus field to TRUE.

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_accept_focus): 
	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_set_accept_focus): 
	* bdk/x11/bdkwindow-x11.c (bdk_window_set_accept_focus): 
	Implementations for the various backends. The Win32 and linux-fb
	implementations set the accept_focus field, but don't use it yet 
	to actually implement noinput windows. The X implementation updates
	the WM_HINTS to select the globally active input model (see the
	ICCCM) if accept_focus is FALSE.

	* bdk/x11/bdkevents-x11.c (bdk_wm_protocols_filter): Ignore the
	WM_TAKE_FOCUS message if accept_focus is FALSE.
	
2003-12-10  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	Added toolbar items for the filter separator and the filter item.
	(toolbar_create): Add the filter widgets here.
	(filter_create): Renamed from create_filter().  Don't store the
	alignment in the impl structure, just return it.
	(toolbar_show_filters): New function.
	(btk_file_chooser_default_add_filter): Use toolbar_show_filters().
	(btk_file_chooser_default_remove_filter): Likewise.
	(btk_file_chooser_default_constructor): Don't create the filter
	widget here.
	(struct _BtkFileChooserDefault): Added a field for a current
	folder label.
	(btk_file_chooser_default_constructor): Create the folder label.
	(btk_file_chooser_default_set_current_folder): Set the current
	folder label.

	* tests/testfilechooser.c (main): Dramatically improved the
	usability of the extra widget through careful word choice.

2003-12-10  Mark McLoughlin  <mark@skynet.ie>

	* bdk/bdk.h: include bdkspawn.h.

2003-12-10  Mark McLoughlin  <mark@skynet.ie>

	* bdk/linux-fb/bdkspawn-fb.c,
	  bdk/win32/bdkspawn-win32.c,
	  bdk/x11/bdkspawn-x11.c: (bdk_spawn_command_line_on_screen):
	s/bdk_spawn/bdk_spawn_on_screen/.

2003-12-10  Mark McLoughlin  <mark@skynet.ie>

	Utility functions for multi-screen applications which need
	to ensure launched applications appear on a certain screen.
	See bug #95897.
	
	* bdk/bdkspawn.h: header for multi-screen launching
	support.
	
	* bdk/Makefile.am: install bdkspawn.h.
	
	* bdk/x11/Makefile.am:
	* bdk/x11/bdkspawn-x11.c:
	(bdk_spawn_make_environment_for_screen): private function
	to create an environment vector with DISPLAY set appropriately
	for the screen.
	(bdk_spawn_on_screen): multi-screen version of g_spawn_async().
	(bdk_spawn_on_screen_with_pipes): version of g_spawn_async_with_pipes().
	(bdk_spawn_command_line_on_screen): version of g_spawn_command_line_async().
	
	* bdk/linux-fb/Makefile.am,
	  bdk/linux-fb/bdkspawn-fb.c: linux-fb impl.
	
	* bdk/win32/Makefile.am,
	  bdk/win32/bdkspawn-win32.c: win32 impl.

2003-12-09  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_append_home): Use "Home"
	rather than "Username's Home" (#125964).
	(shortcuts_selection_changed_cb): New callback, check the
	sensitivity of the Remove Bookmark button at the right time.
	(shortcuts_row_activated_cb): It is not necessary to check the
	sensitivity here.

Wed Dec 10 00:06:24 2003  Matthias Clasen  <maclas@gmx.de>

	Improve the BDK API for dealing with group leaders (#119375):
	
	* bdk/bdkwindow.h: 
	* bdk/x11/bdkwindow-x11.c (bdk_window_get_group): New function to 
	get the group leader of a toplevel window as a BdkWindow.

	* bdk/bdkdisplay.h: 
	* bdk/x11/bdkdisplay-x11.c (bdk_display_get_default_group): New 
	function to get the default group leader as a BdkWindow.

	* bdk/x11/bdkdisplay-x11.h (struct _BdkDisplayX11): Add a field for
	the BdkWindow of the default group leader.
	
	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Construct the BdkWindow
	for the default group leader.

2003-12-09  Noah Levitt  <nlevitt@columbia.edu>

	* bdk/bdkkeysyms.h:
	* bdk/bdkkeyuni.c: Add keysyms Ukrainian_ghe_with_upturn,
	Ukrainian_GHE_WITH_UPTURN. (#128529)

2003-12-08  Jan Arne Petersen  <jpetersen@uni-bonn.de>

	* btk/btkfilechooserdefault.c:
	(btk_file_chooser_default_get_paths), (entry_activate): Use the
	behavior of the BtkFileSelection to determine selected paths in
	single selected, BTK_FILE_CHOOSER_ACTION_SAVE mode.

2003-12-08  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_paths): Don't declare the closure
	struct twice.
	(get_paths_foreach): Likewise.

Tue Dec  9 00:12:36 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilesystemwin32.[hc]: s/Unix/Win32/g. 

2003-12-08  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdisplay-win32.c: Use <multimon.h> when compiling
	with MSVC and old headers. (#126933, John Ehresman)

Mon Dec  8 10:54:44 2003  Owen Taylor  <otaylor@redhat.com>
	 
	* === Released 2.3.1 ===

	* NEWS: Updates for 2.3.1

	* configure.in: Version 2.3.1, interface age 0, binary age 301.

	* btk/btkmenuitem.c (btk_menu_item_can_activate_accel):
	Rename from btk_menu_item_real_can_activate_accel() to
	match BTK+ convention, improve comment.

	* btk/btkwidget.c: Document btk_widget_can_activate_accel(),
	can ::can-activate-accel signal.

	* btk/btkwidget.c (closure_accel_activate): Fix spelling
	in comment.

	* btk/btkmenu.c (btk_menu_real_can_activate_accel): Clean 
	up comment.
	
	* btk/btkcellview{,menuitem}.[ch]: Move GET_PRIVATE() macros
	into the .c file.

Mon Dec  8 12:09:21 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkicontheme.c (find_builtin_icon): Fix a
	missing 'else'. (#128816, Jorn Baayen)

2003-12-02  Michael Meeks  <michael@ximian.com>

	Based on a patch by Martin Kretzschmar; #122448
	
	* bdk/bdk.h: new bdk_threads_lock, bdk_threads_unlock, point to
	implementation of BDK_THREADS_ENTER / BDK_THREADS_LEAVE.
	(BDK_THREADS_ENTER, BDK_THREADS_LEAVE): use bdk_threads_[un]lock
	function pointers. Deprecate the global bdk_threads_mutex variable.
	
	* bdk/bdk.c (bdk_threads_impl_lock, bdk_threads_impl_unlock): new,
	extracted from BTK_THREADS_ENTER/LEAVE macros.
	(bdk_threads_init): init btk_threads_[un]lock if not set.
	(bdk_threads_set_lock_functions): impl.

	* bdk/bdkglobals.c: add definitions of bdk_threads_[un]lock.

Sun Dec  7 23:45:40 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c (btk_icon_theme_has_icon): Don't crash if
	icon_theme_builtin_icons hasn't been initialized.  (#128726, Diego
	Gonzalez)

2003-12-07  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_icon): Don't use the
	return value from SendMessage(WM_SETICON). That is the old
	icon. Fixes GDI resource leak. (#128559, Tim Evans)

	* bdk/win32/bdkevents-win32.c (bdk_pointer_grab): If we already
	have a pointer grab active with a grab cursor set, destroy that
	cursor to avoid a GDI resource leak. (#128410, Tim Evans)

2003-12-05  Paisa Seeluangsawat  <paisa@users.sf.net>

        * configure.in: Added Thai (th) to ALL_LINGUAS.

Sat Dec  6 01:42:04 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkalignment.c (btk_alignment_size_allocate): Implement
	RTL flipping for BtkAlignment.  (#127585)

Sat Dec  6 01:13:09 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombo.c (btk_combo_get_pos): Fix the position of the 
	popup window when in RTL mode.  (#127578)

Fri Dec  5 15:30:16 2003  Manish Singh  <yosh@gimp.org>

	* btk/btkaccelgroup.c (quick_accel_find): Applied patch from
	Ross McFarland <rwmcfa1@neces.com>, initialize *count_p to 0
	before doing anything to prevent garbage returns.

Sat Dec  6 00:23:46 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkviewport.c: Implement RTL flipping for 
	BtkViewport: Adjust the "gravity" when resizing
	This is a bit flickery in RTL mode.  (#107526)

Sat Dec  6 00:22:14 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkscrolledwindow.c: Implement RTL flipping for 
	BtkScrolledWindow: the vertical scrollbar shows up on the left
	side in RTL mode.  (#107526)

Fri Dec  5 01:58:33 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btknotebook.c: Implement RTL flipping for BtkNotebook:
	tabs displayed at the top/bottom are rearranged, and tabs on
	the left/right are displayed at the opposite edge.  (#96630)

2003-12-04  Mark McLoughlin  <mark@skynet.ie>

	* btk/btklabel.c: (btk_label_set_attributes_internal): Allow
	btk_label_set_attributes() take NULL. See bug #128517.

2003-12-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserentry.c (struct _BtkFileChooserEntry): Removed
	the in_change flag.
	(completion_idle_callback): Use a temporary list store and re-set
	it on the completion rather than modifying the old one.  We are
	re-reading the folder anyway, and this gets rid of non-atomicity
	problems.

2003-12-01  Federico Mena Quintero  <federico@ximian.com>

	Decouple impl->current_folder from the selection in the folder
	tree.  This is so that going to /home/federico/.foo (e.g. from a
	bookmark) will work even if show_hidden == FALSE.  The folder tree
	needs to be fixed in this case to show such folders explicitly.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_set_current_folder): When changing
	folders, do the entry and list model work here, instead of
	tree_selection_changed().
	(struct _BtkFileChooserDefault): Added a changing_folder flag
	again, dum de dum.
	(tree_selection_changed): Use _btk_file_chooser_set_current_folder_path().

Tue Dec  2 01:01:54 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconfactory.h: Remove duplicate declaration of 
	btk_icon_source_set_icon_name().  (#Jeff Franks, #128269)

2003-12-01  Federico Mena Quintero  <federico@ximian.com>

	Patch from Hans-Petter Jansson <hpj@ximian.com> to align the
	bookmarks buttons with the location entry.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_constructor): Use a BtkSizeGroup for the
	bookmarks buttons and the location entry.

2003-12-01  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (create_shortcuts_tree): Set the
	shortcuts tree as a drag destination.
	(shortcuts_drag_data_received_cb): New callback.
	(get_file_info): Also fetch information on whether the file is a folder.
	(add_bookmark_button_clicked_cb): Use error_could_not_add_bookmark_dialog().
	(error_could_not_add_bookmark_dialog): New function.
	(shortcuts_add_bookmark_from_path): New helper function.
	(add_bookmark_button_clicked_cb): Use shortcuts_add_bookmark_from_path().
	(shortcuts_row_activated): We no longer need the changing_folder flag.
	(struct _BtkFileChooserDefault): Likewise.

Sun Nov 30 17:31:32 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (slide_idle_handler): return TRUE if there are
	disappearing placeholders that are still visible.

	* btk/btktoolbar.c: formatting fixes

	* btk/btktoolbar.c (struct _ToolbarContent): new bit:
	disappearing, for placeholders that are going to disappear.

	* btk/btktoolbar.c (get_item_size): return 0 for disappearing placeholders

Sat Nov 29 00:55:28 2003  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c (btk_tree_view_new_column_width): 
	* btk/btktreeviewcolumn.c (_btk_tree_view_column_realize_button):
	Patch from <chinen@jp.ibm.com> to handle RTL support for column
	resizers, #127874

Fri Nov 28 00:26:24 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilesystemmodel.c (btk_file_system_model_finalize): 
	Don't use freed memory.  (#127698, Taavi Talvik) 

Fri Nov 28 00:09:10 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserentry.c: Remove debug g_print()s. 

Thu Nov 27 22:17:50 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c: Remove debug define.

Thu Nov 27 16:19:03 2003  Tim Janik  <timj@btk.org>

	* btk/btkmenu.c: allow accel activation depending on sensitivity
	and the attach widget.

	* btk/btkmenuitem.c: allow accel activation depending on visibility,
	sensitivity and the parent menu.

	* btk/btkwidget.[hc]: introduced ::can-activate-accel signal which
	checks whether accelerators may activate a widget. the default handler
	demands the widget be sensitive and visible+viewable.

	* btk/btkaccelgroup.[hc]: export btk_accel_group_activate().

Tue Nov 25 00:10:05 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (update_node): Don't show accelerators in
	popup menus.  (#127227)

Mon Nov 24 13:47:39 GMT 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: start 2.x Section 4 updates

Mon Nov 24 04:05:15 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkradiotoolbutton.[ch]
	(btk_radio_tool_button_new_from_widget): Make this function take a
	BtkRadioToolButton instead of a BtkWidget. (#127729, Murray
	Cumming)

Mon Nov 24 02:34:00 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c: remove variables in_dnd and leaving_dnd

Mon Nov 24 02:19:33 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c: remove variable
	n_overflowed_menu_items_when_dnd_started

Mon Nov 24 01:47:10 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	Rework sliding algorithm.
	- No more weird jumping when items are dragged off and added to
	the toolbar,
	- More natural item movement

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Many changes. This
	function is now responsible for calculating intermediate positions
	during item sliding. It is also responsible for starting sliding
	if items disappear.  Also turn off expanding when there is an
	overflow menu.
	(btk_toolbar_begin_sliding, stop_sliding): New functions.
	(slide_idle_handler): New function. All the sliding is now done by
	btk_toolbar_size_allocate(), so the idle handler now just checks
	if there is more sliding to be done.
	(compute_intermediate_allocation, position): new functions
	calculating intermediate steps in the slide animations. The new
	animation algorithm uses a constant speed instead of a constant
	must-be-finished-within time.
	(struct _ToolbarContent): use 
	BtkAllocation goal_allocation; and 
	BtkAllocation start_allocation; instead of 
	gint start/goal_width;

	* btk/btktoolitem.c (btk_tool_item_set_tooltip): fix typo in
	documentation

Sun Nov 23 22:26:25 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btktooltips.c (btk_tooltips_draw_tips): Make tooltip 
	positioning Xinerama-aware.  (#127332)

Fri Nov 21 01:57:21 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkscreen-x11.c (init_xinerama_support): Make monitor
	boundaries visible in fake Xinerama mode.

Thu Nov 20 15:41:56 2003  Manish Singh  <yosh@gimp.org>

	* btk/btkmenu.c (btk_menu_set_tearoff_state): cast to BTK_WIDGET()
	for the btk_widget_hide() call.

Thu Nov 20 14:51:41 2003  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreedatalist.c (btk_tree_data_list_compare_func): Patch
	from David Hampton to fix sorting on booleans.

Thu Nov 20 15:48:03 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btksocket.c (btk_socket_focus): Use btk_widget_is_focus()
	instead of BTK_WIDGET_HAS_FOCUS. (#122327, Owen Taylor. Reported
	by Frederic Crozat).

Thu Nov 20 13:10:29 GMT 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Update Section 3 to 2.x

2003-11-19  Federico Mena Quintero  <federico@ximian.com>

	Fixes to problems reported by Iain Holmes:

	* btk/btkfilechooserdefault.c (shortcuts_append_desktop): Do not
	throw up an error dialog if the desktop doesn't exist.
	(error_message): Handle the case where there is no real toplevel

	yet.
	(list_model_filter_func): Always let folders pass through (patch
	by Dave Malcolm).

Wed Nov 19 23:19:23 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.[ch] (btk_combo_box_scroll_event): move function
	to a somewhat more logical place,
	(btk_combo_box_remove_text): New function (#125262, Owen Taylor).

Wed Nov 19 22:15:01 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentry.c (btk_entry_completion_timeout): always resize
	the popup when it is visible, popdown when there are less chars
	than the minimum key length in the entry,
	(btk_entry_completion_changed): popdown when the entry is empty.

	* btk/btkentrycompletion.c (btk_entry_completion_init): set the
	size request of the vscrollbar to (-1, 0), to get a nicely sized
	completion treeview (Fixes #126573, reported by Piers Cornwell),
	(_btk_entry_completion_resize_popup): show/hide the action_view
	based on items.

2003-11-19  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdialog.c (btk_file_chooser_dialog_init): Turn
	off the dialog's separator (thanks to Iain Holmes).

Wed Nov 19 18:15:00 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c (DEFAULT_POPUP_DELAY): set to 200 instead of 225
	* btk/btkmenuitem.c (get_minimum_width): Impose a minimum width
	on items that have a submenu. (#120104).

Wed Nov 19 18:11:08 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (struct _ToolbarContent): Add a new
	"ItemState" field indicating the overflowed-ness etc. of the item.
	(btk_toolbar_size_allocate): update the field here.

2003-11-19  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (create_filter): Don't add padding
	to the alignment.  Use the HIG-specified spacing between the
	filter label and the combo.
	(create_filename_entry): Use HIG-specified spacing between the
	location label and the entry.
	(btk_file_chooser_default_constructor): Don't use vertical padding
	around the filename entry.

2003-11-19  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystem.h (struct _BtkFileSystemIface): Added a
	render_icon virtual method.

	* btk/btkfilesystem.c (btk_file_system_render_icon): New function.

	* btk/btkfilesystemunix.c (btk_file_system_unix_render_icon):
	Implement as a stub for now.

	* btk/btkfilechooserdefault.c (shortcuts_insert_path): Use
	btk_file_system_render_icon().
	(list_icon_data_func): Likewise.
	(toolbar_create): Set the toolbar style to icons only.

	* btk/btkfilechooser.c (btk_file_chooser_add_shortcut_folder_uri):
	Fix doc comments.

Wed Nov 19 02:18:37 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenu.c (btk_menu_set_tearoff_state): Call 
	btk_widget_hide(menu) when reattaching the menu.  (#126057) 

Wed Nov 19 00:06:04 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentrycompletion.c (btk_entry_completion_selection_changed):
	only unselect all items if the treeview has focus. (Fixes bug
	reported by Marco Pesenti Gritti).

Tue Nov 18 22:26:30 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentry.c (btk_entry_completion_key_press): the total
	number of actions is "matches + actions - 1". (Fixes #126572).

Tue Nov 18 21:05:05 2003  Christian Persch  <chp@cvs.bunny.org>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_row_inserted): fix
	mem leaks (#119435).

Tue Nov 18 20:51:38 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_row_deleted): don't
	try to fetch the child back, since we do know that it is already
	gone by now (#126493, Marco Pesenti Gritti).

Tue Nov 18 19:47:59 2003  Kristian Rietveld  <kris@btk.org>

	Fixes based on comments from Owen Taylor, #125264.

	* btk/btkcellview.[ch] (btk_cell_view_finalize): remove unused
	variable,
	(btk_cell_view_set_value), (btk_cell_view_set_displayed_model): queue
	a resize,
	(btk_cell_view_get_size_of_row): new function,
	(btk_cell_view_set_value), (btk_cell_view_set_valuesv),
	(btk_cell_view_set_values), (btk_cell_view_set_model),
	(btk_cell_view_set_displayed_row), (btk_cell_view_get_displayed_row):
	s/cellview/cell_view/ in the function definitions, so they match
	with the header file.

	* btk/btkcombobox.c (btk_combo_box_remeasure): remove the resize
	flag again (:, and use btk_cell_view_get_size_of_row instead of
	the measurer, remove _set_size_request call,
	(btk_combo_box_calc_requested_width): use btk_cell_view_get_size_of_row
	instead of the measurer,
	(btk_combo_box_style_set): queue a resize,
	(btk_combo_box_size_request): update of _remeasure call,
	(btk_combo_box_init), (btk_combo_box_cell_layout_pack_start),
	(btk_combo_box_cell_layout_pack_end),
	(btk_combo_box_cell_layout_clear),
	(btk_combo_box_set_model): get rid of the measurer,
	(btk_combo_box_cell_layout_add_attribute),
	(btk_combo_box_cell_layout_set_cell_data_func),
	(btk_combo_box_cell_layout_clear_attributes): ditto and queue a
	resize instead of calling _remeasure.

Mon Nov 17 16:25:04 2003  Manish Singh <yosh@gimp.org>

	* bdk-pixbuf/Makefile.am
	* modules/input/Makefile.am: Use install-data-hook for
	bdk-pixbuf.loaders and btk.immodules install generation targets.
	Fixes #112806.

	* btk/btkexpander.h: Apply missing declarations from #124449.

Tue Nov 18 00:12:55 2003  Matthias Clasen  <maclas@gmx.de>

	Fix for #119555, Peter Zelezny:
	
	* bdk/bdkdrawable.h: Declare bdk_drawable_copy_to_image.
	* bdk/bdkdraw.c (bdk_drawable_copy_to_image): Make public
	by removing the _ prefix. 
	* bdk/bdkdraw.c, bdk/bdkpixbuf-drawable.c, bdk/bdkpixmap.c, 
	bdk/bdkwindow.c: Adjust all callers.

Mon Nov 17 23:36:02 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.c (btk_action_activate): Only activate if 
	the action is sensitive.  (#127187, Christian Persch)

Mon Nov 17 23:23:49 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c: Add mouse wheel support.  (#126517)

Mon Nov 17 22:56:09 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentryprivate.h: add _btk_entry_completion_resize_popup.

	* btk/btkentry.c (btk_entry_completion_timeout): popup when not
	mapped, else resize_popup.

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup),
	(_btk_entry_completion_popup): moved all popup resizing code to
	_btk_entry_completion_resize_popup, and show the window when there
	are more than zero items in the completion list again (sigh).

2003-11-17  Mark McLoughlin  <mark@skynet.ie>

	Patch from Jaiserca <jaiserca@inf.upv.es> to add a
	"use_markup" property. See bug #124449.

	* btk/btkexpander.c:
	(btk_expander_class_init),
	(btk_expander_init), (btk_expander_set_property),
	(btk_expander_get_property), (btk_expander_set_label),
	(btk_expander_set_use_markup),	(btk_expander_get_use_markup):
	Add a "use_markup" property and use it when creating the
	child label.

Mon Nov 17 12:58:32 2003  Kristian Rietveld  <kris@btk.org>

	Temporary size requisition fix. Will fix it for real tonight.

	* btk/btkcombobox.c (btk_combo_box_remeasure): add a resize flag,
	(btk_combo_box_size_request): use btk_combo_box_remeasure to determine
	a good width for the child,
	(btk_combo_box_cell_layout_add_attribute),
	(btk_combo_box_set_cell_data_func),
	(btk_combo_box_cell_layout_clear_attributes): update.

Mon Nov 17 00:11:21 2003  Kristian Rietveld  <kris@btk.org>

	Fixes #124373, Murray Cumming.

	* btk/btkcombobox.[ch] (btk_combo_box_class_init): the model property
	is no longer construct only,
	(btk_combo_box_unset_model), (btk_combo_box_set_model_internal),
	(btk_combo_box_menu_fill): new functions,
	(btk_combo_box_menu_setup), (btk_combo_box_menu_destroy),
	(btk_combo_box_menu_row_*), (btk_combo_box_list_setup),
	(btk_combo_box_list_destroy): updated,
	(btk_combo_box_new), (btk_combo_box_new_with_model): new/changed
	functions,
	(btk_combo_box_set_model): is now public, updated,
	(btk_combo_box_get_model): small update.

	* btk/btkcomboboxentry.[ch] (btk_combo_box_entry_class_init): the
	text_column property is no longer construct only,
	(btk_combo_box_entry_set_text_column): now public,
	(btk_combo_box_entry_new), (btk_combo_box_entry_new_with_model):
	new/changed functions.

	* tests/testcombo.c: updated.

Sun Nov 16 22:50:58 2003  Matthias Clasen  <maclas@gmx.de>

	Reinstate fixes for (#124212, Marco Pesenti Gritti):
	
	* btk/btkuimanager.c (update_smart_separators): Don't spit 
	warnings for popups.
	(_btk_menu_is_empty): Return FALSE for non-menus.

Sun Nov 16 21:48:40 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellview.c (btk_cell_view_finalize): just call
	btk_cell_view_cell_layout_clear instead of trying to free the
	structure ourselves here. (#125726, Morten Welinder).

Sun Nov 16 00:35:29 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooser.[hc]: 
	* btk/btkentrycompletion.h: Fix parameter name mismatches which
	confuse btk-doc.

2003-11-15  Hans Breuer  <hans@breuer.org>

	* bdk/makefile.msc bdk/bdk.def 
            btk/btk.def btk/makefile.msc.in : updated
	* tests/makefile.msc : added all the new tests

	* btk/btkfilefilter.c(finalize) : initialize filter
	from object not from itself

	* btk/btkfilesystemwin32.[hc] : copied from btkfilesystemunix.[hc]
	modified as less as posible to have aworking implementation
	on win32. There maybe the desire to merge the unchanged pats into
	a common base class.
	Also implemented a simple bunnylib based bookmark handling, which
	is currently missing in btkfilesystemunix.[hc] but can be copied
	over there.
	* btk/btkfilechooserwidget.c : conditional include btkfilesystemwin32.h

	* bdk/win32/bdkwindow-win32.c : implement 
	bdk_window_set_keep_above() and bdk_window_set_keep_below()

	* tests/testmerge.c : don't include unistd.h unconditionally,
	#define STDOUT_FILENO if it isn't defined

	* tests/testfilechooser.c : make it compile on win32

2003-11-15  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkwindow-win32.c (bdk_window_focus): If the window is
	maximized, use SW_SHOWMAXIMIZED. (#126986, John Ehresman)

Thu Nov 13 12:55:29 GMT 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Update the rest of Section 2

Thu Nov 13 01:46:32 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c (btk_icon_theme_init): Use 
	BTK_DATADIR/{icons,pixmaps} instead of 
	BTK_DATA_PREFIX/{icons,pixmaps}.  (#123365, Marco Pesenti Gritti)

Wed Nov 12 21:40:10 2003  Matthias Clasen  <maclas@gmx.de>

	Changes to improve menu positioning on Xinerama (#108328, #126150):
	
	* btk/btkmenuitem.c (btk_menu_item_position_menu): Use the event 
	window of the menuitem to determine the monitor. This fixes some

	* btk/btkmenu.c (struct _BtkMenuPrivate): Add a menu_num field
	to store the monitor on which the menu is to be positioned.

	* btk/btkmenu.[hc] (btk_menu_position): Store the monitor number
	in the BtkMenuPrivate struct and fetch the monitor geometry after
	calling the position_func, in case it has been changed.

	* btk/btkmenu.c (btk_menu_set_monitor): New function 
	to be used in BtkMenuPositionFunc implementations for setting
	the monitor_num field in BtkMenuPrivate.

	* btk/btkmenuitem.c (btk_menu_item_position_menu): Call 
	btk_menu_set_monitor.

Wed Nov 12 21:00:10 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkinputdialog.c (btk_input_dialog_init): Clarify the
	label for the empty list. String change.  (#95446, Tomas Ögren)

Wed Nov 12 20:57:50 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.h (enum BtkIconLookupFlags): Correct
	the definition of the values.  (#123361, Marco Pesenti Gritti)

Wed Nov 12 20:54:02 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkkeyuni.c: Map KP_Separator to ','.
	(#122941, Egmont Koblinger)

2003-11-12  Padraig O'Briain  <padraig.obriain@sun.com>

	*btk/btkcolorsel.c (btk_color_selection_init): Add tooltip for
	opacity entry widget. Change tooltip for opacity widgets. (#126426)

2003-11-12  Padraig O'Briain  <padraig.obriain@sun.com>

	* btk/btkmenu.c (btk_menu_popup): Do not let pointer position
	affect window menu position when popped from keyboard. (#102660)

Wed Nov 12 01:29:32 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_internal_insert_element): When we
	are using the old API, make all items "is_important". That way
	BOTH_HORIZ will continue to show both icon and label in old API
	mode.

Mon Nov 10 00:40:41 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkeventbox.c (btk_event_box_set_above_child): 
	Remember the new value in all cases.  (#126276, Damon Chaplin)

Sat Nov  8 23:06:02 2003  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/main.c (row_activated_cb): Call the do_
	functions with the toplevel as argument.

	* demos/btk-demo/geninclude.pl.in: Change the signature
	of GDoDemoFunc to take a widget argument

	* demos/btk-demo/ui_manager.c (do_ui_manager): 
	* demos/btk-demo/tree_store.c (do_tree_store): 
	* demos/btk-demo/textview.c (do_textview): 
	* demos/btk-demo/stock_browser.c (do_stock_browser): 
	* demos/btk-demo/sizegroup.c (do_sizegroup): 
	* demos/btk-demo/pixbufs.c (do_pixbufs): 
	* demos/btk-demo/panes.c (do_panes): 
	* demos/btk-demo/menus.c (do_menus): 
	* demos/btk-demo/list_store.c (do_list_store): 
	* demos/btk-demo/images.c (do_images): 
	* demos/btk-demo/hypertext.c (do_hypertext): 
	* demos/btk-demo/editable_cells.c (do_editable_cells): 
	* demos/btk-demo/drawingarea.c (do_drawingarea): 
	* demos/btk-demo/dialog.c (do_dialog): 
	* demos/btk-demo/colorsel.c (do_colorsel): 
	* demos/btk-demo/changedisplay.c (do_changedisplay): 
	* demos/btk-demo/button_box.c (do_button_box): 
	* demos/btk-demo/appwindow.c (do_appwindow): Take a widget
	as argument, and make new windows or dialogs appear on the
	same screen.  (#80388)

Sat Nov  8 21:59:30 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkeventbox.c (btk_event_box_class_init): Let 
	visible-window default to TRUE, as documented and 
	implemented. (#126270 Damon Chaplin)

Sat Nov  8 01:50:17 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c: 
	* btk/btkfilechooserwidget.c (btk_file_chooser_widget_new): 
	* btk/btkfilechooserdialog.c (btk_file_chooser_dialog_new): 
	* btk/btkfilechooser.c (btk_file_chooser_[un]select_all): Mark as
	2.4 additions.

2003-11-07  Federico Mena Quintero  <federico@ximian.com>

	Changing BtkFileChooserEntry to use BtkEntryCompletion.

	* btk/btkfilechooserentry.c (btk_file_chooser_entry_init): Create
	a BtkListStore for the completion list.  Create a
	BtkEntryCompletion and attach it to the chooser entry.
	(btk_file_chooser_entry_finalize): Unref the completion store.
	(completion_match_func): New callback for the BtkEntryCompletion.
	(completion_idle_callback): Fill the completion store with filenames.

Fri Nov  7 22:55:49 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c (btk_window_set_role): 
	* btk/btkwindow.c (btk_window_set_title): 
	* btk/btkwidget.c (btk_widget_set_name): 
	* btk/btktreeviewcolumn.c (btk_tree_view_column_set_title): 
	* btk/btkbutton.c (btk_button_set_label): Make string setters
	safe for self-assignment.  (#122745, Soeren Sandmann)

Thu Nov  6 20:41:40 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkstyle.c (btk_style_attach): Fix doc comment.
	(#126369, Olexiy Avramchenko)

Thu Nov  6 00:21:41 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcolorbutton.c (btk_color_button_init): 
	* btk/btkfontbutton.c (btk_font_button_init): Improve the 
	consistency of titles.  (#126193, Damon Chaplin)

Wed Nov  5 22:49:36 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenu.c (btk_menu_set_tearoff_state): Set torn off 
	menus to be transient for the toplevel they were torn off from.
	(btk_menu_get_toplevel): Auxiliary function to find the
	toplevel of a menu.  (#54775, Jon-Kare Hellan)

Wed Nov  5 21:07:58 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkpaned.c (btk_paned_class_init): Add readonly properties
	min-position and max-position.  (#58431, Padraig O'Briain)

Wed Nov  5 21:02:26 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcolorsel.c (update_color): 
	(make_label_spinbutton): 
	(adjustment_changed): Change the ranges for Saturation and
	Value to be 0-100 instead of 0-255, since these axes of HSV
	are usually expressed in percent.  (#121519, Gregory Merchan)

Wed Nov  5 08:51:48 GMT 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: More 2.x updates

Tue Nov  4 15:00:33 GMT 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: More 2.x updates, fix
	pkg-config command error, update copyright.

2003-11-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (error_dialog): Take in a path as
	well.  Use a helper function.
	(shortcuts_append_home): Display an error box if necessary.
	(shortcuts_append_desktop): Likewise.
	(add_bookmark_button_clicked_cb): Likewise.
	(btk_file_chooser_default_select_path): Likewise.
	(entry_activate): Likewise.
	(shortcuts_append_paths): New helper function.
	(shortcuts_append_file_system_roots): Use
	shortcuts_append_paths().
	(shortcuts_append_bookmarks): Likewise.

Mon Nov  3 23:12:41 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (_btk_menu_is_empty): Return TRUE if 
	menu is NULL.
	(update_smart_separators): Remove some unneeded ifs.

Mon Nov  3 22:45:58 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow-decorate.h: Add B_BEGIN_DECLS/B_END_DECLS to make 
	these usable in C++. Forgot this file in my Oct 11 commit.

2003-11-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (create_shortcuts_tree): Add a stock
	icon to the "Add bookmark" button.

	* btk/btkfilesystemunix.c: Mark missing strings for translation.
	* btk/btkfilesystemmodel.c: Likewise.
	* btk/btkfilechooser.c: Likewise.
	* btk/btkfilechooserdefault.c: Likewise.

Mon Nov  3 20:56:28 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdk.c: 
	* bdk/bdkinternals.h: 
	* bdk/x11/bdkscreen-x11.c (init_xinerama_support): Introduce a
	BDK_DEBUG_XINERAMA debug flag, and make it trigger a fake 2x2
	Xinerama mode when no actual Xinerama setup is found. 

2003-11-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_select_folder): Removed.
	(create_shortcuts_tree): Don't call the above.
	(bookmarks_changed_cb): Likewise.
	(tree_selection_changed): Unselect everything from the shortcuts
	list.  This is the behavior that Mac OS has.
	(toolbar_add_item): Return the item.
	(toolbar_create): Store the up_button in the impl structure.
	(toolbar_check_sensitivity): New function to set the sensitivity
	of the "Up" button in the toolbar.
	(tree_selection_changed): Call toolbar_check_sensitivity().

2003-11-02  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_init): Do
	not set a border width for the toplevel container.
	(toolbar_create): New function; create a simple toolbar for the
	file chooser.
	(btk_file_chooser_default_constructor): Use a spacing of 12 for
	the table, as per the HIG.
	(btk_file_chooser_default_init): Likewise, for the default
	implementation's vbox.

	* btk/btkfilesystem.c (btk_file_system_get_parent): Added docs to
	note that NULL is a valid return value for the parent path.

Sat Nov  1 14:59:27 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooserdefault.c (shortcuts_row_activated): 
	Change on activation, not selection change (temporary
	workaround for #125955, needed for keynav, likely
	the right UI anyways.)

	* btk/btkfilechooserdefault.c (shortcuts_select_func): 
	Don't allow the separator node to be selected.

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_constructor):
	Set the focus chain so that the entry gets focused first.
	(Not really right after initial focusing, maybe we
	should just have a btk_file_chooser_focus_entry() that
	we call from btk_file_chooser_dialog on creation.)

Sat Nov  1 12:41:04 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.c (btk_window_unfullscreen): Fix a
	residual call to btk_window_get_private().

Sat Nov  1 09:10:13 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.[ch]: Move above_initially, below_initially
	into BtkWindowPrivate structure, fixing ABI breakage
	on Win32. (Hans Breuer). Switch BtkWindowPrivate over
	to instance-private-data.

Fri Oct 31 02:43:34 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (get_item_requisition): delete this function
	(toolbar_item_is_homogeneous): cache max_homogeneous_pixels
	instead of re-calculating for each item.
	(btk_toolbar_size_allocate): Update comments

Thu Oct 30 22:04:31 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_forall): Only include
	placeholders when include_internals is TRUE.

Thu Oct 30 17:57:53 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (logical_to_physical): Make it work even when
	item 0 is a placeholder. (#125826)
	* tests/testtoolbar.c: add an assertion that 
	btk_toolbar_get_nth_item (0) != NULL

Thu Oct 30 17:40:26 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (logical_to_physical): Make it work for
	logical == 0.(#125826)

Thu Oct 30 16:20:58 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (logical_to_physical): Make sure we actually
	return the index of a real item.
	(get_nth_item) assert that the returned items is not a
	placeholder.  (#125826, Marco Pesenti Gritti).
	
2003-10-29  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkcellrendererseptext.c
	(btk_cell_renderer_sep_text_render): Only paint a separator if the
	text is NULL, rather than also doing it if it is an empty string.

Wed Oct 29 15:40:26 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmessagedialog.c (btk_message_dialog_new/
	btk_message_dialog_new_with_format): Allow NULL
	for message_format, as described in the docs and
	as worked previously. (#125759, Richard Hult)

	* btk/btkmessagedialog.c (btk_message_dialog_new_with_markup):
	Use g_markup_vprintf_escaped() to escape arguments.

	* btk/btkmessagedialog.[ch]: Add btk_message_dialog_set_markup()
	so there is some way to set literal markup.

Wed Oct 29 15:01:32 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* bdk/x11/bdkimage-x11.c (_bdk_x11_copy_to_image): Move
 	the call to bdk_error_trap_pop() to the right place,
 	fixing a problem where we'd pop() too many times 
 	when bailing out. (#123302, Thomas Leonard)
	
Wed Oct 29 12:50:02 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooserutils.c (delegate_set_current_folder): 
	Fix infinite recursion. (#125679, Christian Persch)

Wed Oct 29 13:29:15 GMT 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: further 2.x updates:
	mirrors,compiling,g_main_context_iteration

Wed Oct 29 02:54:35 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.[ch] (btk_toolbar_set_drop_highlight_item): Add this
	function; remove btk_toolbar_highlight_drop_location() and
	btk_toolbar_unhighlight_drop_location().

	Also fix bug where the number of overflowed items were miscounted.

Tue Oct 28 12:20:16 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.c (btk_window_has_toplevel_focus): Remove
	some accidentally committed duplicate code.

Tue Oct 28 17:06:17 GMT 2003  Tony Gale <gale@btk.org>

        * docs/faq/btk-faq.sgml: Update info on compiling BTK+

Tue Oct 28 10:34:24 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.[ch] (btk_window_is_active, 
	btk_has_toplevel_focus): Add getters corresponding to
	the is_active and has_toplevel_focus properties.
	(#122531)

2003-10-28  Mark McLoughlin  <mark@skynet.ie>

	* btk/btkexpander.c:
	(btk_expander_class_init): hook up the destroy handler.
	(btk_expander_destroy), (btk_expander_unrealize):
	remove the expand/collapse timeout on destroy instead
	of unrealize to avoid leaving the expander in a inconsistent
	state when unrealizing during animation.
	(btk_expander_start_animation): remove realized check.
	(btk_expander_set_expanded): if the widget isn't realized,
	expand immediately.

Tue Oct 28 09:44:16 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkxembed.c (_btk_xembed_send_focus_message): Silently
	do nothing when recipient is NULL, as described in the
	doc comment. (#123107, Thomas Leonard)

Tue Oct 28 09:21:29 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmain.c (btk_check_version): Move docs inline,
	rewrite docs, mention memory management for the return
	value. (Partly addresses #125549, Michael Natterer)

2003-10-28  Padraig O'Briain  <padraig.obriain@sun.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_remove_filter):
	Change index to filter_index to fix compilation error.

	* btk/btkfilesystem.h: Correct definition of btk_file_path_get_string.

Mon Oct 27 15:47:58 2003  Manish Singh  <yosh@gimp.org>

	* bdk/x11/bdkscreen-x11.c: #include <X11/extensions/Xrandr.h> if
	we have RandR support, for XRRUpdateConfiguration declaration.

	* btk/btkfilefilter.c: #include "btkprivate.h" for _btk_fnmatch
	declaration.

	* btk/btkuimanager.c (btk_ui_manager_add_ui_from_file): Make
	length a gsize variable, since that's what g_file_get_contents()
	expects.

Mon Oct 27 12:18:49 2003  Owen Taylor  <otaylor@redhat.com>

	* NEWS: Fix attribution for above/below EWMH work.

Sat Oct 25 23:30:13 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_class_init): Add "name" 
	as a construct-only property.  (#125475, Murray Cumming)

Thu Oct 23 21:55:10 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	Fix bug 116297 and 125472
	
	* btk/btktoolbar.c (btk_toolbar_highlight_drop_location): Make
	this function take an index and a BtkToolItem.

	* tests/testtoolbar.c (main): Make "Show Arrow" default to
	true. Make one of the separators !draw and expand.
	Update for new highlight_drop_location() API.

	* btk/btktoolitem.[ch]: Remove "pack_end" property

	* btk/btktoolbar.h: Formatting fixes.

	* btk/btktoolbar.c: Remove "pack_end" child property. Allow
	separator tool items to expand.
	(logical_to_physical, physical_to_logical): Fix off-by-one errors
	(Fix #125472, Marco Pesenti Gritti)

	* btk/btkseparatortoolitem.[ch]: Add new "draw" property.
	(btk_separator_tool_item_expose) only draw if "draw" is TRUE. Also
	return FALSE, not TRUE.
	(btk_separator_too_item_{set|get}_property,
	(btk_separator_tool_item_{set|get}_draw): new functions

Fri Oct 24 16:54:04 2003  Owen Taylor  <otaylor@redhat.com>

	* === Released 2.3.0 ===

	* configure.in: Remove a stray comma.

	* README.in: Fix a few notes about Xft 1 and bango-1.0.

	* NEWS: Finish updates for 2.3.0.

	* po/Makefile.in.in: Update to latest GLib version.

Fri Oct 24 20:31:35 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellview.[ch], btk/btkcellviewmenuitem.[ch],
	btk/btkcombobox.[ch], btk/btkcomboboxentry.[ch],
	btk/btktreemodelfilter.[ch]: Fix licensing (I managed to put it
	under GPL licensing instead of LGPL...). (Fixes #125381, Soeren
	Sandmann).

Fri Oct 24 20:22:40 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelfilter.h: add padding to the class structure.

2003-10-23  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooser.c (btk_file_chooser_get_preview_uri): Fixed docs.
	(btk_file_chooser_remove_filter): Likewise.
	(btk_file_chooser_select_all): Added docs.
	(btk_file_chooser_unselect_all): Likewise.

	* btk/btkfilechooserdialog.c (btk_file_chooser_dialog_new): Added docs.

	* btk/btkfilechooserwidget.c (btk_file_chooser_widget_new): Added docs.

Thu Oct 23 23:22:15 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilefilter.c: 
	* btk/btkfilechooser.c: Add "Since: 2.4" to all API doc comments.

Thu Oct 23 22:33:47 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilefilter.c (btk_file_filter_new): Fix doc markup.

Thu Oct 23 21:49:05 2003  Matthias Clasen  <maclas@gmx.de>

	* NEWS: Remove a few duplicates, group the menu changes.

Thu Oct 23 21:12:50 2003  Kristian Rietveld  <kris@btk.org>

	* NEWS: Updates for 2.3.0; changed header to match the style we used
	for 2.1.0.

Thu Oct 23 20:47:44 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_group): Actually
	assign the new leader.  (#125168, Mariano Suarez-Alvarez)

Thu Oct 23 20:21:16 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcelllayout.c, btk/btkcellview.c btk/btkcellviewmenuitem.c,
	btk/btkcombobox.c, btk/btkcomboboxentry.c, btk/btkentrycompletion.c,
	btk/btktreemodelfilter.c, btk/btkcellrenderertoggle.c: Fix includes.

Thu Oct 23 15:13:56 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* NEWS: Partial update for 2.3.0.

Thu Oct 23 01:09:04 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooserdefault.c: Convert BtkOptionMenu to
	BtkComboBox.

Wed Oct 22 23:20:04 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilechooser.[ch] btk/btkfilefilter.[ch] 
	btk/btkfilechooserwidget.[ch] btk/btkfilechooserdialog.[ch]:
	btk/btkfilechooserutils.c btk/btkfilechooserprivate.[ch]:
	Basic framework for the new file selector widget.

	* btk/btkfilechooserdefault.[ch] btk/btkcellrenderersep.[ch] 
	btk/btkfilechooserentry.[ch] btk/btkfilesystemmodel.[ch]:
	Initial implementation of the BtkFileChooser user interface.

	* btk/btkfilesystemunix.[ch]: BtkFileSystem implementation
	for Unix files.

	* configure.in btk/Makefile.am btk/xdgmime: Build code
	for freedesktop.org MIME system on Unix.

	* tests/testfilechooser.c: Test program for BtkFileChooser

	* tests/prop-editor.c: Add support for properties on interfaces.

Tue Oct 21 16:12:51 2003  Owen Taylor  <otaylor@redhat.com>

	* demos/btk-demo/menus.c (do_menus): Fix some unused
	variables.

	* btk/btkmain.c (_btk_get_lc_ctype): Fix an unused
	variable warning.

Thu Oct 23 00:04:50 2003  Matthias Clasen  <maclas@gmx.de>

	* NEWS: Partial update for 2.3.0.

Tue Oct 21 22:07:12 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_real_move_cursor): set
	ctrl_pressed and shift_pressed according to the current event
	state (if there is one). (Fixes #125063, reported by Sebastien Bacher).

Mon Oct 20 23:24:27 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentry.c (btk_entry_key_press): remove the completion
	timeout when the user pressed on Enter/ESC. Fixes the bug where the
	completion popup popped up after the user pressed on Enter (which is
	just weird). Reported by the Epiphany people (all of them).

Mon Oct 20 20:27:22 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	Add support for OS X like sliding of toolbar items during drag and
	drop, (#110919, Dave Bordoley)

	Make dnd highlighting the responsibility of the
	application. (Fixes #116298, Owen Taylor)

	* btk/btktoolbar.h: Add prototypes for new API.
	
	* btk/btktoolbar.c
	(physical_to_logical, logical_to_physical): new functions
	converting between "position including placeholders" and "position
	excluding placeholders".
	(btk_toolbar_class_init): remove drag_leave and drag_motion
	handlers
	(struct _ToolbarContent): new struct containing information
	related to toolbar items.
	(btk_toolbar_highlight_drop_location): new public function
	(btk_toolbar_unhighlight_drop_location): new public function
	
	* tests/testtoolbar.c
	(toolbar_drag_motion, toolbar_drag_leave): new functions
	(main): connect to dnd signals.  Make the "New" item expand to
	make drag and drop more exciting.

Wed Oct 15 22:39:23 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcomboboxentry.c (btk_combo_box_entry_init): it's
	_set_active, not _set_active_item.

Wed Oct 15 22:31:09 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.h: add padding to the class structure.
	* btk/btkcomboboxentry.h: ditto.
	* btk/btkentrycompletion.h: ditto.

Wed Oct 15 22:04:59 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.c (btk_combo_box_get_active),
	(btk_combo_box_set_active): mention in the docs that -1 is a valid
	value and what it means.

	* btk/btkcomboboxentry.c (btk_combo_box_entry_init): set the active
	item to -1 (default),
	(btk_combo_box_entry_active_changed): do nothing when the index is
	< 0.

Tue Oct 14 16:10:21 2003  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_set_active_iter): New function
	to set the active row by iter.

	* btk/btkcombobox.c (btk_combo_box_get_active_iter): New function
	to get the active row by iter.

2003-10-13  Federico Mena Quintero  <federico@ximian.com>

	* btk/btktreeview.c (btk_tree_view_real_collapse_row): Don't do
	operations on windows if the tree view is not mapped.
	(btk_tree_view_button_press): Compare equal types of pointers, not
	BtkWidget* vs. BtkTreeView*.

Mon Oct 13 21:01:43 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentrycompletion.c (btk_entry_completion_popup): remove
	the reset of first_sel_changed, as after the first popup the treeview
	will always have a row selected and will thus not focus_to_cursor.

	* btk/btkentry.c (keyval_is_cursor_move): new function to determine
	whether the keyval should move the completion selection cursor (used
	to avoid ending up with extreme cluttered code), also added
	all KP_ equivalents of the keys here,
	(btk_entry_completion_key_press): Keynav tweaks based on comments
	from Dave Bordoley and Marco Pesenti Gritti; add the -1 state
	as possible current selection, implement Home/End keys, modified
	the down key to stop cycling. Maybe page up/down should be implemented
	at some later time.

Mon Oct 13 20:58:07 2003  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_icon): Make it work 
	as documented when pixmap or mask is NULL.  (#124081) 

Mon Oct 13 20:21:38 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentry.c (btk_entry_set_text): I overlooked a return when
	I was adding the signal block/unblock code. Oops. (Noticed by
	Marco Pesenti Gritti).

Mon Oct 13 20:21:55 2003  Kristian Rietveld  <kris@btk.org>

	* demos/testpixbuf-scale.c: enable BTK_DISABLE_DEPRECATED again,
	(set_interp_type), (main): port over from option menu to BtkComboBox.

Mon Oct 13 19:41:55 2003  Kristian Rietveld  <kris@btk.org>

	* tests/testmenus.c: Still uses option menus, so turn off
	BTK_DISABLE_DEPRECATED.

Sun Oct 12 01:10:29 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkalignment.[hc]: 
	* btk/btkcombobox.[hc]: 
	* btk/btkcomboboxentry.[hc]: 
	* btk/btktreemodelfilter.[hc]: Move GET_PRIVATE macros
	from header to implementation.

Sun Oct 12 00:18:02 2003  Matthias Clasen  <maclas@gmx.de>

	* tests/testtreeview.c: 
	* demos/testpixbuf-scale.c: 
	* tests/prop-editor.c: These files still use option menus,
	so turn off BTK_DISABLE_DEPRECATED to fix the build. 

Sat Oct 11 23:14:36 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.h: 
	* btk/btkaction.h: 
	* btk/btkradioaction.h: 
	* btk/btkradiotoolbutton.h: 
	* btk/btkseparatortoolitem.h: 
	* btk/btktoggleaction.h: 
	* btk/btktoolitem.h: 
	* btk/btkuimanager.h: Add B_BEGIN_DECLS/B_END_DECLS to make 
	these usable in C++.  (#124351, Murray Cumming)

Sat Oct 11 19:09:05 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentry.c (btk_entry_set_text): Check if completion is
	non-NULL before accessing it. Oops.

Sat Oct 11 15:47:03 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentrycompletion.[ch] (btk_entry_completion_insert_action),
	(btk_entry_completion_insert_action_text),
	(btk_entry_completion_insert_action_markup): the gchar* parameters
	should be const (pointed out by both Marco Pesenti Gritti and
	Murray Cumming (#124356).

Sat Oct 11 15:37:19 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.c (btk_combo_box_size_allocate): for the custom
	child list mode, allocate the height allocation->height to the
	button instead of the height requested by the button. (Tiny
	size allocation screwup noticed by Macro Pesenti Gritti).

Sat Oct 11 15:23:27 2003  Kristian Rietveld  <kris@btk.org>

	Fixes based on comments from Marco Pesenti Gritti.

	* btk/btkentry.c (btk_entry_set_text): block the completion changed
	signal handler, avoids the completion popup to popup when text is
	set programmatically in most cases (we actually have to handle this
	in the _editable functions as well, but that will break popping up
	when the user actually typed something :),
	(btk_entry_completion_key_press): when handling enter, bail out
	when nothing has been selected,
	(btk_entry_completion_changed): don't popdown when the entry content
	changed.

	* btk/btkentrycompletion.c (btk_entry_completion_init),
	(btk_entry_completion_selected_changed): unselect_all on the
	first selected changed signal. Avoids having a default row selected,
	(_btk_entry_completion_popup): don't select the first row by default.

	* btk/btkentryprivate.h (struct _BtkEntryCompletionPrivate): add a
	first_sel_changed field.

Fri Oct 10 23:02:58 2003  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/menus.c: Replace BtkItemFactory by BtkUIManager 
	in the intro (again).

Fri Oct 10 22:50:05 2003  Matthias Clasen  <maclas@gmx.de>

	Fixes for (#124212, Marco Pesenti Gritti):
	
	* btk/btkuimanager.c (update_smart_separators): Don't spit 
	warnings for popups.
	(_btk_menu_is_empty): Return FALSE for non-menus.

Fri Oct 10 19:10:12 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombo.h: Deprecate.
	* btk/btkoptionmenu.h: Ditto.

	* btk/btkcombobox.c (btk_combo_box_size_request),
	(btk_combo_box_size_allocate): Rework, things behave better now. Still
	needs some work on requesting enough size when taking the items in
	the list into account.

	* btk/btkfilesel.c: put btkoptionmenu.h include inside "enable
	deprecated" guards.
	* btk/btkinputdialog.c: ditto.
	* btk/btkitemfactory.c: ditto.
	* btk/btkoptionmenu.c: ditto.

	* demos/btk-demo/menus.c: remove the option menu.
	* demos/btk-demo/sizegroup.c: replace the option menus with
	BtkComboBox.
	* demos/btk-demo/textview.c: ditto.
	(A general BtkComboBox demo will be added later on).

Wed Oct  8 00:06:17 2003  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/ui_manager.c (activate_radio_action): New
	callback to propertly report radio actions.

	* demos/btk-demo/ui_manager.c (do_ui_manager): Use it here.

Tue Oct  7 23:23:05 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkplug.c (xembed_set_info): Put the supported protocol
	version in in the right field of the _XEMBED_INFO property.  
	(#123885, Denis Mikhalkin)

Mon Oct  6 14:18:47 2003  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkexpander.c (btk_expander_animation_timeout): only show
	the child if we have one.

	(btk_expander_button_release): use
	btk_widget_activate instead.

Mon Oct  6 21:05:46 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btktable.c (btk_table_class_init): Start the blurb for 
	"right_attach" with a capital.  (#123945, Christian Rose)

Sun Oct  5 23:59:03 2003  Matthias Clasen  <maclas@gmx.de>

	* tests/testsocket.c (child_read_watch): Remove an
        extraneous unref.  (#122336, Frederic Crozat)

Sun Oct  5 22:38:22 2003  Matthias Clasen  <maclas@gmx.de>

	* btk/btkeventbox.c (btk_event_box_class_init): Trim 
	whitespace in "visible-window" blurb.  (#123910, Christian Rose)

Sun Oct  5 00:53:15 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_list_children_in_focus_order):
	focus arrow before pack_end items (#123851, Matthias Clasen)

Fri Oct  3 20:50:48 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.c (btk_combo_box_set_model): only set the model
	on ->priv->cell_view if ->priv->cell_view is non-NULL.

	* btk/btkcomboboxentry.c: include btkintl.h, add text_renderer
	field to BtkComboBoxEntryPrivate,
	(btk_combo_box_entry_class_init), (btk_combo_box_entry_init),
	(btk_combo_box_entry_set_property), (btk_combo_box_entry_get_property),
	(btk_combo_box_entry_set_text_column), (btk_combo_box_entry_new): add
	a construct-only "text_column" property and reorder code to use it
	and support inheriting this widget.

Thu Oct  2 23:28:02 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.c: Added API doc comments.

	* btk/btkcomboboxentry.c: Ditto.

2003-10-02  Matthias Clasen  <maclas@gmx.de>

	* btk/btktoggleaction.c: Documentation tweaks.

Wed Oct  1 22:43:40 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellview.[ch]: implement the BtkCellLayout interface, drop
	packing/attribute/cell data functions from the header,
	(btk_cell_view_set_cell_data): added support for cell data funcs.

	* btk/btkcombobox.[ch]: implement the BtkCellLayout interface, drop
	packing/attribute/cell data functions from the header, implemented
	cell data func support.

	* btk/btkcomboboxentry.c (btk_combo_box_entry_new): updated
	for the move to BtkCellLayout.

	* tests/testcombo.c (create_combo_box_grid_demo), (main): ditto.

2003-10-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.c (btk_action_class_init): 
	(btk_action_[gs]et_property): Introduce a separate
	"hide_if_empty" property for empty menu handling.
	(_btk_action_sync_menu_visible): ...and use it here.

	* tests/testmerge.c (main): ...and here.

	* btk/btktoolitem.c (btk_tool_item_class_init): Fix signal doc 
	comments to pacify btk-doc.

	* btk/btkmain.c: Doc formatting tweaks.

	* btk/btktoolitem.c (btk_tool_item_set_is_important): Fix a typo.

	* btk/btkcheckmenuitem.h (btk_check_menu_item_set_draw_as_radio): 
	Use the same parameter names as in .c file, to pacify btk-doc.

	* btk/btktoggletoolbutton.[hc]: 
	* btk/btktoolbutton.[hc]: 
	* btk/btktoolitem.[hc]:
	* btk/btktoolbar.[hc]: 
	* btk/btkcolorbutton.[hc]: 
	* btk/btkfontbutton.[hc]: 
	* btk/btkalignment.[hc]: Define GET_PRIVATE macros in the 
	source, not in the header.

	* btk/btkcheckmenuitem.c (btk_check_menu_item_[sg]et_draw_as_radio): 
	Document these as 2.4 API additions.

Tue Sep 30 23:42:56 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkentry.c (btk_entry_set_completion),
	(btk_entry_get_completion): Add API doc comments.

	* btk/btkentrycompletion.c: Fix #includes and add API doc comments.

Tue Sep 30 23:12:34 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelfilter.c: Add "Since: 2.4" to all API doc comments.

Tue Sep 30 22:59:58 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c: Some API doc comment fixes.

	* btk/btkcellayout.c: Fix #include and oooooh API doc comments!

2003-09-30  Matthias Clasen  <maclas@gmx.de>

	* tests/merge-*.ui: 
	* tests/testmerge.c: Test handling of empty menus.

	* btk/btkuimanager.c (_btk_menu_is_empty): New function to determine
	whether a menu is empty. Used in btkaction.c.
	(update_smart_separators): Also update the visibility of empty menus.
	(update_node): When creating a new menu proxy, insert an "Empty" menu 
	item which only gets shown if the menu is empty. 

	* btk/btkaction.c (btk_action_class_init): Document the meaning of
	"is_important" for menu proxies.
	(_btk_action_sync_menu_visible): New function to sync the visibility
	of menu proxies. Used in btkuimanager.c.
	(btk_action_sync_visible): New function to sync the visibility of 
	proxies.

Tue Sep 30 21:43:34 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.c (btk_combo_box_menu_button_press): set
	popup_in_progress to TRUE,
	(btk_combo_box_menu_show): and back to FALSE here; the menu now
	won't disappear on the first button release. (Reported by Matthias
	Clasen).

Tue Sep 30 21:08:43 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcombobox.c (btk_combo_box_init): actually show the child.

	* btk/btkcomboboxentry.c (btk_combo_box_entry_init): ditto. (#123543,
	Marco Pesenti Gritti).

2003-09-30  Murray Cumming  <murrayc@usa.net>
 
 	* btk/btkcellrenderer.h: The render vfunc takes a BdkDrawable*
 	instead of a BdkWindow*, because that what it is given. The 
 	documentation was already correct. This should cause no API/ABI
 	breakage with C compilers.
 	* btk/btkcellrenderertext.c, btkcellrendererpixbuf.c, 
 	btkcellrenderertogger.c: Updated the declarations of the render vfunc
 	implementation accordingly.

2003-09-30  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkkeys.c (bdk_keymap_class_init): Document the
	"direction-changed" and "keys-changed" signals.

	* bdk/bdkscreen.c (bdk_screen_class_init): Document the 
	"size-changed" signal.

	* bdk/bdkdisplaymanager.c (bdk_display_manager_class_init): 
	Document the "display-opened" signal.

	* bdk/bdkdisplay.c (bdk_display_close): Doc tweak.
	(bdk_display_class_init): Document the "closed" signal.

Sat Sep 27 16:02:40 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktextview.[ch]: rename property tab_moves_focus to
	accepts_tab. (#122709 again).

2003-09-27  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c (btk_window_new):
	* btk/btkitemfactory.c (btk_item_factory_new): Document 
	the fact that the newly created object does not come with 
	a floating reference.  (#103068, patch by Frederic Lespez)
	
	* btk/btkitemfactory.h: Deprecate BtkItemFactory in favor 
	of BtkUIManager. Just leave BtkTranslateFunc undeprecated, 
	since BtkActionGroup uses it.

	* tests/testtext.c: Turn off BTK_DISABLE_DEPRECATED, since
	this test uses the soon-to-be-deprecated BtkItemFactory.

	* demos/btk-demo/Makefile.am (demos): Add ui_manager.c,
	remove item_factory.c

	* demos/btk-demo/ui_manager.c: Duplicate of item_factory.c 
	using BtkUIManager instead of BtkItemFactory.

	* tests/testmerge.c: Demonstrate the use of the 
	connect-proxy signal.

	* btk/btkaction.c (connect_proxy): Add connect-proxy and 
	disconnect-proxy signals to do small customizations 
	like displaying tooltips in the statusbar without 
	custom actions.  (#122894, Philip Langdale)

	* btk/btkuimanager.c (update_node): Don't leak tooltip.

Fri Sep 26 23:49:44 2003  Kristian Rietveld  <kris@btk.org>

	Landing the new ComboBox. Note that only btkcombobox.h and
	btkcomboboxentry.h are public.

	* btk/btkcellview.[ch], btk/btkcellviewmenuitem.[ch],
	btk/btkcombobox.[ch], btk/btkcomboboxentry.[ch]: new files.

	* btk/Makefile.am, btk/btk.h: adding the new files.

	* tests/testcombo.c: and a new test.

	* tests/Makefile.am: adding the new test.

2003-09-25  Tor Lillqvist  <tml@iki.fi>

	* demos/btk-demo/main.c: Don't use hardcoded DEMOCODEDIR on Windows.

2003-09-21  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (handle_wm_paint): New
	function. Code split out from bdk_event_translate(). Needed
	because bdk_event_get_graphics_expose() couldn't do anything
	sensible otherwise. (Not that I think graphics exposes work anyway
	in bdk/win32, but at least now the code could work.)

	(bdk_event_get_graphics_expose): Call handle_wm_paint() instead of
	bdk_event_translate(), which couldn't have worked as it doesn't
	take any pre-allocated BdkEvent parameter any longer.
	
	(bdk_event_translate): Handle WM_MOUSEACTIVATE: Don't let
	BDK_WINDOW_TEMP windows be activated. (#122578, John Ehresman)

2003-09-24  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/appwindow.c (do_appwindow): Demonstrate tooltips
	on toolitems.

	* btk/btkaction.c (connect_proxy): Sync tooltips on toolitems.

	* btk/btkuimanager.c (update_node): Don't complain about missing
	actions on popups. Re-set "tooltip" property on toolitems after
	adding them to parent to trigger proxy update.

2003-09-22  Matthias Clasen  <maclas@gmx.de>

	* tests/testmerge.c (main): Initially activate the JUSTIFY_RIGHT
	group member to test the fix for #122904.

	* btk/btkactiongroup.c (btk_action_group_add_radio_actions_full): 
	Add the action to the group before activating it, otherwise we
	may end up with multiple active group members.  (#122904, Marco
	Pesenti Gritti)

2003-09-21  Matthias Clasen  <maclas@gmx.de>

	Changes to make cross-process merging feasible:
	
	* btk/btkuimanager.[hc]: Add a readonly "ui" property which holds the
	merged UI definition. Remove the "changed" signal, since its role
	is now filled by "notify::ui". Instead add a "actions-changed" signal
	which gets emitted when the set of actions changes.

	* btk/btktoggleactionprivate.h:
	* btk/btktoggleaction.[hc] (btk_toggle_action_[sg]et_draw_as_radio):
	Add a "draw_as_radio" property to toggle actions so that they can be
	used as proxies for radio actions much like the "draw_as_radio" 
	property on check menu items enables them to operate as proxies for
	radio actions.

	Prevent the "show_all" trap for action-based menus (see
	http://mail.bunny.org/archives/btk-devel-list/2003-September/
	msg00260.html):

	* btk/btkmenu.c (btk_menu_{hide,show}_all): Remove g_return_if_fail()
	calls from static functions.

	* btk/btkuimanager.c (update_node): 
	* btk/btkaction.c (connect_proxy): Set "no_show_all" on constructed
	widgets whose visibility is externally controlled.

	* btk/btkwidget.[hc] (btk_widget_[gs]et_no_show_all): Add a boolean 
	"no_show_all" property with setter and getter. When TRUE, it keeps
	btk_widget_{hide,show}_all() from modifying the visibility of the 
	widget and its children.

Sun Sep 21 23:13:37 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktextview.[ch]: Add new "tab moves focus" property (#122709)

2003-09-20  Tor Lillqvist  <tml@iki.fi>

	* btk-zip.sh.in: Don't use zip -r on the etc directory, to avoid
	including editor backup files. List files we want explicitly.

	* btk/btkmain.c (_btk_get_lc_ctype): New function. On Unix, just
	calls setlocale (LC_CTYPE, NULL). On Windows, looks for the
	LC_ALL, LC_CTYPE and LANG environment variables, than calls
	g_win32_getlocale().

	(btk_get_default_language): Code snippet moved to above function,
	call it.

	* btk/btkimmulticontext.c (btk_im_multicontext_get_slave)
	* btk/btkrc.c (btk_rc_context_parse_file): Call
	_btk_get_lc_ctype() instead of setlocale().

Fri Sep 19 18:15:31 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkpaned.c, btk/btkhpaned.c: implement RTL flipping
	(#96632)

Fri Sep 19 13:24:54 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktreeview.c (btk_tree_view_get_cursor): Improve
	documentation. (#117306, Steve Chaplin)

2003-09-19  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkkeys-win32.c (update_keymap): Handle dead keysyms
	present on the US-International keyboard. For clarity, order
	keysyms in case statement according to numeric value.

	(bdk_keymap_translate_keyboard_state): Handle Caps Lock
	correctly. (#120176, Ken Rastatter and Owen Taylor)

2003-09-18  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.c (btk_action_finalize): Call g_closure_unref() to
	unref a closure, not g_object_unref().  (#122637, Marco Pesenti Gritti)

	Install accelerators on actions, not on proxies, support
	accelerator-only actions:
	
	* btk/btkmenu.c (get_accel_path): New function to get the accel path
	and its lock status either via _btk_widget_get_accel_path() or by 
	looking at the accel_path stored in the menu item itself and determining
	its lock status by peeking into the contained accel label. This was
	already (accidentally) committed a week ago.

	* btk/btkaction.h (btk_action_set_accel_group):
	(btk_action_[dis]connect_accelerator): New functions.

	* btk/btkaction.c (struct _BtkActionPrivate): Add accel_group,
	accel_closure and accel_count. We must have a reference to the 
	accel_group, since we need it in connect_proxy. The count is necessary
	to ensure that the accelerator isn't removed before the last proxy 
	requesting it has been unmerged.
	(connect_proxy): Connect the accelerator to the 
	action now, only set the accel_path on the menuitem.
	(remove_proxy): Disconnect the accelerator from the action, not from
	the menuitem.
	(btk_action_set_accel_group): Set the accel group. 
	(btk_action_[dis]connect_accelerator): Count the number of times
	this functions have been called and install/remove the accelerator if
	the count leaves/reaches zero.

	* btk/btkuimanager.h (BtkUIManagerItemType): Add 
	BTK_UI_MANAGER_ACCELERATOR.

	* btk/btkuimanager.c (NodeType): Add NODE_TYPE_ACCELERATOR.
	(start_element_handler): Create NODE_TYPE_ACCELERATOR nodes from
	<accelerator> elements.
	(btk_ui_manager_add_ui): Create NODE_TYPE_ACCELERATOR nodes when
	type is BTK_UI_MANAGER_ACCELERATOR.
	(update_node): Set the accel group on actions before creating their
	proxies. Don't set the accel group on created menus. For 
	NODE_TYPE_ACCELERATOR nodes, [dis]connect the actions' accelerator.
	(print_node): Also emit <accelerator> elements.

	* tests/testmerge.c (dump_accels): Add a "Dump Accels" button. 

	* btk/btkuimanager.c (update_node): Robustness improvements.

2003-09-17  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (text_handler): Report unexpected character
	data as error from the GMarkup parser, otherwise things like
	btk_ui_manager_add_ui_from_string (ui, "Hi there!", -1, &error) 
	pass unexpectedly.

Wed Sep 17 02:38:53 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_class_init): revert accidentally
	committed redraw_on_allocate change.

Tue Sep 16 10:42:00 2003  Eric Warmenhoven  <eric@warmenhoven.org>

	* bdk/linux-fb/bdkwindow-fb.c: Add bdk_window_set_keep_{above,below}
	stubs to fix compilation

	* bdk/linux-fb/bdkrender-fb.c: Add bdk_shadow_fb_stop_updates stub for
	when shadowfb is disabled. Patch from pjm@cctechnol.com (#120847).

	* bdk/linux-fb/bdkmouse-fb.c: Add BDK_MOUSE_DEVICE environment
	variable. Patch from Marc Welz (#121347).

2003-09-16  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.h: Apply ebtk-format-protos.

2003-09-15  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c: Doc tweaks.

	Smart separators; see 
	http://mail.bunny.org/archives/btk-devel-list/2003-September/msg00133.html:
	
	* btk/btkuimanager.c (update_smart_separators): New function which 
	implements "smart" separators by iterating once over the entries of a 
	menu, hiding and showing separators as necessary.
	(update_node): Mark separators used as fences of placeholders as
	hidden. Explicitly added separators are marked as smart. Call 
	update_smart_separators after updating a menu or toolbar node. 
	Connect update_smart_separators to "notify::visible" signal on menu
	and tool items.
	
	* tests/merge-[12].ui: Test smart separators.

	Changes to allow setting action state before connecting signal; see
	the thread starting at 
	http://mail.bunny.org/archives/btk-devel-list/2003-September/msg00140.html:
	
	* btk/btkactiongroup.[hc]: (btk_action_group_add_radio_actions):
	(btk_action_group_add_radio_actions_full): Add value parameter to allow
	setting the currently selected group member before connecting signals.
	(BtkToggleActionEntry): Separate struct for constructing toggle actions,
	including a boolean to initialize the action state before connecting
	signals.
	(btk_action_group_add_toggle_actions):
	(btk_action_group_add_toggle_actions_full): New functions to construct
	toggle actions from an array of BtkToggleActionEntries.

	* demos/btk-demo/appwindow.c: 
	* tests/testactions.c: 
	* tests/testmerge.c: Adjust to new action group API.

Sun Sep 14 16:59:52 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_init): Name the arrow 
	"btk-toolbar-arrow" so themes can special-case it.

Sun Sep 14 16:07:49 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/Makefile.am (btk_c_sources): sort the list of files.

Sun Sep 14 15:49:00 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (toolbar_item_is_homogeneous): Unref the
	BangoFontMetrics. Patch from Steve Chaplin (#122257).

2003-09-14  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkwindow-win32.c (show_window_internal): Remove
	special-case code for WS_EX_TRANSPARENT (BDK_INPUT_ONLY) windows,
	the usefulness of which was already in doubt. Removing it fixes
	bugs #118575 and #121851.

Fri Sep 12 16:32:53 2003  Jonathan Blandford  <jrb@redhat.com>

	Merge from stable.

	* btk/btktreeview.c (btk_tree_view_button_press): only save the
	pressed button (used to determine if we want to initiate a drag later
	on) if the current grab widget is either NULL or tree_view (Reported
	by Jeroen Zwartepoorte).

2003-09-12  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkdraw.c (bdk_draw_string, bdk_draw_text) 
	(bdk_draw_text_wc): Add deprecation notes.  (#121955, Martin Pool)

2003-09-11  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkbango.c: Doc tweaks.

	* tests/testbtk.c: Add table menu tests.

	* btk/btkmenu.c (btk_menu_free_private): Don't forget to free the 
	BtkMenuPrivate struct itself. Pointed out by valgrind.

	* btk/btkuimanager.c (btk_ui_manager_finalize): Clean up 
	properly.  (#121998)

Wed Sep 10 22:25:04 2003  Kristian Rietveld  <kris@btk.org>

	The table menu patch! Turns BtkMenu into a table, so you can attach
	menu items in numerous new ways! Be creative!

	Contains some bug fixes and RTL adaptions from Matthias Clasen.

	* btk/btkmenu.c [toplevel]: introduce ATTACH_INFO_KEY, extend
	BtkMenuPrivate, introduce AttachInfo, add child properties enum,
	(btk_menu_free_private), (btk_menu_get_private): we have to free
	the heights array in the private struct,
	(btk_menu_class_init): reorder code a bit, install child properties,
	(get_attach_info), (get_child_attach): new utility functions,
	(btk_menu_set_child_property), (btk_menu_get_child_property): introduce
	child properties, for the attach info,
	(btk_menu_remove): remove AttachInfo from menu item,
	(btk_menu_real_insert): implemented algorithm to automagically place
	inserted menu items at the correct place in the table,
	(btk_menu_size_request), (btk_menu_size_allocate),
	(compute_child_offset): reworked/rewritten to support table menus,
	(btk_menu_attach): new function,
	(find_child_containing), (btk_menu_move_current): new functions to
	get table menu keynav right.

	* btk/btkmenu.h: add btk_menu_attach() prototype.

2003-09-10  Matthias Clasen  <maclas@gmx.de>

	* btk/btksocket.c (btk_socket_filter_func): Only remove 
	PropertyNotify events from the stream if they have been handled,
	in order to enable extending the plug<->socket communication via
	properties.

Wed Sep 10 01:06:44 2003  Kristian Rietveld  <kris@btk.org>

	Big TreeView DnD fixage, makes drops on empty models work, makes
	TreeStore DnD work and gets rid of btk-tree-model-drop-append.
	Related bugs #95362 and #113314. I don't want to touch this code
	ever again.

	* btk/btktreeprivate.h (BtkTreePrivate): add empty_view_drop field.

	* btk/btktreednd.c (btk_tree_get_row_drag_data): add check
	for selection_data->length.

	* btk/btktreeview.c (struct DestRow), (dest_row_free),
	(set_dest_row), (get_dest_row): we don't store just the row ref
	anymore, but a struct with the row ref and additional info,
	(set_destination_row): handle drops on empty space and some
	style fixes,
	(get_logical_dest_row): also return path_down_mode/drop_append_mode
	flags, handle dropping childs on their new parents, rewrite
	drop append handling into something saner,
	(btk_tree_view_drag_motion): show a "drop possible arrow" on empty
	spaces,
	(btk_tree_view_drag_drop): updates for updated backend,
	(btk_tree_view_drag_data_received): updates for updated backend,
	path down mode (treestore DnD) handling,
	(btk_tree_view_set_drag_dest_row): set empty_view_drop flag,
	when we are trying to drop a row on an empty model,
	(btk_tree_view_get_drag_dest_row): handle empty_view_drop flag.

	* btk/btkliststore.c (btk_list_store_drag_data_received),
	(btk_list_store_row_drop_possible): style and drop-append fixes.

	* btk/btktreestore.c (btk_tree_store_drag_data_received): ditto.

2003-09-08  Alexander Larsson  <alexl@redhat.com>

	* btk/btkeventbox.[hc]:
	Implement btk_event_box_get/set_input_only()
	
	* tests/testbtk.c:
	Tests for the new input only event boxes

Mon Sep  8 21:44:20 2003  Kristian Rietveld  <kris@btk.org>

	Fixes from David Hampton <hampton@employees.org> via btk-devel-list.

	* btk/btktreemodelfilter.c (btk_tree_model_filter_elt_get_path): fix
	the call to btk_tree_model_filter_add_root,
	(btk_tree_model_filter_row_changed): bail out if c_path is not above
	the virtual root, allow building levels on the second try to convert
	the child path to a filter path,
	(btk_tree_model_filter_convert_iter_to_child_iter): pass the virtual
	root when calling btk_tree_model_filter_elt_get_path.

2003-09-07  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (update_node): Fix a C99ism.  (#121640,
	Josh Beam)

	Fixes for accelerator handling during (un)merging:
	
	* btk/btkuimanager.c (update_node): Move setting info-action
	after the switch, since the old action is needed in some cases.
	In cases of proxy type mismatch, disconnect the old proxy from
	the old action.

	* btk/btkaction.c (remove_proxy): Renamed from 
	btk_action_remove_proxy(). Move unsetting of the accelerator
	here from disconnect_proxy() in order to catch all cases of 
	removing a proxy.
	(btk_action_disconnect_proxy): Fix logic in g_return_if_fail()
	to fail if proxy isn't a proxy of action.

2003-09-07  Pablo Saratxaga  <pablo@mandrakesoft.com>

	* configure.in: Added Uzbek latin (uz) and cyrillic (uz@Cyrl) to
	ALL_LINGUAS

2003-09-07  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.c (disconnect_proxy): Make disconnect work
	for toolitems.

2003-09-06  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.c (btk_action_connect_proxy): Disconnect from 
	prev_action, not from action.  (Fix by David Hampton)

Fri Sep  5 14:15:10 2003  Owen Taylor  <otaylor@redhat.com>
 
	* Back out locale-dependent interpretation of
 	KP_Decimal, the official XFree86 interpretation
 	is that KP_Decimal => . KP_Separator => ,
 	always, independent of locale. 
 	(#105161, Frederic Crozat, 
 	http://bugs.xfree86.org/show_bug.cgi?id=534)
 
2003-09-04  Matthias Clasen  <maclas@gmx.de>

	* tests/testmerge.c: Test buttons and toggle buttons as proxies.

	* btk/btktoggleaction.c (connect_proxy): 
	(btk_toggle_action_real_toggled): Support toggle buttons as proxies. Note 
	that a "draw_as_radio" property is needed for check buttons similar to 
	check menu items, in order to fully support button proxies for radio actions.

	* btk/btkaction.c (connect_proxy): Allow buttons as proxies.

	* tests/testmerge.c (toggle_dynamic): Test btk_ui_manager_add_ui(). 

	* btk/btkuimanager.h: Add BtkUIManagerItemType enum which is needed for the
	'type' argument of btk_ui_manager_add_ui().

	* btk/btkuimanager.[hc] (btk_ui_manager_add_ui): Add 'type' and 'top' arguments
	to make this function as powerful as the XML methods of adding UI.  (#120647)

Thu Sep  4 19:11:23 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	* docs/RELEASE-HOWTO: updates.

2003-09-04  Matthias Clasen  <maclas@gmx.de>

	* tests/merge-2.ui: Use "position" instead of "pos".

	* btk/btkuimanager.c (start_element_handler): No need 
	to be terse: Change the name of the "pos" attribute
	to "position".

2003-09-04  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c: Un-prefix BtkUIManagerNodeType and 
	BtkUIManagerNode to shorten the names and to make the
	BTK_UI_MANAGER_<TYPE> names available for a public enum.

	* btk/btkactiongroup.c:
	* btk/btkuimanager.c: Various doc tweaks.	

	* btk/btkuimanager.c (start_element_handler):
	(end_element_handler): Improve error reporting. 

Wed Sep  3 23:18:17 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	* btk/btkmenu.c (btk_menu_real_move_scroll): for the END case,
	use end_position - page_size instead of G_MAXINT, since
	btk_menu_scroll_to doesn't CLAMP anymore internally. (Fixes #121237,
	reported by Havoc Pennington).

Wed Sep  3 21:58:03 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	* btk/btkiconfactory.c (cached_icon_free): if icon->style != NULL,
	unref it. (Fixes memleak, patch from Kjartan Maraas).

Wed Sep  3 21:38:26 2003  Kristian Rietveld  <kris@btk.org>

	* bdk/Makefile.am, bdk/linux-fb/bdkfbmanager.c, bdk/x11/bdkcolor-x11.c,
	bdk-pixbuf/io-gif.c, btk/Makefile.am, btk/btkcalendar.c,
	btk/btkclist.c, btk/btkctree.c, btk/btkdnd.c, btk/btkentry.c,
	btk/btkhandlebox.c, btk/btkitemfactory.c, btk/btkmenu.c,
	btk/btknotebook.c, btk/btkrange.c, btk/btkrc.h, btk/btktree.c,
	btk/btktypeutils.h: big patch from Kjartan Maraas
	to fix numerous typos.

Wed Sep  3 17:38:01 BST 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Correct compile line for threads example.

2003-09-02  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdisplay-win32.c (bdk_display_open): Don't call
	CloseHandle() on the HMODULE returned from GetModuleHandle().
	Didn't cause any harm, but didn't do anything useful either. When
	running a BTK+ program under MS's debugger, the CloseHandle() call
	would cause a "first-chance exception" in ntdll.dll to show up.
	(The exception is caught appropriately if you let it proceed, but
	it confuses the person using the debugger). Thanks to Bruce
	Hochstetler for noticing.

Tue Sep  2 21:01:19 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	* btk/btktreeview.c (btk_tree_view_button_press): revert the change
	to only select when button 1 is pressed introduced in the fix of
	bug #120187.

2003-09-02  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_new): Doc addition.

	* btk/btkuimanager.c: Shorten the names of some static 
	functions.

	Support adding and removing merge nodes dynamically (#120647, 
	Anders Carlsson):
	
	* btk/btkuimanager.[ch] (btk_ui_manager_new_merge_id): Renamed 
	btk_ui_manager_next_merge_id to btk_ui_manager_new_merge_id 
	and made it public.
	(btk_ui_manager_add_ui): New function to add UI elements
	without juggling XML fragments, currently restricted to menuitems,
	toolitems and separators. Actions still come from registered 
	action groups.

Mon Sep  1 19:39:14 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/bdkwindow.c (bdk_window_get_bg_gc): Fix bug where the
	background pixmap was being offset twice, once by the ts_origin in
	bdk_window_get_bg_gc(), and once by bdk_draw_rectangle().

2003-09-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.[ch] (btk_ui_manager_ensure_update): Make
	this public again, since it's occasionally useful.  (#121128,
	Marco Pesenti Gritti)

	* btk/btkaction.c: Add an "is_important" property and propagate
	it to toolitem proxies.  (#121058, Marco Pesenti Gritti)

Mon Sep  1 00:32:30 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* tests/testtoolbar.c (main): connect to "delete_event" so the
	application will actually quit when you close the window

2003-09-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (btk_ui_manager_get_widget) 
	(btk_ui_manager_get_action): g_return_if_fail() if
	path is NULL.
	(btk_ui_manager_get_node): Avoid a segfault if path is empty.
	(btk_ui_manager_finalize): Remove the idle on finalize. (#121125, 
	Marco Pesenti Gritti)

2003-08-31  Matthias Clasen  <maclas@gmx.de>

	* btk/btktoolitem.c: Fix some typos in docs.

	* btk/btkuimanager.[ch] (btk_ui_manager_get_action): New function,
	replaces btk_ui_manager_activate().  (#120658)

	* tests/testmerge.c: Use btk_ui_manager_get_action() instead of
	btk_ui_manager_activate().

	* btk/btkaction.c: 
	* btk/btkactiongroup.c: Some doc tweaks.

	* btk/btkuimanager.[hc]: Get rid of the remove_widget signal. It
	wasn't emitted anyway. Some doc tweaks.

2003-08-30  Matthias Clasen  <maclas@gmx.de>

	* tests/testmerge.c (add_widget): Connect to "destroy" on toolbar,
	rather than to "remove" on handlebox. 

	* btk/btkuimanager.[hc] (btk_ui_manager_activate): New method to
	activate an action found by following a path.  (#120658)

	* tests/testmerge.c: Add a button to test btk_ui_manager_activate().

	* tests/testmerge.c (add_widget): Put toolbars in handleboxes.

	* btk/btkuimanager.[hc]: Add a boolean property, "add_tearoffs" with 
	setter and getter. If it is set, add tearoff menu items to regular 
	menus, but not to popups. Add a signal "changed", which gets emitted
	when the merged ui has changed.  (#120649, #120656)

	* tests/testmerge.c: Add button to test the generation of tearoff 
	menu items.

2003-08-29  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_add_radio_actions_full): 
	Actually group the actions together rather than putting each in its 
	own group.

	* btk/btkradioaction.c (create_menu_item): Set "draw_as_radio" on 
	proxy menu items for radio actions.

	* btk/btkgamma.c (gamma_ok_callback): Use g_strtod instead of strtod.

Fri Aug 29 21:40:01 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkactiongroup.c (btk_action_group_add_radio_actions_full):
	Fix use of uninitialized variable.

	* btk/btktextutil.c
	(_btk_text_util_append_special_char_menuitems): add const cast to
	get rid of warning

2003-08-29  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcheckmenuitem.c (btk_check_menu_item_class_init): Install 
	"draw_as_radio" as a separate property, not as an alias of 
	"inconsistent".
	(btk_check_menu_item_get_property): 
	(btk_check_menu_item_set_property): Also support "draw_as_radio".

Fri Aug 29 20:32:07 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c: Only treat buttons as homogeneous when they
	are narrower than 13 time the estimated character width of the
	font. (#107781, David Bordoley)

	* btk/btktoggletoolbutton.c (btk_toggle_tool_button_init): Check
	here if the BtkToggleButton is active. This may be the case if it
	is a radio button.

	* btk/btktoolbar.c: Clarify documentation wrt. BtkSignalFunc
	vs. void (*) (BtkWidget, gpointer). (#107495, Mariano
	Suarez-Alvarez).

	* btk/btkcheckmenuitem.[ch]: new "draw_as_radio"
	property. (#111207, David Bordoley).

	* btk/btktoggletoolbutton.c
	(btk_toggle_tool_button_create_menu_proxy): use new
	"draw_as_radio" property on the menu item when the item is a radio
	tool button

	* btk/btktoolbutton.c (btk_tool_button_create_menu_proxy): Fixes
	to only pay attention to the "use_underline" property when the
	button label comes from the "label" property.

2003-08-29  Laurent Dhima  <laurenti@alblinux.net>

	* configure.in: Added "sq" to ALL_LINGUAS.
	
2003-08-28  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkkeys-x11.c (bdk_keymap_translate_keyboard_state): Markup
	fix in the docs.

	* btk/btkuimanager.c: Change the XML format:
	<Root> element is replaced by <ui>,
	<menu> element is replaced by <menubar>,
	<submenu> element is replaced by <menu>,
	<dockitem> element is replaced by <toolbar>,
	<popups> element is gone,
	verb attribute is replaced by action,
	name defaults to action or the element name. 

	* btk/btkactiongroup.[hc]: Replace BtkActionGroupEntry by 
	BtkActionEntry and BtkRadioActionEntry. BtkActionEntry is simplified 
	by removing the user_data, entry_type and extra_data fields, 
	BtkRadioActionEntry is further simplified by removing the callback. 
	The user_data can now be specified as an argument to 
	btk_action_group_add_actions(). There is a new method 
	btk_action_group_add_radio_actions(), which is similar to 
	btk_action_group_add_actions(), but takes BtkRadioActionEntrys
	and a callback parameter in addition to the user_data. The callback
	is connected to the ::changed signal of the first group member.
	There are _full() variants taking a GDestroyNotify of 
	btk_action_group_add_[radio_]actions().

	* btk/btkradioaction.[hc]: Add a ::changed signal which gets emitted 
	on every member of the radio group when the active member is changed. 
	Add an integer property "value", and a getter for the value of "value"
	on the currently active group member. 

	* tests/testactions.c: 
	* tests/testmerge.c: 
	* tests/merge-[123].ui:  
	* demos/btk-demo/appwindow.c: Adjust to these changes.

	* btk/btktoolbar.c (btk_toolbar_append_element): Trivial doc fix.

2003-08-27  Anders Carlsson  <andersca@bunny.org>

	* demos/btk-demo/appwindow.c (do_appwindow): Focus the
	text view, so the tool bar won't have focus.

Tue Aug 26 09:57:38 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkkeys-x11.c (update_keymaps): Fix variable
	declaration not at start of block. (#120371, Damien Carbery)

2003-08-26  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.[hc] (btk_ui_manager_add_ui_from_string): Use gssize 
	for length, not gsize.

	* btk/btkuimanager.c: Refactor the XML format a bit: rename <Root> to 
	<ui> and make it optional in strings. Rename verb to action, <dockitem> 
	to <toolbar>, <menu> to <menubar>, <submenu> to <menu>.

	* demos/btk-demo/appwindow.c: 
	* tests/testactions.c: 
	* tests/testmerge.c:
	* tests/merge-1.ui:
	* tests/merge-2.ui:
	* tests/merge-3.ui: Adjust to the new XML format.

Mon Aug 25 19:55:55 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextview.c (btk_text_view_update_layout_width): 
	Since we add one to the layout's reported width to
	account for the cursor, we need to subtract one when
	setting the wrap width for the layout. (Fixes infinite
	loop (#120325, Frederic Crozat)

	* btk/btktextlayout.c (btk_text_layout_get_line_display): 
	Be a bit more careful about rounding when converting
	wrapped width from Bango units to pixels.

2003-08-26  Matthias Clasen  <maclas@gmx.de>

        Rename BtkMenuMerge to BtkUIManager. 
	
	* btk/btkuimanager.[hc]: New files. 
	* btk/btkmenumerge.[hc]: Removed. 

	* btk/Makefile.am: 
	* btk/btk.h:
	* tests/testmerge.c: 
	* tests/testactions.c: 
	* demos/btk-demo/appwindow.c: Replace all uses of BtkMenuMerge by 
	BtkUIManager.

	* demos/btk-demo/appwindow.c: Make BtkMenuMerge demo less intimidating: 
	add comments to entries array, remove newlines from ui definition. Don't 
	use the ::add_widget signal.

Mon Aug 25 17:28:04 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btknotebook.c (btk_notebook_forall): Don't
	include page->menu_label - causes various problems,
	including #12047.

Mon Aug 25 23:21:43 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	Fixes #115871, reported by Michael Natterer.

	* btk/btktreeprivate.h: added BtkTreeSelectMode enum,
	added ctrl_pressed and shift_pressed bitfields,
	(_btk_tree_selection_internal_select_node): replace BdkModifierType
	arg with BtkTreeSelectMode.

	* btk/btktreeselection.c (btk_tree_selection_set_mode),
	(btk_tree_selection_select_path), (btk_tree_selection_unselect_path),
	(_btk_tree_selection_internal_select_node): all updated for
	BdkModifierType -> BtkTreeSelectMode move.

	* btk/btktreeview.c (btk_tree_view_button_press): set ctrl_pressed
	and shift_pressed around selection handling block,
	(btk_tree_view_real_select_cursor_row),
	(btk_tree_view_real_toggle_cursor_row),
	(btk_tree_view_real_selection_cursor_parent),
	(btk_tree_view_real_set_cursor): use ctrl_pressed and shift_pressed,
	instead of checking the event state. And also updates for the
	BdkModifierType -> BtkTreeSelectMode move.

Wed Aug 20 21:26:49 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkplug.c (btk_plug_focus): Send the focus on
	to the parent when there was no focus widget before
	and no focus widget after - that is, when there are
	no focusable widgets. (#108678, help tracking it
	down from Padraig O'Briain, Federico Mena Quintero, )

	* btk/btkxembed.[ch]: Move various shared utilities
	for the XEMBED protocol eused by BtkPlug and BtkSocket 
	here.

	* btk/btkxembed.[ch] btkplug.c btksocket.c: Implement
	a flag bit that is sent with focus mesages to indicate
	that the focus has wrapped around on the toplevel;
	use this bit to catch infinite loops when there is no
	focusable widget at ll in the entire toplevel.

	* tests/testsocket.c (child_read_watch): Remove an
	extraneous unref.

	* btk/btkplug.c btk/btksocket.c btk/btkxembed.h: 
	Up XEMBED protocol version to 1, add logic for 
	sending the right version in XEMBED_EMBEDDED_NOTIFY.

	* btk/btksocket.c (btk_socket_add_window): Send
	the embedder window in the XEMBED_EMBEDDED_NOTIFY
	as the spec requires.

Mon Aug 25 16:15:41 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkkeys-x11.c: Fix up CapsLock and 
	NumLock handling for non-XKB. Add a special case
	hack for NumLock on Sun servers. (Patch from
	Robert Basch, #115819)

2003-08-25  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_add_actions): Remove C99isms. (Morten 
	Welinder)

	* btk/btkactiongroup.[hc] (btk_action_group_set_translate_func,
	btk_action_group_set_translation_domain): Hooks for translation of
	label and tooltip in BtkActionGroupEntries.  (#120620)

2003-08-25  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.h (BtkActionGroupEntryType): Namespace the enum
	values properly. Sorry about the resize grip trouble, Owen.  (#120621)
	
	* btk/btkactiongroup.c: 
	* demos/btk-demo/appwindow.c: 
	* tests/testmerge.c: 
	* tests/testactions.c: Use new BtkActionGroupEntryType enum.  

Sun Aug 24 17:14:44 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btk.h: Remove reference to btkresizegrip.h.

Sun Aug 24 17:03:44 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/Makefile.am: Fix accidental commit of references
	to btkresizegrip.[ch]

Sun Aug 24 17:00:03 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkrc.c: Fix some missing initializations of
	rc_file->directory.

2003-08-24  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaction.[ch]: 
	* btk/btktoggleaction.[ch]: 
	* btk/btktoggleactionprivate.h: 
	* btk/btkradioaction.[ch]: 
	* btk/btkactiongroup.[ch]: 
	* btk/btkmenumerge.[ch]: A model-view separation for menus and
	toolbars, using the EggMenu code by James Henstridge.

	* btk/btk.h: Include new headers.
	* btk/Makefile.am: Add new files.

	* tests/testactions.c: Test for actions.
	* tests/testmerge.c: Test for menu merging.
	* tests/merge-[123].ui: Test data for testmerge. 
	* tests/Makefile.am: Add testactions and testmerge.

	* demos/btk-demo/appwindow.c: Use BtkMenuMerge to construct the 
	menubar and toolbar.
	
Sat Aug 23 21:40:18 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* btk/btkrc.c (btk_rc_context_parse_one_file): Fix 
 	problem where rc_file->directory wasn't always getting
	set. (#120549, Luis Villa)
 
2003-08-22  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "ne" to ALL_LINGUAS.

Thu Aug 21 16:00:36 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* btk/btkrc.c: Keep a list of current BtkRcFiles
 	being parsed, not just the directories for those
 	files. Use that to catch recursion. (Part of
 	#114988)
 
Thu Aug 21 21:27:45 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	Fix option menu scrolling (#119821, Owen Taylor).

	* btk/btkmenu.c (btk_menu_scroll_to): remove logic introduced
	by #80484 and the CLAMP,
	(get_menu_height): new function,
	(btk_menu_real_move_scroll): sort of moved the CLAMP here to correct
	new_offset to handle page up/down right.

Thu Aug 21 15:17:42 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkkeys-x11.c: Change the interpretation
	of consumed_modifiers so that it contains:
	 - Modifiers combinations actually found in
	   state.
	 - Single modifier modifier combinations.
	But not multi-modifier combinations that aren't
	in event->state. Document. (#100439)

Thu Aug 21 20:53:46 2003  Kristian Rietveld  <kris@btk.org>

	Slightly modified patch from Yann Rouillard to improve selection
	behavior with the mouse. Fixes #120187.

	* btk/btktreeview.c (btk_tree_view_button_press): only
	select/deselect items on the first button press of button 1,
	expand checks for row_activated to include triple clicks.

Thu Aug 21 01:33:51 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	* btk/btkspinbutton.c (btk_spin_button_size_request): always round
	approximate digit widths up, to avoid truncation, convert to
	bango pixels when we have the full string width instead of converting
	the approx digit width to bango pixels, take inner border and
	interior focus into account correctly. (Fixes #116368, patch from
	Morten Welinder).

2003-08-20  Noah Levitt  <nlevitt@columbia.edu>

	* btk/queryimmodules.c: Don't look at the same directory twice (in
	simple cases). (#120342)

Wed Aug 20 22:04:47 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/bdkwindow.c: Make the layers in the paint stack have their
	own pixmap instead of sharing one. (#118317)

	* tests/testbtk.c (create_get_image): Fixes to make the window fit
	on an 800x600 screen

Wed Aug 20 22:03:25 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btkspinbutton.c (start_spinning): change the type of step
	to gdouble, since it gets it's data from a gdouble (Fixes #113547).

Mon Aug 18 17:19:12 2003  Owen Taylor  <otaylor@redhat.com>

	* modules/input/btkimcontextxim.[ch]: Substantially
	rework the handling of status windows:
	
	 - Store the current StatusWindow in the 
	   BtkIMContextXIM structure and vice-versa, so we
	   don't have to hunt the window hierarchy on
	   cleanup.
	 - Use the Btkidget hierarchy instead of/or as well
	   as the BdkWindow hierarchy when finding the toplevel;
	   this helps for things like BtkHandlebox
	 - Watch BtkWidget::hierarchy_changed to catch 
	   changes in the toplevel without changes in the
	   BdkWindow (reparenting)
	 - Never create the BtkWindow for the status window
	   unless we have text to display.
	 - Various cleanups, add lots of comments.

	(#115077, much help from Takuro Ashie and Hidetoshi
	Tajima in tracking this down and figuring out a fix.)

	* modules/input/btkimcontextxim.c (btk_im_context_xim_focus_in): 

	* modules/input/btkimcontextxim.c: Track the current
	screen for each toplevel so that we show the status
	window on the right screen. (#116340, James Su)

	* modules/input/btkimcontextxim.c: If create a new IC
	when we currently have the focus, call XSetICFocus()
	on it.
	
	* modules/input/btkimcontextxim.c (get_im): Fix bug
	with multiple open screens.

Tue Aug 19 14:37:46 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkimmulticontext.[ch] (struct _BtkIMMulticontext): 
	Replace client_window field with 'priv' pointer,
	retaining binary compatibility.

	* btk/btkimmulticontext.c (btk_im_multicontext_set_slave): 
	save use_preedit/cursor_location/focus status and set
	up the new slave appropriately. (#118651, Botond Botyanszki)

Tue Aug 19 13:58:50 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkgeometry-x11.c (bdk_window_scroll): 
	Don't use impl->position_info.clip_rect for toplevels.
	(#107068, reported by Thomas Mirlacher)

Mon Aug 18 11:48:51 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdrawable-x11.c (convert_to_format): 
	Add a fallback for unaligned source data for
	FORMAT_ARGB_MASK. (#117217)

Mon Aug 18 10:51:57 2003  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Rework handling of REBUILD_PNGS,
	so that we also don't try to REBUILD_PNGS when
	cross-compiling and there is no bdk-pixbuf-csource.
	But give an error if btk/stock-icons/btkstockpixbufs.h
	is not in the source tree. (Note that REBUILDS_PNG
	was set backwards before, which is why you always
	had to manually recreate btkstockpixbufs.h!)

Mon Aug 18 10:19:55 2003  Owen Taylor  <otaylor@redhat.com>

	* btk+-2.0-uninstalled.pc.in: Add a missing btk/ in the
	path to libbtk.la. (#120080, Benedikt Spranger)

Sat Aug 16 10:34:49 2003  Owen Taylor  <otaylor@redhat.com>

	* modules/input/imcedilla.c: Make the list of default
	languages more comprehensive. (Suggestion of
	Fco. Javier F. Serrador)

Sat Aug  9 12:47:11 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdk.c (bdk_arg_context_parse): Fix broken 
	parentheses when skipping args.

Sat Aug 16 16:22:23 2003  Kristian Rietveld  <kris@btk.org>

	Fix major bug in row ref handling, so the new combo box
	will actually work right (:. Bug #107748. Patch written
	with help from Tim Janik.

	The basic idea is to update the row refs in a closure,
	before the actual signal is emitted (rather than having
	the model connect signal handlers).

	* btk/btktreemodel.c (btk_tree_model_base_init): change
	g_signal_new calls for row_inserted, row_deleted and
	rows_reordered to use the new marshallers,
	(row_inserted_marshall), (row_deleted_marshall),
	(rows_reordered_marshall): the new marshallers,
	(btk_tree_row_ref_inserted_callback): renamed to
	btk_tree_row_ref_inserted since it isn't a callback
	anymore and gets called by the marshaller now,
	(btk_tree_row_ref_deleted_callback): likewise,
	(btk_tree_row_ref_reordered_callback): likewise,
	(connect_ref_callbacks), (disconnect_ref_callbacks):
	removed,
	(btk_tree_row_reference_new_proxy),
	(btk_tree_row_reference_free),
	(btk_tree_row_reference_inserted),
	(btk_tree_row_reference_deleted),
	(btk_tree_row_reference_reordered): updated.

Fri Aug 15 16:54:39 2003  Owen Taylor  <otaylor@redhat.com>

	Improve Cedilla handling - based on a patch from Gustavo 
	De Nardin, #111334

	* modules/input/imcedilla.c po/POTFILES.in: Input method that 
	produces C_WITH_CEDILLA rather than C_WITH_ACUTE for 
	dead_acute+c combinations. Make this the default for
	fr and pt.

	* btk/btkimmulticontext.c (btk_im_multicontext_get_slave): 
	Use LC_CTYPE instead of LC_MESSAGES to pick the default
	input method.

Fri Aug 15 17:00:19 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkimcontextsimple.c: Fix missing compose sequence
	for Multi_key+c+apostrophe.

Fri Aug 15 21:57:34 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_adjustment_changed): stop editing
	on vertical scrolling. (#108035, reported by Tim Janik).

Fri Aug 15 20:06:42 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_model_sort_row_changed),
	(btk_tree_model_sort_level_find_insert),
	(btk_tree_model_sort_insert_value): fix off-by-one error.
	(#109292 continued, patch from Yann Rouillard).

Fri Aug 15 19:43:14 2003  Kristian Rietveld  <kris@btk.org>

	(Note: This is not exactly the same as the patch which went in
	 btk-2-2).

	* btk/btktreeview.c (btk_tree_view_class_init),
	(btk_tree_view_key_press), (btk_tree_view_search_key_press_event):
	Also support the up, down, left, right, home, end, page up and
	page down keys on the numpad. (#119419, reported by Alex Larsson).

Fri Aug 15 12:34:04 2003  Owen Taylor  <otaylor@redhat.com>

	Fixes for X/Cygwin builds of BTK+ (#107623, Masahiro Sakai):

	* configure.in (BDK_DEP_LIBS_FOR_X): Make sure that
	we link libbtk against X explicitely, since we
	make BTK+ calls for plug/socket.

	* btk/queryimmodules.c: Use USE_LA_MODULES and 
	G_MODULE_SUFFIX here. 

	* bdk/x11/bdkdrawable-x11.c (bdk_x11_draw_image): Protect
	XShmPutImage with #ifdef USE_SHM.

Thu Aug 14 18:25:39 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilesel.c (btk_file_selection_populate):
	Don't reposition the cursor when we aren't trying
	to complete. (Fixes problems with selection on
	startup, #108433, reported by Mark Finlay.)

	* btk/btkfilesel.c (btk_file_selection_populate): Remove
	code that tried to position the cursor after the common
	prefix when there was one, it wasn't working, and
	would be hard to fix. Just always put the cursor
	at the end when completing.

Thu Aug 14 17:58:23 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilesel.c (get_current_dir_utf8): If getting
	the current directory fails because of encoding
	conversion problems, walk up textually to parent
	directories until we can convert. (#113627)

Wed Aug 13 17:01:49 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmenushell.[ch] (btk_menu_shell_enter_notify):
	Remove usage of menu_shell->ignore leave which was
	to deal with stray events we no longer get because
	we do grabbing differently. Comment it as unused in
	the header. (#115837, Keith Bissett)

Wed Aug 13 16:32:43 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmenu.c (btk_menu_position, btk_menu_window_size_request): 
	Fix some places that weren't properly Xinerama-ified.

	* btk/btkmenu.c: Fix problem with windows that scroll
	at the top of the screen.

Wed Aug 13 11:34:53 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkcombo.c (btk_combo_init): connect_after() to 
	key-press-event on the entry, so input methods get access to 
	key presses before BtkCombo customization.
	(#115451, Botond Botyanszki)

2003-08-13  Anders Carlsson  <andersca@bunny.org>

	* tests/testtoolbar.c: (set_important_func), (important_toggled),
	(create_items_list):
	Add an important column.
	
Tue Aug 12 15:00:15 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.c (btk_window_real_set_focus): Protect
	against reentrancy from ::focus-out handlers. 
	(#118129, Felipe Heidrich)

Tue Aug 12 14:27:42 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkkeyhash.c (_btk_key_hash_lookup): Remove
	BDK_LOCK_MASK before calling
	bdk_keymap_translate_keyboard_state so bindings 
	and accelerators are independent of the Caps-lock
	key. (#115384, reported by Toni Willberg)

Mon Aug 11 12:07:14 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkevents-x11.c (get_real_window): Add missing
	break statements (#119494, Soeren Sandmann)

Mon Aug 11 11:10:07 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwidget.h: Mark parent public as well; it's
	extensively accessed in existing code, so there is
	no advantage in making people use get_parent().
	(Tweak to #119463 fix)

2003-08-11  Matthias Clasen  <maclas@gmx.de>

	Add support for EWMH "Above" and "Below" window states.  (105100,
	Manuel Clos)
	
	* tests/testbtk.c: Add "Above" and "Below" to the the "Window
	State" demo.

	* btk/btkwindow.h: Add btk_window_set_keep_above and
	btk_window_set_keep_below.

	* btk/btk.def: Add btk_window_set_keep_above and
	btk_window_set_keep_below.

	* btk/btkwindow.c (btk_window_set_keep_below):
	(btk_window_set_keep_above): New functions, call the corresponding
	bdk functions.

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_keep_below): New
	function, sets _NET_WM_STATE_BELOW.
	(bdk_window_set_keep_above): New function, sets
	_NET_WM_STATE_ABOVE.

	* bdk/bdkwindow.h: Add bdk_window_set_keep_above and
	bdk_window_set_keep_below.

	* bdk/bdkevents.h (BdkWindowState): Add BDK_WINDOW_STATE_ABOVE and
	BDK_WINDOW_STATE_BELOW.

	* bdk/bdk.def: Add bdk_window_set_keep_above and
	bdk_window_set_keep_below.

	* acinclude.m4: Copy newer versions of JH_CHECK_XML_CATALOG and
	JH_PATH_XML_CATALOG from btk-doc to enable configuring without
	xmlcatalog in PATH.  (#119115)

2003-08-10  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.h (struct _BtkWidget): Mark some members as
	public.  (#119463)

2003-08-09  Noah Levitt  <nlevitt@columbia.edu>

	* bdk/bdkevents.h:
	* docs/reference/bdk/tmpl/windows.sgml: Elaborate a bit more in the
	docs on BdkFilterFunc and BdkFilterReturn.

2003-08-09  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c:  Add and hook in btk_calendar_scroll,
	to let the mouse wheels select the month. Scrolling down
	moves forward in time. (#53134, Abibail Brady) 

	* btk/btkcalendar.c: Complete the RTL flipping support for
	BtkCalendar, make it possible to flip the headings using the
	"magic translated string" technique.  Translators, note the
	comment in btk_calendar_init() explaining this.  (#102416)

	* btk/btkcalendar.c: Get the information about the first day of
	the week from the locale using another instance of the "magic
	translated string" technique.  Ignore the display option
	BTK_CALENDAR_WEEK_START_MONDAY with a warning.  (#87977)

	* btk/btkcalendar.c: Add DND support to BtkCalendar. The selected
	date is dragged as text, formatted via strftime %x. Text drops are
	accepted if g_date_set_parse() can make sense of the text. A
	dedicated data format for date DND has not been introduced yet,
	since there didn't seem to be sufficient consensus on such a
	format on xdg-list.  (#117297)
	
2003-08-08  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkrebunnyion-generic.c (bdk_rebunnyion_spans_intersect_foreach):
	Fix a segfault.  (#115284, Jan Kratochvil)

2003-08-08  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (print_event): Print also the root
	coordinates for events that have such. Print coordinates for enter
	and leave events.

	(bdk_event_translate): Don't use event uninitialixed in the
	return_exposes branch of the WM_PAINT handler.

	* bdk/win32/bdkwindow-win32.c (bdk_window_new,
	_bdk_windowing_window_get_pointer, _bdk_windowing_window_at_pointer): 
	Must offset top-level window coordinates here, too.

2003-08-08  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/appwindow.c (do_appwindow): Hide the resize grip
	when maximized or fullscreen.

2003-08-07  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkinput-win32.h
	* bdk/win32/bdkinput-win32.c (_bdk_input_configure_event,
	_bdk_input_enter_event): Drop the BdkEvent* parameter, it wasn't
	used.

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): Adapt caller
	accordingly, in fact an uninitialised variable was dereferenced.
	

	[Win32] Add support for multiple monitors. 
	
	* bdk/win32/bdkprivate-win32.h
	* bdk/win32/bdkglobals-win32.c: New global variables for
	multiple-monitor info: _bdk_num_monitors, _bdk_monitors, and
	_bdk_offset_x and _bdk_offset_y.
	
	* bdk/win32/bdkdisplay-win32.c (count_monitor, enum_monitor): New
	functions, enumeration functions passed to EnumDisplayMonitors().

	(bdk_display_open): If the EnumDisplayMonitors() and
	GetMonitorInfo() API is present (on Win98, Win2000 and newer), use
	if to find out monitor info.

	Calculate the offset between Win32 coordinates (relative to the
	primary monitor's origin (and thus negative on monitors to the
	left of or above it), and BDK's (visible coordinates should be
	non-negative).
	
	* bdk/win32/bdkscreen-win32 (bdk_screen_get_n_monitors,
	bdk_screen_get_monitor_geometry): Use information collected above.

	(bdk_window_move, bdk_window_move_resize_window_get_geometry):
	Subtract _bdk_offset_{x,y} from BDK root window coordinates.

	(bdk_window_get_geometry, bdk_window_get_origin,
	bdk_window_get_frame_extents): For top-level windows, add
	_bdk_offset_{x,y} to BDK root window coordinates

	Still need to handle multiple monitors in
	bdk_window_fullscreen(). Probably should make the window
	fullscreen on the monitor where the cursor is?

	* bdk/win32/bdkevents-win32.c: Add _bdk_offset_{x,y} to all BDK
	root window coordinates in BdkEvents.

	
	[Win32] Fix geometry hint handling. Add support for resize
	increment and base size, and aspect ratio geometry hints. The
	"gridded geometry" test in testbtk now works beautifully.

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_geometry_hints):
	Turns out this function shouldn't actually ever modify the
	window's size, just store the hints. (Old code kept for a while
	inside #if 0.)

	(bdk_window_set_hints): Remove presumably broken code that handles
	the position hints, this function is obsolete anyway.

	* bdk/win32/bdkevents-win32.c: Drop the current_{x,y}_root
	variables, not used.

	(adjust_drag): New function, used to implement resize increment
	hints.

	(bdk_event_translate): Handle WM_SIZING, implement resize
	increment and base size, and aspect ratio geometry hints here. The
	WM_GETMINMAXINFO handler takes care of the minimum and maximum
	size hints as before. Fix the WM_GETMINMAXINFO handler to take
	into account window decorations. No need to modify the
	ptMaxPosition and ptMaxSize fields in the MINMAXINFO struct,
	the defaults are fine.
	
	* bdk/win32/bdkprivate-win32.h 
	* bdk/win32/bdkwindow-win32.c (_bdk_win32_adjust_client_rect,
	_bdk_win32_get_adjusted_client_rect): New helper functions.

2003-08-07  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkevents-x11.c (bdk_check_wm_state_changed): Reset the
	toplevel->have_* flags before iterating over the _NET_WM_STATE 
	atoms.  (#119217) 

Thu Aug  7 16:49:29 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* btk/btkwidget.c (btk_widget_set_style_internal): 
 	Fix a bug where on theme change, resize/redraw wasn't
 	properly getting queued on toplevel windows. (#116346,
 	Rajkumar Siva)
 
 	* btk/btkwidget.c (btk_widget_invalidate_widget_windows): 
 	Fix bug where wrong coordinates were used for toplevel
 	window.
 
Thu Aug  7 16:40:21 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btknotebook.c (btk_notebook_remove): Remove leftover
	page_num variable (Archit Baweja)

2003-08-07  Matthias Clasen  <maclas@gmx.de>

	* btk/btkspinbutton.c (btk_spin_button_default_input): Use g_strtod() to
	cope with C libraries with crippled locale support.  (#115293)

2003-08-07  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkevents-win32.c : finally use TrackMouseEvent
	(only if the new window not known to Bdk) to get proper
	leave notification, and get rid of the wrong placed 
	tooltips, bug #102283
 
	(bdk_event_translate) : small code reordering to not get
	BDK_MOTION_NOTIFY for still mouse and get back tooltips on 
	menus, bug #117367

2003-08-07  Tor Lillqvist  <tml@iki.fi>

	* bdk/bdk.def
	* bdk/win32/bdkfont-win32.c (bdk_fontset_load_for_display): Add
	missing function, trivially implement.

2003-08-07  Matthias Clasen  <maclas@gmx.de>

	* btk/btkctree.c (draw_row): Don't cut descenders when 
	rendering.  (#118646, Charles Kerr) 

2003-08-06  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkpixmap-win32.c (bdk_pixmap_new) :
	initialize bits to 0 (probably default on NT)

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_icon) :
	now it works as intended ;-)

2003-08-04  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkwindow-win32.c(bdk_window_set_modal_hint) :
	set HWND_NOTOPMOST for modal==FALSE, fixes bug #118435

	* bdk/win32/bdkwindow-win32.c : implement bdk_window_[un]fullscreen
	(bdk_window_{move,resize,move_rezize})) : noop if FULLSCREEN

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_icon) :
	against all expectations it is basically ony a call with WM_SETICON
	needed (the visual effect is there, though colors or mask are
	still somewhat wrong).
	* bdk/win32/bdkwindow-win32.h : place to store the HICON

	* bdk/win32/bdkdrawabke.win32.c : readded the conditional end
	pixel drawing as it was fixed at 1999-08-23

	btk/btk.def : updated

Tue Aug  5 10:07:08 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmessagedialog.c (btk_message_dialog_get_property): 
	Add a missing break. (#119156, Callum McKenzie)

Tue Aug  5 00:24:13 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c (btk_menu_position): New positioning
	algorithm.(#116649)

Fri Aug  1 15:26:46 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c, btk/toolitem.c: add new "is_important"
	property
	
	* btk/btkradiotoolbutton.c
	(btk_radio_tool_button_new_from_widget): Don't take a stock id

	* btk/btkradiotoolbutton.c
	(btk_radio_tool_button_new_with_stock_from_widget): make this
	function take a stock_id.

	* btk/toolbar: documentation

Mon Aug  4 14:53:46 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkimage-x11.c (_bdk_windowing_image_init): 
	Fix problem where use_xshm was getting set wrong if
	MIT_SHM wasn't found. (George Lebel)

2003-08-04  Tor Lillqvist  <tml@iki.fi

	* bdk/win32/bdkevents-win32.c (apply_filters): Fix braino:
	actually use the passed-in filter list. The function also needs a
	BdkWindow parameter, as filter functions expect
	BdkEvent::any.window to be valid. (#119034, Hans Breuer)

2003-08-03  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkscreen-x11.c (bdk_screen_get_n_monitors): 
	(bdk_screen_get_monitor_geometry): Improve wording of the docs, avoid
	the term "virtual screen".  (#119030, Tor Lillqvist)

2003-08-02  Matthias Clasen  <maclas@gmx.de>

	* tests/testtext.c (test_init): 
	* tests/testbtk.c (test_init): 
	* tests/testdnd.c (test_init): 
	* demos/pixbuf-init.c (pixbuf_init): 
	* demos/btk-demo/main.c (main): Use g_setenv().

	* bdk/x11/bdkdisplay-x11.c (_bdk_windowing_set_default_display): Use
	g_unsetenv(). 

Sat Aug  2 12:53:16 2003  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Requires bunnylib-2.3.0, bango-1.2.0.

	* configure.in: Require Xft version 2,
	remove code for handling older versions of bango and Xft.
	Many miscellaneous improvements to X checks

	* acinclude.m4: Add BTK_ADD_LIB() macro for adding 
	a library to a variable, avoiding dups.

	* bdk/x11/bdkfont-x11.c (bdk_font_from_description_for_display): 
	Always load "fixed"

	* bdk/x11/bdk*-x11.[ch]: Remove support for Xft1 and
	for bangox.

2003-08-02  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcolorsel.c (color_sample_drop_handle) 
	(palette_drop_handle): 
	* btk/btkcolorbutton.c (btk_color_button_drag_data_received):  Accept
	drops with the wrong format, since the KDE color chooser incorrectly
	drops application/x-color with format 8.  (#118810)

	* btk/btkcolorsel.c (color_sample_drop_handle) (palette_drop_handle): 
	* btk/btkcolorbutton.c (btk_color_button_drag_data_received):  
	Accept drops with the wrong format, since the KDE color chooser 
	incorrectly drops application/x-color with format 8.  (#118810)

2003-08-02  Tor Lillqvist  <tml@iki.fi>

	Fix bdk/win32 window geometry handling again. The window position
	in a BDK_CONFIGURE event should be that of the client area, not of
	the window decorations. (I was confused by the term "window
	border" in X11. It does *not* mean the window manager
	decorations. There are no X11-style window borders in Win32.)
	Also, this time do take the geometry hints into account
	appropriately when moving windows. Now testbtk's gravity test's
	move buttons work OK. There are stil problems with taking gravity
	into account when showing a hidden window.

	* bdk/win32/bdkwindow-win32.h: Keep a whole BdkGeometry as hints
	instead of separate fields.
	
	* bdk/win32/bdkevents-win32.c (handle_configure_event): Don't
	adjust for decorations.

	* bdk/win32/bdkwindow-win32.c (get_outer_rect,
	adjust_for_gravity_hints): New functions.
	(bdk_window_move, bdk_window_resize, bdk_window_move_resize): Use
	above functions, take geometry hints into account.
	(bdk_window_set_geometry_hints): Size hints specicy client area,
	not including decorations.

Fri Aug  1 17:10:22 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilesel.c (cmpl_completion_fullname): Always
	return an absolute path (#115590), fix a problem where
	you could crash the file selector with a looong name
	by returning a newly allocated buffer.

Fri Aug  1 16:44:51 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilesel.c (update_cmpl): Fix obvious reallocation
	bug in rarely or never hit code path (#118071,
	Tor Lillqvist)

Fri Aug  1 16:30:13 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdrawable-x11.c (_bdk_x11_have_render): 
	If the check for missing depths, try actually creating pixmaps
	of the depths to deal with Xinerama not reporting
	all the depths it should. (#115822)

Fri Aug  1 15:33:59 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btksocket.c: Patch from Denis Mikhalkin to
	forward KeyRelease events as well as KeyPress events.
	(#115597)

Fri Aug  1 15:06:25 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* bdk/bdk.c (bdk_parse_args): g_set_prgname("<unknown>")
 	if argc is 0 as well, instead of leaving it unset.
 	(#116023, Michael Meeks)
 
Thu Jul 31 23:09:02 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_class_init): make show_arrow
	default to TRUE; ignore the property when api_mode != NEW_API

2003-07-31  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c (btk_window_set_default_icon): Rename parameter pixbuf
	to icon, to pacify btk-doc.

	* btk/btkwidget.c (btk_widget_class_init): Fix formatting of drag-motion 
	example. 

Thu Jul 31 15:33:33 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btk*tool*.h: add padding to subclasses of BtkToolItem

Thu Jul 31 15:29:28 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolitem.c (struct _BtkToolItemPrivate): remove unused
	overflow_item field.

Wed Jul 30 21:11:13 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolitem.h: make _btk_tool_item_toolbar_reconfigured()
	an internal function

	* btk/btktoolitem.h: remove unused declaration of
	_btk_tool_item_get_drag_window().

Wed Jul 30 17:03:58 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbutton.[ch]:
	(btk_tool_button_new): swap icon_widget and label arguments to
	match BonoboUIToolbarButton.

	* btk/btktoolbar.h: un-deprecate btk_toolbar_{set|unset}_style().

2003-07-30  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c (btk_widget_class_init): Some updates to the DND
	signal docs. 

2003-07-29  Tor Lillqvist  <tml@iki.fi>

	Fix for #108007, #112402, #117042: There was confusion in
	bdk/win32 at various places whether a window position refers to
	the decoration position or the client area position. Also whether
	window size includes decorations or not.
	
	The correct interpretation apparently is that in BDK (like in
	X11), a top-level window position means the decoration's position,
	but size means the window's inner size (client area size). In the
	Win32 API, the window size usually includes the decorations,
	though.
	
	* bdk/win32/bdkevents-win32.c (decode_key_lparam): Move inside
	#ifdef G_ENABLE_DEBUG.
	(handle_configure_event): New function, generates BDK_CONFIGURE
	events from WM_SIZE and WM_MOVE messages. Even if no event is
	generated because of the event mask, still set the private
	position and size fields. Calculate position and size correctly.
	(bdk_event_translate): Call handle_configure_event().

	* bdk/win32/bdkgeometry-win32.c: Cosmetics.

	* bdk/win32/bdkwindow-win32.c: Use GDI_CALL() and API_CALL()
	macros. Cosmetic debugging output changes.
	(SafeAdjustWindowRectEx): Remove. If an application wants to
	locate a window outside of the screen, it's not BDK's business to
	prevent it. And anyway, with multiple monitors, negative
	coordinates are perfectly normal.
	(bdk_window_new): Adjust the window size for decorations after
	_bdk_window_init_position() has done its job. (But the big window
	code currently is presumably broken on Win32 anyway.)
	(bdk_window_move): The position passed in is supposed to be that
	of the window border, so don't need to adjust for decorations.
	(bdk_window_resize, bdk_window_move_resize): Simplify somewhat.

Tue Jul 29 13:55:44 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (btk_toolbar_set_style,
	btk_toolbar_prepend_element, btk_toolbar_append_element,
	btk_toolbar_insert_space, btk_toolbar_prepend_space,
	btk_toolbar_append_space, btk_toolbar_insert_item,
	btk_toolbar_prepend_item, btk_toolbar_append_item,
	btk_toolbar_set_tooltips, btk_toolbar_set_orientation,
	btk_toolbar_new, btk_toolbar_prepend_item):

	Move documentation inline from template files.

	* btk/btktoolbar.c (btk_toolbar_insert_element,
	btk_toolbar_insert_widget, btk_toolbar_prepend_widget,
	btk_toolbar_append_widget, btk_toolbar_remove_space,
	btk_toolbar_insert_stock, btk_toolbar_unset_icon_size,
	btk_toolbar_get_icon_size, btk_toolbar_set_icon_size,
	btk_toolbar_get_tooltips, btk_toolbar_unset_style,
	btk_toolbar_get_style, btk_toolbar_get_orientation)

	Copy documentation from stable that was added after the EggToolbar
	branched.

	* btk/btktoolbar.h: deprecate btk_toolbar_unset_icon_size()

Mon Jul 28 18:21:34 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk+/docs/: Commit autogenerated changes, so patches will make
	sense.

2003-07-27  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (build_key_event_state): On Win9x,
	the keyboard state returned by GetKeyboardState() doesn't
	distinguish between the left and right Control and Alt keys. Thus
	we cannot detect AltGr (which is supposed to be left Control +
	right Alt) the same way as on NT-based systems, but have to accept
	either Control + either Alt as AltGr.

2003-07-27  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeselection.c (btk_tree_selection_selected_foreach):
	Fix function name in warning message.  (#118156, Tim-Philipp
	Mller)

	* btk/btkcellrenderer.c (btk_cell_renderer_get_property):
	is-expander and is-expanded are boolean properties, not ints.
	(#118359, Josh Parsons)

Sat Jul 26 15:21:27 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkimagemenuitem.c
	(btk_image_menu_item_toggle_size_request): don't request
	toggle_space when the image width is 0.

2003-07-25  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkprivate-win32.h
	* bdk/win32/bdkglobals-win32.c: New flags _bdk_input_locale_is_ime
	and _bdk_keyboard_has_altgr.
	
	* bdk/win32/bdkevents-win32.c: Lots of changes. Most important
	ones detailled here.

	Code that has been ifdeffed out for a long time removed. Remove
	some really old doc comments that were left behind for some public
	functions, the official ones are in the X11 backend anyway. Change
	BDK_WINDOW_OBJECT() calls to BdkWindowObject casts. Reformat
	multi-line boolean expressions to have the operators at ends of
	lines.

	As mouse capture with SetCapture() indeed seems to work OK, no
	need to have the correspoinding macro USE_SETCAPTURE and ifdefs.

	Ifdef out the bdk-ping-msg stuff. I don't remember why it was
	needed at some time, and things seem to work fine now without
	(knock on wood).

	Ifdef out the search for some Latin locale keyboard layout being
	loaded. Not used currently, but might be needed after all, if we
	decide that we want to be able to generate ASCII control character
	events with a non-Latin keyboard.

	(assign_object): New helper function, handles the g_object_ref()
	and unref() calls when assigning GObject pointers.
		
	(generate_crossing_events): Also generate the BDK_NOTIFY_INTERIOR
	enter event when the pointer has moved to an ancestor window. Was
	left out by mistake.

	(bdk_window_is_ancestor): Renamed from bdk_window_is_child().

	(bdk_pointer_grab, bdk_pointer_ungrab): Implement the confine_to
	functionality, using ClipCursor().
		
	(find_window_for_mouse_event): Splice part of code into new
	function find_real_window_for_grabbed_mouse_event().

	(fixup_event, append_event, apply_filters): New functions, code
	refactored out from elsewhere.

	(synthesize_enter_or_leave_event, synthesize_leave_event,
	synthesize_enter_event,
	synthesize_leave_events,synthesize_enter_events): Also take a
	BdkCrossingMode parameter, in preparation to generating
	BDK_CROSSING_GRAB and BDK_CROSSING_UNGRAB events.

	(fixup_event, append_event, fill_key_event_string): New functions,
	code refactoring.

	(vk_from_char, build_keypress_event, build_keyrelease_event):
	Removed as part of dropping WM_CHAR handling.

	(build_key_event_state,bdk_event_translate): Call
	GetKeyboardState(), once, for each keyboard message, instead of
	several calls to GetKeyState() here and there.

	(bdk_event_translate): Fix bugs #104516, #104662, #115902. While
	at it, do some major refactoring, and some fixes for potential
	problems noticed while going through the code.

	Don't handle WM_CHAR at all. Only handle WM_KEYDOWN and
	WM_KEYUP. Don't need the state variables related to whether to
	wait for WM_CHAR or not, and whether the current key is
	AltGr. Remove lots of complexity. Thus don't need the
	use_ime_composition flag.

	Not handling WM_CHAR means dead key handling will have to be taken
	care of by BTK, but that seems to work fine, so no worry.

	Another side-effect is that Alt+keypad digits don't work any
	longer, but it's better to learn to use BTK's ISO14755 support is
	anyway.

	Be more careful in checking whether AltGr is involved. Only
	attempt to handle it if the keyboard actually has it. And
	explicitly check for *left* Control plus *right* Alt being
	pressed. Still, allow (left) Alt and/or (right) Control with AltGr
	chars.

	Handle keys using similar code as in the X11 backend. As we have
	built a keymap in bdkkeys-win32.c anyway, use it by calling
	bdk_keymap_translate_keyboard_state() to look up the keysym from
	the virtual key code and keyboard state. Build the key event
	string in exactly the same way as the X11 backend.

	If an IME is being used, don't generate BDK events for keys
	between receiving WM_IME_STARTCOMPOSITION and
	WM_IME_ENDCOMPOSITION, as those keys are for the IME.
	
	For WM_IME_COMPOSITION, handle all the Unicode chars returned from
	the IME, not just the first one.

	bdk_event_translate() is still quite complex, could split the
	message handler cases out into separate functions.

	On mouse events, when the mouse is grabbed, use
	find_real_window_for_grabbed_mouse_event() in order to be able to
	generate correct crossing events.
	
	No longer take a pre-allocated BdkEvent as parameter. Instead,
	allocate events as needed and append them to the queue. (This is
	different from how bdk_event_translate() in the X11 backend
	works.) This change made the code much clearer, especially in the
	cases where we have to generate several BDK events for one Windows
	message.  Return FALSE if DefWindowProc() should be called, TRUE
	if not. If DefWindowProc() should not be called, also return the
	value to be returned from the window procedure.

	(Previously, the interaction with bdk_event_translate()'s caller
	was much more complex, when we had to indicate whether the
	already-queued event should be left in the queue or removed, and
	in addition also had to indicate whether to call DefWindowProc()
	or not, and what value to return from the window procedure if
	not.)

	Don't use a separate "private" variable required to be pointing to
	the BdkWindowObject of the "window" variable at all times. Just
	use casts, even if looks a bit uglier.

	Notice destroyed windows as early as possible, and break out of
	the messsage switch.

	Use _bdk_pointer_root as current_window when the pointer is
	outside BDK's top-level windows.
	
	On WM_INPUTLANGCHANGE, set _bdk_input_locale_is_ime as
	appropriate, based on ImmIsIME().
	
	(bdk_event_translate, bdk_event_send_client_message_for_display,
	bdk_screen_broadcast_client_message): Implement client messages.
	Use a registered Windows message to pass BDK client messages. Note
	that the amount of user data is restricted to four bytes, as it is
	carried in the LPARAM. (The WPARAM is used for the message type
	"atom".)
	
	(real_window_procedure): Adapt for new bdk_event_translate()
	interface.

	* bdk/win32/bdkmain-win32.c (_bdk_windowing_init): Set
	_bdk_input_locale_is_ime initially.

	* bdk/win32/bdkwindow-win32.c: Use g_object_ref()/unref() instead
	of g_colormap_ref()/unref().

	(bdk_window_new): Made code a bit more like the X11 one, pretend
	to handle screens (although we just have one for now).

	* bdk/x11/bdkevents-x11.c
	(bdk_event_send_client_message_for_display,
	bdk_screen_broadcast_client_message): Document the user data
	limitation on Win32.

	* bdk/win32/bdkevents-win32.c (print_event): More complete enter
	and leave notify detail output.

	* bdk/win32/bdkkeys-win32.c (update_keymap): Make dead keys
	visible to BDK and BTK. Store the corresponding BDK_dead_* keysym
	for those, so that the BtkIMContextCimple compose tables will
	work. Deduce if the keyboard layout has the AltGr key, and set the
	above flag accordingly.

2003-07-26  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c: Document DND signals.

2003-07-24  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (popup_targets_received): Make the "Input Methods"
	insensitive when editing isn't possible.  (#118150)

2003-07-23  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcolorsel.c (btk_color_selection_init): Make the hue 
	spinbutton wrap.  (#118097, John Darrington)

	* docs/faq/btk-faq.sgml: Mention Xnest as a way to debug BTK+ apps. 

2003-07-20  Hans Breuer  <hans@breuer.org>

	* makefile.msc : new file to build it all
	* Makefile.am : ... added to EXTRA_DIST

	* bdk/makefile.msc btk/stock-icons/makefile.msc 
	  btk/makefile.msc.in tests/makefile.msc : updated

	* bdk/bdk.def btk/btk.def : export a bunch of new 
	functions

	* btk/btkbbox.c : use g_return_val_if_fail() if
	there is a value to return

	* btk/btkfontsel.c btk/btkiconfactory.c :
	static correctness

	* btk/btkicontheme.c : ported to use GTimeVal instead of
	struct timeval and BTK_DATA_PREFIX instead of BTK_DATADIR

	* btk/btkicontheme.c : use HAVE_LC_MESSAGES

	* btk/btkimmulticontext.c : use btkprivate.h

	* btk/stock-icons/stock_color_picker_25.png
	  btk/stock-icons/stock_jump_to_rtl_16.png
	  btk/stock-icons/stock_jump_to_rtl_24.png
	  btk/stock-icons/stock_redo_rtl_16.png
	  btk/stock-icons/stock_redo_rtl_24.png
	  btk/stock-icons/stock_undelete_rtl_16.png
	  btk/stock-icons/stock_undelete_rtl_24.png
	  btk/stock-icons/stock_undo_rtl_16.png :
	  btk/stock-icons/stock_undo_rtl_24.png :
	readded as binary

Sat Jul 19 22:39:24 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolitem.c (btk_tool_item_size_request): remove
	leftover request of {xy}thickness

Sat Jul 19 16:26:02 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbutton.c (btk_tool_button_construct_contents): don't
	attempt to add a NULL icon to the box.

Sat Jul 19 12:13:20 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btknotebook.c (btk_notebook_focus_in|out): only redraw tabs
	on focus in/out.

2003-07-19  Matthias Clasen  <maclas@gmx.de>

	* btk/btkstock.h (BTK_STOCK_DIALOG_AUTHENTICATION): New stock id. 
	* btk/btkiconfactory.c (get_default_icons): Add
	stock_dialog_authentication_48.  (#65765) 
	* btk/stock-icons/Makefile.am (VARIABLES2, IMAGES): Here too.
	* btk/stock-icons/stock_dialog_authentication_48.png: New image.

	* btk/btkbbox.h: 
	* btk/btkbbox.c (btk_button_box_get_child_secondary): New
	function. (#64562) 

Sat Jul 19 00:18:40 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkwindow.c (btk_window_set_default_icon): Fix C99
	declaration

	* btk/btkwidget.c (btk_widget_queue_shallow_draw): new function
	(btk_widget_real_focus_{in|out}_event): queue shallow draws
	instead of full draws.

2003-07-18  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c: Add properties decorated and gravity.  (#80234) 

	* btk/btktextview.c (btk_text_view_class_init): Add a new keybinding
	signal, move_viewport. 
	(btk_text_view_move_viewport): New function which implements the
	move_viewport functionality. 
	(btk_text_view_move_cursor_internal): If the cursor is not visible, move
	the viewport. (#78669) 

	* btk/btkenums.h (BtkScrollStep): New enumeration, used for
	move_viewport argument. 

	* btk/btkstatusbar.c (btk_statusbar_class_init): Add a has_resize_grip
	property.  (#111779) 

	* btk/btkwindow.h: 
	* btk/btkwindow.c (btk_window_set_default_icon): New method.  (#95816)

	* btk/btkmessagedialog.h:
	* btk/btkmessagedialog.c (btk_message_dialog_add_buttons): New method.  
	(#65501, Sebastian Rittau)

Fri Jul 18 20:06:57 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktextview.c (changed_handler): use
	btk_widget_queue_resize_noredraw().

2003-07-16  Jody Goldberg <jody@bunny.org>

	* bdk/x11/bdkwindow-x11.c (bdk_window_focus) : fix cut-n-paste-o

Fri Jul 18 19:55:50 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkwidget.c (btk_widget_queue_resize_no_redraw): Add this
	API. 

Fri Jul 18 18:43:01 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	By popular request give toolbuttons a border.
	
	* btk/btktoolitem.c
	(btk_tool_item_size_allocate):
	(btk_tool_item_size_request): don't request and allocate a border
	around the child

	* btk/btktoolbutton.c 
	(btk_tool_button_size_allocate):
	(btk_tool_button_size_request): remove these functions

	* btk/btktoolbar.c 
	(btk_toolbar_size_request):
	(btk_toolbar_size_allocate): request and allocate a border if we
	have a shadow.

Thu Jul 17 19:24:51 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	Fixes issues pointed out by Morten Welinder in #115140.

	* btk/btktreeview.c (btk_tree_view_size_request): fix comment,
	(do_validate_rows): update validated_area with a logic OR instead
	of a bitwise OR,
	(validate_rows_handler): make the if statement match the one in
	validate_rows(), so we don't leak the timeout.

Thu Jul 17 19:12:02 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_remove_widget): the treeview
	should only grab focus back if the "cell_editable" widget still
	has focus. (Fixes #110104, testcase provided by Marco Pesenti
	Gritti).

Thu Jul 17 19:06:34 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeviewcolumn.c (_btk_tree_view_column_realize_button):
	Don't set attr.event_mask twice, those things were meant to be
	ORred. (#115139, pointed out by Morten Welinder).

Thu Jul 17 16:11:21 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_rows_reordered): stop editing
	if needed. (Fixes #115869, reported by Michael Natterer).

2003-07-15  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkcursor-x11.c (bdk_display_get_maximal_cursor_size):
	Fight against btk-doc stupidity.

2003-07-13  Matthias Clasen  <maclas@gmx.de>

	* btk/btkdnd.c (btk_drag_begin): Rename parameter target_list back to 
	targets, to pacify btk-doc.

Sun Jul 13 15:57:57 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbutton.c (btk_tool_button_finalize): Fix leaks of
	label_text, label_widget and icon_widget. (#117312, 
	Christian Persch)
	
Sun Jul 13 01:37:51 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c (btk_menu_class_init): new properties
	"horizontal-offset" and "vertical-offset" that determines the
	position of the menu when it is a submenu. 

	* btk/btkmenuitem.c (btk_menu_item_position_menu): position
	submenus according to new vertical- and horizontal-offset
	properties.

Sat Jul 12 16:16:04 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_drag_data_received): special
	case drags to "0", scroll to the top after dropping. (Fixes #94968,
	reported by Alp Toker).

Sat Jul 12 16:08:32 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* demos/btk-demo/editable_cells.c (cell_edited): fixup bad
	code (#115784, Owen Taylor).

Sat Jul 12 16:01:03 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_set_property):
	free the old text and extra_attrs *after* we parsed the new
	markup string. (Fixes #114485, reported by Owen Taylor).

Sat Jul 12 15:51:33 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	Fixes #113904, testcase provided by Rene Seindal.

	* btk/btktreeview.c (btk_tree_view_button_press): set
	pressed_button to -1 when a row has been activated,
	(btk_tree_view_motion_bin_window): only start a drag if there's
	a button being pressed.

Sat Jul 12 15:51:18 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_real_collapse_row): use
	bdk_window_get_pointer instead of bdk_display_get_window_at_pointer
	to avoid a roundtrip (#110272, Owen Taylor).

Sat Jul 12 15:28:26 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	This patch really really fixes scrolling. Related bugs: #81627,
	testcase provided by Timo Sirainen, #111500, testcase provided by
	manu, #113241, reported by Pedro Gimeno/Michael Natterer.

	* btk/btktreeview.c (validate_visible_area): scrolling to a dy
	which is equal to the lower border of the window means scrolling
	to an invisible row, always update the dy when scrolling to an
	invisible row, corrected area_above/below calculations for
	invisible rows, when walking the tree correct the size
	subtracted for invalidated rows, fix wrong logic in comment.

2003-07-11  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c (pixbuf_supports_svg): Use g_strfreev() to free
	mime_types.  (#117219, Steve Chaplin)

Tue Jul  8 20:11:04 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkevents-x11.c (get_real_window)
	bdk/x11/bdkinput-x11.c (_bdk_input_common_init)
	bdk/x11/bdkimage-x11.c (_bdk_windowing_image_init)
	bdk/x11/bdkprivate-x11.h (_bdk_windowing_image_init)
	Don't assume that all events start with XEventAny - Xkb events
	don't! (#105745). So, only do that for core events, and for
	non-core events, add a system for registering event types
	that start with XEventAny.

	* bdk/x11/bdkevents-x11.c (bdk_event_translate):
	Check to see if the result of bdk_window_lookup_for_display()
	is actually a window.

Fri Jul 11 20:48:14 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodel.c (btk_tree_path_free): make the path != NULL
	check a silent assert, so it follows the g_free() behaviour.

2003-07-11  Matthias Clasen  <maclas@gmx.de>

	* btk/btkstatusbar.c (btk_statusbar_init): Center statusbar contents 
	vertically.  (#109823, Joe Shaw)

2003-07-11  Morten Welinder  <terra@bunny.org>

	* bdk/x11/bdkcursor-x11.c (bdk_cursor_new_from_pixbuf): Fix memory
	access error.  (#69436)

Fri Jul 11 14:32:43 2003  Kristian Rietveld  <kris@btk.org>

	Landing BtkTreeModelFilter and the completion code. (Test program
	and documentation will follow next week).

	* btk/btkcellayout.[ch], btk/btkentrycompletion.[ch],
	btk/btktreemodelfilter.[ch], btk/btkentryprivate.h: new files.

	* btkentry.[ch]: added btk_entry_{get,set}_completion, wrote
	necessary code to hook up completion.

	* btktreeviewcolumn.c: made BtkTreeViewColumn implement the new
	BtkCellLayout interface.

	* btkmarshalers.list: added BOOLEAN:OBJECT,BOXED.

	* btk/btk.h, btk/Makefile.am, po/POTFILES.in: all updated for the new
	source files.

Wed Jul  9 19:48:26 2003  Kristian Rietveld  <kris@btk.org>

	Merge from stable.

	* bdk/bdkdisplay.c (bdk_display_get_window_at_pointer): don't
	directly return from ->window_at_pointer, but set win_x and win_y
	first if needed. (Fixes #110166, reported by Arno Charlet).

	* bdk/bdkwindow.c (bdk_window_get_composite_drawable): change
	function to accept BdkDrawables and not just BdkWindows. This was
	already done in some other functions a while back, but this patch
	got lost for some reason.

2003-07-09  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcontainer.c (btk_container_focus_sort_tab): Consider the text
	direction when sorting children.  (#116540, Soeren Sandmann)

Tue Jul  8 17:36:21 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkasync.[ch] bdk/bdkdnd-x11.c: 
	Change _bdk_x11_send_xevent_async() to 
	_bdk_x11_send_client_message_async() avoid using Xlib
	internals that are different on Solaris. 
	(#116917, Morten Welinder)

2003-07-08  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcontainer.c (btk_container_remove): Doc addition.
	(#116501, Doug Quale)

Tue Jul  8 21:35:22 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoggletoolbutton.h: remove strange #define
	* btk/btktoolbutton.h: fix cut'n'paste error
	* btk/btktoolbutton.c (btk_tool_button_init): use instance
	private data
	* btk/btktoolitem.c (btk_tool_item_class_init): use instance
	private data instead of g_new0()
	* btk/btktoggletoolbutton.c (btk_toggle_tool_button_init): use
	instance private data

Tue Jul  8 21:10:14 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkbutton.c (btk_button_realize): remove BDK_EXPOSURE_MASK
	for INPUT_ONLY window
	* btk/btkmenuitem.c (btk_menu_item_realize): same
	* btk/btknotebook.c (btk_notebook_realize): same
	* btk/btkexpander.c (btk_expander_realize): same
	* btk/btkrange.c (btk_range_realize): same

	Fix #116303

Tue Jul  8 19:57:14 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkstyle.c (btk_default_draw_arrow): remove correction on x
	when detail is "menuitem". With the new menu look is isn't needed
	anymore.

	* btk/btktoolitem.c (btk_tool_item_toolbar_reconfigured): queue a
	resize here, so that tool items will get a chance to relayout
	themselves based on the toolbar configuration.

	change DEFAULT_SPACE_SIZE to 4 instead of 5

	* btk/btktoolbar.c 
	Get rid of "!BTK_BIN (item)->child means separator". Separators
	are widgets in their own right

	change DEFAULT_SPACE_SIZE to 4 instead of 5
	
	(get_space_size): remove this function
	(toolbar_item_is_homogeneous): new function

	* btk/btkseparatortoolitem.c
	(btk_separator_tool_item_size_request): new function.

Tue Jul  8 14:10:35 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoggletoolbutton.h: use private data, add new
	internal function _btk_toggle_tool_button_get_button()

	* btk/btktoolbutton.h: move to private data

	* btk/btkradiotoolbutton.c, btk/btktoolbutton.c: updates for new
	private data.

Tue Jul  8 12:50:20 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbutton.c (btk_tool_button_get_icon_widget): fix a
	type check, (#116947, Krasimir Angelov)

	* btk/btktoolbar.c: Use new BtkToolItem accessors.
	
	* btk/btktoolitem.[ch]: Use a private struct to hold the instance
	data. Not instance private data yet, because of bug 116921.

	* btk/btktoolitem.h: new accessors:
		btk_tool_item_get_homogeneous ()
		btk_tool_item_get_expand ()
		btk_tool_item_get_pack_end ()
		btk_tool_item_get_use_drag_window ()

Mon Jul  7 16:50:32 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkcellrenderertext.c
	(btk_cell_renderer_text_class_init): remove accidentally committed
	debugging spew

	* btk/btktoolbar.c
	(btk_toolbar_paint_space_line): remove this function
	(btk_toolbar_expose): always propagate expose, even if the item is
	a separator item

	* btk/btkseparatortoolitem.c
	(btk_separator_tool_item_expose): moved here from btktoolbar.c
	(get_space_size): new function.
	(get_space_style): new function

Sun Jul  6 13:00:20 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkdnd.c (_btk_drag_source_handle_event)
	* btk/btkdnd.c (btk_drag_begin_internal):  Remove use
	of BDK_POINTER_MOTION_HINT_MASK.

	* btk/btkdnd.c (btk_drag_update_idle): Move updating
	of the drag into an idle as a superior form of 
	expose compression.

	* btk/btkdnd.c (btk_drag_begin_internal): Move default icon
	creation here, so that we have an icon at the start
	of the drag (e.g., when retrieving the window cache
	information.)

Sun Jul  6 17:21:23 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* docs/widget_geometry.txt: better drawing of BtkMenuItem
	* docs/widget_geometry.txt: add notes about BtkMenu
	* btk/btkstyle.c: remove leftover "#include "btkhandlebox.h""

Sat Jul  5 10:34:00 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c: add vertical_padding style property.
	
	* btk/btkmenuitem.c: add style properties toggle_spacing,
	arrow_spacing and horizontal_padding. Also center separators and
	make them a bit taller.

	* btk/*menuitem.c: use new style properties.
	
	* docs/widget_geometry.txt: Add note about BtkMenuItem

	* btk/btkstyle.c 
	(btk_default_draw_vline, btk_default_draw_hline):
	fix +/-1 errors. 

	(btk_default_draw_shadow): draw a black border around menus.

	* btk/btkvseparator, btk/btkhseparator.c, btk/btkmenuitem.c: fix
	calls to btk_paint_hline() and btk_paint_vline() (they take x1,
	x2 and y1, y2 respectively, not x, width and y, height).

Sat Jul  5 09:55:38 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdnd-x11.c (precache_target_list): Lookup
	all the atoms in the target list at once.

	* bdk/x11/bdkdnd-x11.c (bdk_drag_get_protocol_for_display):
	Local drag short-circuit.

	* bdk/x11/bdkdnd-x11.c (bdk_drag_motion): For the
	local case, poke the actions in directly instead of
	going through xdnd_set_actions.

	* bdk/x11/bdkdnd-x11.c (xdnd_read_actions): Short-circuit
	the local case.

	* bdk/x11/bdkdnd-x11.c (xdnd_manage_source_filter): Don't
	XSelectInput()/add a filter if the drag is local.

	* bdk/x11/bdkdnd-x11.c (bdk_drag_get_selection): 
	Simplify handling of "XdndSelection".

	* bdk/x11/bdkevents-x11.c
	(bdk_event_send_client_message_to_all_recurse): Somehow,  
	a WM_STATE => _NET_WM_STATE change hand been made here.

	* bdk/x11/bdkproperty-x11.c (_bdk_x11_precache_atoms): Free
	xatom_names, not atom_names.

	* tests/testdnd.c (target_drag_motion): Make the trashcan
	open again. (Got lost in deprecation cleanup.)

Sat Jul  5 00:49:32 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkdnd.c (btk_drag_begin): Move the grabs up
	earlier, so we don't get a big pile of uncompressed
	motion events before the grab takes effect.

	* btk/btkdnd.c (btk_drag_update_icon): Call 
	bdk_window_process_all_updates() so that the area
	we are dragging over gets a change to redraw.

	* btk/btkdnd.c (_btk_drag_dest_handle_event): Use 
	bdk_window_get_position(), not bdk_window_get_origin().

	* bdk/x11/bdkwindow-x11.[ch] (bdk_window_have_shape_ext)
	bdkdisplay-x11.h: use XShapeQueryExtension to 
	avoid duplicate XQueryExtension when we actually
	use it. Remove unnecessary caching in BdkDisplayX11.

Fri Jul  4 23:49:22 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkasync.[ch] (_bdk_x11_get_window_child_info): 
	Function to get a range of information about all the
	children of a window in a single pass.

	* bdk/x11/bdkdnd-x11.c (get_client_window_at_coords_recurse)
	bdk/x11/bdkdnd-x11.c (bdk_window_cache_new): Use
	_bdk_x11_get_window_child_info() to greatly reduce
	the number of roundtrips.

Fri Jul  4 22:57:18 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkasync.[ch] (_bdk_send_xevent_async): Add
	a function to XSendEvent() and call a calback on
	failure/success.

	* bdk/x11/bdkdnd-x11.c (xdnd_send_xevent): Short-circuit
	messages to the same process, use _bdk_send_xevent_async().

Fri Jul  4 22:26:27 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkwindow-x11.[ch] bdkevents-x11.c: Split
	toplevel-specific pieces of BdkWindowImplX11 into
	a separate BdkToplevelX11 structure.

Fri Jul  4 22:05:09 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkasync.c (struct _SetInputFocusState): Fix
	some leftover fields.

Fri Jul  4 15:57:52 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkevents-x11.c (bdk_wm_protocols_filter):
	Use asynchronously _bdk_x11_set_input_focus_safe
	to avoid having to trap errors and XSync().

	* bdk/x11/bdkwindow-x11.c (bdk_window_focus): Use
	_bdk_x11_set_input_focus_safe() here as well.

	* bdk/x11/bdkevents-x11.c (bdk_check_wm_state_changed):
	Rework handling of property notifies on _NET_WM_STATE
	so that we ignore _NET_WM_DESKTOP notifies unless we
	really care.

	* bdk/x11/bdkimage-x11.c (bdk_image_check_xshm): Use
	XShmQueryExtension() rather than XQueryExtension() to
	avoid extra rountrip.

	* bdk/x11/bdkwindow-x11.c (_bdk_windowing_window_init):
	Remove unused call to XGetWindowAttributes()
	
	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Remove
	unused call to XGetKeyboardControl().

	* bdk/x11/bdkdisplay-x11.c bdk/bdk.def (bdk_display_flush):
	Add (#99571)

	* bdk/win32/bdkevents-win32.c bdk/linux-fb/bdkevents-fb.c 
	No-op implementations of bdk_display_flush().

	* bdk/bdkwindow.c (bdk_window_process_all_updates): Use
	bdk_display_flush() rather than bdk_flush() to avoid
	XSync().
	
	* bdk/x11/bdkwindow-x11.c (update_wm_hints)
	bdk/x11/bdkwindow-x11.h: Centralize all handling of WM_HINTS here
	so that we don't have to get the property back from the server.

	* bdk/x11/bdkwindow-x11.c (show_window_internal): Store
	the serial of when we map a toplevel to allow optimizing
	out notifies on _NET_WM_STATE/_NET_WM_DESKTOP.

	* bdk/x11/bdkevents-x11.c (bdk_event_translate): Don't
	XTranslateCoordinates() for override-redirect windows.

Fri Jul  4 15:59:27 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_group): Remove comment
	about setting window group after the window is mapped from docs
	- nothing the ICCCM forbids that.

	* bdk/x11/bdkcursor-x11.c (bdk_display_get_maximal_cursor_size):
	Fix g_return_val_if_fail() in void return function.

	* configure.in: Fix misplaced comma that was resulting
	in XShm always being disabled.

Fri Jul  4 19:55:49 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* tests/stresstest-toolbar: remove this accidentally committed
	file.
	
	* tests/stresstest-toolbar.c: really add this new test

Fri Jul  4 19:06:31 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* tests/stresstest-toolbar.c: new test for removing items
	
	* tests/testtoolbar.c: add a popup menu

	* btk/btkcontainer.c (btk_container_remove): add hack to avoid
	  assert widget->parent == container when the container is a
	  toolbar.

	* btk/btktoolbar.c (btk_toolbar_remove_tool_item): Make much
	simpler. Also make correct.

	* btk/btktoolbar.c (btk_toolbar_button_press): make
	popup_context_menu a boolean handled signal.

2003-07-04  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdrawable-win32.c (bdk_win32_draw_polygon,
	bdk_win32_draw_segments, bdk_win32_draw_lines): We can calculate
	the width and height of the bounding rectangle only after the
	minumum x and y have been found, and need a separate loop for
	it. Thanks to Bruce Hochstetler for providing a sample program
	exhibiting the bug.

2003-07-03  Tor Lillqvist  <tml@iki.fi>

	* bdk/bdk.def: Add bdk_string_to_compound_text_for_display.
	(#116537, Peter Zelezny)

Thu Jul  3 03:13:20 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkpaned.c (btk_paned_set_child_property): Insert cast to
	fix warning. Assign something to old_value to quiet gcc

	* btk/btkcalendar.c 
	(start_spinning): btk_timeout_add->g_timeout_add

	* btk/btkicontheme.c 
	(theme_lookup_icon): Make it compile (remove double semicolon)

	* btk/btktoolbutton.c
	(btk_tool_button_class_init): Long comment about properties.
	(btk_tool_button_class_init): Improve text for "use_underline"
	property
	(btk_tool_button_create_menu_proxy): Fix up to use_mnemonic based
	on whether the passed-in label has use_mnemonic set
	(btk_tool_button_create_menu_proxy): Split image cloning out in
	new function. Make that function also handle image with pixbuf
	storage.
	(btk_tool_button_construct_contents): Use btk_widget_destroy()
	instead of btk_container_remove().
	(btk_tool_button_construct_contents): Fix eliding bug

	* btk/btktoolbar.c
	(btk_toolbar_finalize): New function. Unref tooltips, pointed out
	by Morten Welinder
	(btk_toolbar_button_press): Make popup_context_menu signal provide
	coordinates and button number

	* tests/testtoolbar.c (main): Add new pixbuf toolbutton

	* tests/apple-red.png: new file

Wed Jul  2 18:00:56 2003  Owen Taylor  <otaylor@redhat.com>
	 
        * btk/btkicontheme.[ch]: Implement a loader for
	named themed icon based on from bunny-desktop library
	by Alex Larsson.

	* btk/btkiconthemeparser.[ch]: .ini file parsing code
	from bunny-desktop.

	* btk/btkiconfactory.[ch]: Add
	btk_icon_source_set/get_icon_name() to allow stock icons
	to be based off of named theme icons.

	* btk/btkiconfactory.c: Rework sources so that the source
	is *either* a pixbuf, or a filename, or an icon name,
	instead of the pixbuf/filename mix it was before. Put a
	workaround for get_pixbuf() so that it can return the
	filename pixbuf, e.g, for render_icon().

	* btk/btkiconfactory.c: Make the default setup use
	themed icons, and add builtin icons to the default
	icon theme for all the standard pixbufs, so we
	don't rely on actually having an icon theme on disk.

	* btk/btkrc.c: Add support for @"icon-name" to specify
	a themed icon for a stock icon source.

	* tests/Makefile.am test/testicontheme.c: Add a test
	program from bunny-desktop.

	* bdk/x11/bdkevents-x11.c btk/btksettings.c: Add
	Net/IconThemeName / btk-icon-theme-name setting.

	* btk/btkiconfactory.c (ensure_cache_up_to_date): Actually
	update the icon cache serial so we don't continually
	think we are out-of-date.

	* btk/btkwidget.c: Fix a couple of references in doc comments 
	to ::direction_set that should have been to ::direction-changed

Wed Jul  2 14:45:41 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btktoolbar.c (btk_toolbar_realize): Attach the
	style to the widget.

Wed Jul  2 15:42:26 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btk.h: Add new toolbar headers

	* tests/testtoolbar.c: new file

	* tests/Makefile.am (noinst_PROGRAMS): Add testtoolbar.c

	* btk/btkexpander.c (btk_expander_class_init): Make it compile

Tue Jul  1 22:49:25 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c:
	(btk_toolbar_remove_tool_item): Fix bug where list is changed
	inside a for loop (pointed out by Morten Welinder).
	(btk_toolbar_focus_home_or_end): Minor formatting change

	Comments from Owen:

	* btk/btktoolbutton.c: remove copy of elide_underscores(). Use
	btk_toolbar_elide_underscores instead.

	* btk/btktoolbar.c: rename signal from focus_ends to
	focus_home_or_end.
	(_btk_toolbar_elide_underscores): export this as an internal
	function.
	(btk_toolbar_move_focus): add comment explaining difference to
	btk_toolbar_focus();
	(btk_toolbar_list_children_in_focus_order): Make TAB_FORWARD and
	TAB_BACKWARD focus the right widgets in RTL mode

	* btk/btktoolbutton.c (btk_tool_button_new): Change to take
	"label" and "icon" parameters

	* btk/btktoolbutton.[ch]: remove icon_set property.

2003-07-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkspinbutton.c (btk_spin_button_set_digits): Improve docs.
	(116364, Morten Welinder) 

	* tests/testbtk.c: Use BtkFontButton and BtkColorButton to bring up the
	corresponding dialogs.

	* btk/Makefile.am (btk_public_h_sources): Add btkfontbutton.h,
	btkcolorbutton.h.  
	(btk_c_sources): Add btkfontbutton.c, btkcolorbutton.c. 

	* btk/btkfontbutton.[hc]: New files containing a font picker widget. 

	* btk/btkcolorbutton.[hc]: New files containing a color picker widget. 

	* btk/btk.h: Include btkexpander.h, btkfontbutton.h, btkcolorbutton.h.

	* btk/btkexpander.c: Small additions to the docs. 

2003-07-01  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkwindow-win32.c (_bdk_windowing_window_get_pointer):
	WindowFromPoint() wants screen coordinates (#115422, Tim Evans).

2003-07-01  Matthias Clasen  <maclas@gmx.de>

	* configure.in: Check for Xcursor.
	
	* bdk/x11/bdkcursor-x11.c:
	* bdk/bdkdisplay.h: 
	* bdk/bdkcursor.h: RGBA cursor support based on Xcursor. New functions:
	bdk_cursor_new_from_pixbuf(), bdk_display_supports_cursor_alpha(), 
	bdk_display_supports_cursor_color(),
	bdk_display_get_default_cursor_size() and 
	bdk_display_get_maximal_cursor_size().  (#69436)

2003-06-30  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdnd-win32.c (find_window_enum_proc): New function,
	callback proc for EnumWindows().
	(bdk_drag_find_window_for_screen): Actually take the drag_window
	argument into account: Instead of using WindowFromPoint(), use
	EnumWindows(), to be able to skip the drag_window. (#116320, Tony
	M Brown, Herman Bloggs)

	* bdk/win32/*.c: Replace bdk_drawable_ref()/unref() and
	bdk_window_ref()/unref() calls with g_object_ref()/unref().
	Consistently use %p format in debugging output of pointers and
	HANDLEs.

2003-06-30  Mark McLoughlin  <mark@skynet.ie>

	* btk/btkexpander.h: kill some stray characters
	breaking the build.

2003-06-30  Mark McLoughlin  <mark@skynet.ie>

	Add BtkExpander. See discussion in bug #60553.

	* btk/btkexpander.[ch]: add.
	
	* btk/Makefile.am: build btk-expander.[ch].
	
	* docs/widget_geometry.txt: add info on the layout
	of BtkExpander.

Mon Jun 30 01:20:19 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btkradiotoolbutton.c:		new file
	* btkradiotoolbutton.h:		   "
	* btktoggletoolbutton.c:	   "
	* btktoggletoolbutton.h:	   "
	* btktoolbutton.c:		   "
	* btktoolbutton.h:		   "
	* btktoolitem.c:		   "
	* btktoolitem.h:		   "
	* btktoolbar.c: many changes
	* btktoolbar.h: many changes
	* btkseparatortoolitem.c:	new file
	* btkseparatortoolitem.h	   "

	New toolbar.
	
	- Items on a toolbar are now separate widgets, instances of a
	  subclass of BtkToolItem.

	- Items there aren't room for on the toolbar are unmapped, and an
	  overflow menu with a proxy menu item is added instead.

	- The toolbar is keyboard navigatable. Press TAB to focus the
	  first item, then use arrow keys and Ctrl TAB to move around the
	  toolbar. TAB moves focus out of the toolbar.

	- Bascially all of the old toolbar API is deprecated in favor of
	  new API in btktoolbar.h, btktoolitem.h, btktoolbutton.h

	- The toolbar is backwards compatible with the old toolbar.

2003-06-29  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c (btk_widget_class_init): Remove a duplicate parameter
	from docs, some more formatting fixes. 

2003-06-28  Tor Lillqvist  <tml@iki.fi>

	Fix for #111028, thanks to J. Ali Harlow, who writes:
	I found that the BdkPixmap->BdkImage reference really isn't
	important. It's only really there to have somewhere convenient to
	store the location of the pixel data in the pixmap and as an easy
	way of accessing the dimensions of that data. I have therefore put
	together a fix which removes this reference entirely which seems
	to solve the problem.

	* bdk/win32/bdkpixmap-win32.h (struct _BdkPixmapImplWin32):
	Instead of a pointer to a BdkImage, keep a pointer to the pixels
	directly.

	* bdk/win32/bdkimage-win32.c (_bdk_win32_setup_pixmap_image): Remove.
	(_bdk_win32_new_image): New function, replacing the above. Creates
	a BdkImage without any associated BdkPixmap.
	(bdk_image_new_bitmap, _bdk_image_new_for_depth): Use it instead.

	* bdk/win32/bdkprivate-win32.h: Remove from here, too.

	* bdk/win32/bdkcursor-win32.c (bdk_cursor_new_from_pixmap)
	* bdk/win32/bdkdrawable-win32.c (blit_from_pixmap)
	* bdk/win32/bdkgc-win32.c (_bdk_win32_bitmap_to_hrgn)
	* bdk/win32/bdkmain-win32.c (_bdk_win32_drawable_description):
	* bdk/win32/bdkpixmap-win32.c (bdk_pixmap_impl_win32_finalize,
	bdk_pixmap_new, bdk_bitmap_create_from_data, bdk_pixmap_foreign_new)
	Corresponding changes.

Thu Jun 26 21:41:16 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktreeviewcolumn.c
	(btk_tree_view_column_cell_set_cell_data): only set "is_expander"
	and "is_expanded" if the new value is different fromt he old one.

Wed Jun 25 18:59:15 BST 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Fix typos. Update
	thread example I missed yesterday.

2003-06-24  Matthias Clasen  <maclas@gmx.de>

	* btk/btkspinbutton.c (btk_spin_button_class_init): Add a blurb for
	shadow_type. 

	* btk/btkwidget.c (btk_widget_class_install_style_property_parser): 
	(btk_widget_class_list_style_properties): Use same parameter names as in  
	header (to silence btk-doc).

	* btk/btkalignment.c (btk_alignment_[gs]et_padding): Fix doc comments.

Tue Jun 24 20:00:45 BST 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Thread support updates
	from Owen. Various suggestions from Steve Chaplin.

2003-03-24  Mohammad DAMT  <mdamt@bisnisweb.com>

	* po/id.po: Updated Indonesian translation

2003-06-21  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): When
	emulating X11's automatic grab on button down, pass owner_events
	as FALSE. According to the XLib spec, automatic grabs use True for
	owner_events when OwnerGrabButtonMask is selected, and I don't see
	the X11 backend doing that. (#82497, #91619, #92835, #107322, #110271)
	(find_window_for_pointer_event): Improve debugging output.

2003-06-17  Tor Lillqvist  <tml@iki.fi>

	* btk-zip.sh.in (DLLDIR): Look for DLLs also in the bin
	subdirectory, where libtool 1.5 installs them.

	* README.win32: Point to FSF's binary Win32 distribution of
	gettext-runtime.

2003-06-17  Matthias Clasen  <maclas@gmx.de>

	* acinclude.m4 (JH_PATH_XML_CATALOG, JH_CHECK_XML_CATALOG): New
	macros to check for XML catalog contents and path, borrowed from
	btk-doc. 
	* configure.in: New option --enable-man to enable regeneration of
	man pages from Docbook, if the necessary tools are found.

2003-06-15  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c (btk_calendar_class_init): 
	* btk/btknotebook.c (btk_notebook_class_init): 
	* btk/btkalignment.c (btk_alignment_class_init): 
	* btk/btkpaned.c (btk_paned_class_init): Document new properties
	as 2.4 additions.

	* btk/btkwidget.c (btk_widget_class_init): Move inline signal docs 
	to the proper place, immediately before the g_signal_new() call.

	* btk/btktextiter.h: Make the flags-nature of BtkTextSearchFlags 
	more obvious.  (#115122, Jeff Franks)

2003-06-12  Anders Carlsson  <andersca@codefactory.se>

	* btk/btkwidget.c: (event_window_is_still_viewable):
	Special case pixmaps. (#114880)
	
2003-06-12  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c: Document child-notify and drag-data-received
	signals. Owen, we need to figure out where the best place for
	these comments in the source is. I currently put them in front of
	the signals enum.

2003-06-11  Matthias Clasen  <maclas@gmx.de>

	* btk/btkdnd.c (btk_drag_check_threshold): s/threshhold/threshold/.

Thu Jan 12 01:01:19 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action):
	silly typo fix. s/seperator/separator/. This gets rid of the
	assert spam when using TreeView.

Tue Jun 10 11:23:48 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* modules/input/btkimcontextxim.c (xim_instantiate_callback): New
	function for XIM instantiate callback.
	* modules/input/btkimcontextxim.c (xim_info_try_im): New function
	where call to XOpenIM() or XRegisterIMInstantiateCallback() is
	actually made.
	* modules/input/btkimcontextxim.c (xim_destroy_callback): New function
	for XIM's destroy callback.
	* modules/input/btkimcontextxim.c (get_im): add a check if info->im 
	is set or not - if it's not set, call xim_info_try_im() to try to
	initiaize it.
	* modules/input/btkimcontextxim.c (reinitialize_ic): reset
	filter_key_release flag of the context.
	* modules/input/btkimcontextxim.c (get_ic_real): removed
	* modules/input/btkimcontextxim.c (btk_im_context_xim_get_ic): move
	code from the removed get_ic_real().

	For XIM instantiation, destruction and re-instantiation. With
	this, Btk+ apps will be able to connect or reconnect to the XIM,
	when it starts after the apps, or when the XIM gets lost and recover.
	(#113099, #107782).

Mon Jun 10 01:12:31 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_get_size):
	check if width is !null, not *width. Doh.

Tue Jun 10 01:09:33 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action):
	Remove the weird dx logic, get all cell_area and background_area
	calculations right. Not sure what was up with it before. (Fixes
	#110989, testcase from Vasco Alexandre da Silva Costa).

Tue Jun 10 00:58:23 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* tests/testbtk.c: Make it compile with C89 compilers

2003-06-10  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_class_init): Install boolean
	property "overwrite".
	(btk_text_view_[gs]et_property): Handle "overwrite".
	* btk/btktextview.[hc] (btk_text_view_[gs]et_overwrite): Getter
	and setter for "overwrite" property.  (#110241, Jeroen Zwartepoorte)

2003-06-09  Matthias Clasen  <maclas@gmx.de>

	* btk/btkpaned.c (btk_paned_class_init): Install boolean child
	properties "resize" and "shrink".
	(btk_paned_[gs]et_child_property): Implementations of 
	BtkContainer::[gs]et_child_property.  
	* tests/testbtk.c (toggle_resize, toggle_shrink): Use the new
	paned child properties instead of remove/add hacks.  (#114667, 
	Soeren Sandmann) 

Mon Jun  9 16:18:11 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btknotebook.c (btk_notebook_button_press): Back
	out event->window test - it wasn't needed because
	of the call to get_widget_coordinates().

	* btk/btknotebook.c (btk_notebook_button_press): Remove
	call to btk_widget_grab_focus() when not clicking on
	any tabs. (Real fix for #114534)

Sun Jun  8 22:03:09 2003  Owen Taylor  <otaylor@redhat.com>

	* tests/testdnd.c: Use application/x-rootwindow-drop for
	root window drops. (#108670, Alex Larsson)

	* bdk/x11/bdkdnd-x11.c (bdk_drag_motion) btk/btkdnd.c (btk_drag_drop): 
	Accept either application/x-rootwin-drop (what BTK+ has always used)
	or application/x-rootwindow-drop (what the XDND standard specifies).

Fri Jun  6 11:07:33 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwidget.c (event_window_still_viewable): 
	Before delivering an event to a widget, check that
	(if relevant), the event's window is still viewable.
	(#105642, Dennis Björklund)

	* bdk/bdkwindow.c (_bdk_window_destroy_hierarchy): 
	NULL out private->parent, since after destruction
	it might not be valid any more.

	* bdk/bdkwindow.c (bdk_window_is_viewable): Fix some
	accesses before g_return_val_if_fail(). Treat 
	DESTROYED windows as unmapped.

Thu Jun  5 09:28:03 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkentry.c: Recompute unconditionally in
	btk_entry_style_set, and in a new btk_label_screen_changed().
	Protect the guts of recompute_idle_func() with
	btk_widget_has_screen(). (#114040, Morten Welinder) 
	Fix FALSE/0 confusion.
	
Sun Jun  8 18:27:14 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/bdkpixbuf-drawable.c (G8fromRGB565): swap G and B.
	Fixes (#114669)

Sun Jun  8 11:27:29 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkviewport.c (viewport_set_adjustment): Fix bug with 
	set_adjustment (viewport, NULL);

2003-06-07  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconfactory.c (get_default_icons): 
	* btk/stock-icons/stock_{undo,redo,undelete,revert}_rtl_{16,24}.png:
	* btk/stock-icons/Makefile.am: Add rtl variants of undo, redo,
	undelete and revert.  (#96633)
	
Fri Jun  6 16:25:44 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkviewport.c: Many fixes, along with extensive cleanups and 
	refactoring of code to reduce duplication; fixes include:

	- btk_viewport_realize(): Position the window correct from adjustment 
	values. (#110737, Michael Natterer)

	- Remove some division-by-zero checks in places where there is no 
	longer division. (#110737)

	- btk_viewport_class_init: Make the hadjustment/vadjustment properties 
	G_PARAM_CONSTRUCT, so that there will always be adjustments, even 
	if btk_viewport_new isn't used (#101135, Thomas Leonard).

	- Switch over to encapsulated lazy-creation for hadjustment/
	vadjustment; even with the CONSTRUCT property, we need this after
	destroy.

	- When updating the adjustment, immediate set their values to
	match the the current range of the viewport, and update the 
	viewport position to match the value of the new adjustments. 
	(Part of #1165)

2003-06-06  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkprivate-win32.h: Fix typo.

	* bdk/win32/bdkgc-win32.c (_bdk_win32_gc_new): Set
	graphics_exposures and subwindow_mode, too, even if they aren't
	currently used.

Fri Jun  6 23:38:23 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (do_expand_collapse),
	(expand_collapse_timeout), (cancel_arrow_animation): made
	expand_collapse_timeout a wrapper with locks around	
	do_expand_collapse, made cancel_arrow_animation use
	do_expand_collapse. Fixes threadlock. (Fixes #111286, patch from
	Peter Bloomfield).

Fri Jun  6 11:05:45 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* modules/input/btkimcontextxim.h (struct _BtkIMContextXIM):
	* modules/input/btkimcontextxim.c (preedit_start_callback,
	preedit_draw_callback, preedit_done_callback): Add a 'finalizing' flag 
	to keep preedit-[start,changed,end] signals from being called during
	finalization (#111861).

2003-06-05  Noah Levitt  <nlevitt@columbia.edu>

	* btk/btknotebook.c (btk_notebook_button_press): Ignore button
	presses that are not on the tab (#114534).

Thu Jun  5 20:35:40 2003  Owen Taylor  <otaylor@redhat.com>

	* demos/Makefile.am: Conditionalize dependencies for
	bdk-pixbuf-csource on cross-compilation (#112391, J. Ali Harlow). 
	Buildtest-inline-pixbufs.h in srcdir. Don't try to build 
	test-inline-pixbufs.h if we don't have libpng.

	* btk/stock-icons/Makefile.am (btkstockpixbufs.h): 
	Add a dependency on bdk-pixbuf.loaders when not 
	cross-compiling, remove the dependency on bdk-pixbuf-csource
	when not cross compiling.

Thu Jun  5 20:12:51 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.c (btk_window_get_default_size): Handle
	btk_window_get_geometry_info() returning NULL.
	(#107311, John Finlay)

Thu Jun  5 19:24:33 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btktoolbar.c (btk_toolbar_expose): Subtract off
	twice the border width from the width/height, not
	1x the border width. (#106336, Rodney Dawes)

Thu Jun  5 15:33:38 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* btk/btktextlayout.c (btk_text_layout_move_iter_to_next_line):
 	If at the end of the buffer, move to the end iter -
 	parallels behavior of move_iter_to_previous_line.
 	(#81960, Padraig O'Briain)
 
Thu Jun  5 16:12:54 2003  Owen Taylor  <otaylor@redhat.com>

        #80023, Yao Zhang, TOKUNAGA Hiroyuki

	* btk/btktextlayout.c (btk_text_layout_get_cursor_locations):
	Account for the preedit cursor offset if the iter passed
	in is at the same place as the insertion cursor.

	* btk/btktextview.c (btk_text_view_get_cursor_location):
	Encapsulate getting the insertion cursor location.

	* btk/btktextview.c (btk_text_view_update_im_spot_location):
	Pass the real y/height to the IM context. Take 
	text_view->x/yoffset into account.

Thu Jun  5 16:52:54 2003  Owen Taylor  <otaylor@redhat.com>

        * btk/btktextview.[ch]: Never scroll on focus in
	(#81893, Patch from Paolo Maggi)

	* btk/btktextview.c (btk_text_view_scroll_[h]pages): 
	Scroll to the current cursor location before handling
	the action, in case the user just tabbed in
	and the cursor is offscreen.

Thu Jun  5 17:20:40 2003  Owen Taylor  <otaylor@redhat.com>
	 
	 #107883, Gustavo Giráldez

	* btk/btktextlayout.c (btk_text_layout_emit_changed):
	Split out the case where we know we changed, and 
	already dealt with our cached line being invalidated
	from external calls to btk_text_layout_changed.

	* btk/btktextlayout.c (btk_text_layout_changed):
	Check if the invalidate yrange intersects our
	cached line, and clear it if necessary.

2003-06-05  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): Handle global
	filters.

2003-06-05  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c: Fix for #84668, reported by Torbjrn Andersson:
	(btk_text_view_grab_notify): 
	(btk_text_view_state_changed): Implement these
	to unobscure cursor when grab shadowed or insensitised.
	(btk_text_view_unobscure_mouse_cursor): New function to undo the
	effect of btk_text_view_obscure_mouse_cursor(). Code lifted from
	btk_text_view_motion_event().
	(btk_text_view_motion_event): Use btk_text_view_obscure_mouse_cursor().

	* btk/btktextview.c (select_all): New keybinding signal for
	(un)selecting the whole buffer. Bound to C-a/C-\.  (see #107889)

	* btk/btkcalendar.c (calendar_timer): 
	(stop_spinning): Replace deprecated btk_timeout_* functions by
	their GLib counterparts.  (#114429)

	* btk/btktreestore.c (btk_tree_store_new): 
	* btk/btkliststore.c (btk_list_store_new): Document restriction on 
	types.

Wed Jun  4 19:42:17 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkbango.c (bdk_draw_layout_line_with_colors):
	When drawing underlines, join up adjacent runs
	where possible, so we don't get changes in 
	shaper/font/etc. breaking underlines. (#103662,
	Kang Jeong-Hee)

Wed Jun  4 19:22:58 2003  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreemodelsort.c (btk_tree_model_sort_level_find_insert):
	Slightly modified patch from Owen Taylor <otaylor@redhat.com> to
	improve the speed of inserting rows into an already sorted list,
	#109292

Wed Jun  4 19:24:28 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkgc-x11.c bdk/x11/bdkprivate-x11.h: Keep
	track of when we have a clip mask set for the GC,
	and when we unset it, or switch to a clip rebunnyion,
	immediately call XSetClipMask (..., None) to avoid
	Xlib caching stale data. (#111806)

	* btk/btktextdisplay.c: Don't set a clip mask
	when drawing alpha pixmaps; it isn't necessary any more.
	(#111806)

Wed Jun  4 18:27:44 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkcheckbutton.c (btk_real_check_button_draw_indicator): 
	btk/btkradiobutton.c (btk_radio_button_draw_indicator): 
	Use BTK_WIDGET_IS_SENSITIVE(), not BTK_WIDGET_SENSITIVE
	(#92548, Tim Evans)

	* btk/btkcheckmenuitem.c (btk_real_check_menu_item_draw_indicator)
	btk/btkradiomenuitem.c (btk_radio_menu_item_draw_indicator): If
	Use state_type = STATE_INSENSITIVE for insensitive menu items.

Wed Jun  4 21:25:35 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_drag_begin): use a silent
	assert for get_info. (reported by Michael Natterer),
	(btk_tree_view_expand_all_emission_helper),
	(btk_tree_view_expand_all_helper): emit row_expanded for all
	expanded rows during an _expand_all operation. (Fixes #111280,
	reported by Benjamin Bayart).

Tue Jun  3 18:32:30 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkevents-x11.c (bdk_wm_protocols_filter): Don't
	respond to pings on a root window; prevents infinite
	loops if we are selecting for SubstructureNotify on the
	root window. (#111945, Sergey V. Udaltsov)

Tue Jun  3 17:39:16 2003  Owen Taylor  <otaylor@redhat.com>

	#71597, reported by Morten Welinder

	* bdk/bdkpixbuf-drawable.c (rgb888amsb): Fix and simplify
	(Patch from Christian Petig)

	* bdk/bdkpixbuf-drawable.c (rgb{555,565}{a,}{msb,lsb}):
	Major rewrite of 555 and 565 conversion routines:

	- Move all the bit shifting into a small block of macros,
	  eliminating much duplication of complicated arithmetic.
	- Get rid of 2-pixels at a time code, which was buggy,
	  hard to maintain, caused unaligned accesses, and
	  probably didn't actually perform any better.
	- Simplify cases where different data types were
	  used for the little and big endian cases, use
	  GUINT16_SWAP_LE_BE() where appropriate.
		
Tue Jun  3 15:05:47 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdrawable-x11.c (convert_to_format): Remove
	bad optimization for src_rowstride == dest_stride.
	(Didn't consider the case where we were copying only
	partial widths of a wider source buffer)
	(#113034, reported by Hans Petter Jansson)

2003-06-03  Michael Natterer  <mitch@gimp.org>

	* bdk/x11/bdkinput-x11.c (_bdk_input_common_find_events):
	reenabled button_release events for xinput devices. (#113948)

2003-06-03  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "li" to ALL_LINGUAS.

Mon Jun  2 18:58:54 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btknotebook.c (btk_notebook_size_allocate): Don't
	map the event window if the notebook isn't mapped. (#113980,
	Richard Reich)

2003-06-02  Sven Neumann  <sven@gimp.org>

	* btk/btkprogress.c (btk_progress_changed): added a missing cast.

	* bdk/bdkrgb.c (bdk_rgb_try_colormap): removed an unused variable.

2003-06-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkalignment.c (btk_alignment_[gs]et_padding): Add 
	Since: 2.4 to the docs.

	* btk/btkwindow.c (btk_window_parse_geometry): Add some hints and
	an example to the docs.  (#98427)

2003-05-30  Murray Cumming  <murrayc@usa.net>

	* btk/btkalignment.[h|c]: Added 4-sided padding as properties with
  	btk_alignment_get_padding() and btk_aligment_set_padding(). This
  	uses the new private data system - see g_type_class_add_private() in
  	btk_alignment_class_init() and the use of BTK_ALIGNMENT_GET_PRIVATE().

2003-05-30  Matthias Clasen  <maclas@gmx.de>
	
	* btk/btknotebook.c: Changed guint to BtkNotebookArrow in the
	signature of btk_notebook_draw_arrow() for Solaris builds to go
	through.  (#114043, Anand Subramanian)

Thu May 29 18:30:35 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* modules/input/imipa.c: 
	use GETTEXT_PACKAGE to get a translation for "ipa"(#113850).

Thu May 29 18:08:01 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* btk/btkimmodule.c (_btk_im_module_list):
	use GETTEXT_PACKAGE to get a translation for "Default"(#113850).

Thu May 29 09:34:05 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* btk/btkimmodule.c (_btk_im_module_list): make "Default"
	label of default input method localizable.
	* btk/btkimmulticontext.c (btk_im_multicontext_append_menuitems): 
	use translations of input method context names
	* modules/input/imam-et.c, modules/input/imcyrillic-translit.c,
	  modules/input/iminuktitut.c, modules/input/imthai-broken.c,
	  modules/input/imti-er.c, modules/input/imti-et.c
	  modules/input/imviqr.c, modules/input/imxim.c
	use GETTEXT_PACKAGE instead of "btk+" for domain name.
	(#113850).

Thu May 29 18:23:01 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_button_press): put the focus
	grab separate, the user might clear the tree in the focus-in
	callback. (Fixes #113086, testcase from Felipe Heidrich).

Thu May 29 18:06:26 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_model_set_model): reset a bunch
	of row reference when we unset the model. Also reset
	dy and top_row_dy. (Fixes #109289, patch from Owen Taylor).

Thu May 29 17:12:19 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_set_cursor_on_cell): cancel
	the current editing, if it exists. (Fixes #108956, reported by
	Michael Natterer).

Thu May 29 17:06:09 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (check_selection_helper): new function,
	(btk_tree_view_row_deleted): traverse the tree from the
	deleted node to see whether the selection changed, instead of
	just checking this node. (Fixes #107400, reported by 'Duncan').

Thu May 29 16:31:34 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_maybe_begin_dragging_row),
	(btk_tree_view_drag_begin): set the DnD icon in _drag_begin
	instead of _maybe_begin_dragging_row, so the icon can be
	overridden by apps. (Fixes #104374, patch from Daniel Elstner).

Thu May 29 16:14:04 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_start_editing): correct
	cell_area x/width for the expander if needed. (Fixes #101748,
	reported by Dave Cook and Mariano Suarez-Alvarez).

Thu May 29 16:01:38 2003  Kristian Rietveld  <kris@btk.org>

	Merged from stable.

	* btk/btktreeview.c (btk_tree_view_real_set_cursor): check
	if tree/node are still the same after _internal_select_node.
	(Fixes #92256, reported by edscott).

Thu May 29 15:38:30 2003  Kristian Rietveld  <kris@btk.org>

	Fixes #75745, reported by Richard Hult. Merged from stable.

	* btk/btktreeview.c (btk_tree_view_bin_expose): set/unset
	BTK_CELL_RENDERER_FOCUSED flag whether the current node is the
	cursor or not.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action):
	if we are rendering a cursor row, and the cell the be
	processed has focus, then set the BTK_CELL_RENDERER_FOCUSED
	flag (else we unset it).

2003-05-27  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow-decorate.c: 
	* btk/btktreeprivate.h: 
	* btk/btkdnd.c: 
	* bdk/win32/bdkwindow-win32.h: 
	* bdk/linux-fb/bdkprivate-fb.h: 
	* bdk/linux-fb/bdkkeyboard-fb.c: Remove dubious bitfields of
	unspecified signedness.  (#112919, Morten Welinder)

	* btk/queryimmodules.c (escape_string): 
	* btk/btktextbtree.c (_btk_text_btree_get_text): 
	* btk/btksettings.c (_btk_settings_parse_convert): 
	* btk/btkrc.c (btk_rc_parse_assignment): 
	* btk/btkinputdialog.c (btk_input_dialog_set_key): 
	* bdk/x11/bdkdisplay-x11.c (escape_for_xmessage): Replace all 
	occurances of g_string_new ("") by g_string_new (NULL). (#106975,
	Morten Welinder) 

2003-05-27  Tor Lillqvist  <tml@iki.fi>

	* btk-zip.sh.in: Only include the Default and Emacs themes' btkrc
	files. Include share/btk-doc/{bdk-pixbuf,bdk,btk}.

	* bdk/Makefile.am: libbdk-win32-2.0.la depends on
	win32/libbdk-win32.la.

	* btk/btk.def: Add btk_tree_view_column_cell_get_position.

Sat May 24 22:19:13 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkscrollbar.c (btk_scrollbar_class_init): Make the minimum
	scrollbar slider length 21 instead of 7.

2003-05-23  Matthias Clasen  <maclas@gmx.de>

	* btk/btknotebook.c: Add support for up to four scroll
	arrows. Control their display by new style properties
	"has_forward_stepper", "has_backward_stepper",
	"has_secondary_forward_stepper" and
	has_secondary_backward_stepper". (#110540)

	* btk/btknotebook.h (struct _BtkNotebook): Make in_child and
	click_child three bits wide, add
	has_{before,after}_{previous,next} fields.

	* btk/btkcolorsel.c (btk_color_selection_init): Update color on
	focus out of hex_entry.  (#112665)
	(hex_focus_out): New signal handler for focus out of hex entry.

Wed May 21 19:01:06 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwidget.c (btk_widget_realize): 
	g_return_if_fail() if
	BTK_WIDGET_ANCHORED (widget) || BTK_IS_INVISIBLE (widget).
	(#107872, Christian Reis)

2003-05-22  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilesel.c (btk_file_selection_create_dir): 
	(btk_file_selection_rename_file): Some keynav improvements for the
	"Rename File" and "Create Directory" subdialogs: Enter in entry
	activates default, default is "Create"/"Rename", Escape cancels
	dialog.  (#113110)
	(btk_file_selection_set_filename): Add a hint about opening 
	directories.  (#113175)

2003-05-22  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkdrawable-x11.c (bdk_x11_drawable_update_xft_clip):
	Use XftDrawSetClipRectangles(), since we're inside HAVE_XFT2
	anyway.  (#113476)

Wed May 21 15:53:14 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkprogress.c (btk_progress_set_format_string,
	btk_progress_set_show_text): Always queue a resize ... 
	we rely on the size-allocate to do the update, plus a 
	different format can actually change our size requisition.
	(#111052, Vasco Alexandre da Silva Costa)

	* btk/btkprogress.c (btk_progress_changed): Track
	::changed as well as ::value_changed, and queue a
	resize on ::changed when necessary.

	* btk/btkprogress.c (btk_progress_set_adjustment): 
	Call btk_progress_changed() here to update or 
	queue a resize as necessary.

Wed May 21 14:06:13 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* btk/btkimcontextsimple.c: added composing rules of
	Greek accented letters, patch by Vasilis Vasaitis (#107507)

Wed May 21 13:19:05 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* btk/btkenums.h (enum BtkIMPreeditStyle, BtkIMStatusStyle): 
	* modules/input/btkimcontextxim.c (preedit_style_change, status_style_change):
	btk settings for XIMPreeditNone and XIMStatusNone. (#105909)

Wed May 21 12:10:25 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* btk/btkimcontextsimple.c: 
	code that can check the compose table for ascending order,
	by Vasilis Vasaitis (#104862).

Wed May 21 12:52:01 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkkeyhash.[ch] (_btk_key_hash_looku): We need 
	to pass the unmasked state to bdk_keymap_translate_keyboard_state() 
	to handle the case where a modifier not in the mask
	(like Num_Lock) changes the key value, so replace
	the masked state with a state/mask pair. (#106913,
	Olivier Ripoll)

	* btk/btkwindow.c btk/btkbinding.c: Update to pass
	in state/mask pair to _btk_key_hash_lookup()

Tue May 20 21:58:00 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* modules/input/btkimcontextxim.c (xim_info_display_closed):
	fix a memory leak, free input context list (#113259).

2003-05-21  Matthias Clasen  <maclas@gmx.de>

	* configure.in (all_loaders): Add pcx.

	* btk/btkcalendar.c: Make calendar controls spin.  (#112540)

Tue May 20 17:27:24 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkimmodule.c (btk_im_module_init): Silently
	accept a missing btk.immodules file, some people
	want to run without one. (#112406, patch from
	Arnaud Charlet)

Tue May 20 17:05:31 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwindow.c (btk_window_compute_hints): Fix 
	height/width confusion (#113370, Xan Lopez)

Tue May 20 15:48:45 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdnd-x11.c bdk/x11/bdkwindow-x11.c: Comprehensively
	zero all unused parts of client messages (Mainly Motif DND
	and EWMH). Also, fix a couple places where we were putting
	contents into Motif DND messages that didn't belong.
	(#113361, EWMH problem reported by Lubos Lunak)

	* btk/btkselection.c (_btk_selection_request): Handle the
	case where the property type for the multiple atoms is
	ATOM_PAIR by doing the conversions ourselve. This is
	needed for Xt inter-operation.

2003-05-19 Arafat Medini <lumina@silverpen.de>

	* configure.in: Added ar to ALL_LINGUAS

2003-05-19  Matthias Clasen  <maclas@gmx.de>

	* btk/btksettings.c (btk_rc_property_parse_border,
	btk_rc_property_parse_color, btk_rc_property_parse_enum,
	btk_rc_property_parse_flags, btk_rc_property_parse_requisition):
	Add docs.

	* btk/btkwidget.c (btk_widget_class_install_style_property, 
	btk_widget_class_install_style_property_parser): Add docs. 

2003-05-17  Matthias Clasen  <maclas@gmx.de>

	* tests/prop-editor.c: Add navigation for object properties, so
	that you can easily edit the properties of the parent of a widget.
	(#113152)

Wed May 14 17:45:32 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkkeysyms.h bdk/bdkkeynames.c bdk/bdkkeyuni.c:
	Patch from Vasilis Vasaitis to fix Greek_IOTAdi[a]eresis 
	inconsistency and leave the old name as an aliass (#104873)

Wed May 14 16:40:09 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkframe.c (btk_frame_set_label_widget): Patch
	from Charles Schmidt to add missing notify (#108305)

Wed May 14 16:00:51 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* bdk/x11/bdkgc-x11.c: Remove unecessary g_return_if_fail().
 	(#105500, Morten Welinder.)
 
Wed May 14 09:05:11 2003   Hidetoshi Tajima <hidetoshi.tajima@sun.com>

	* modules/input/btkimcontextxim.c (get_ic_real): use type of guint32
	instead of gumake for XNFilterEvents event mask(#110493).

2003-05-11  Anders Carlsson  <andersca@codefactory.se>

	* btk/btkdnd.c (btk_drag_source_unset_icon): Don't cast a gchar to
	a GObject. (#112762)

2003-05-08  Sven Neumann  <sven@gimp.org>

	* configure.in: set the HAVE_X11R6 automake conditional to false
	if not compiling for X11.

2003-05-08  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.[ch] (btk_calendar_set_display_options): 
	(btk_calendar_get_display_options): New functions.
	(btk_calendar_display_options): Depreate.  (#64567)
	(btk_calendar_class_init): Add boolean properties for the display
	options.  (#50949)

Tue May  6 16:50:52 2003  Owen Taylor  <otaylor@redhat.com>

	Patch from James Henstridge to update to automake-1.7
	(#109542)
 
 	* autogen.sh: update to call newer tools.
 
 	* configure.in: various updates, to use M4 macros to put
 	variables that change each release at the top.
 	Use AC_HELP_STRING to format help strings.
 	Use AC_CONFIG_COMMANDS to generate bdkconfig.h.
 
 	* Makefile.am: require Automake 1.7.  Remove bdk-2.0.pc and
 	btk+-2.0.pc on uninstall.  Pass --enable-btk-doc to configure
 	during distcheck.
 
 	* docs/reference/*/Makefile.am: simplify to use the btk-doc.make
 	makefile fragment.
 
 	* */Makefile.am: don't use STRIP_BEGIN/STRIP_END.
 	Use BUILT_SOURCES where appropriate.
 	Build generated files in builddir rather than srcdir.
 	Fix uninstall and distclean targets to satisfy distcheck.

	===

	* bdk/*/Makefile.am: Remove the hacks to get bdkenumtypes.h
	built first, since we are now using BUILT_SOURCES.

	* bdk/Makefile.am: Remove an outdated comment about bdk_headers.

	* demos/btk-demo/Makefile.am: Fix srcdir != buildd problem
	with geninclude.pl.

	* configure.in: Update versions to 2.3.0.
 
2003-05-06  Tor Lillqvist  <tml@iki.fi>

	Fix for #110165 (thanks to Arnaud Charlet):
	
	* bdk/win32/bdkevents-win32.c (build_keypress_event,
	build_keyrelease_event): For unshifted control char, use
	lowercase ASCII keyval.
	(bdk_event_translate): Similarily, when handling WM_SYSKEYDOWN and
	UP (i.e. Alt-something), if it's an unshifted ASCII letter, use
	lowercase keyval. Use build_key_event_state() here, too, instead
	of minor code duplication.

2003-05-06  Matthias Clasen  <maclas@gmx.de>

	* tests/testmultidisplay.c: Don't include strings.h, it's not
	needed anymore.  (#112388)

	* examples/menu/itemfactory.c: 
	* docs/tutorial/btk-tut.sgml: Remove an unneeded include from the
	itemfactory example.

2003-05-05  Matthias Clasen  <maclas@gmx.de>

	* btk/btkdnd.c (btk_drag_source_set_icon_stock):  Actually set the
	icon type to the stock icon type.  (#111735, Dave Bordoley)

2003-05-05  Christian Rose  <menthos@menthos.com>

	* configure.in: Added sr and sr@Latn to ALL_LINGUAS.
	Removed sp, it's replaced by sr@Latn.

Wed Apr 30 22:09:11 BST 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: BTK+ 2.x updates, mainly from
	Gonzalo Odiard

Mon Apr 28 17:54:39 2003  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeview.c (btk_tree_view_destroy): destroy the search
	data iff the destroy func isn't NULL.

Thu Apr 24 19:12:05 2003  Owen Taylor  <otaylor@redhat.com>

	* autogen.sh (have_libtool): Accept libtool-1.5. (#111480)

2003-04-23  Abel Cheung  <maddog@linux.org.hk>

	* configure.in: Added "am" "mk" "ta" to ALL_LINGUAS.

Tue Apr 22 15:33:51 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkfilesel.c (open_new_dir): Fix capitalization
	of UTF-8. (#106419, Roozbeh Pournader)

Tue Apr 22 15:17:25 2003  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Only check for XFT2 if we found bango-xft
	(#105692, Jon Nall)

Tue Apr 22 15:12:19 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkwidget.c (btk_widget_class_init): Fix PROP_HAS_FOCUS/
	PROP_IS_FOCUS confusion. (#111333, Jody Goldberg)

Tue Apr 22 19:43:01 BST 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: add note about version converage.

Mon Apr 21 19:02:16 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btksocket.c (activate_key): Fix prototype for
	activate_key. (#108927, Jason D. Hildebrand)

Mon Apr 21 18:42:51 2003  Owen Taylor  <otaylor@redhat.com>

	* demos/btk-demo/Makefile.am demos/btk-demo/geninclude.pl:
	Remove geninclude.pl from CVS and don't dist it either,
	it is generated. (#108970, Rich Kinder)

Mon Apr 21 18:35:48 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkobject.h: Remove a couple of obsolete comments,
	fix another comment. (#109737, Britton Kerin)

Mon Apr 21 18:29:03 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkiconfactory.c (btk_icon_set_unref): Free
	the source list, not just it's contents (Patch
	from Charles Kerr, #108243)

Mon Apr 21 18:13:46 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdnd-x11.c (bdk_window_cache_filter): Patch
	from Alex Larsson fixing problem with restacking during
	DND. (#108671)

Mon Apr 21 15:07:29 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdisplay-x11.c (bdk_display_keyboard/pointer_ungrab):
	Calling XFlush() after ungrabbing, to avoid problems if
	the app subsequently blocks on a long-running operation.
	(#106520, reported by Rajkumar Siva)

Fri Apr 18 17:42:45 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkwindow-x11.c (set_initial_hints): Add
	SKIP_TASKBAR/SKIP_PAGER to set of properties we
	might set on map. (#110019, problem reported
	by Loban Rahman)

Fri Apr 18 17:14:33 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkevents.c (bdk_event_copy): Fix for the
	case when bdk_event_copy() is called on a non-allocated
	event. (#109716, reported by Rich Burridge)

Fri Apr 18 16:57:44 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdrawable-x11.c (draw_with_images/pixmaps):
	Fix pointer arithmetic on 'void *'. (#108322)

Fri Apr 18 16:31:49 2003  Owen Taylor  <otaylor@redhat.com>

	* configure.in bdk/x11/bdkdisplay-x11.c modules/input/Makefile.am:
	Check for XAddConnectionWatch()/X11R6, and if found, disable XIM and
	use of XAddConnectionWatch. Remove --enable-xim config option.
	Should fix building on X11R6 (#110523, Albert Chin)

Fri Apr 18 15:56:46 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdisplay-x11.[ch] bdk/x11/bdkdrawable-x11.[ch]:
	Patch from Morten Welinder to catch Sun servers	with a 
	broken implementation of the RENDER extension. (#108309)

Fri Apr 18 15:30:38 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkwindow-x11.c (set_text_property): Use
	bdk_free_compound_text(), not g_free(). (#107643,
	Michael Zucchi)

Fri Apr 18 15:11:50 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdisplay-x11.c (_bdk_display_x11_get_type)
	bdk/x11/bdkscreen-x11.c (_bdk_screen_x11_get_type): Fix
	wrong use of base_finalize. (#105126, Sven Neumann)

Fri Apr 18 15:06:00 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkwindow.c (bdk_window_constrain_size): Fix
	'/' vs. '*' problem in aspect ration computations. (#108237)

Fri Apr 18 14:15:09 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): 
	* bdk/x11/bdkevents-x11.c (bdk_event_translate): You
	don't get a XkbMapNotify event if you get a XkbNewKeyboardNotify 
	event, so select for both. (#108406, Egmont Koblinger)

Thu Apr 17 09:57:44 2003  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c (validate_visible_area): remove infinite loop
	caused by not clearing the scroll_to_path.

2003-04-16  Matthias Clasen  <maclas@gmx.de>

	* btk/btkstyle.c: Doc additions and fixes.

	* btk/btktreeviewcolumn.c
	(_btk_tree_view_column_get_neighbor_sizes): Doc fixes.

2003-04-14  Michael Natterer  <mitch@gimp.org>

	* btk/btkliststore.c (btk_list_store_move): added checks to ensure
	that the iter is not reordered to its own position. Prevents model
	corruption for the case that the store contains only a single item
	(fixes bug #108387).

	Unrelated:

	* btk/btkliststore.c (btk_list_store_insert): g_list_alloc() the
	new list element later so we don't leak it if we decide to return
	early.

	* btk/btktreeselection.c (_btk_tree_selection_internal_select_node):
	set selection->tree_view->priv->anchor to NULL after freeing it.

2003-04-13  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeviewcolumn.c
	(btk_tree_view_column_cell_get_position): Document. 

	* btk/btktextbuffer.c (btk_text_buffer_select_range): 
	* btk/btktreeviewcolumn.c (btk_tree_view_column_[sg]et_expand): 
	* btk/btkbutton.c (btk_button_[sg]et_focus_on_click): Document
	these as 2.4 additions.

2003-04-09  Matthias Clasen  <maclas@gmx.de>

	* INSTALL.in: Fix the real thing.

	* INSTALL: Typo fix.

Mon Apr  7 19:43:15 2003  Owen Taylor  <otaylor@redhat.com>

 	* bdk/x11/bdkdisplay-x11.c (bdk_x11_display_ungrab): Flush
 	after ungrabbing the server.
 
	* bdk/x11/bdkimage-x11.c: Remove some no-longer-needed
	calls to XFlush().

 	* bdk/x11/bdkwindow-x11.c (_bdk_windowing_window_at_pointer):
 	Use bdk_x11_display_grab/ungrab.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Initialize
	use_xshm to TRUE so SHM gets used when present.
 
2003-04-07  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextlayout.c (set_para_values): 
	* btk/btkenums.h (BtkWrapMode): Add BTK_WRAP_WORD_CHAR.  (#110086,
	David Brigada)

	* btk/btkcelleditable.c, btk/btkfixed.c, btk/btktreemodel.c,
	btk/btktreeselection.c, btk/btktreeview.c: Fix numerous
	misspellings of possessive "its".  (#110027, Doug Quale)

2003-04-03  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/main.c (demo_find_file): Only use files from the
	current directory if it looks like the srcdir.  (#109357)

Wed Apr  2 23:02:26 2003  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkbutton.[ch] (btk_button_class_init): add property
	focus_on_click

	* btk/btkwindow.c (btk_window_focus): make arrow keyboard
	navigation not wrap around.

2003-04-02  Matthias Clasen  <maclas@gmx.de>

	* btk/btkprogress.c (btk_progress_get_percentage_from_value):
	Return 0 if lower == upper.  (#109155)
	(btk_progress_get_current_percentage): Use
	btk_progress_get_percentage_from_value().

2003-04-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkimcontext.c (btk_im_context_focus_in): Fix docs.
	(#109510, Noah Levitt)

Mon Mar 31 13:52:13 2003  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkrbtree.c (_btk_rbtree_reorder): null initialize reorder's
	members so Purify won't complain.

	* btk/btkliststore.c (btk_list_store_sort): ditto.

2003-03-31  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c: Add a new property, role, corresponding to 
	btk_window_[gs]et_role().  (#93904)

Sun Mar 30 03:57:42 2003  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeselection.c (btk_tree_selection_get_selected_rows):
	fix crash.  Patch from Markus Lausser <sgop@users.sourceforge.net>

2003-03-29  Matthias Clasen  <maclas@gmx.de>

	* btk/btkoptionmenu.c (btk_option_menu_remove_contents): Set state
	of labels back to normal before reparenting back.  (#102387)

	* btk/btkcolorseldialog.c (btk_color_selection_dialog_init): Set
	a default window title to match the BtkFontSelectionDialog behavior.
 
	(btk_color_selection_dialog_new): Don't call
	btk_window_set_title() if title is NULL.  (bug #101975, Daniel Elstner)

2003-03-29  Matthias Clasen  <maclas@gmx.de>

	Fix for bug #78499:
	
	* btk/btkentry.h (struct _BtkEntry): Add flags select_words and
	select_lines. 

	* btk/btkentry.c (btk_entry_button_press): Set select_words and
	select_lines on double/triple click.

	* btk/btkentry.c (btk_entry_motion_notify): Implement
	select-by-words and select-by-lines behaviour.

        Fixes for bug #56248:
	
	* btk/btknotebook.c (stop_scrolling): New function to remove the
	timer and queue a redraw. 
	(btk_notebook_grab_notify): 
	(btk_notebook_state_changed): New functions to call stop_scrolling() 
	if necessary.	
	(btk_notebook_button_release): Use stop_scrolling().
	(btk_notebook_draw_arrow): Fix drawing of insensitive arrows.

	* btk/btkrange.c (stop_scrolling): New function to remove the
	grab, remove the timer and queue a redraw.
	(btk_range_grab_notify): 
	(btk_range_state_changed): New functions to call stop_scrolling() 
	if necessary.	
	(btk_range_button_release): Use stop_scrolling().

	* btk/btkspinbutton.c (btk_spin_button_grab_notify): 
	(btk_spin_button_state_changed): Redraw after stop_spinning.
	(btk_spin_button_stop_spinning): Reset click_child to correct the
	drawing of the arrows.
	(btk_spin_button_button_release): Use a local copy of click_child,
	since stop_spinning() resets it.

	* btk/btknotebook.c (btk_notebook_class_init): Add C-A-PgUp and
	C-A-PgDown as alternatives to the A-less variants. (This slipped
	in accidentally some time ago).  (#97860)

2003-03-26  Sven Neumann  <sven@gimp.org>

	* btk/btktreeview.c: rewrote the function that does node and arrow
	prelighting, queue all redraws from here (Fixes bug #108792).

2003-03-20  Richard Kinder <r_kinder@yahoo.com>

	* demos/testpixbuf.c (update_timeout): set error to NULL, not FALSE.
        Fixes bug #108778.

2003-03-20  Guntupalli Karunakar <karunakar@freedomink.org>

	* configure.in: Added "ml" in ALL_LINGUAS

Sat Mar 15 18:49:27 2003  Manish Singh  <yosh@gimp.org>

	* btk/btkradiomenuitem.h: use BTK_DISABLE_DEPRECATED instead of
        G_DISABLE_DEPRECATED.

2003-03-14  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c: Use the signed GET_X_LPARAM() and
	GET_Y_LPARAM() to extract x and y coordinates from an LPARAM or
	DWORD, and not the unsigned HIWORD() and LOWORD(). Systems with
	multiple monitors can have negative coordinates on some of the
	monitors. (partial fix for #99496, Arnaud Charlet)

2003-03-15  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c: Add a "buffer" property.  (#108353) 

2003-03-13  Sven Neumann  <sven@gimp.org>

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_set_property):
	removed redundant calls to g_object_notify().
	(btk_cell_renderer_pixbuf_get_size): removed redundant casts, see
	bug #108236.

	* btk/btktextiter.c (_btk_text_iter_get_segment_char)
	(_btk_text_iter_get_segment_byte): return 0, not NULL (these
	functions return an integer value).

2003-03-13  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): On
	WM_MOUSEMOVE, the test whether we have actually moved (and thus
	shouldn't generate an BDK event) moved after the call to
	propagate() and translate_mouse_coords(). Otherwise we were
	testing wrong values. (#108115, Allin Cottrell)
	(bdk_event_translate): On WM_?BUTTONUP, set current_{x,y} the same
	way as in WM_?BUTTONDOWN and WM_MOUSEMOVE.

	* bdk/win32/bdkevents-win32.c (bdk_pointer_grab): if a grab cursor
	is used, must copy the HCURSOR with CopyCursor(), as it is OK to
	destroy the BdkCursor after calling bdk_pointer_grab(). Set the
	cursor right away with SetCursor(), as we won't get any
	WM_SETCURSOR messages while the mouse is captured. 
	(bdk_display_pointer_ungrab): Correspondingly, destroy the copy
	with DestroyCursor() when no longer used. (#108114, Allin Cottrell)

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): On
	WM_SYSCHAR, return FALSE from the window procedure to prevent the
	DefWindowProc from being called. Otherwise Windows would beep,
	thinking you are tring to access a (nonexistent) menu when you
	press Alt-something. Don't do this for Alt-Space,
	though. (#107454, Martyn Russell)

	* bdk/win32/bdkcursor-win32.c: Minor spacing and debug print fixes.

Tue Mar 11 12:01:07 2003  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c (btk_tree_view_class_init): Ctrl/Shift
	[left/right] expands/collapses the tree, #108092

2003-03-09  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdrawable-win32.c (draw_segments): Don't try to
	compensate for LineTo() not drawing the end pixel. It causes more
	harm than benefits, see bug #81895.

2003-03-08  Matthias Clasen  <maclas@gmx.de>

	Bug #107664 continued:

	* bdk/x11/bdkinputprivate.h: 
	* bdk/x11/bdkinput-none.c (_bdk_input_window_none_event): Remove. 
	(_bdk_input_other_event): Return gboolean.
	* bdk/x11/bdkinput-xfree.c (_bdk_input_window_none_event): Remove. 
	(_bdk_input_other_event): Return gboolean.
	* bdk/x11/bdkinput-x11.c (_bdk_input_common_other_event): Return gboolean.

	* bdk/x11/bdkevents-x11.c (bdk_event_translate): Make return_val
	gboolean, remove pointless call to _bdk_input_window_none_event.

	* bdk/win32/bdkinput-win32.[hc] (_bdk_input_other_event): Return gboolean.
	(_bdk_input_window_none_event): Remove.

	* btk/btktextiter.c (_btk_text_iter_get_indexable_segment): 
	(_btk_text_iter_get_any_segment): 
	(_btk_text_iter_get_segment_byte): 
	(_btk_text_iter_get_segment_char): 
	(_btk_text_iter_get_text_line): 
	(_btk_text_iter_get_btree): Fix 0/NULL confusion.
	* bdk/x11/bdkdnd-x11.c (motif_target_table_check): Return gint.
	* bdk/win32/bdkfont-win32.c (bdk_font_equal): 
	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_get_deskrelative_origin): 
	(bdk_window_get_origin): 
	* bdk/linux-fb/bdkcolor-fb.c (bdk_colors_alloc): Fix 0/FALSE confusion. 

2003-03-06  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkrgb.c (bdk_rgb_try_colormap): Return gboolean, not gint.
	(#107664, Morten Welinder)

	* bdk/x11/bdkwindow-x11.c (bdk_window_get_deskrelative_origin): 
	* bdk/x11/bdkfont-x11.c (bdk_font_equal): 
	* bdk/x11/bdkdnd-x11.c (bdk_drag_get_protocol_for_display): 
	Fix TRUE/1 and FALSE/0 confusion.  (#107664, Morten Welinder)

	* btk/btktextmark.c (btk_text_mark_get_buffer): 
	* btk/btkeditable.c (btk_editable_get_chars): 
	* btk/btkctree.c (btk_ctree_find_node_ptr): 
	* demos/btk-demo/main.c (demo_find_file): Fix NULL/FALSE confusion
	(#107648, Morten Welinder)Fix NULL/FALSE confusion
	(#107648, Morten Welinder)

2003-03-04  Matthias Clasen  <maclas@gmx.de>

	* btk/btkobject.h: Add deprecation guards for btk_object_new ().

Sun Mar  2 23:35:57 2003  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkcellrenderertoggle.c (btk_cell_renderer_toggle_get_size):
	handle rtl code.  Thanks to Matthias Clasen for an initial patch
	to handle the RTL code.

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_get_size): ditto

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_get_size): ditto

	* btk/btktreeview.c: (invalidate_column),
	(invalidate_last_column),
	(btk_tree_view_get_real_requested_width_from_column),
	(btk_tree_view_size_allocate_columns),
	(btk_tree_view_size_allocate), (btk_tree_view_button_press),
	(btk_tree_view_button_release_drag_column),
	(btk_tree_view_update_current_reorder),
	(btk_tree_view_motion_drag_column), (btk_tree_view_bin_expose),
	(btk_tree_view_key_press), (btk_tree_view_header_focus),
	(btk_tree_view_get_background_xrange),
	(btk_tree_view_get_arrow_xrange),
	(btk_tree_view_is_expander_column),
	(btk_tree_view_set_column_drag_info),
	(btk_tree_view_move_cursor_left_right):
	Add RTL support.

	* btk/btktreeviewcolumn.h (struct _BtkTreeViewColumn): add an
	expand flag.

	* btk/btktreeviewcolumn.c:
	(btk_tree_view_column_class_init),
	(btk_tree_view_column_set_property),
	(btk_tree_view_column_get_property),
	(btk_tree_view_column_set_expand),
	(btk_tree_view_column_get_expand),
	(btk_tree_view_column_cell_process_action):
	Add support for expand flag.  Thanks to Kristian Rietveld for an
	initial patch for this.

Fri Feb 28 02:06:17 2003  Jonathan Blandford  <jrb@bunny.org>


2003-03-02  Tor Lillqvist  <tml@iki.fi>

	* bdk/bdk.def
	* btk/btk.def: Add a bunch of missing entries. Noticed by Cedric
	Gustin.

2003-03-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkscrolledwindow.c (btk_scrolled_window_set_vadjustment): 
	(btk_scrolled_window_set_hadjustment): Replace uses of
	btk_object_new by g_object_new.

Thu Feb 27 17:44:24 2003  Manish Singh  <yosh@gimp.org>

	* demos/btk-demo/main.c
	* demos/btk-demo/tree_store.c
	* bdk/x11/bdkscreen-x11.c
	* btk/btkcellrenderertoggle.c
	* btk/btkcolorsel.c
	* btk/btkdnd.c
	* btk/btkeditable.c
	* btk/btkentry.c
	* btk/btkmenu.c
	* btk/btkmenubar.c
	* btk/btkmenuitem.c
	* btk/btkmenushell.c
	* btk/btkrc.c
	* btk/btksettings.c
	* btk/btkstyle.c
	* btk/btktextbuffer.c
	* btk/btktextview.c
	* btk/btktreeviewcolumn.c
	* tests/testbtk.c
	* tests/testtext.c
	* tests/testtreeedit.c
	* tests/testtreefocus.c
	* tests/testtreeview.c: remove unnecessary G_OBJECT() casts.

Tue Feb 25 21:55:17 2003  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkoptionmenu.c (btk_option_menu_position): account for RTL
	code.

2003-02-24  Sven Neumann  <sven@gimp.org>

	* btk/btkmain.c (btk_get_default_language): fixed documentation.

2003-02-21  Tomas Ogren  <stric@ing.umu.se>

	* docs/reference/btk/tmpl/btktreemodel.sgml: Fix typos in an example

2003-02-20  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextbtree.c (_btk_text_line_previous_could_contain_tag): 
	Check if line_ancestor_parent is NULL.  (#102711, Manuel Clos)

	* btk/btktextview.c (btk_text_view_scroll_to_iter): 
	(btk_text_view_update_adjustments): Make sure cursor stays visible
	during horizontal scrolling.  (#75270)

2003-02-19  Matthias Clasen  <maclas@gmx.de>

	* tests/testdnd.c: Replace btk_timeout_* by their GLib
	counterparts. (#106532)

	* bdk/bdkkeys.c (bdk_keymap_class_init): Associate the
	keys_changed virtual function with the keys_changed signal.
	(#106512, Jeff Franks)

2003-02-15  Larry Ewing  <lewing@ximian.com>

        * bdk/bdkevents.c (bdk_event_copy): copy the event axes as well.

2003-02-17  Mohammad DAMT  <mdamt@bisnisweb.com>

	* po/id.po: Added Indonesian translation
	* configure.in: Added "id" to ALL_LINGUAS

2003-02-14  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (popup_targets_received): Remove bogus casts.

2003-02-12  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "yi" to ALL_LINGUAS.

2003-02-12  Matthias Clasen  <maclas@gmx.de>

	Fix for #82734 and #78216:
	
	* btk/btktextview.c (delete_cb): 
	(select_all_cb): New callbacks for context menu items.
	(popup_targets_received): Add "Delete" and "Select All" to context
	menu, mnemonics and title caps for all items.

	* btk/btkentry.c (btk_entry_delete_cb): New callback for "Delete"
	context menu item.
	(popup_targets_received): Add "Delete" to context menu, mnemonics
	and title caps for all items.

2003-02-09  Tor Lillqvist  <tml@iki.fi>

	* btk/btkfilesel.c (win32_btk_add_drives_to_dir_list): Use
	GetDriveType() to recognize removable drives (in order to avoid
	hanging if trying to access an empty floppy drive), instead of
	hardcoding A: and B: (#105654).

2003-02-09  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c (btk_widget_set_name): Add note about periods in 
	names.  (#57680)

2003-02-09  Christian Rose  <menthos@menthos.com>

	* configure.in: Removed "en@IPA.po" from ALL_LINGUAS.

Fri Feb  7 04:49:46 2003  Tim Janik  <timj@btk.org>

	* btk/btkobject.c: remove quark_user_data usage in
	btk_object_{g|s}et_user_data(). fixes get_user_data()
	returning NULL for user_data set through property interface.

	* btk/btkitemfactory.c (btk_item_factory_create_item): don't put out
	warnings if a pixbuf couldn't be retrieved, since (a) this doesn't
	need to be a programming error (in case of loaded data), (b) it breaks
	with 2.0 behaviour where extra magic could be used to create empty
	images. don't attempt to retrieve pixbufs from NULL extra_data.

2003-02-06  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkvisual-x11.c (bdk_visual_get_best_with_depth): Return
	a BdkVisual *, not a BdkVisual **.  (#105243)

	* btk/btkclist.c: 
	* btk/btkctree.c: 
	* btk/btkcontainer.c: 
	* btk/btkdnd.c: 
	* btk/btkentry.c: 
	* btk/btklist.c:
	* btk/btkmenu.c:
	* btk/btkmenuitem.c:
	* btk/btknotebook.c:
	* btk/btkselection.c:
	* btk/btkspinbutton.c:
	* btk/btktext.c:
	* btk/btktextview.c:
	* btk/btktooltips.c:
	* btk/btktreeview.c:
	* btk/btkwindow.c: Replace uses of btk_timeout_* and btk_idle_* by
	their non-deprecated GLib counterparts.
	
	* btk/btkmain.h: Fully deprecate btk_timeout_* and btk_idle_*.
	
Sun Feb  2 16:45:57 GMT 2003  Tony Gale <gale@btk.org>

	* docs/tutorial/btk-tut.sgml: cleanups from
	Sebastian Rittau (#104832)

2003-02-01  Tor Lillqvist  <tml@iki.fi>

	Merge from stable:

	* bdk/win32/bdkpixmap-win32.c (bdk_pixmap_foreign_new_for_display,
	bdk_pixmap_lookup, bdk_pixmap_lookup_for_display): Implement.
	(#104108, Naofumi Yasufuku)

	* bdk/bdk.def: Export the above. Export
	bdk_screen_get_system_visual, noticed by Ed Woods.

Fri Jan 31 17:45:22 2003  Manish Singh  <yosh@gimp.org>

	* demos/pixbuf-demo.c
	* demos/testpixbuf.c
	* demos/btk-demo/pixbufs.c: remove deprecated btk_timeout_* usage.

Fri Jan 31 17:33:00 2003  Manish Singh  <yosh@gimp.org>
                                                                                
        * btk/btknotebook.c (btk_notebook_remove_tab_label): set_state
        on the tab_label before unparenting it, in case the unparent
        drops the refcount to 0.

2003-02-01  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconfactory.h: Use BDK_MULTIHEAD_SAFE like all other btk
	headers. Sorry about btk_selection_clear, Yosh.

Thu Jan 30 17:16:05 2003  Manish Singh  <yosh@gimp.org>

	* btk/btkselection.h: declare btk_selection_clear in BTK_COMPILATION
	too, for btkwidget.c. Remember people, when introducing new
	deprecations, make sure internal code isn't using it, or if so,
	reorganize appropriately like I've done in other places.

	* tests/testtext.c: don't use deprecated btk_timeout_* stuff.

2003-01-31  Matthias Clasen  <maclas@gmx.de>

	* btk/btkselection.h: 
	* btk/btkselection.c (btk_selection_clear): Deprecate.  (#85683)

	* bdk/bdkpixbuf.h: 
	* bdk/bdkpixbuf-render.c (bdk_pixbuf_render_to_drawable): 
	(bdk_pixbuf_render_to_drawable_alpha): Deprecate.  (#60582)

	* btk/btkcolorsel.h:
	* btk/btkcolorsel.c (btk_color_selection_set_change_palette_hook):
	Deprecate.  (#98167)

	* btk/btkpaned.h: Deprecate btk_paned_computed_position(). (#97077)

	* btk/btkmain.h: Deprecate the btk_timeout_*, btk_idle_*
	and btk_input_* functions.  (#71596)
	
	* btk/btkentry.c (btk_entry_move_cursor): 
	* btk/btklabel.c (btk_label_move_cursor): Handle
	BTK_MOVEMENT_HORIZONTAL_PAGES in switches.

	* bdk/bdk.h: Deprecate bdk_wcstombs() and bdk_mbstowcs().  (#79803)

	* btk/btkitemfactory.h: 
	* btk/btkitemfactory.c (btk_item_factory_add_foreign): Deprecate. 
	(#69244)

Thu Jan 30 23:48:30 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c (_btk_tree_view_column_count_special_cell):
	only count the special cell if it is also visible,
	(_btk_tree_view_column_get_neighbor_sizes): only take the width into
	account from visible cells,
	(btk_tree_view_column_cell_get_position): likewise, (Reported and
	testcase provided by Vasco Alexandre da Silva Costa, via IRC,
	tracking bug was #104563).
	
Thu Jan 30 23:46:15 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action):
	subtract expander space and focus line space from the extra space
	we are about the allocate. (Fixes #104635).

Thu Jan 30 23:42:03 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkstyle.c (apply_affine_on_point): fix rouding error
	(Fixes #96242, patch from Soeren Sandmann).

Thu Jan 30 16:54:29 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btknotebook.c: Patch from Soeren Sandmann
	to update the states of the tab label child
	widgets to match the state of the tabs. 
	(#93389, Reported by Tommi Komulainen)

Thu Jan 30 16:30:54 2003  Owen Taylor  <otaylor@redhat.com>

	* Makefile.am (EXTRA_DIST): Remove btk+.spec.in from
	EXTRA_DIST, and from dist rules. (#102231)

2003-01-30  Daniel Elstner  <daniel.elstner@gmx.net>

	* btk/btktoolbar.c (set_child_packing_and_visibility): New helper
	function that sets the icon's and label's packing options and
	visibility based on toolbar->style.

	(btk_toolbar_internal_insert_element):
	(btk_real_toolbar_style_changed): Make use of
	set_child_packing_and_visibility() to clean up the code and get
	the packing right for icon-only/text-only toolbars. (#104679)

	(get_first_child): Remove, and use btk_bin_get_child() instead.

2003-01-30  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c: Replace PAGE_HORIZONTALLY_HACK_VALUE by
	BTK_MOVEMENT_HORIZONTAL_PAGES.  (#68947)

	* btk/btkenums.h: Add BTK_MOVEMENT_HORIZONTAL_PAGES to BtkMovementStep.
	
Thu Jan 30 16:01:29 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkrgb.c (bdk_rgb_try_colormap): Remove the 
	attempt-to-allocate then free code. To handle multiple
	people allocating colors at the same time, we need
	to just go ahead and try. (#102213, Shivram U)
	
2003-01-30  Daniel Elstner  <daniel.elstner@gmx.net>

	* btk/btkcolorsel.c (palette_paint): Explicitely draw an opaque
	rectangle using the background color rather than relying on
	bdk_window_clear_area(), so that the palette works properly with
	pixmap themes. (#101732)

	* demos/btk-demo/colorsel.c: Install an "expose_event" handler
	to fill the drawing area in the background color.

Wed Jan 29 14:11:21 2003  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* modules/input/btkimcontextxim.c (choose_better_style): fix a memory
	initialization error for selecting input style (#103549).

Wed Jan 29 17:02:41 2003  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkkeyuni.c (get_decimal_char): Make the 
	translation of BDK_KP_Decimal dependent on LC_NUMERIC.
	(#101225)

Wed Jan 29 15:43:56 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btkmenushell.c (btk_real_menu_shell_move_current):
	Make up from the menu bar go to the end of the submenu.
	(#96114, Ian Peters.)

	* btk/btkmenuitem.c (btk_menu_item_mnemonic_activate): 
	Only do the select-but-not-activate stuff if the
	menu is already active. Otherwise, just activate.
	(#101690, Arvind Samptur)

Tue Jan 28 15:18:24 2003  Owen Taylor  <otaylor@redhat.com>

	* autogen.sh (have_automake): Fix version in complaint
	message about automake. (#104366, Rich Burridge)

Mon Jan 27 16:38:13 2003  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Remove SOEXT stuff; it doesn't work portably.

Mon Jan 27 22:45:15 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreestore.c (btk_tree_store_move): don't handle b if
	we appended/prepended, send the rows_reordered signal to the 
	correct level ... (Reported by Matthew Tuck).

Mon Jan 27 22:43:11 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreestore.c (btk_tree_store_sort_helper): don't just bail
	out if the level only has one item, recurse over the child if there
	is one. (Fixes #100458, reported by Gaël Le Mignot).

Mon Jan 27 22:41:26 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_set_model),
	(btk_tree_view_search_equal_func): make TreeView search handle
	all types which are transformable by GValue. (Fixes #99803, reported
	by Muktha Narayan).

Mon Jan 27 22:39:25 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_set_sort_column_id):
	*really* handle unsetting the ID. Slightly modified patch from
	Soeren Sandmann. Fixes #87556, reported by Jarek Dukat.

Mon Jan 27 22:33:43 2003  Kristian Rietveld  <kris@btk.org>

	Fixes the total BtkTreeSortable mess, and #83195, reported by
	Jarek Dukat

	* btk/btktreestore.c (btk_tree_store_get_sort_column_id),
	(btk_tree_store_set_sort_column_id), (btk_tree_store_set_sort_func),
	(btk_tree_store_set_default_sort_func): use the constant
	BTK_TREE_SORTABLE_DEFAULT_SORT_COLUMN_ID instead of -1, make functions
	work as advertised by the documentation.

	* btk/btklistore.c (btk_list_store_get_sort_column_id),
	(btk_list_store_set_sort_column_id), (btk_list_store_set_sort_func),
	(btk_list_store_set_default_sort_func): likewise.

	* btk/btktreemodelsort.c (btk_tree_model_set_sort_column_id),
	(btk_tree_model_set_sort_func),
	(btk_tree_model_sort_set_default_sort_func): make functions work
	as advertised by the documentation.

Mon Jan 27 22:31:56 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_button_press): update focus_column
	before we decide if we edit. (fixes #100973, reported by Dave Cook).

Mon Jan 27 22:29:30 2003  Kristian Rietveld  <kris@btk.org>

	Bug report and test case from Paolo Maggi via IRC.

	* btk/btkliststore.c (btk_list_store_swap): update tail if needed,
	(btk_list_store_move): update tail if needed.

Mon Jan 27 16:19:59 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btksocket.c (btk_socket_filter_func): event->any.window
	might be NULL. Use btk_widget_get_display (widget) 
	(#102860, Thomas Leonard)

Mon Jan 27 15:58:31 2003  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Fix --without-modules/--disable-modules
	confusion that was causing --disable-modules not to work.
	(#102865, Akira Tagoh)

	* configure.in: Fix problem with plain --with-xinput
	(#104266, Akira Tagoh)

2003-01-24  Sebastian Rittau  <srittau@jroger.in-berlin.de>

	* docs/tutorial/btk-tut.sgml: Fix a few typos, introduced by my last
	patch.

Fri Jan 24 17:06:41 GMT 2003  Tony Gale <gale@btk.org>

	* docs/tutorial/btk-tut.sgml: Remove duplicate copy of tictactoe.h

Thu Jan 23 21:15:29 GMT 2003  Tony Gale <gale@btk.org>

	* docs/faq/btk-faq.sgml: Learn to spell Library

Thu Jan 23 20:56:56 GMT 2003  Tony Gale <gale@btk.org>
	* Sebastian Rittau  <srittau@jroger.in-berlin.de>:

	   docs/tutorial/btk-tut.sgml: Adopted chapter 21.3 "Creating a
	   Composite widget" to modern standards. (I.e. use bobject instead of
	   bunnylib, derive from BtkTable instead of BtkVBox.) Bugzilla #103869.

	* docs/tutorial/btk-tut.sgml, examples/tictactoe: Fixup tic-tac-toe
	code in Appendix C to reflect above changes.

	* examples/rangewidgets/rangewidgets.c: From Roger Leigh
	auto resize on page size change

2003-01-23  Daniel Elstner  <daniel.elstner@gmx.net>

	* btk/btktoolbar.c (btk_toolbar_hide_all): Override hide_all
	in addition to show_all in order to keep them symmetric. (#102201)

Wed Jan 22 14:18:46 2003  Manish Singh  <yosh@gimp.org>

	* bdk/x11/bdkevents-x11.c (translate_key_event): add a "return" at
	the end of the function, so there is a statement following the "out"
	label in all cases (fixes #101961)

2003-01-22  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "mn" to ALL_LINGUAS.

Wed Jan 15 17:02:18 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* btk/btktextlayout.c (btk_text_layout_validate_yrange):
 	Fix off-by-one error on the backward iteration loop,
 	that was causing the wrong range to be redrawn.
 	(at least part of #72734)
	
2003-01-21  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_size_allocate): Adjust the
	vadjustment value after changing its bounds.  (fixes #101963 and 
	#73562)

	* btk/btkcolorsel.c (hex_changed): Fix clamping to [0,1] to avoid 
	unnecessary roundtrip failures.  (#93500)

2003-01-19  Tor Lillqvist  <tml@iki.fi>

	Merge from stable:
	
	Fix for #103614 and some other problems with BtkFileSelection on
	Windows:
		
	* btk/fnmatch.c (get_char): Need to use g_unichar_tolower(), not
	g_ascii_tolower(). Windows file names are case-insensitive for all
	Unicode letters.

	* btk/btkfilesel.c: Instead of checking for G_OS_WIN32 or
	G_WITH_CYGWIN, check G_PLATFORM_WIN32. Move inclusion of btkintl.h
	earlier, as it includes config.h unconditionally, and btkprivate.h
	redefines BTK_LOCALEDIR.
	(struct _CompletionDirSent): Ifdef out the fields not used on
	Windows.
	(compare_utf8_filenames, compare_sys_filenames): Need different
	comparison implementation for UTF-8 file names and system locale
	file names on Win32. Cannot simply use g_ascii_strcasecmp(), but
	need to casefold all Unicode letters.
	(cmpl_completion_matches, open_dir, correct_parent): Ifdef out
	variables not used on Win32 to avoid warnings about unused
	variables.
	(open_ref_dir): Use g_path_skip_root() to skip past potential
	drive letter in front of the leading (back)slash.
	(open_new_dir): Ifdef out use of CompletionDirSent fields not
	there on Win32.
	(correct_parent): Bypass inode check also on Cygwin.

	Fix bug noticed by Alex Shaduri: Tooltips and other
	BDK_WINDOW_TEMP windows were activated. This looked very odd, and
	was a regression from earlier versions.
	
	* bdk/win32/bdkwindow-win32.c (show_window_internal): Fine-tune
	behaviour. Don't ever activate BDK_WINDOW_TEMP windows.
	(bdk_window_move, bdk_window_resize): Add debug logging.

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): When we get a
	WM_SIZE message for a non-visible (withdrawn) window, don't clear
	the BDK_WINDOW_STATE_WITHDRAWN bit. The window is still withdrawn
	even if its size changes.

2003-01-16  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextlayout.c (btk_text_layout_get_cursor_locations): Typo fixes.
	(totally_invisible_line): Fix an incorrect optimization which
	caused invisible paragraphs to be occasionally misrendered.

Wed Jan 15 15:55:47 2003  Owen Taylor  <otaylor@redhat.com>

	* btk/btksettings.c: Set the double click speed from
	XSETTINGS when creating a new BtkSettings object
	as well as when getting a notify. (#103601, reported
	by Louis Garcia)

Wed Jan 15 14:56:09 2003  Owen Taylor  <otaylor@redhat.com>
 
 	* btk/btknotebook.c (btk_notebook_size_allocate): 
 	Show/hide the notebook event window as necessary,
 	we weren't previously keeping the visibility updated
 	properly.  (#103599)
 
2003-01-15  Matthias Clasen  <maclas@gmx.de>

	* examples/menu/itemfactory.c: 
	* docs/tutorial/btk-tut.sgml: Add a <StockItem> to the itemfactory
	example.  (#103211)

2002-12-29  Murray Cumming  <murrayc@usa.net>

	Fixes #102168.

	* btk/btkliststore.c, btktreednd.c, btktreestore.c:
	Actually implement the BtkTreeDragSource::row_draggable virtual 
	function in BtkListStore and BtkTreeStore instead of just checking 
	whether it's implemented at all. This means that DnD isn't broken by
	btkmm's virtual function wrappers. The alternative would be to
	hard-code the TRUE return value into btkmm's wrappers, but that's 
	part of BTK+'s implementation, not it's API.

Tue Jan 14 23:42:29 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c: fix compiler warning.

Tue Jan 14 23:29:00 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_render):
	make sure exposed pixbufs are clipped to the exposed area before
	drawing, which is a slight speedup. (#102379, patch from Soeren
	Sandmann).

Tue Jan 14 23:26:41 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (validate_visible_area): silly typo fix,
	only free scroll_to_path when the complete tree has been validated.
	This makes sure that we scrolled to the correct path.

Tue Jan 14 23:25:32 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_style_set): update the
	background of widget->window and bin->window. (Fixes #96650, reported
	by Dave Camp).

Tue Jan 14 23:24:02 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_clamp_node_visible): process
	updates before scrolling, avoiding a "selection streak". (Fixes
	#101235, patch from Soeren Sandmann).

Tue Jan 14 23:22:13 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (validate_visible_area): actually put values
	in the requisition using btk_widget_size_request. (Fixes #100172,
	reported by Kjartan Maraas).

Tue Jan 14 23:19:45 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_rows_reordered): cancel the
	arrow animation timeout before we actually reorder the rbtree. If
	we don't do this we can get stuck arrows,
	(cancel_arrow_animation): new function. (Fixes #93629, part 2,
	reported and testcase provided by Hans Petter Jansson).

Tue Jan 14 23:18:21 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeselection.c (btk_tree_selection_real_modify_range):
	anchor_path should be start_path, not end_path. (Fixes #102618,
	patch from Carlos Garnacho Parro).

Tue Jan 14 23:16:15 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btkliststore.c (btk_list_store_move): also update the tail,
	only correct new_pos if we don't move to the head/tail.

Tue Jan 14 23:11:55 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreestore.c (btk_tree_store_swap): take the path from
	the parent_iter if depth >= 1, so we send the reordered signal to
	the correct level, remove debugging printfs which I forgot the remove
	earlier (2.2.0 shipped with this, oops). (Fixes #103198, Reported and
	testcase provided by Matthew Tuck).

Tue Jan 14 20:58:44 2003  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (invalite_last_column): split out actual column
	invalidation into invalidate_column(),
	(btk_tree_view_size_allocate_columns): invalidate column if the
	new width is larger than the old width.
	(fixes #102890, reported by Alex Duggan).

2003-01-14  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_move_cursor_internal): Skip
	invisible chars for BTK_MOVEMENT_LOGICAL_POSITIONS and
	BTK_MOVEMENT_WORDS.

	* btk/btktextiter.c,
	btk/btktextiter.h: Add some variant movement functions which
	skip invisible chars, and do some cleanups.

2003-01-12  Tor Lillqvist  <tml@iki.fi>

	Merge from stable:
		
	* btk/btkmain.c: Move inclusion of config.h and btkintl.h earlier,
	as btkprivate.h redefines BTK_LOCALEDIR on Win32, for run-time
	lookup.

	* bdk/Makefile.am (libbdk_win32_2_0_la_DEPENDENCIES): Depend on
	bdk.def.

	* bdk/bdk.def
	* btk/btk.def: Add some missing entries. Thanks to Kenichi SUTO.

	* btk-zip.sh.in (DEVZIP): Add bin/{btk-query-immodules-2.0,
	btk-demo}.exe and share/btk-2.0.

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_skip_taskbar_hint):
	Implement by setting or clearing the WS_EX_TOOLWINDOW extended
	window style.
	(bdk_window_set_type_hint): Add all cases to the switch (not all
	do anything, though). Handle BDK_WINDOW_TYPE_HINT_TOOLBAR by
	calling bdk_window_set_skip_taskbar_hint(). This means that BTK
	won't know that the skip_taskbar hint is on for the window, is
	this bad?

Wed Jan  8 18:43:03 2003  Manish Singh  <yosh@gimp.org>

	* bdk/x11/bdkdisplay-x11.c: #include <stdlib.h> for putenv,
	<string.h> for strlen.

	* bdk/x11/bdkscreen-x11.c: #include <stdlib.h> for getenv,
	<string.h> for strrchr.

	* tests/testbtk.c (create_saved_position): "x" and "y" properties
	for widgets no longer exist, use btk_window_move instead.

	* test/testtextbuffer.c (check_get_set_text): cast strlen to
	int for g_error.

2003-01-08  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextdisplay.c (btk_text_layout_draw): Fix display of
	the selection in the presence of invisible segments.

2003-01-07  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_class_init): Bind C-/ and C-\
	to "select all" and "unselect all".  (#102065)

	* btk/btktextview.h (struct _BtkTextView): Add a comment that
	the just_selected_element is unused.

	* btk/btktextview.c (extend_selection): New helper function to
	find the range that should be added to the selection. 
	(selection_motion_event_handler): 
	(btk_text_view_start_selection_drag): 
	(btk_text_view_end_selection_drag): 
	(selection_motion_event_handler): 
	(selection_scan_timeout): Support select-by-words/lines.
	(btk_text_view_button_press_event): Start a selection drag on
	double/triple clicks.  (#78499)

2003-01-06  Matthias Clasen  <maclas@gmx.de>

	Implement a utility function proposed in #102534:
	
	* btk/btktextbtree.h: 
	* btk/btktextbtree.c (_btk_text_btree_select_range): New function.
	(_btk_text_btree_place_cursor): Now a simple wrapper around
	_btk_text_btree_select_range().   

	* btk/btktextbuffer.h: 
	* btk/btktextbuffer.c (btk_text_buffer_select_range): New function.
	(btk_text_buffer_place_cursor): Now a simple wrapper around
	btk_text_buffer_select_range(). 

2003-01-05  Havoc Pennington  <hp@pobox.com>

	* configure.in: fix a stray bracket that was breaking the build

2003-01-05  Tor Lillqvist  <tml@iki.fi>

	* btk-zip.sh.in: Use correct DLL and import library names, with
	BTK_API_VERSION in name, not BTK_MAJOR_VERSION.BTK_MINOR_VERSION.
	(DEVZIP): Add bdk-pixbuf-query-loaders.exe.

	* configure.in: Improve check for dimm.h.

	* configure.in: Set SOEXT to 'so' on Unix, 'dll' on Win32. Used in
	bdk-pixbuf/Makefile.am.

	* bdk-pixbuf/makefile.mingw.in
	* bdk-pixbuf/pixops/makefile.mingw.in
	* bdk/makefile.mingw.in
	* bdk/win32/makefile.mingw.in
	* btk/makefile.mingw.in: Remove. Not maintained anyway.

	* bdk-pixbuf/Makefile.am
	* bdk-pixbuf/pixops/Makefile.am
	* bdk/Makefile.am
	* bdk/win32/Makefile.am
	* btk/Makefile.am
	* configure.in: Remove makefile.mingw{,.in} from here, too.
	
	* README.win32: Updates. Don't mention the now removed
	makefile.mingw files.

	* bdk/bdk.def
	* btk/btk.def: Add a couple of missing entries.

	* bdk/bdkkeynames.c: Include <string.h> for strcmp() and memcpy().

	* bdk/win32/bdkevents-win32.c: Move dimm.h header clash workaround
	earlier.

	* bdk/win32/rc/Makefile.am: Add hack to help
	build/win32/lt-compile-resource decide which kind of libtool
	object file to produce.

2003-01-05  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_move_cursor_internal): Make
	C-Down step through the sequence of paragraph ends (old behaviour
	included paragraph starts).  (#80340, patch by Narayana Pattipati)

	* btk/btktextiter.c (_btk_text_btree_get_iter_at_first_toggle):
 	Check for a tag toggle at the start iterator before calling
 	btk_text_iter_forward_to_tag_toggle().  (#102090, patch by Daniel 
	Elstner)

2003-01-04  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilesel.h (struct _BtkFileSelection): Add /*< public >*/
	and /*< private >*/ as appropriate.  (#97211)

2003-01-04  Tor Lillqvist  <tml@iki.fi>

	* Makefile.am (EXTRA_DIST): Don't distribute btk-zip.sh, but do
	distribute btk-zip.sh.in.

	* btk-zip.sh.in (DEVZIP): Add bdk-pixbuf-csource.exe and .1.

2003-01-03  Havoc Pennington  <hp@pobox.com>

	* docs/Makefile.am (EXTRA_DIST): put it in EXTRA_DIST

	* docs/text_widget_internals.txt: add a file documenting some of
	the text widget internals

2003-01-02  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c (btk_window_get_focus): Document that it may
	return NULL.  (#102069)

2003-01-01  Matthias Clasen  <maclas@gmx.de>

	* btk/fnmatch.c (FNMATCH_TEST_CASES): #undef, since having
	a main() in the library is obviously bad. 

2002-12-27  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_drag_data_received): Place the
	cursor at drop point.  (#72384)
	(btk_text_view_size_allocate): Update the horizontal adjustment
	value.  (#75694)

2002-12-25  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextdisplay.c (btk_text_layout_draw): Fix highlighting of
	selection wrt. to empty lines.  (#90435, #90582, #91619)

	* btk/btktextview.c (btk_text_view_preedit_changed_handler):
	Keep the cursor on screen.  (#96929)

2002-12-24  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextbuffer.c (paste_from_buffer): 
	(clipboard_text_received): Let the user action span the insertion
	and the deletion of the old selection.  (#82844)

2002-12-23  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextiter.c (btk_text_iter_backward_sentence_starts):
	Don't call btk_text_iter_backward_sentence_start() if
	count is zero.  (#99115)

	* btk/btktextview.c (btk_text_view_move_cursor_internal): Call
	move_cursor() even if the cursor hasn't moved, since it has the
	side effect of canceling the selection.  (#81395, #98537, #98333)

2002-12-22  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextlayout.c (add_preedit_attrs): Don't add attributes
	with empty ranges.  (fixes #101564 and #80637)

2002-12-21  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkwindow-win32.c (bdk_window_new): Move the code that
	sets the window style and extended window style, and adjusts the
	width and height to take the window decorations into account
	earlier. The adjusted width and height used to be ignored. Remove
	the local x, y, width and height variables, no need to further
	confuse the code by having local copies. (Partial fix, I hope, for
	#101588)

	(bdk_window_move): When moving top-level windows, take title bar
	and border width into account, offsetting the coordinates before
	calling SetWindowPos().

	(bdk_window_set_decorations, bdk_window_set_functions):
	Reimplement, taking into account the peculiar semantics of
	BDK_DECOR_ALL and BDK_FUNC_ALL. (#79036)

	(bdk_window_get_decorations): Implement. (#98981)
	
	(bdk_window_set_type_hint): When setting
	BDK_WINDOW_TYPE_HINT_MENU, call	bdk_window_set_decorations().
	(#79036)

	* bdk/bdk.def: Add bdk_window_get_decorations. (#98981)

2002-12-21  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (btk_text_view_set_background): New static
	function to set the background of all windows.
	(btk_text_view_style_set): Use btk_text_view_set_background().
	(btk_text_view_state_changed): New function; change background
	according to state.  (#88126)

2002-12-21  Havoc Pennington  <hp@pobox.com>

	* btk/btktextview.c (btk_text_view_move_visually): fix the documentation


2006-08-22  Matthias Clasen  <mclasen@redhat.com> 

	* Branch for 2.10

2006-08-23  Tor Lillqvist  <tml@novell.com>

	* btk/btkfilesystemwin32.c: Remove dead code. Reduce spurious
	differences between this file and btkfilesystemunix.c so that it
	is easier to compare them and check if differences are
	intentional. I will later factor out the common functions and code
	snippets from these two files.

2006-08-23  Tor Lillqvist  <tml@novell.com>

	Fix several problems with the file chooser on Windows, for
	instance prevent duplicated directory entries from appearing.

	* btk/btkfilesystem.c (btk_file_paths_sort): Use
	_btk_file_system_win32_path_compare() on Windows for casefolded
	sorting.

	* btk/btkfilesystemwin32.c (casefolded_hash, casefolded_equal):
	case-independent hash and equality functions. Scan the UTF-8
	strings gunichar by gunichar, and ignore special casing rules, to
	more closely match NTFS behaviour.
	(btk_file_system_win32_init): Use casefolded_hash() and
	casefolded_equal() for the folder hash table.
	(remove_trailing_slash): Don't remove the slash of a drive or
	share root.
	(get_mime_type_for_file): Take also a WIN32_FILE_ATTRIBUTE_DATA as
	argument, and use that to recognize directories. Don't call
	g_file_test() to check for executables, just look at the file name
	extension directly.
	(btk_file_system_win32_make_path): Check illegal chars in file
	name, like in btkfilesystemunix.c.
	(create_file_info): Drop unused basename parameter. Call
	g_filename_display_name() directly for roots, as
	g_filename_display_basename() mishandles those.
	(btk_file_folder_win32_get_info): Skip sanity check for now, as it
	fails for server share roots. Construct basename only in the if
	branch that uses it.
	(fill_in_names): Use casefolded_hash() and casefolded_equal() for
	the folder's stat_info hash table, too.
	(_btk_file_system_win32_path_compare): Scan the strings gunichar
	by gunichar and ignore special casing here, too, instead of using
	g_utf8_casefold(). Match slash and backslash.

2006-08-23  Tor Lillqvist  <tml@novell.com>

	* bdk/x11/bdkwindow-x11.c (bdk_window_shape_combine_mask)
	(bdk_window_input_shape_combine_mask)
	(bdk_window_shape_combine_rebunnyion)
	(bdk_window_input_shape_combine_rebunnyion): Add Win32 detail to doc
	comments.

2006-08-22  Paolo Borelli  <pborelli@katamail.com>

	* btk/btktextview.c: do not scroll on copy. Bug #329604.

2006-08-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrecentchooser.c (btk_recent_chooser_get_uris): Behave as
	documented and always return a NULL-terminated array.

	* btk/btkrecentmanager.c (btk_recent_manager_real_changed): Make sure
	to reset write_in_progress.  

2006-08-17  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version

	* === Released 2.10.2 ===

	* btk/btkrecentchoosermenu.c (btk_recent_chooser_menu_list_filters):
	Initialize menu.  (#351857, Chris Wilson)

	* btk/btkprinteroptionwidget.c (update_widgets): 
	* modules/printbackends/file/btkprintbackendfile.c 
	(output_file_from_settings): Handle filename encoding
	consistently.  (#351812, Christian Persch)

	* NEWS: Updates

2006-08-17  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserdefault.c
	(_btk_file_chooser_default_class_init): Enable "/" and "~" as
	bindings to activate the location entry again.  Fixes bug #340856.
	(tree_view_keybinding_cb): Likewise.
	(trap_activate_cb): Likewise.
	(location_popup_handler): Handle the "path" argument again; set it
	as the text on the location entry.
	(location_set_user_text): New helper function.
	(load_setup_timer): Fix comment.

	* tests/autotestfilechooser.c (main): Oops, enable all the tests again.

2006-08-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmodules.c (find_module): Revert the local binding
	change to avoid a11y regressions in current OpenOffice.org
	releases. The G_MODULE_BIND_LOCAL will be reintroduced 
	in 2.12.

2006-08-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktrayicon-x11.c: Fix the ClientMessages we are
	sending to the notification area to be more in sync with
	the systray spec.  (#350860, Wincent Untz)

	* btk/btkprintoperation.c (print_pages, preview_ready): Queue
	printing idles at a low priority.  (#348289, Yevgen Muntyan)

	* btk/btkstatusicon.c (btk_status_icon_get_geometry): Add some
	caveats to the documentation.  (#348971)

Thu Aug 17 16:19:35 2006  Tim Janik  <timj@imendio.com>

	* docs/tutorial/btk-tut.sgml: fixed buglet from #351759.

2006-08-17  Tor Lillqvist  <tml@novell.com>

	* btk/Makefile.am (libbtk_win32_2_0_la_LIBADD): Link with -luuid
	for IID_IUnknown that btkprintoperation-win32.o needs.

2006-08-17  Matthias Clasen  <mclasen@redhat.com>

	* modules/printbackends/file/btkprintbackendfile.c: Improve
	the handling of the default output filename, to ensure
	that we default to output.ps when only PostScript output
	is possible.  (#348236, Don Scorgie)

	* btk/btkprintunixdialog.c (btk_print_unix_dialog_set_manual_capabilities): 
	Re-select the current printer to update per-printer ui. 
	(#348245, Don Scorgie)

	* btk/btkfilechooserbutton.c (set_info_get_info_cb) 
	(model_add_special_get_info_cb): Handle the case where the
	filechooser button is destroyed quickly.

2006-08-17  Paolo Borelli  <pborelli@katamail.com>

	* btk/btktextbuffer.c: make sure the has-selection property is
	updated when the delection is deleted. Bug #329752
	* tests/testtext.c: add a copy menu item and show how to
	update its sensitivity tracking the has-selection property.

2006-08-17  Michael Emmel  <mike.emmel@gmail.com>

	* configure.in:
	Changed  to use bairo-directfb.pc bug #351519

2006-08-17  Kristian Rietveld  <kris@btk.org>

	* demos/btk-demo/main.c (window_closed_cb), (row_activated_cb),
	(create_tree): move the ITALIC_COLUMN over to a STYLE_COLUMN
	which sets the style attribute.  Makes drawing the active demos
	in italic work again.

2006-08-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreemodel.c (btk_tree_model_base_init): Add some
	docs to the row-deleted signal.  (#349128, Benedikt Meurer)

	* btk/btkiconview.c: Update background upon style-set and
	state-changed.  (#348634, Thomas Rydzynski)

	* btk/btkentry.c (paste_received): Popup completion if paste
	is at the end (patch was already in 2.8.x).  (#165714, 
	Christian Persch)

	* btk/btknotebook.c (btk_notebook_set_current_page): Explain
	some quirks of this function.  (#351112)

2006-08-16  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action):
	take the cell spacing into account when calculating the available
	extra space. (#350938, patch from Peter Johanson).

2006-08-16  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_fetch_child):
	update the refs from children to parents for all nodes, since
	they may all have been moved by the insert operation. (#346800,
	patch from Jonathan Matthew).

2006-08-15  Matthias Clasen <mclasen@redhat.com>

	* btk/btkrecentfilter.c (btk_recent_filter_filter):
	* btk/btkrecentmanager.c (btk_recent_manager_lookup_item):
	Add Since tags.  (#351581, Brian Cameron)

2006-08-15  Michael Emmel  <mike.emmel@gmail.com>

	* configure.in  
	Added bairo flag patch to fix directfb build from bug #351519

2006-08-15  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkevents-quartz.c: (get_event_mask_from_ns_event): 
	Add BDK button mask for NS dragging events.
	(create_scroll_event): Remove obsolete comment.
	(_bdk_quartz_get_current_event_mask), (bdk_event_translate): Keep
	track of the latest event mask here...

	* bdk/quartz/bdkwindow-quartz.c: 
	(_bdk_windowing_window_get_pointer): And use it here. Patch from
	Kristian Rietveld.
	(bdk_window_quartz_update_idle): Rename to make things clearer.

2006-08-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperationpreview.c: 
	* btk/btkprintoperation.c (btk_print_operation_class_init): Add
	more docs.

	* btk/btkaboutdialog.c (btk_about_dialog_init): Set CAN_DEFAULT
	on all buttons.  (#168737, fix proposed by Benjamin Berg)

	* btk/btkentryprivate.h: 
	* btk/btkentry.c (_btk_entry_effective_inner_border): Export 
	privately. Adjust all callers.

	* btk/btkspinbutton.c (btk_spin_button_size_request): Use it
	here to get the actual inner border.  (#349429, Benjamin Berg)

	* btk/btkfilechooserentry.c (struct _BtkFileChooserEntry): Don't
	store GSource pointers, but ids.
	(btk_file_chooser_entry_dispose): Remove idles.
	(idle_add, idle_add): Factor this out.
	(btk_file_chooser_entry_maybe_update_directory): 
	(add_completion_idle): And use it here. (#350039, Chris Wilson)

	* btk/btkicontheme.c (do_theme_change): Run the reset_styles
	idle at a priority higher than size negotiation.  (#350517,
	SÃ¸ren Sandmann)
	
	* btk/btkfilesystem.c (btk_file_info_render_icon) 
	(btk_file_system_volume_render_icon): Do better fallbacks
	if the icon theme does not have icons.  (#345666,
	Kazuki Iwamoto)

	* btk/btkruler.c (btk_ruler_unrealize): Don't leak
	no_gr_exp_gc.  (#350050, Chris Wilson)

	* bdk/x11/bdkdrawable-x11.c (get_shm_pixmap_for_image): Don't
	leak ShmPixmapInfo.  (#349858, Chris Wilson)

	* btk/Makefile.am (BTK_PRINT_PREVIEW_COMMAND): Call evince
	with the --preview option.  (#350139, Carlos Garcia Campos)

	* modules/printbackends/cups/btkprintbackendcups.c (create_pickone_option): 
	Simplify, make it build against cups 1.1.  (#350329)	

	* btk/btkliststore.c (btk_list_store_insert_with_values): 
	Fix a typo in the docs.  (#349501, Carlos GUSLiBu)

	* btk/btkcolorsel.c (palette_paint): Remove a leftover
	debug statement. (#350072, Iago Rubio)

	* btk/btktextbufferserialize.c (check_id_or_name): Fix
	warning text.  (#349277)

	* btk/btknotebook.c (btk_notebook_enter_notify): Remove.
	(btk_notebook_motion_notify): Instead, update the arrow
	state here.  (#349570, Benjamin Otte)

	* bdk/x11/bdkwindow-x11.c (bdk_window_get_geometry_hints):
	Use XAllocSizeHints to allocate the XSizeHints struct.
	(#249285, David Baron)

	* bdk/x11/bdkdnd-x11.c (bdk_window_register_dnd):
	* bdk/x11/bdkwindow-x11.c (bdk_window_set_decorations):
	(bdk_window_set_functions): Zero out some stack-allocated
	X structures, to avoid valgrind warnings about uninitialized
	memory.  (#349382, David Baron)

2006-08-14  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchooser.c:
	(btk_recent_chooser_add_filter),
	(btk_recent_chooser_remove_filter),
	(btk_recent_chooser_set_filter): Add a check on the
	filter argument, instead of blindly passing it to
	underlying implementation.

	* btk/btkrecentchoosermenu.c:
	(btk_recent_chooser_menu_add_filter),
	(btk_recent_chooser_menu_remove_filter),
	(btk_recent_chooser_menu_list_filters): Implement
	these BtkRecentChooser methods, by setting and
	returning the only BtkRecentFilter object supported
	by a BtkRecentChooserMenu. (#347856, reported by Rod
	Butcher)

2006-08-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_remove): Null the
	cell_view pointer if the internal cell view is removed. 
	(#348828, Rolando Espinoza La Fuente)

	* btk/btkentry.c (btk_entry_drag_data_received): Don't leak
	in the non-editable case.  (#350258, Colin Leroy)

2006-08-10  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkdrawable-directfb.c
	Remove bdk_directfb_update_rebunnyion and calls 
	* bdk/directfb/bdkwindow-directfb.c
	Code cleanup 
	* bdk/directfb/bdkgeometry-directfb.c
	Fix scroll call to use rebunnyion

2006-08-10  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchoosermenu.c:
	(btk_recent_chooser_menu_finalize): Remove the idle
	source in ::finalize...
	
	(idle_populate_func),
	(idle_populate_clean_up): ...and reset the idle source
	id at the end of the idle loop while we hold the BDK mutex
	lock. (#350605, reported by Wouter Bolsterlee, patch by
	Chris Wilson)

2006-08-10  Michael Natterer  <mitch@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c
	(bdk_window_maximize)
	(bdk_window_unmaximize)
	(bdk_window_iconify)
	(bdk_window_deiconify): don't try to set the state of unmapped
	windows, call bdk_synthesize_window_state() instead. Also added
	autorelease pools back, seems they are needed after all.

	* bdk/quartz/bdkwindow-quartz.c (show_window_internal): maximize
	and iconify windows here if the state says so.

2006-08-09  Michael Natterer  <mitch@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c (bdk_window_set_geometry_hints):
	implement MIN_SIZE, MAX_SIZE and RESIZE_INC.

2006-08-08  Richard Hult  <richard@imendio.com>

	* btk/btkdnd-quartz.c: Implement get/set_track_motion.
	
2006-08-08  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkevents-quartz.c: (poll_func): Whitespace cleanup.	 
	(synthesize_crossing_events): Add comments and prevent a crash.

2006-08-08  Michael Natterer  <mitch@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c
	(bdk_window_maximize)
	(bdk_window_unmaximize): implement.

	(bdk_window_iconify)
	(bdk_window_deiconify): remove unneeded autorelease pools.

2006-08-08  Richard Hult  <richard@imendio.com>

	* bdk/quartz/BdkQuartzView.c: Just expose the minimal rebunnyion 
	instead of the whole rect.

	* bdk/quartz/bdkwindow-quartz.c:
	(bdk_window_quartz_process_all_updates), (bdk_window_update_idle),
	(bdk_window_impl_quartz_invalidate_maybe_recurse),
	(bdk_window_impl_quartz_process_updates),
	(_bdk_windowing_window_destroy): Rework the expose handling so that
	it works like the X11 backend, using an idle with the right
	priority instead of relying on quartz to do it.
	(bdk_window_set_type_hint): Use tornoff instead of submenu as the
	documentation (and Mitch) suggests.

2006-08-08  Michael Natterer  <mitch@imendio.com>

	* bdk/quartz/bdkdrawable-quartz.c: some whitespace and indentation
	cleanup.

	(bdk_quartz_draw_rectangle)
	(bdk_quartz_draw_arc)
	(bdk_quartz_draw_polygon)
	(bdk_quartz_draw_points): for pixel-prefect drawing, stroked
	coordinates need to go through pixel centers, while filled ones
	need to go along pixel boundaries. Moved +0.5 adjusting to the
	if(!filled) branches and added/removed some adjustments where they
	were wrong.

2006-08-07  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkdrawable-quartz.c (bdk_quartz_draw_points): Don't
	get and release the context for each point, just once, speeds up
	drawing many points a lot.

2006-08-07  Michael Natterer  <mitch@imendio.com>

	* btk/btkdnd-quartz.c (btk_drag_dest_unset): need to disconnect
	from signals connected in btk_drag_dest_set() here.

	* btk/btkdnd-quartz.c (btk_drag_dest_set): call btk_drag_dest_unset()
	instead of disconnecting the old signal connections here.

2006-08-07  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchooserdefault.c:
	(_btk_recent_chooser_default_init): Show non existing
	resources by default.
	(recent_meta_data_func): Do not mark non existing
	resources as insensitive.

	* btk/btkrecentchoosermenu.c:
	(btk_recent_chooser_menu_init): Show non existing
	resources by default.
	(btk_recent_chooser_menu_create_item): Do not mark
	non existing resources as insensitive.

2006-08-06  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkkeys-x11.c (bdk_keymap_x11_finalize): Free
	all XKB data. (#349997, Chris Wilson)

	* btk/btkstyle.c (option_menu_get_props): Only get the
	indicator-size and indicator-spacing style properties
	for BtkOptionMenu.  (#349859, Benjamin Otte)

	* btk/btktreeview.c (btk_tree_view_set_grid_lines) 
	(btk_tree_view_set_enable_tree_lines): Be more careful
	when creating gcs, also emit change notification.
	(btk_tree_view_unrealize): Free the gcs here.  (#349834,
	Chris Wilson)

	* btk/btkcalendar.c (calendar_start_spinning, calendar_timer): 
	Use G_PRIORITY_DEFAULT_IDLE for the month/year-change timer,
	so that the caller will have a chance to redraw/resize itself
	between every change.  (#348824, Federico Mena Quintero, patch
	by Michael Meeks)
	
	* btk/btkfontbutton.c (btk_font_button_update_font_info): 
	Add a missing initialization.  (#348787, Leonardo Boshell)
	
	* configure.in: Use $PKG_CONFIG consistently.  (#348740,
	Jeremy LainÃ©)
	
	* btk/btknotebook.c (btk_notebook_drag_motion): Don't allow
	dragging a notebook tab to one of its children.  (#348626,
	Benjamin Otte)
	(btk_notebook_drag_motion): Don't accept drops on 
	arrows.  (#348706, Benjamin Otte)

	* tests/testnotebookdnd.c: Test more corner cases.

2006-08-05  Matthias Clasen  <mclasen@redhat.com>

	* docs/tutorial/btk-tut.sgml: Remove outdated lists of
	authors and maintainers.  (#348538, Owen Taylor)

	* btk/btkentry.c:
	* btk/btkentryprivate.h: Export btk_entry_reset_im_context
	privately.
	
	* btk/btkentrycompletion.c (btk_entry_completion_action_button_press): 
	* btk/btkentry.c (btk_entry_completion_key_press): Reset the
	entry's im context here.  (#348478, Nguyen Thai Ngoc Duy, Christian
	Persch) 

	* btk/btktextview.c (btk_text_view_style_set): Create new
	BangoContexts and set them on the layout, to catch changes in
	font options.  (#348278, Behdad Esfahbod)

	* btk/btkstyle.c (btk_default_draw_flat_box): Add a 
	missing initialization.  (#349863, Benjamin Berg)

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_layout_reorder): 
	Protect against tree_view being NULL.  (#348652, Patrick K. O'Brian,
	Chris Wilson)

2006-08-03  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchoosermenu.c:
	(set_recent_managet), (btk_recent_chooser_menu_populate),
	(idle_populate_func), (idle_populate_clean_up),
	(manager_changed_cb): Lazily populate the menu when creating
	it and after the manager emits the "changed" signal; this
	fixes the initial bad placing of the BtkRecentChooserMenu
	widget when its set as the menu of a BtkMenuToolButton.

	(btk_recent_chooser_menu_map),
	(btk_recent_chooser_menu_class_init): Remove the ::map method
	override, since it's not needed anymore.

2006-08-03  Michael Natterer  <mitch@imendio.com>

	* btk/btkrc.c (btk_rc_parse_assignment): reset scanner config to
	default values while checking if an expression(foobar) follows,
	because if no expression follows the scanner's "next token" must
	be usable for the caller of this function (fixes bug #349552).

2006-08-03  Michael Natterer  <mitch@imendio.com>

	* btk/btkstyle.c: removed the "widget &&" part from
	"widget && BTK_IS_FOO (widget)" checks.

2006-07-13  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkwindow-directfb.c
	Remove unused call to GetPosition 

2006-07-31  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkdrawable-quartz.c: (bdk_quartz_draw_drawable):
	* bdk/quartz/bdkwindow-quartz.c:
	(bdk_window_impl_quartz_begin_paint_rebunnyion): Patch from Erik van
	Pienbroek to implement drawing bg_pixmaps (#348145).

2006-07-29  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkcolor-quartz.c (bdk_colormap_alloc_colors): Always
	set success to TRUE.
	(bdk_color_change): Implement.

	* bdk/quartz/BdkQuartzWindow.c
	([BdkQuartzWindow -canBecomeKeyWindow]): Add comment.

	* bdk/quartz/bdkevents-quartz.c (bdk_screen_get_setting): Make the
	default font a bit smaller until we have made this get the system
	setting.

	* bdk/quartz/bdkwindow-quartz.c (bdk_window_set_type_hint): Enable
	shadows for the right window types.

	* bdk/quartz/bdkprivate-quartz.h:
	* bdk/quartz/bdkgc-quartz.c:
	* bdk/quartz/bdkdrawable-quartz.c:
	* bdk/quartz/bdkcolor-quartz.c: Expose the CGContext functions,
	update callers.

	* bdk/quartz/bdkmain-quartz.c: (_bdk_windowing_init): No need to
	get the current process ID, use the right constant instead.

2006-07-28  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentmanager.c (btk_recent_manager_init): Add the
	timeout for polling the file; change the default polling
	delta to 2000 msec.

2006-07-27  Michael Natterer  <mitch@imendio.com>

	* bdk/x11/bdkwindow-x11.c (bdk_window_get_type_hint): cast the
	return value of XGetWindowProperty() correctly so we don't return
	garbage type hints. Pointed out by Tommi Komulainen, patch taken
	from https://maemo.org/bugzilla/show_bug.cgi?id=724

2006-07-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksettings.c (btk_settings_finalize): Move the
	_btk_rc_context_destroy call to the right spot.  (#348096,
	Chris Wilson)

2006-07-24  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkevents-quartz.c (bdk_screen_get_setting): Implement
	getting the double click threshold.

2006-07-24  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c (bdk_window_set_type_hint): Set the
	window level depending on the type hint.

	* bdk/quartz/bdkevents-quartz.c (bdk_keyboard_grab,
	pointer_ungrab_internal): Only break the grab if the new window is
	a different one.
	(bdk_event_translate): Catch the case where the entire app loses 
	focus and break any grabs. Only do implicit grabs when the event
	mask has both press and release.

	* bdk/quartz/bdkkeys-quartz.c (translate_keysym):
	* bdk/quartz/bdkselection-quartz.c:

        * bdk/quartz/BdkQuartzWindow.c
	([BdkQuartzWindow -windowDidResignKey:]): Use this to update the
	focus window instead of resignMain, fixes the case where other apps
	uses focus follows mouse (like the terminal can).

2006-07-23  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version
	
	* === Released 2.10.1 ===

	*  NEWS: Updates

	* btk/btkstyle.c (btk_default_draw_box_gap): Draw
	gaps on the left/right properly.  (#348134, Benjamin Otte)

	* btk/btkprintsettings.c (btk_print_settings_get_page_ranges):
	Fix a memory leak.  (#348424, Carlos Garcia Campos)

2006-07-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrc.h:
	* btk/btkrc.c (_btk_rc_context_destroy): New function to
	destroy an rc context.

	* btk/btksettings.c (btk_settings_finalize): Destroy the rc context.
	(btk_settings_get_for_screen): Unref the settings when the screen
	goes away. (#348096, Chris Wilson)

2006-07-21  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkgc-quartz.c: (bdk_quartz_gc_get_values),
	(bdk_quartz_gc_set_values), (_bdk_windowing_gc_copy),
	(bdk_gc_get_screen): Implement.

	* bdk/quartz/bdkwindow-quartz.c: (bdk_window_set_back_pixmap):
	Implement.

2006-07-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkimcontextsimple.c (btk_im_context_simple_get_preedit_string): 
	0-terminate outbuf in all cases.  (#348227, Nguyen ThÃ¡i Ngoc Duy)

2006-07-21  Michael Natterer  <mitch@imendio.com>

	Enable symbolic colors and color expressions in style
	properties. Fixes bug #346751.

	* btk/btkrc.c (rc_parse_token_or_compound): add BtkRcStyle
	parameter and replace symbolic colors by color constants.

	(btk_rc_parse_assignment): likewise. Also support parsing of
	expressions of the form identifier(compound).

	(btk_rc_parse_style): pass the BtkRcStyle to
	btk_rc_parse_assignment().

	(btk_rc_parse_statement): pass NULL since we don't have a
	BtkRcStyle here.

2006-07-21  Michael Natterer  <mitch@imendio.com>

	* btk/btkentrycompletion.c (btk_entry_completion_finalize):
	remove accidential 2nd parameter to g_object_unref().

2006-07-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c (btk_entry_completion_finalize):
	Don't leak the action_view.  (#348120, Chris Wilson)

	* btk/btknotebook.c (btk_notebook_paint): Improve drawing
	of tabs while reordering.  (#348115, Benjamin Otte)

	* btk/btkiconview.c (btk_icon_view_destroy): Don't
	leak the adjustments.  (#348094, Chris Wilson)

	* btk/btknotebook.c (btk_notebook_stop_reorder): Unset
	the during_reorder flag.  (#348049, Sven Herzberg, patch
	by Benjamin Otte)

2006-07-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmenu.c (btk_menu_destroy): Just remove the scroll
	timeout here, don't access settings.  (#348095, Chris Wilson)

	* btk/btktextlayout.c (btk_text_layout_set_contexts): Fix
	messed up refcounting.  (#348090, Chris Wilson)

	* btk/btkicontheme.h: 
	* btk/btkicontheme.c (_btk_icon_theme_ensure_builtin_cache): 
	Export this privately.

	* btk/btkiconfactory.c (render_fallback_image): And call it
	here to initialize the builtin cache before using it.  (#348063,
	Diego PettenÃ²)

2006-07-19  Federico Mena Quintero  <federico@novell.com>

	* tests/autotestfilechooser.c (test_black_box): Argh, initialize
	"passed"!
	(set_filename_timeout_cb): Renamed from timeout_cb().
	(test_confirm_overwrite): New function, test confirmation before
	overwriting a file in SAVE mode.

2006-07-20  Michael Natterer  <mitch@imendio.com>

	* btk/btkrecentchoosermenu.c (btk_recent_chooser_menu_finalize):
	fix typo to make it compile again.

2006-07-20  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchoosermenu.c:
	(btk_recent_chooser_menu_finalize): Correctly chain up the
	finalization vfunc. (#348089, Chris Wilson)

2006-07-20  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkevents-quartz.c: (generate_grab_broken_event):
	Append the event to the queue instead of using bdk_event_put.
	(_bdk_quartz_get_mouse_window, find_current_keyboard_window):
	Handle grabs.
	(get_event_mask_from_ns_event, create_focus_event)
	(convert_window_coordinates_to_root, find_window_for_event)
	(bdk_event_translate): Improve readability (style changes).
	(bdk_flush, bdk_display_sync, bdk_display_flush)
	(bdk_event_send_client_message_for_display),
	(bdk_screen_broadcast_client_message): Remove FIXMEs.	
	(bdk_screen_get_setting): Reindent.
	Also move find_child_window_by_point to bdkwindow-quartz.c.
	
	* bdk/quartz/bdkwindow-quartz.c:
	(find_child_window_by_point_helper),
	(_bdk_quartz_find_child_window_by_point): Move here from 
	bdkevents-quartz.c
	(_bdk_windowing_window_get_pointer): Handle destroyed windows and
	imlement the return value.
	(_bdk_windowing_window_at_pointer): Implement.

2006-07-19  Richard Hult  <richard@imendio.com>

	* btk/btkdnd-quartz.c (register_types): Reindent.
	
	* btk/btkclipboard-quartz.c (btk_clipboard_set_contents): Add
	autorelease pool.

2006-07-19  Richard Hult  <richard@imendio.com>

	* bdk/quartz/BdkQuartzWindow.c
	([BdkQuartzWindow -windowDidResignMain:]):
	* bdk/quartz/bdkevents-quartz.c (_bdk_quartz_update_focus_window):
	Listen to windowDidResignMain notifications and properly update the
	focus window when windows are unfocused.

2006-07-19  Kristian Rietveld  <kris@imendio.com>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_init),
	(btk_cell_renderer_text_[gs]et_property), (get_layout): add
	align_set field to keep track whether the align property was
	set by the user, if not we will use the alignment by looking
	at the direction of the widget. (#157439)

2006-07-19  Matthias Clasen  <mclasen@redhat.com>

	* modules/printbackends/file/btkprintbackendfile.c 
	(file_printer_get_settings_from_options): Check if option
	is NULL before using it.  (#348014, Christian Persch)

	* bdk/x11/bdkx.h (bdk_font_lookup_for_display): When looking
	up a font XID, add the XID_FONT_BIT.  (#348001)

2006-07-19  Richard Hult  <richard@imendio.com>

	* bdk/quartz/BdkQuartzView.c ([BdkQuartzView -drawRect:]):
	* bdk/quartz/bdkpixmap-quartz.c (bdk_pixmap_new): Remove unused
	variables to fix compiler warnings.

2006-07-19  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c (bdk_window_impl_quartz_init)
	(bdk_window_set_type_hint, bdk_window_get_type_hint):
	* bdk/quartz/BdkQuartzWindow.c
	([BdkQuartzWindow -canBecomeMainWindow])
	([BdkQuartzWindow -canBecomeKeyWindow]): Implement type hints and
	use them to determine which windows should be allowed to become
	main and key windows.

2006-07-19  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c:
	(_bdk_windowing_window_get_pointer): Get the position correctly
	for the root window. Fixes bug #347976, patch by Dave Vasilevsky.

2006-07-18  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Updates

	* btk/btkdnd.c: Make the ipc widgets BtkWindows instead
	of BtkInvisibles, and put them in the same window group
	as the drag source, to avoid interactions between DND
	and window groups.  (#347277, Michael Wu, analysis by
	Owen Taylor)

2006-07-18  John (J5) Palmieri  <johnp@redhat.com>

	* modules/printbackends/cups/btkprintbackendcups.c:
	Make bits from my last commit are conditionally compiled
	only if cups 1.2 is available. 

2006-07-18  John (J5) Palmieri  <johnp@redhat.com>

	* btk/btkprinteroption.h:
	* btk/btkprinteroptionwidget.c:
	* modules/printbackends/cups/btkprintbackendcups.c:
	add BTK_PRINTER_OPTION_TYPE_PICKONE_PASSWORD,
	BTK_PRINTER_OPTION_TYPE_PICKONE_PASSCODE,
	BTK_PRINTER_OPTION_TYPE_PICKONE_REAL,
	BTK_PRINTER_OPTION_TYPE_PICKONE_INT,
	and BTK_PRINTER_OPTION_TYPE_PICKONE_STRING options to support a subset
	of the new CUPS 1.2 custom options spec

2006-07-18  Federico Mena Quintero  <federico@novell.com>

	Fix https://bugzilla.novell.com/show_bug.cgi?id=184875 - make the
	location entry in Save mode preserve the stuff from
	set_filename(); it was overwriting it with $cwd.

	This is the same fix for
	http://bugzilla.bunny.org/show_bug.cgi?id=347066

	* tests/autotestfilechooser.c: (test_black_box): Added black-box
	test for set_filename() and set_current_name().

	* btk/btkfilechooser.c (btk_file_chooser_get_type): Cast to
	GClassInitFunc in the call to g_type_register_static_simple(), to
	avoid a compiler warning.

	* btk/btkfilechooserprivate.h (struct _BtkFileChooserDefault):
	Added a browse_files_last_selected_name field.  We'll copy the
	logic from btkfilesel.c to see when to clear the location entry.
	(struct _BtkFileChooserDefault): Removed the
	processing_pending_selections field.

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_finalize):
	Free impl->browse_files_last_selected_name.
	(pending_select_paths_process): Don't use
	impl->processing_pending_selections.
	(update_chooser_entry): Keep track of the name that was last
	selected in the file list.  We use this to know when to clear the
	location entry.  The logic is similar to that of
	btkfilesel.c:btk_file_selection_file_changed().  This also lets us
	get rid of the processing_pending_selections flag.
	(update_chooser_entry): Clear the entry if we didn't have a
	selection before.
	(location_switch_to_filename_entry): Do not set $cwd as the
	contents of the location entry here...
	(location_popup_handler): ... but do it here instead, only as the
	result of the user asking to turn on the location entry.
	(btk_file_chooser_default_get_paths): If the location entry is
	empty, do the fallback of seeing if it is sensible to say that
	$cwd is the selected path.
	(btk_file_chooser_default_update_current_folder): Don't set the
	text of the location entry; this is no longer needed with the
	fixes above.
	(shortcuts_activate_iter): Clear the location entry when
	activating a shortcut if we are not in SAVE mode.  This keeps the
	contents of the location entry consistent even when switching
	folders via the shortcuts.

2006-07-18  Michael Natterer  <mitch@imendio.com>

	* btk/btkrange.c: remember the sensitivity of the steppers in
	BtkRangeLayout, update it in btk_range_calc_layout() and check for
	changes in layout_changed(), so adjustment changes that leave the
	slider position unchanged are still able to update the steppers'
	sensitivity. Fixes bug #347902.

2006-07-18  Kristian Rietveld  <kris@imendio.com>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_start_editing):
	oooops.

2006-07-18  Kristian Rietveld  <kris@imendio.com>

	Fix for #335012, reported by Matteo Nastasi.

	* btk/btktreeview.c (btk_tree_view_real_start_editing): if the
	requested space of the editable is smaller than the cell area,
	put it up above the middle of the cell area.

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_start_editing):
	configure the inner border to cover the cell area if the 
	entry requisition is smaller than the cell_area.

2006-07-18  Kristian Rietveld  <kris@imendio.com>

	Another fix for #164884.

	* btk/btktreeprivate.h: add in_grab field.

	* btk/btktreeview.c (btk_tree_view_button_press): only save press
	to possibly begin a drag when there's no grab pending,
	(btk_tree_view_grab_notify): toggle in_grab field.

2006-07-18  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreeview.c (btk_tree_view_realize): use MAX
	priv->width, alloc.width when allocating the bin_window,
	(btk_tree_view_bin_expose): don't overrun bin_window when drawing
	the flat box.

2006-07-17  Richard Hult  <richard@imendio.com>

	* btk/btkdnd-quartz.c: (btk_drag_begin_internal): Set an empty
	NSImage if there is none, covers the cases where applications try
	to set a pixmap which is not supported by the quartz backend.

2006-07-17  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkevents-quartz.c: (create_key_event):
	* bdk/quartz/bdkkeys-quartz.c: (_bdk_quartz_key_event_type),
	(_bdk_quartz_key_is_modifier):
	* bdk/quartz/bdkprivate-quartz.h: Fill in string, length and
	is_modifier for key events. Map some more keys into bdk keyvals.

2006-07-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c (btk_notebook_stop_reorder): Don't undo
	reordering if we haven't been reordering.  (#346836, Ed Catmur)

2006-07-17  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkkeys-quartz.c: Add escape to the list of special
	keys, to get the escape key working.

2006-07-17  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkdisplay-quartz.c (bdk_display_open): Initialize
	BdkInput.
	
2006-07-17  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreeview.c (btk_tree_view_build_tree): check if the iter
	still has children after running the test-expand-row func,
	(btk_tree_view_real_expand_row): ditto. (#302127, Billy Biggs).

2006-07-17  Michael Natterer  <mitch@imendio.com>

	* btk/btkcalendar.c (calendar_timer): use 5 * btk-timeout-repeat,
	just as many other widgets. Makes the calendar arrow buttons
	usable for quick month/year skipping (#142582).

2006-07-17  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c:
	(_bdk_windowing_window_destroy_foreign): Fix comment.
	(bdk_window_set_title): Surround by release pool macros.
	(bdk_window_get_type_hint): Fix return value.
	(bdk_window_get_frame_extents): Implement.
	(bdk_window_iconify): Use the release pool macros.
	(bdk_window_deiconify): Likewise. 
	(_bdk_windowing_get_pointer): Implement.
	(bdk_window_get_deskrelative_origin, bdk_window_get_root_origin): 
	Implement.

	* bdk/quartz/bdkevents-quartz.c (create_crossing_event) 
	(create_scroll_event, convert_window_coordinates_to_root): 
	Set coordinates and root coordinates for crossing and scroll 
	events.

	* bdk/quartz/bdkcursor-quartz.c (bdk_cursor_new_for_display): 
	Map some more cursors.

2006-07-17  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkwindow.c (bdk_window_get_pointer): Add some more
	detail to the docs.  (#311399, Nikos Kouremenos)

	* btk/btkentrycompletion.c (btk_entry_completion_set_match_func): 
	* btk/btkcomboboxentry.c (btk_combo_box_entry_set_text_column): 
	Fix typos in the docs.

2006-07-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkassistant.c: Some small documentation
	fixups.  (#347711, Guillaume Cottenceau)

	* btk/btkfilechooserdefault.c (browse_widgets_create): Mark
	the text of the location label as translatable.  

	* btk/btkprintjob.c (btk_print_job_send): Fix a typo in 
	the docs.  (#347211, Kouhei Sutou)   

	* configure.in: Make the test for the sync extension
	more robust.  (#347315, Tommi Komulainen)

2006-07-13  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkdrawable-directfb.c
	Remove +1 in fill and draw rect this may be wrong.
	Commented out update calls left for reference the should not be needed.
	Comment out subsurface for bairo remove when proved its not needed
	* bdk/directfb/bdkkeys-directfb.c
	Allow multiple calls and return if initalized
	* bdk/directfb/bdkmain-directfb.c
	Make sure string is malloced since its freed by apps
	* bdk/directfb/bdkprivate-directfb.c
	Added back pointer to window for paintable impl
	* bdk/directfb/bdkvisual-directfb.c
	Fix for Bug 346733 make sure visual list is populated
	* bdk/directfb/bdkwindow-directfb.c
	Finally removed uneeded pixmap buffering now implements BdkPainter

2006-07-11  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchooser.c (btk_recent_chooser_set_show_numbers),
	(btk_recent_chooser_get_show_numbers): Check if the chooser
	implementation supports the "show-number" property and use a
	meaningful warning in case it doesn't; tell developers not to
	use these functions.

2006-07-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaction.c:
	* btk/btkiconview.c:
	* btk/btkprintbackend.c:
	* btk/btkprintoperation-unix.c:
	* btk/btkscrolledwindow.c:
	* btk/btktoolbar.c: Fix some typos with inline property
	docs.  (#347065, John Finlay)

	* btk/btkfilechooserbutton.c: Fix some memory handling
	issues.  (#347043, Chris Wilson)

2006-07-10  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchooserdefault.c (scan_for_uri_cb): Do not
	leak the URI returned by the model; select the row when
	calling btk_recent_chooser_set_current_uri(). (patch by
	Torsten Schoenfeld)

2006-07-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpapersize.c (btk_paper_size_is_equal): Fix a 
	typo in the docs.  (#347041, Kouhei Sutou)

	* btk/btkprintcontext.c (btk_print_context_get_height): Fix
	a typo in the docs.  (#347032, Kouhei Sutou)

	* btk/btkassistant.c (btk_assistant_focus): Don't assume
	that priv->current_page is non-NULL.  (#347048, Guillaume 
	Cottenceau)

	* btk/btk.symbols: Add some missing deprecation guards.

	* bdk/directfb/bdkwindow-directfb.c: Don't confuse btk-doc.

2006-07-10  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkpixmap-quartz.c: (bdk_bitmap_create_from_data): 
	Account for alignment when reading xbm data. (#346721, patch
	by Dave Vasilevsky)

2006-07-09  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkgeometry-quartz.c:
	* bdk/quartz/bdkmain-quartz.c:
	* bdk/quartz/bdkpixmap-quartz.c:
	* bdk/quartz/bdkwindow-quartz.c:
	* btk/btkclipboard-quartz.c: Implement some more stubs for pybtk, 
	bug #346713.

2006-07-09  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkwindow-quartz.c (bdk_window_new): Release the pool
	in all cases.
	(move_resize_window_internal): Surround by alloc/release pool.
	Patch from Brian Tarricone, fixes bug #347018.

2006-07-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c (update_label_and_image): Don't
	leak an empty list.  (#346970, Chris Wilson)

2006-07-08  Behdad Esfahbod  <behdad@bunny.org>

	* bdk/bdkbango.c (layout_iter_get_line_clip_rebunnyion),
	(bdk_bango_layout_line_get_clip_rebunnyion),
	(bdk_bango_layout_get_clip_rebunnyion): Fix quadratic implementation of
	bdk_bango_layout_get_clip_rebunnyion into a linear one. (#337910, patch
	by Priit Laes)

2006-07-07  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkevents-quartz.c: Generate a grab broken event when
	appropriate. Fixes bug #346603, patch from Dave Vasilevsky.
	
	* bdk/quartz/bdkevents-quartz.c:
	* bdk/quartz/bdkkeys-quartz.c:
	* bdk/quartz/bdkprivate-quartz.c: Another patch from Dave Vasilevsky,
	fixes bug #346605. Makes modifier key events being sent properly.

2006-07-07  Michael Natterer  <mitch@imendio.com>

	* btk/btkrc.c
	* btk/btksettings.c: fix canonicalization of property names which
	was broken after recent constant string cleanup.

2006-07-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c: Small memory savings.

2006-07-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c: Get the display name
	for the home directory.  (#346498, Dennis Cranston,
	patch by Andreas KÃ¶hler)

2006-07-06  Behdad Esfahbod  <behdad@bunny.org>

	* configure.in: Drop required Bango version down to 1.12.0. (#346597)

2006-07-06  John (J5) Palmieri  <johnp@redhat.com>

	* modules/printbackends/cups/btkprintbackendcups.c: 
	(cups_request_printer_list_cb): Get the name of the first printer
	in a class to use when requesting a PPD
	(cups_request_ppd_cb, cups_request_ppd): Fix the parameters of
	the "details-acquired" signal emittion
	(cups_request_ppd): get the ppd name from the cups printer

	* modules/printbackends/cups/btkprintercups.c (btk_printer_cups_get_ppd_name):
	New method for getting the name of the ppd we should request

2006-07-06  Michael Natterer  <mitch@imendio.com>

	* btk/btkrc.c: added a bunch of utility functions to copy
	icon_factories and color_hashes between BtkRcStyles and make sure
	that newly created, duplicated and merged styles have access to
	all icon_factories and color_hashes they need. Fixes bug #346668.

2006-07-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/*.c: Improve the -/_ consistency in signal and
	property names, reducing the amount of near-duplicate strings.

2006-07-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_set_enable_tree_lines): Don't
	leak dash_list.  (#346639, Christian Persch)

	* btk/btkwindow.c (btk_window_unmap, btk_window_set_keep_above) 
	(btk_window_set_keep_below): Fix some assignments involving
	booleans.  (#346467, Christian Persch)

2006-07-03  Matthias Clasen <mclasen@redhat.com>

	* btk/btkgamma.c: Use serialized pixbufs instead of xpms.
	
2006-07-03  Runa Bhattacharjee <runabh@gmail.com>

	* configure.in: Added Bengali India (bn_IN) to ALL_LINGUAS.

2006-06-26  Michael Emmel  <mike.emmel@gmail.com>
	
	* bdk/directfb/bdkdirectfb.h: changed ifdef to compile with api introduced
	in directfb 0.9.25 
	* bdk/directfb/bdkwindow-directfb.c: changed ifdef to 0.9.25 

2006-07-03  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version

2006-07-02  Matthias Clasen  <mclasen@redhat.com>
	
	* === Released 2.10.0 ===

	* btk/btkmenubar.c (window_key_press_handler): Treat
	"" like NULL when parsing the menu-bar-accel setting.	
	* btk/btkmenu.c (btk_menu_key_press): Here too.  
	(#346420, Yevgen Muntyan)

	* configure.in: Require bairo 1.2 and GLib 2.12,
	set version to 2.10

2006-06-30  Matthias Clasen  <mclasen@redhat.com>
	
	* btk/btknotebook.c (btk_notebook_tab_space): Remove
	redundant assignments to page, which may cause NULL
	dereferences.  (#346334, Dave Vasilevsky)

	* demos/btk-demo/editable_cells.c: Portability fix.
	(#346375, Thomas Klausner)

	* NEWS, README.in, INSTALL.in: Updates

	* btk/btktreemodelsort.c (btk_tree_model_sort_finalize):
	Don't leak default_sort_data.  (#346341, Christian Weiske)

	* btk/Makefile.am: Make sure all win32-specific printing
	sources are distributed.  (#346312, Erik van Pienbroek)
	
	* btk/btkprinter.c (btk_enumerate_printers): Always call the
	destroy notify.  (#346027, Christian Persch)

	* btk/btkprintsettings.c (btk_print_settings_get_page_ranges):
	Documentation updates.

	* btk/btkprintunixdialog.c (btk_print_unix_dialog_set_settings):
	Don't leak the ranges.  (#346237, Carolyn MacLeod)

	* btk/btkprintjob.[hc]: Add a PREVIEW capability to hide
	the preview button.  (#346113, Christian Persch)

	* btk/btkprintunixdialog.c (update_dialog_from_capabilities):
	Hide the preview button depending on the capability.

	* btk/btkprintoperation-unix.c: Set the PREVIEW capability.

2006-06-29  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* btk/btkprogress.h: revert last change by Matthias -- it broke the
	build of btkprogressbar.

2006-06-29  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkevents-x11.c (bdk_event_translate): Update the 
	size of the drawable for the root window when the screen size 
	changes.  (#346102, Sven Herzberg)

2006-06-29  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Updates

	* btk/btkprintoperation.c: Clarify docs for the allow-async
	property.  (#346108, Christian Persch)

2006-06-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprinter.c: 
	* btk/btkprintunixdialog.c: 
	* btk/btkprintoperationpreview.c: 
	* btk/btkprintcontext.c (btk_print_context_set_bairo_context): 
	* btk/btklabel.c (btk_label_set_line_wrap_mode): 
	* btk/btkentry.c (btk_entry_new): 	
	* btk/btkprintoperation.c (btk_print_operation_set_custom_tab_label): 
	* btk/btkclipboard.c (btk_clipboard_wait_for_rich_text): Documentation
	additions and fixes.

	* btk/btkaspectframe.h:
	* btk/btkaboutdialog.c:
	* btk/btkcalendar.c:
	* btk/btkinputdialog.c: 
	* btk/btk.symbols: Remove unnecessary includes.
	
	* btk/btkprogress.[hc]: 
	* btk/btkitemfactory.[hc]: Don't unnecessarily use BTK_COMPILATION,
	remove unnecessary includes.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Only select the
	XKB event details we actually care about.  (#346079, Ryan Lortie)

2006-06-27  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_set_model): cancel the
	expand collapse timeout when unsetting the model (Fixes #327164,
	reported by Daichi Kawahata).

2006-06-26  Michael Emmel  <mike.emmel@gmail.com>
	
	* bdk/directfb/bdkdirectfb.h: added ifdef to compile with directfb 0.9.24 
	* bdk/directfb/bdkwindow-directfb.c: ifdef depend on directfb cvs 

2006-06-26  Kristian Rietveld  <kris@btk.org>

	Make the insert and set functions somewhat more convenient.
	(#343841, David Necas).

	* btk/btkliststore.c (btk_list_store_insert_with_values): allow
	a NULL iter,
	(btk_list_store_insert_with_valuesv): likewise.

	* btk/btktreestore.c (btk_tree_store_insert_with_values): ditto,
	(btk_tree_store_insert_with_valuesv): likewise.

2006-06-26  Michael Natterer  <mitch@imendio.com>

	* btk/btktextview.c (btk_text_view_size_allocate): revert "keep
	cursor visible when size changes" since it breaks things (#344874).

2006-06-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_cell_view_menu_item_new): Avoid
	a refcounting leak in the python bindings.  (#344876, Phil Dumont)

2006-06-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprinter.c (btk_enumerate_printers): Make
	this work when the enumeration is stopped early.  (#344074,
	Felipe Heidrich)

2006-06-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c: Update the height as well
	when changing fonts.  (#321393, Billy Biggs)
`
2006-06-23  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "ur" to ALL_LINGUAS.

2006-06-22  Matthias Clasen  <mclasen@redhat.com>

	Fix #345663, reported by Kazuki Iwamoto
	
	* btk/btkaction.c: Include btkiconfactory.h

	* btk/btkactiongroup.c: Include btkicontheme.h

2006-06-22  Michael Natterer  <mitch@imendio.com>

	* btk/btktextview.c (btk_text_view_size_allocate): keep the cursor
	visible when the size changes. Fixes bug #344874.

2006-06-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpintjob.h: Add a note about updating the registration.
	* btk/btkprintjob.c (btk_print_capabilites_get_type): Add missing
	capabilitites. 

	* modules/printbackends/cups/btkprintbackendcups.c: Remove
	an unused variable and make it compile with Cups 1.1.  (#345644,
	Joseph Sacco)

2006-06-21  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version
	
	* === Released 2.9.4 ===

	* modules/printbackends/file/btkprintbackendfile.c: 
	Apply a patch by Christian Persch to support PostScript and PDF
	output.

	* btk/btkprinteroptionwidget.c (radio_changed_cb): Don't free
	the value.

2006-06-21  Matthias Clasen  <mclasen@redhat.com>

	Apply a patch by John Palmieri to use buffered io using
	BUNNYIOChannels, clean up error handling and support Cups 1.2
	api in the printing code.

	* acconfig.h:
	* configure.in: Detect Cups 1.2

	* btk/btkdebug.h:
	* btk/btkmain.c: Add a printing debug key.

	* btk/btkprintbackend.[hc]: Remove the GError parameter from
	btk_print_backend_print_stream, and take a  BUNNYIOChannel instead
	of an fd.

	* btk/btkprinter-private.h:
	* btk/btkprinter.c: Replace the fd parameter of 
	_btk_printer_create_bairo_surface by a BUNNYIOChannel.

	* btk/btkprintjob.[hc]: Remove the GError parameter from
	btk_print_job_send and make it return void.

	* btk/btkprintoperation-unix.c:
	* btk/btkprintjob.c: Adjust callers, add some debugging support.

	* modules/printbackends/Makefile.am: Fix DIST_SUBDIRS.

	* modules/printbackends/cups/Makefile.am:
	* modules/printbackends/lpr/Makefile.am: Add debug CFLAGS.
	
	* modules/printbackends/cups/btkcupsutils.[hc]: 
	* modules/printbackends/cups/btkprintbackendcups.c:
	* modules/printbackends/file/btkprintbackendfile.c:
	* modules/printbackends/lpr/btkprintbackendfile.c: Adapt to
	the BUNNYIOChannel and GError changes, add debug output
	
2006-06-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprinter.c (btk_enumerate_printers): Remove an 
	unused variable.

	* NEWS: Updates

	* btk/btktreeview.c (btk_tree_view_class_init): Fix the registration
	of the grid-lines property  (#345456, Murray Cumming) 
	
2006-06-21  Kristian Rietveld  <kris@imendio.com>

	Allocate space for the grid lines when they are enabled.

	* btk/btktreeview.c (btk_tree_view_bin_expose): make sure the cell
	area does not overlap with the grid lines, also draw the line for
	"the next cell" in the last loop iteration, make sure the cursor falls
	in between the grid lines,
	(validate_row): request extra space for the grid lines.

2006-06-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintbackend.h: 
	* btk/btkprintbackend.c (btk_print_backend_print_stream): Add an
	GError parameter.

	* modules/printbackends/file/btkprintbackendfile.c 
	(btk_print_backend_file_print_stream): 
	* modules/printbackends/lpr/btkprintbackendlpr.c 
	(btk_print_backend_lpr_print_stream): 
	* modules/printbackends/cups/btkprintbackendcups.c 
	(btk_print_backend_cups_print_stream): 
	* btk/btkprintjob.c (btk_print_job_send): Update all callers and
	implementations.

	* modules/printbackends/cups/btkprintbackendcups.c: Remove the
	GError parameter from cups_request_execute(), and various other
	cleanups.

2006-06-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintjob.c (btk_print_job_class_init): Make 
	track-print-status a property.

2006-06-20  Murray Cumming  <murrayc@murrayc.com>

	* btk/btkprintoperation.c: (btk_print_operation_class_init): 
	Correctly register the done signal - it sends an enum, not an int.

2006-06-20  Christian Persch  <chpe@cvs.bunny.org>
	
	* configure.in
	* btk/Makefile.am
	* modules/printbackends/Makefile.am
	A modules/printbackends/file/.cvsignore
	A modules/printbackends/file/Makefile.am
	A modules/printbackends/file/btkprintbackendfile.c
	A modules/printbackends/file/btkprintbackendfile.h
	R modules/printbackends/pdf/*:
	Rename "pdf" backend to "file" backend. Step 2 from bug #339592.

2006-06-20  Christian Persch  <chpe@cvs.bunny.org>

	* btk/btkprinteroptionwidget.c: (filesave_changed_cb),
	(alternative_set), (construct_widgets): Convert input to filename
	encoding and construct an URI from that.
	* btk/btkprintsettings.h: Add OUTPUT_FILE_FORMAT and OUTPUT_URI keys.
	* modules/printbackends/pdf/btkprintbackendpdf.c: Use those defines.
	Step 1 from bug #339592.

2006-06-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintjob.c (btk_print_job_set_source_file): Add to docs.

	Fix handling of stock items without icons in action-based
	ui.  (#342458, Callum McKenzie)
	
	* btk/btkactiongroup.c (btk_action_group_add_actions_full): Set
	the stock id even if there is no icon for it.

	* btk/btkaction.c (connect_proxy): 
	* btk/btktoolbutton.c (btk_tool_button_construct_contents): Only
	construct a stock icon if the stock item has an icon.

2006-06-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_set_column_drag_info): Better 
	fix.

	* btk/btk.symbols: 
	* btk/btkprintsettings.h: 
	* btk/btkprintsettings.c: Remove unused print-to-file setting.

2006-06-20  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btknotebook.c (btk_notebook_stop_reorder): unset the pressed
	button here.
	(btk_notebook_grab_notify): stop reorder when the widget becomes
	shadowed. Fixes bug #335873

2006-06-18  Christian Persch  <chpe@cvs.bunny.org>

	* btk/btkdialog.c: (btk_dialog_class_init): Set default action area
	spacing to HIG-compliant 6px. Bug #345106, follow-up from bug #163850.

2006-06-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_enable_model_drag_dest): 
	Small doc fix.  (#345176, Claudio Saavedra)

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_functions): Update
	the docs. (#345194, Yevgen Muntyan)

2006-06-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_set_grid_lines): Don't leak
	dash_list.
	(btk_tree_view_set_column_drag_info): Don't crash if the 
	column_drop_func says always no.  (#344850, Christian Weiske)
	
	Make transparent tray icons work.  (#320034, based on a 
	patch by Dan Winship)
	
	* btk/btktrayicon-x11.c (btk_tray_icon_init): Make trayicons
	app-paintable and non-double buffered. 

	* btk/btkrc.c (_btk_rc_init): Give tray icons a parent-relative
	background in the default style.

2006-06-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/updateiconcache.c: Marks strings for translation.  (#314278,
	Claudio Saavedra)

	* btk/btkentrycompletion.c (btk_entry_completion_compute_prefix): Don't
	call g_str_has_prefix on a NULL strung.  (#344897, Tommi Komulainen)

	* btk/btkfilechooserdefault.c: 
	Avoid a near-duplicate string and add some
	translator comments.  (#345320, #345321, Hendrik Richter)

2006-06-19  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooser.c (btk_file_chooser_get_current_folder)
	(btk_file_chooser_get_current_folder_uri): Clarify the use of
	these functions, to avoid the case where a chooser is in
	SELECT_FOLDER mode and people mistakenly use _get_current_folder()
	to get the selection:  they should use _get_filename() instead.

2006-06-19  Alexander Larsson  <alexl@redhat.com>

	* btk/btk.symbols:
	* btk/btklabel.[ch]:
	Add btk_label_set_line_wrap_mode, btk_label_get_line_wrap_mode, and
	a wrap-mode property that lets you set the BangoWrapMode.

2006-06-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols: Add new functions

	* btk/btkprinter.h: 
	* btk/btkprinter.c (btk_enumerate_printers): New function
	to list all printers (#344074, Felipe Heidrich)

	* btk/btkprinter-private.h: 
	* btk/btkprinter.c (_btk_printer_get_options) 

	* btk/btkprintbackend.h: Add a capabilities argument to the 
	printer_get_options method and to the _btk_printer_get_options
	function
	
	* modules/printbackends/lpr/btkprintbackendlpr.c 
	(lpr_printer_get_options): 
	* modules/printbackends/pdf/btkprintbackendpdf.c 
	(pdf_printer_get_options): 
	* modules/printbackends/cups/btkprintbackendcups.c 
	(cups_printer_get_options): 
	* btk/btkprintunixdialog.c (selected_printer_changed): Adjust
	callers and implementations.

	* btk/btkprintjob.h: Add a GENERATE_PS capability. 
	* btk/btkprintunixdialog.c (is_printer_active): And use it here.

2006-06-18  Matthias Clasen  <mclasen@redhat.com>

	* tests/testnouiprint.c (main): Don't open a display connection.

	* btk/btkprintbackend.c (btk_print_backend_load_modules): Make
	this work without a display connection.  (339702, Alexander Larsson)

	* btk/btkwindow.c (btk_window_move): Small doc addition. 
	(#345275, Behdad Esfahbod)

2006-06-17  Matthias Clasen  <mclasen@redhat.com>

	* modules/printbackends/pdf/btkprintbackendpdf.c:
	* modules/printbackends/lpr/btkprintbackendlpr.c: Fix a typo:
	s/Extention/Extension/. 
	
	* btk/btkprintunixdialog.c: Clean up the handling of 
	printer-specific options. There is just one extension point on the
	main tab now, and all options in the BtkPrintDialogExtension
	group are put there. 

	* btk/btkprinteroption.h: 
	* btk/btkprinteroption.c: Add BTK_PRINTER_OPTION_TYPE_ALTERNATIVE
	which is semantically the same as PICKONE, but is intended to 
	show all options all the time.
	
	* btk/btkprinteroptionwidget.c: Implement ALTERNATIVE as radio
	group.

2006-06-16  Matthias Clasen  <mclasen@redhat.com>

	* modules/printbackends/cups/btkprintbackendcups.c:
	* modules/printbackends/lpr/btkprintbackendlpr.c: Use a stock icon
	for printers.

	* btk/btkprintunixdialog.c (add_option_to_table): Don't grow
	additional columns.

	* btk/btkprintbackend.h: Add a BtkPrintSettings parameter to the
	printer_create_bairo_surface method.
	
	* modules/printbackends/pdf/btkprintbackendpdf.c: 
	* modules/printbackends/cups/btkprintbackendcups.c: 
	* modules/printbackends/lpr/btkprintbackendlpr.c: 
	* btk/btkprinter.c (_btk_printer_create_bairo_surface): 
	* btk/btkprinter-private.h: 
	* btk/btkprintjob.c (btk_print_job_get_surface): Adapt all users.

	* btk/btkentrycompletion.c (btk_entry_completion_finalize): Don't
	leak match data.  (#345107,  Christian Weiske)

	* btk/btkprintunixdialog.c (populate_dialog): Move the conflict
	label out of the button box.  (#339456, Christian Persch)

	* btk/btksizegroup.c (compute_dimension): Ignore unmapped widgets
	when ignore_hidden is TRUE.  (#344707, Christian Persch)

	* configure.in: Require cvs bunnylib.

	* btk/btkprintoperation-unix.c: 
	(_btk_print_operation_platform_backend_create_preview_surface): 
	Don't use a temporary directory for preview files, since it
	is not clear who cleans it up. Instead, use g_mkstemp() directly
	to create a temp pdf file, and make the preview app responsible
	for cleaning it up.

	* btk/btkprintbackend.c: Move the registration of the 
	btk-print-preview-command setting from btkprintbackend.c to 
	btkprintoperation-unix.c, to make sure it is registered before
	the first use. Also, document the two settings.

	* tests/print-editor.c: Add a "Preview" menu item.

	* btk/btkprintoperation-unix.c (handle_print_response): When starting
	a preview from the print dialog, set the action to PREVIEW.

	* btk/btkprintoperation.c: Cosmetic changes.

2006-06-16 Matthias Clasens  <mclasen@redhat.com>

	* btk/btkprintoperation-unix.c: Mark the preview filename
	as translatable (#345093, Christian Persch)

Fri Jun 16 11:49:53 2006  Tim Janik  <timj@imendio.com>

	* fixed #337882 by applying patches from Tommi Komulainen:

	* btk/btkprogressbar.c:
	(btk_progress_bar_paint_activity):
	(btk_progress_bar_get_activity): Move activity bar offset and size
	calculations to separate function.
	(btk_progress_bar_paint_text): Allow caller to specify offset for the
	prelight part in addition to width.
	(btk_progress_bar_paint): Paint the text also in activity mode, #337882.

	* btk/btkprogressbar.c: (btk_progress_bar_paint_text): Paint the
	prelighted text on top of the normal rather than side by side, to
	simplify painting text in activity mode.

2006-06-16  Matthias Clasen  <mclasen@redhat.com>

	* modules/printbackends/cups/btkprintbackendcups.c: Include
	btkprinter-private.h  (#345038, Christian Persch)
 
2006-06-15  Matthias Clasen  <mclasen@redhat.com>

	* modules/printbackends/pdf/btkprintbackendpdf.c: Use the
	stock floppy icon.

	* btk/btkprintoperation-unix.c: Set the GENERATE_PDF capability
	when creating a print dialog.  (noted by Yevgen Muntyan)

2006-06-15  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btknotebook.c (btk_notebook_motion_notify): use
	bdk_window_get_pointer() to get pointer coordinates, but limit its
	calls to a maximum of 45 times per second for not being too
	CPU/network abusive. stop drag operation if (event->state &
	BDK_BUTTON1_MASK) is FALSE to prevent tabs from "adhering" to the
	pointer. Fixes bug #341571
	(btk_notebook_calculate_tabs_allocation), (btk_notebook_button_press):
	get rid of the "tab jumps to pointer" sensation when beginning a drag
	by using the pointer offset in the tab when the drag begins as an
	anchor.
	(btk_notebook_redraw_tabs_union): remove, it wasn't worth the little
	performance gain and could draw artifacts under some circumstances.
	(btk_notebook_drag_end): do not reparent the detached tab label until
	the animation has ended.

2006-06-15  Bastien Nocera  <hadess@hadess.net>

	* configure.in: Update the Bairo requirements (#345008)

2006-06-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperationpreview.c 
	(btk_print_operation_preview_base_init): Fix errors in the
	signal definitions.  (#344891, Marko Anastasov)

2006-06-14  Michael Emmel  <mike.emmel@gmail.com>
	
	* configure.in: updated mininum  dfb to 0.9.24
	* bdk/directfb/bdkdirectfb.h: added more directfb wrapper functions
	* bdk/directfb/bdkdrawable-directfb.c: wrapper functions and patch from 
	 Claudio Ciccani <klan@users.sf.net> to use a subsurface for bairo
    * bdk/directfb/bdkvisual-directfb.c: changed initalization sequence
    * bdk/directfb/bdkwindow-directfb.c: corrected reparent for toplevels
    * bdk/directfb/bdkdisplay-directfb.c: changed initilization sequence
	to a more rational order

2006-06-14  Federico Mena Quintero  <federico@novell.com>

	* perf/btkwidgetprofiler.c (btk_widget_profiler_profile_expose):
	New function; it lets us time the expose sequence of a widget.
	(create_widget): New helper function.
	(map_widget): New helper function.
	(profile_boot): Use create_widget() instead of doing it by hand.
	(profile_map_expose): Use map_widget() instead of doing it by hand.

	* perf/main.c (main): Call btk_widget_profiler_profile_expose() as well.

2006-06-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpagesetupunixdialog.c: Use GKeyFile for the custom
	filename storage.  (#344867, Christian Persch)

	* btk/btkselection.c: Call init_atoms before using atoms
	in several functions.  (#344743, John Finlay)

	* btk/btktreeview.c (btk_tree_view_set_search_position+_func):
	Allow NULL to reset to default.  (#344838, John Finlay)

	* btk/btkprintjob.h: Collect booleans into a bitfield
	(#344765, Christian Persch)

2006-06-13  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version

2006-06-12  Matthias Clasen  <mclasen@redhat.com>

	* === Released 2.9.3 ===

	* NEWS: Updates
	
	* btk/btk.symbols: Add btk_tree_view_grid_lines_get_type.

	* configure.in: Set interface age to 0

2006-06-12  Kristian Rietveld  <kris@imendio.com>

	Introduce grid and tree lines in BtkTreeView. (#106406,
	Martyn Russell).

	* btk/btktreeprivate.h: add new fields to BtkTreePrivate.

	* btk/btkenums.h: add BtkTreeViewGridLines.

	* btk/btktreeview.[ch] (btk_tree_view_set_grid_lines),
	(btk_tree_view_get_grid_lines),
	(btk_tree_view_set_enable_tree_lines),
	(btk_tree_view_get_enable_tree_lines): new API,
	(btk_tree_view_class_init): new properties,
	(btk_tree_view_init), (btk_tree_view_{get,set}_property),
	(btk_tree_view_realize), (btk_tree_view_draw_grid_lines),
	(btk_tree_view_bin_expose): implement.

	* btk/btk.symbols: update.

2006-06-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintunixdialog.c (is_printer_active): Use 
	btk_printer_accepts_ps here.

	* modules/printbackends/pdf/btkprintbackendpdf.c (btk_print_backend_pdf_init):
	Mark the virtual "Print to PDF" printer as not accepting PS.

	* btk/btk.symbols:
	* btk/btkprinter.h: 
	* btk/btkprinter.c: Add two new properties accepts-pdf and
	accepts-ps (with getters) to allow learning supported formats.

	* btk/btkprintjob.h: Add a BTK_PRINT_CAPABILITY_GENERATE_PDF
	capability.
	
	* btk/btkprintunixdialog.c: Use it here to hide "Print to PDF" 
	from the printer list.  (#339592, Christian Persch)
	
	* btk/btkfilechooserdefault.c: Add support for pasting
	filenames into the filechooser.  (#153212, Bastian Nocera)

2006-06-12  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelfilter.[ch]
	(btk_tree_model_filter_convert_child_iter_to_iter),
	(btk_tree_model_filter_convert_child_path_to_path): report status
	in return value instead of spewing assertions.  (#335729, Yevgen
	Muntyan).

2006-06-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_finalize): 
	Clean up user data.  (#344624, Christian Weiske)

	* NEWS: Updates

	* btk/btkprintjob.c:
	* btk/btkprintbackend.c: 
	* btk/btkpagesetupunixdialog.c: 
	* btk/btkprintunixdialog.c: Cosmetic cleanups.

2006-06-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkassistant.c: Add an accessible implementation in
	order to make the buttons visible to a11y tools.  (pointed out
	by David Malcolm, #343945)

	* btk/btkprintoperation-win32.c: Store scale as a percentage.
	(#344560, Christian Persch)

	* btk/btkprogressbar.h: Add a dirty flag to BtkProgressBar.n/ 
	* btk/btkprogressbar.c: Defer updating of the offscreen
	pixmap until expose.  (#344543, Chris Wilson)

2006-06-11  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentchooserdefault.c
	(get_is_recent_filtered):
	* btk/btkrecentchoosermenu.c
	(get_is_recent_filtered):
	Do not leak the groups string vector. (#344607,
	John Finlay)

2006-06-11  Tor Lillqvist  <tml@novell.com>

	* btk/btkprintoperation-win32.c: Fix MSVC build problem. (#339739,
	Kazuki Iwamoto)

	* bdk/win32/bdkproperty-win32.c (bdk_property_change): Convert \n
	to \r\n also when storing CF_UNICODETEXT (UTF-16) in the
	Clipboard. (#344496)

2006-06-10  Matthias Clasen <mclasen@redhat.com>

	* btk/btkrecentchooserwidget.c 
	(btk_recent_chooser_widget_new_for_manager):
	* btk/btkrecentchoosermenu.c
	(btk_recent_chooser_menu_new_for_manager): 
	Allow NULL to mean the default manager.  (#344530, 
	John Finlay)

	* btk/btkprintoperation-unix.c (page_setup_data_free):
	Check if rdata->page_setup is set before unreffing it. 
	(#344518, Christian Persch)

	* btk/btkprintoperation.h: Remove an extra comma.  (#344528, 
	Elijah Newren)

	* modules/printbackends/btkprintbackendpdf.c 
	(btk_print_backend_pdf_print_stream): Use the passed in 
	destroy notify.  (#344513, Christian Persch)

	* configure.in: Require bairo 1.1.7

	* btk/btkprintoperation.c:
	* modules/printbackends/pdf/btkprintbackendpdf.c: Use
	bairo_pdf_surface_set_dpi by bairo_surface_set_fallback_resolution.
	(#344512, Elijah Newren)

	* bdk-2.0-uninstalled.pc.in: Make compiling against uninstalled
	bdk work.  (#344386, Masatake Yamamoto)

	* btk/btkprintoperation.c: Register create_custom_widget as 
	an object-returning signal.  (#344505, Marko Anastasov, patch
	by Christian Persch)

	* btk/btkmarshalers.list: Add the right marshaller.

	* btk/btk.symbols:
	* btk/btkprintjob.[hc]: Register BtkPrintCapabilities as a
	flags type.  (#344504, Marko Anastasov)

2006-06-09  Benjamin Berg  <benjamin@sipsolutions.net>

	* btk/btkmenuitem.c: (get_offsets): Take BtkMenu::horizontal-padding
	into account when placing submenus (#344290)

2006-06-09  Michael Natterer  <mitch@imendio.com>

	* btk/btkrange.c: added new style properties "trough-side-details"
	and "draw-trough-under-steppers" and fixed the "stepper-spacing"
	style property. Fixes bugs #342339 and #342249.

	"draw-trough-under-steppers", when set to FALSE, starts trough
	drawing next to the steppers instead of drawing the trough "below"
	(around) the steppers. If "stepper-spacing" is set to any value
	larger than zero, "draw-trough-under-steppers" is set to FALSE
	automatically to avoid rendering an area that looks clickable but
	isn't.

	(btk_range_calc_layout): honor draw-trough-under-steppers.
	Don't reserve stepper-spacing on sides of the range that don't
	have steppers.

	(btk_range_expose): changed drawing accordingly. Implement
	"trough-side-details" which enables drawing of the upper and lower
	parts of the trough with different details. This is useful for
	theme engines which want to draw these parts differently.

	(coord_to_value): correctly take all rendering options into
	account. stepper-spacing > 0 caused jumping and otherwise
	strangely behaving ranges before.

	(other functions): changed accordingly.

2006-06-09  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkdrawable-win32.c (_bdk_win32_drawable_release_dc):
	Call ReleaseDC() on DCs acquired with GetDC() (for windows), and
	DeleteDC() on DCs acquired with CreateCompatibleDC() (for
	bitmaps). According to MSDN, this is the correct thing to do, even
	if always using DeleteDC() seems to have worked fine in
	practice. (#337491, Chris Wilson)

2006-06-08  Matthias Clasen  <mclasen@redhat.com>

	* tests/testprint.c: Update for api changes.

	* btk/btkprintoperation.c: Fix some copy-and-paste errors,
	and rename the pdf-target property to export-filename.

	* btk/btkfilechooserdefault.c: Turn off profiling code.

	* tests/print-editor.c: Update for api changes.

	* btk/btk.h: Include btkprintoperationpreview.h

	* btk/btkprintoperationpreview.c (btk_print_operation_preview_is_selected): 
	Use g_return_val_if_fail (#344288, Kazuki Iwamoto)

	* btk/btkprintbackend.h: Don't include btkprinter-private.h here.

	* btk/btkprintunixdialog.c: 
	* btk/btkprintoperation-unix.c: 
	* btk/btkprintjob.c: 
	* btk/btkprintbackend.c: Instead include it here.

	* btk/btk.symbols: 
	* btk/btkprintoperation.h: 
	* btk/btkprintoperation.c: Rename pdf_target to export_filename.

2006-06-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperation.h (BtkPrintOperationResult): Get
	rid of BTK_PRINT_OPERATION_RESULT_PREVIEW.
	
	* btk/btkprintoperation-unix.c: 
	* btk/btkprintoperation.c: Update all users.

2006-06-08  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate):
	[WM_WINDOWPOSCHANGED] Replace identical code as in
	handle_configure_event() with call to that function.
	[WM_SIZING] Fix implementation of aspect ratio hints. (#344244)
	The hints are for the geometry of the client area, not of the
	window including decorations. Improve resizing behaviour in the
	presence of aspect hints, to be more in line with typical X window
	managers.

2006-06-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktoolbutton.c (btk_tool_button_style_set): Give
	BtkToolButton the same treatment.

	* btk/btkbutton.c (btk_button_style_set): Don't call
	construct_child here, since some apps make assumptions 
	about the lifecycle of the constructed label.  

2006-06-08  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprintoperation-unix.c (finish_print):
	Fix up unix fallout from previous change.

2006-06-08  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprintoperation-win32.c:
	Update windows to build with new APIs and first cut
	at preview work.
	
	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation-unix.c:
	* btk/btkprintoperation.c
	Various updates needed when making the preview work on win32.

	* tests/print-editor.c:
	Print, don't preview.

2006-06-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (popup_targets_received): Make Delete
	menuitem insensitive if entry is not editable.  (#344232, 
	Milosz Derezynski)

	* btk/btkprintoperation.c: Add some docs. 

	* btk/btk.symbols: Add btk_print_operation_set_allow_async.

	* btk/btkprintoperation.h: Remove btk_print_operation_run_async.

	* tests/testnotebookdnd.c: Update callers.

	* btk/btknotebook.h:
	* btk/btknotebook.c (btk_notebook_set_window_creation_hook):
	Add a destroy notify for the callback data.  (#344209, 
	Murray Cumming)

2006-06-07  JÃ¼rg Billeter  <j@bitron.ch>

	* btk/Makefile.am: Fix building btkbuiltincache.h without system BTK+.

2006-06-07  Alexander Larsson  <alexl@redhat.com>

	* btk/btk.symbols:
	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation-unix.c:
	* btk/btkprintoperation.[ch]:
	Clean up APIs:
	Make async a setting instead of separate calls.
	Combine settings like show_dialog, show_preview and pdf_target into
	an action enum that you pass to btk_print_dialog_run().
	
	* tests/print-editor.c:
	* tests/testnouiprint.c:
	* tests/testprint.c:
	* demos/btk-demo/printing.c:
	Update to new APIs

2006-06-07  Bastien Nocera  <hadess@hadess.net>

	* configure.in: Update the BATK requirements (#344148)

2006-06-07  Matthias Clasen  <mclasen@redhat.com>

	* modules/printbackends/cups/btkprintercups.c 
	(btk_printer_cups_finalize):  Fix a C99ism.
	(#344123, Jens Ganseuer)

2006-06-06  Behdad Esfahbod  <behdad@bunny.org>

	* bdk/bdkbango.c (bdk_bango_layout_line_get_clip_rebunnyion): Correct
	rounding of rect members.  Improved docs.  (#337603)

2006-06-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c: Small optimization

2006-06-05  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version

	* === Released 2.9.2 ===

	* configure.in: Set interface age to 0.

	* NEWS: Updates

	* btk/btkprintoperationpreview.c: Include btkalias.h

	* btk/btk.symbols: Add some forgotten new functions.

2006-06-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c (btk_notebook_calculate_shown_tabs):
	(btk_notebook_calc_tabs): Fix borderline cases in tab
	visibility calculation.  (#168105, Carlos Garnacho Parro)

	* bdk/x11/bdkfont-x11.c (_bdk_font_destroy): Remove the right
	XID from the xid table.  (#341327, Sampo Savolainen, Tim Janik)

2006-06-04  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkprintoperationpreview.h: Add missing B_END_DECLS (#343838)

2006-06-03  Richard Hult  <richard@imendio.com>                                 

	* bdk/quartz/Makefile.am:                                               
	* bdk/quartz/bdkspawn-quartz.c: Add spawn functions, copied from the
	win32 backend.

2006-06-02  Matthias Clasen  <mclasen@redhat.com>
	
	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation.h:
	* btk/btkprintoperation.c: Add a show-preview property. 

	* btk/btkprintoperation-unix.c: Implement it here.

	* btk/btkprintoperation-unix.c: Cleanups

2006-06-02  Kristian Rietveld  <kris@imendio.com>

	Rubber banding for BtkTreeView, #80127.  Uses same method as
	BtkIconView.

	* btk/btktreeview.c (btk_tree_view_class_init),
	(btk_tree_view_init), (btk_tree_view_get_property),
	(btk_tree_view_set_property), (btk_tree_view_set_rubber_banding),
	(btk_tree_view_get_rubber_banding): add property,
	(btk_tree_view_button_press): start rubber banding if enabled and
	press is on a non-selected node,
	(btk_tree_view_button_release): stop rubber banding,
	(btk_tree_view_motion_bin_window), (scrool_row_timeout): enable/update
	the rubber band,
	(btk_tree_view_bin_expose): draw rubber band if active,
	(btk_tree_view_stop_rubberband),
	(btk_tree_view_update_rubber_band_selection_range),
	(btk_tree_view_update_rubber_band_selection),
	(btk_tree_view_update_rubber_band),
	(btk_tree_view_paint_rubber_band): new functions.

	* btk/btktreeview.h: add new set/get function for rubber banding
	property.

	* btk/btktreeprivate.h: add a bunch of new private fields.

2006-06-02  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreeview.c (btk_tree_view_leave_notify): revert fix of
	#164884 because it's not a problem in btk+ but in applications and
	it breaks starting drags from the edge of a row.

2006-06-02  Kristian Rietveld  <kris@imendio.com>

	Separate sensitive/selectable properties.

	* btk/btktreeselection.c (tree_column_is_sensitive): remove,
	(_btk_tree_selection_row_is_selectable): remove checks to see if at
	least one column is sensitive,
	(btk_tree_selection_real_select_node): remove code which enables
	insensitive rows to always be unselected.

	* btk/btktreeview.c (btk_tree_view_row_changed): remove code
	that unselects a node if it just became insensitive.

	* btk/btkcombobox.c (btkcombo_box_list_select_func): new function,
	based on the at least one column sensitive check from
	_btk_tree_selection_row_is_selectable(),
	(btk_combo_box_list_setup): set selection function on tree selection.

2006-06-02  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreemodelfilter.c
	(btk_tree_model_filter_convert_child_path_to_path): need to use
	btk_tree_model_filter_get_iter_full() since the path returned
	by btk_real_tree_model_filter_convert_child_path_to_path() includes
	invisible nodes.

2006-06-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkstatusicon.c (btk_status_icon_get_geometry): Allow
	to return partial information.  (#343625, Christian Persch)

	* btk/btkwindow.c (btk_window_key_release_event): Chain up
	to key_release, not to key_press.  (#343677, Tommi Komulainen)

2006-06-02  Alexander Larsson  <alexl@redhat.com>

	* btk/Makefile.am:
	Add btkprintoperationpreview.[ch]
	Set default preview command. Hardcoded for now.
	
	* btk/btkmarshalers.list:
	Add BOOLEAN:OBJECT,OBJECT,OBJECT
	
	* btk/btkprintbackend.c:
	Add preview command property.
	
	* btk/btkprintcontext.[ch]:
	Make less dependent on PrintOperation for output settings
	Externally set bairo_t and dpi. Resettable.
	Create fontmap without metrics hinting (so that print preview
	text layout doesn't depend on zoom level).
	
	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation-unix.c: 
	* btk/btkprintoperation.[ch]:
	Initial work on print preview API and default implementation
	using an external preview app.
	
	* btk/btkprintoperation-win32.c:
	Some needed updates. Not done, needs more work.
	
	* btk/btkprintoperationpreview.[ch]:
	New interface used in print preview api.
	
	* btk/btkprintunixdialog.c:
	Add print preview dialog.
	
	* tests/print-editor.c:
	Test using an custom print preview widget.

2006-06-02  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentmanager.c
	(btk_recent_info_get_application_info): Fix a typo (spotted by
	Paolo Borelli and coverity).

2006-06-01  Matthias Clasen  <mclasen@redhat.com>
	
	* tests/testnotebookdnd.c: Small tweaks to test more things.

	* btk/btktoolbutton.c (btk_tool_button_class_init): Add
	an icon-spacing style property for the same purpose.

	* btk/btkbutton.c (btk_button_class_init):  Add an image-spacing
	style property that allows to adjust the spacing between image
	and label in button.  (#320431, James Moger)

	* btk/btkprintoperation-private.h: 
	* btk/btkprintoperation.c: 
	* btk/btkprintoperation-unix.c: Move the 
	PrintPagesData.wait flag to BtkPrintOperationPrivate.is_sync.
	Also use a recursive mainloop instead of manually looping.
	
	* btk/btkprintoperation.c: Add some examples to the docs.

	* btk/btkprintbackend.c (btk_print_backend_class_init): 
	Intern signal names.

	* btk/btkprintunixdialog.c: 
	* btk/btkprintoperation-unix.c: Use canonical signal names.

2006-05-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpagesetupunixdialog.c: Add docs, cleanup some
	formatting.

	* btk/btkprintoperation.c (print_pages_idle): Don't
	treat manual_scale like a percentage, its a factor.

	* btk/btktreeview.c (btk_tree_view_class_init): Document
	signals.  (#302556, Stefan Kost)

2006-05-31  Alexander Larsson  <alexl@redhat.com>

	* btk/btk.symbols:
	* demos/btk-demo/printing.c:
	* tests/print-editor.c:
	* tests/testnouiprint.c:
	* tests/testprint.c:
	* tests/testprintfileoperation.c:
	Further updates from the BtkPrintContext functions rename.
	
	* modules/printbackends/cups/btkcupsutils.c:
	Always set requesting-user-name when doing cups requests.

2006-05-31  Alexander Larsson  <alexl@redhat.com>

	* btk/btkpagesetupunixdialog.c:
	Remove request_details_tag with g_signal_handler_disconnect,
	not g_source_remove. (#343475)

2006-05-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintcontext.h: 
	* btk/btkprintcontext.c: 
	* btk/btkprintoperation.c: 
	* btk/btkprintoperation-unix.c: Change some function names to be 
	longer and better. 
	btk_print_context_get_bairo -> btk_print_context_get_bairo_context
	btk_print_context_get_fontmap -> btk_print_context_get_bango_fontmap
	btk_print_context_create_context -> btk_print_context_create_bango_context
	btk_print_context_create_layout -> btk_print_context_create_bango_layout
	Update all callers.

	* btk/btkpagesetupunixdialog.c: Don't run the custom page
	size dialog.  (#340444, Christian Persch)

	* demos/btk-demo/main.c (main): Display comments in friendly
	DodgerBlue instead of scary red.  (#343444, Carol Spears)

	* btk/btkfontbutton.c: 
	* btk/btkcolorbutton.c: Clarify the docs of the color-set and
	font-set signals.  (#343438, Olexiy Avramchenko)

2006-05-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmain.c (btk_grab_notify_foreach): Don't skip internal
	children when emitting grab-notify.  (#343425, Markku Vire)

	* bdk/bdkpixmap.c: 
	* bdk/bdkwindow.c: Don't use G_DEFINE_TYPE, since the instance
	struct name does not match the type name.  (#343453, Ed Catmur)

	* btk/btk.symbols: 
	* btk/btkbutton.h: 
	* btk/btkbutton.c: Add a BtkButton::image-position property
	with getter and setter, to allow constructing buttons with
	the image stacked on top of the label.  (#342930, Johan Dahlin)

2006-05-30  Johan Dahlin  <jdahlin@async.com.br>

   * btk/btk.symbols:
   * btk/btkbutton.c: (btk_button_class_init), (btk_button_init),
   (btk_button_set_property), (btk_button_get_property),
   (btk_button_construct_child), (btk_button_set_image_spacing),
   (btk_button_get_image_spacing):
   * btk/btkbutton.h:
   * btk/btktoolbutton.c: (btk_tool_button_class_init),
   (btk_tool_button_construct_contents),
   (btk_tool_button_set_property), (btk_tool_button_get_property),
   (_btk_tool_button_get_button), (btk_tool_button_set_icon_spacing),
   (btk_tool_button_get_icon_spacing):
   * btk/btktoolbutton.h:
   Add BtkButton:image-spacing and BtkToolButton::icon-spacing.
   (#320431, James Moger)

2006-05-30  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_update_button): only
	check sort column id if connected to sortable model.

2006-05-30  Behdad Esfahbod  <behdad@bunny.org>

	* bdk/bdkbango.c (draw_error_underline): Fix offset to center the
	underline in requested rectangle. (Ported from bango fix.)

2006-05-29  Michael Natterer  <mitch@imendio.com>

	* btk/btkdialog.h: removed forgotten declaration of
	_btk_dialog_get_response_for_widget(), the function has been made
	public a long time ago.

2006-05-29  Michael Natterer  <mitch@imendio.com>

	* btk/btktextview.c (btk_text_view_target_list_notify): applied
	patch from Chris Wilson which replaces a useless loop with
	built-in access to free'd memory by a simple integer comparison.
	Fixes bug #342894.

2006-05-29  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_move_cursor_up_down): select
	the current focus row if nothing is selected and ctrl is not pressed.
	(Fixes #324480, Murray Cumming/Srirama Sharma).

2006-05-28  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeviewcolumn.c (_btk_tree_view_column_cell_focus): refactor
	to work correctly in RTL mode.

	* btk/btktreeview.c (btk_tree_view_move_cursor_left_right): make
	cursor movement to left/right work correctly in RTL mode.

2006-05-28  Behdad Esfahbod  <behdad@bunny.org>

	* bdk/bdkrectangle.c (bdk_rectangle_union, bdk_rectangle_intersect):
	Note in docs that @dest can be the same as @src1 or @src2. (#343233,
	Christian Persch)

2006-05-28  Kristian Rietveld  <kris@btk.org>

	* btk/btkstyle.c (btk_default_draw_flat_box): handle
	cell_even_ruled_sorted and cell_odd_ruled_sorted for the selected
	state.

2006-05-28  Kristian Rietveld  <kris@btk.org>

	* btk/btkenums.h: add BTK_ARROW_NONE.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_update_column): always
	"show" the arrow if sort_column_id >= 0, only set arrow type if
	this column is the column we are currently sorting on. (#331338).

2006-05-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrecentchoosermenu.c: Avoid trivial differences
	in translated strings.  (#343088, Clytie Siddall)

2006-05-28  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_build_tree): emit test_expand_row
	and test return value before expanding a branch. (Fixes #321523,
	reported by Daniel Lindenaar).

2006-05-28  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_insert_column): set the sizing
	type of the new column to FIXED,
	(btk_tree_view_insert_column_with_attributes): likewise. (#341898,
	Dan Winship).

2006-05-27  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_remove_node):
	only unref if elt->ref_count > 0,
	(btk_tree_model_filter_row_deleted): likewise. (Fixes #340839,
	reported by Yevgen Muntyan).

2006-05-27  Kristian Rietveld  <kris@btk.org>

	Small refactoring. (#340428, Paolo Borelli).

	* btk/btkliststore.c (btk_list_store_set_valist_internal),
	(btk_list_store_insert_with_valuesv): refactor code to determine
	iter compare func into btk_list_store_get_compare_func().

	* btk/btktreestore.c (btk_tree_store_set_valist_internal),
	(btk_tree_store_insert_with_valuesv): likewise.

2006-05-27  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_queue_draw_arrow): really fix
	#333284.

2006-05-27  Kristian Rietveld  <kris@btk.org>

	Editable cell window placement and RTL fixes.

	* btk/btktreeview.c (btk_tree_view_button_press),
	(btk_tree_view_bin_expose), (btk_tree_view_get_cell_area),
	(btk_tree_view_create_row_drag_icon): Only add indentation to x
	if !rtl,
	(btk_tree_view_create_row_drag_icon): Iterate over columns in reverse
	direction if in rtl mode.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action):
	horizontal_separator is not part of the real background area width,
	add 2 * focus_line_width to real_cell_area.x and not
	real_background_area.x, fix up event coordinates check in the
	PACK_END loop, also set depth to zero at the end of the PACK_END
	loop,
	(_btk_tree_view_get_neighbor_sizes): also add column_spacing for each
	visible cell.

2006-05-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/stock-icons/24/btk-orientation-landscape.png:
	* btk/stock-icons/24/btk-orientation-portrait.png:
	* btk/stock-icons/24/btk-orientation-reverse-landscape.png:
	* btk/stock-icons/24/btk-orientation-reverse-portrait.png:
	Cleaned up icons by Diana Fong.

2006-05-26  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_queue_draw_arrow): queue a redraw
	for the full width of the row, not just the width we got allocated.
	(Fixes #333284, reported by Benjamin Berg).

2006-05-26  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_top_row_to_dy): set dy to
	page_size + height in the event dy + page_size is about to become
	bigger than height.

2006-05-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols:
	* btk/btkstatusicon.h:
	* btk/btkstatusicon.c (btk_status_icon_get_geometry):
	New function that can be used to e.g. position 
	notification bubbles wrt to the status icon.  
	(#341450, Christian Persch, Havoc Pennington)

2006-05-25  Matthias Clasen  <mclasen@redhat.com>

	Make BTK+ work as an untrusted X client. (#136571,
	Ed Catmur)

	* bdk/x11/bdkdisplay-x11.h:
	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): When 
	opening a display, determine if we are untrusted.
	
	* bdk/x11/bdkdisplay-x11.c (bdk_notify_startup_complete): 
	Just bail out when we are untrusted.

	* bdk/x11/bdkwindow-x11.c (bdk_window_new): Work around
	a bug in the Xorg XSECURITY implementation by coercing
	toplevel InputOnly windows to InputOutput.

	* bdk/x11/bdkwindow-x11.c (_bdk_windowing_get_pointer): 
	(_bdk_windowing_window_get_pointer): 
	When untrusted, call XQueryPointer on an auxiliary
	window, not on the root window.
	
	* bdk/x11/bdkwindow-x11.c (_bdk_windowing_window_at_pointer): 
	If untrusted, loop through all BDK-aware toplevels on all
	screens in the hope we hit one containing the pointer; 
	then use that as the basis of the current XQueryPointer 
	child recursion.

	* bdk/x11/bdkmain-x11.c (bdk_pointer_grab): 
	(bdk_keyboard_grab): Ignore failed grabs when untrusted.

	* bdk/x11/bdkdnd-x11.c (bdk_window_cache_new): Only
	cache our own toplevels when untrusted.

	* bdk/x11/bdkdnd-x11.c (motif_send_enter): Don't try
	to do Motif DND as untrusted client.

	* bdk/x11/bdkevents-x11.c (fetch_net_wm_check_window): 
	(bdk_x11_screen_get_window_manager_name): 
	(bdk_x11_screen_supports_net_wm_hint): 
	Bail out early if untrusted.
	
	* btk/btkcolorsel.c (grab_color_at_mouse): If getting 
	the color under the pointer by screenshooting the root 
	window fails, it tries to get the color from our own 
	window.

	* btk/btkcolorsel.c (get_screen_color): Make the
	dropper_grab_widget a child of the dialog, not a 
	toplevel.

	* btk/btkinvisible.c (btk_invisible_realize): Respect
	a parent window that has been set before realizing.

	* btk/btkwidget.c (btk_widget_get_parent_window): 
	Always return a previously set parent window.
	
2006-05-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfontbutton.c (btk_font_button_clicked): 
	* btk/btkcolorbutton.c (btk_color_button_clicked): 
	Fix the handling of modality by copying what
	BtkFileChooserButton does.  (#342754, Yevgen Muntyan)
	
	* btk/btkprintunixdialog.c (create_main_page): Make
	the range entry insensitive if another range option
	is selected.  (#342783, Caolan McNamara)
	(update_dialog_from_capabilities): Make the collate
	check button insensitive unless multiple copies are
	printed  (#342781, Caolan McNamara)

	* btk/btkwidget.c: Remove style properties when a widget
	class gets finalized, to make style properties work in
	dynamic types.  (#342513, Christian Persch)

2006-05-24  Henrique Romano  <henrique@async.com.br>

	* btk/btkcellview.c: (btk_cell_view_class_init),
	(btk_cell_view_get_property), (btk_cell_view_set_property):
	Add model property for BtkCellView, part of #172535.

2006-05-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperation.h: 
	* btk/btkprintoperation-private.h: 
	* btk/btk.symbols:
	* btk/btkprintoperation.c: Add a custom-tab-label property.
	
	* btk/btkprintoperation-unix.c (get_print_dialog): Use it
	here.  (#342752, Yevgen Muntyan)

2006-05-24  Alexander Larsson  <alexl@redhat.com>

	* btk/btk.symbols:
	* btk/btkprintunixdialog.[ch]:
	Add btk_print_unix_dialog_set_manual_capabilities that controls
	what widgets to enable in the dialog depending on the apps
	capabilities.
	
	* btk/btkprintbackend.[ch]:
	* btk/btkprinter-private.h:
	* btk/btkprinter.c:
	* btk/btkprintjob.h:
	Add printer_get_capabilities to backend.
	Move some fallback calls to the printbackend base class.
	
	* btk/btkprintoperation-unix.c:
	Set manual capabilities
	
	* modules/printbackends/cups/btkprintbackendcups.c:
	Implement get_capabilities
	
	* modules/printbackends/lpr/btkprintbackendlpr.c:
	* modules/printbackends/pdf/btkprintbackendpdf.c:
	Move some methods to baseclass.

2006-05-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperation.c (print_pages): Do the begin-print
	emission in the idle, so that the print dialog goes away
	before begin-print.

2006-05-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols: 
	* btk/btkprintoperation.h: 
	* btk/btkprintoperation.c: Add a boolean show-progress  
	property, and show a progress dialog if it is set to TRUE.

	* btk/btkprintoperation.c (pdf_end_run): 
	* btk/btkprintoperation-win32.c (win32_end_run): 
	* btk/btkprintoperation-unix.c (unix_end_run): 
	* btk/btkprintoperation-private.h: Add a cancelled
	parameter to end_run, and call it even if the print
	operation was cancelled.

2006-05-23  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprinteroptionwidget.c (filesave_changed_cb):
	Allow absolute filenames in filename entry.
	Patch from Yevgen Muntyan (#341679)

2006-05-23  Alexander Larsson  <alexl@redhat.com>

	* btk/btk.symbols:
	* btk/btkprintunixdialog.[ch]:
	Add btk_print_unix_dialog_add_custom_tab
	
	* btk/btkprintoperation-unix.c:
	Implement custom widgets for unix.
	Fix some warnings by including bairo-ps/pdf.h
	
	* btk/btkprintoperation-win32.c:
	Mark string for translation.

2006-05-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperation.c (btk_print_operation_class_init): 
	Fix docs.

2006-05-22  Alexander Larsson  <alexl@redhat.com>

	* btk/btkmain.c:
	Make sure grab-notify is emitted on toplevels as well as 
	child widgets.

	* btk/Makefile.am:
	* btk/btkwin32embedwidget.[ch]
	Add new widget used for win32 port to embed btk+
	widgets in windows dialog.

	* btk/btkmarshalers.list:
	Add POINTER:VOID

	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation.[ch]:
	Generic support for custom widgets in print dialog.

	* btk/btkprintoperation-win32.c:
	Implement custom widget support for win32.

	* tests/print-editor.c:
	Allow setting of font using custom widgets in the print dialog.

2006-05-22  Behdad Esfahbod  <behdad@bunny.org>

	Rollback the following changes, to fix it the proper way in Bango:

	* bdk/bdkinternals.h:
	* bdk/bdkscreen.c (bdk_screen_class_init), (bdk_screen_finalize),
	(update_fontmap_resolution), (bdk_screen_set_resolution):  Add new
	function _bdk_screen_get_font_map() and have one fontmap per screen,
	with the correct resolution set on it.

	* bdk/bdkbango.c (bdk_bango_context_get_for_screen): Use
	_bdk_screen_get_font_map() instead of setting resolution on the
	BangoBairoContext.  (#342529)

2006-05-22  Emmanuele Bassi  <ebassi@bunny.org>

	* btk/btkrecentmanager.h:
	* btk/btkrecentmanager.c
	(btk_recent_info_get_application_info): Don't mask "time" with
	the "time" argument.

2006-05-22  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkcolor.h: bdk_color_parse returns boolean, not int.
	(#342569, Masatake Yamato)

	* btk/btkprintunixdialog.c (dialog_set_scale): Don't return
	a value from a void function.

	* btk/btkprinter.c (_btk_printer_prepare_for_print) 
	(_btk_printer_get_settings_from_options) 
	(_btk_printer_request_details): Don't return values from void
	functions.

	* btk/btkrecentchooserutils.c (delegate_unselect_uri): Don't
	return a value from a void function.

	* btk/btkfilesystem.c (btk_file_system_cancel_operation): Don't
	return a value from a void function.  Also, don't put 
	semicolons behind G_DEFINE_TYPE. (#342543)

	* btk/btkwidget.c (btk_widget_class_init): Add docs
	for new style properties.  (#342535, Mart Raudsepp)

	* bdk/x11/bdkscreen-x11.c: Remove _bdk_x11_screen_request_cm_notification

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Directly call 
	bdk_display_request_selection_notification. 

	* bdk/x11/bdkdisplay-x11.c: Several cleanups.
	
2006-05-21  Behdad Esfahbod  <behdad@bunny.org>

	* bdk/bdkinternals.h:
	* bdk/bdkscreen.c (bdk_screen_class_init), (bdk_screen_finalize),
	(update_fontmap_resolution), (bdk_screen_set_resolution):  Add new
	function _bdk_screen_get_font_map() and have one fontmap per screen,
	with the correct resolution set on it.

	* bdk/bdkbango.c (bdk_bango_context_get_for_screen): Use
	_bdk_screen_get_font_map() instead of setting resolution on the
	BangoBairoContext.  (#342529)

2006-05-22  Tor Lillqvist  <tml@novell.com>

	* btk/btkfilesystemwin32.c: Make it compile again. Doesn't work
	properly yet, though. There is lots of commonality between this
	file and btkfilesystemunix.c that should really be factored out.

2006-05-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpaned.c (btk_paned_compute_position): Avoid warnings
	if a child is NULL.  (#342007, Patrick Monnerat)
	
	* btk/btk.symbols: 
	* btk/btkprintoperation.h: 
	* btk/btkprintoperation.c (btk_print_operation_cancel): New function
	to cancel a running print operation.

	* btk/btkprintoperation-private.h (struct _BtkPrintOperationPrivate): 
	Add a cancelled flag, use g types, use bitfields.

	* btk/btkprintoperation.c (print_pages): Clean up after the idle
	in the synchronous case.

	* btk/btknotebook.c (btk_notebook_pages_allocate): Fix a 
	boundary case in scrolling where a tab was not shown.  (#168105,
	Hiroyuki Ikezoe, patch by Kouhei Sutou)

2006-05-19  Damon Chaplin  <damon@bunny.org>

	* btk/btkfontsel.c (btk_font_selection_init): use
	batk_relation_add_target() to add the targets, since it sets up weak
	references to avoid crashes. (#305530)

2006-05-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperation.h: 
	* btk/btkprintoperation.c: Add a BtkPrintOperation:: paginate signal 
	that gets emitted to paginate a document in chunks.

	* btk/btkprintoperation-private.h: 
	* btk/btkmarshalers.list: Add necessary glue.

	* btk/btkcalendar.c (btk_calendar_drag_motion): Don't produce
	a stuck drag if shift is held.  (#341734, Sebastien Bacher) 

	* bdk/x11/bdkdnd-x11.c (_bdk_drag_get_protocol_for_display): 
	Always set protocol.  (#342003, Tommi Komulainen)

	* btk/btkimage.c (icon_theme_changed): Only unref the pixbuf
	if the image has the appropriate storage type.  (#342096, Tommi
	Komulainen)

	* configure.in: Actually require GLib 2.11
	
	* btk/btkentry.c (btk_entry_drag_data_received): Make drops
	end up at the right spot.  (#342072,  Yevgen Muntyan)

2006-05-18  Michael Natterer  <mitch@imendio.com>

	* btk/btkrange.c: canonicalize the name of the "activate-slider"
	style property and use BTK_PARAM_READABLE instead of
	G_PARAM_READABLE. Moved one "activate_slider" variable to the
	local scope its used in.

2006-06-18  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkscreen-directfb.c: 
	* added bdk_screen_is_composited to compile
	* Bug 342091

2006-05-17  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprintoperation-win32.c:
	Update to changed APIs.

2006-05-16  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version

	* === Released 2.9.1 ====

	* configure.in: Reset interface age
	
	* NEWS: Updates

Tue May 16 12:36:25 2006  SÃ¸ren Sandmann  <sandmann@redhat.com>

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Move getting the
	property out of the loop, and rename the variable 'max_expand'.

	* btk/btktoolbar.c (btk_toolbar_class_init): Fix the decription
	for the max-child-expand property. 

2006-05-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprinter.c (btk_printer_class_init): 
	* btk/btkprintjob.c (btk_print_job_class_init): 
	* btk/btkprintoperation.c (btk_print_operation_class_init): 
	Cosmetic cleanups.

	* btk/btkpagesetupunixdialog.c (populate_dialog): Add labels
	for page orientations, also add the fourth one.  (#339589)

	* btk/stock-icons/24/btk-orientation-reverse-portrait.png: New
	icon.
	
	* btk/Makefile.am: Add it here.
	
	* btk/btkstock.[hc]: Add stock items for the page orientations.

2006-05-16  Michael Natterer  <mitch@imendio.com>

	* btk/btktoolbar.c: added "max-child-expand" style property which
	limits the space taken by expanding tool items. Fixes bug #340722.

2006-05-16  Kristian Rietveld  <kris@imendio.com>

	* btk/btkpathbar.c (btk_path_bar_dispose): cancel all pending handles
	in the button list. (Fixes #341035, reported by William Jon McCann).

2006-05-16  Kristian Rietveld  <kris@imendio.com>

	* btk/btkfilechooserdefault.c
	(show_and_select_paths_finished_loading): put the newly selected
	row(s) the in the middle of the view,
	(update_current_folder_get_info_cb),
	(btk_file_chooser_default_update_current_folder): make sure reload
	state is set to RELOAD_HAS_FOLDER while loading the new folder,
	so _map() won't start loading the current working directory. (Fixes
	#341028, reported by Michael Natterer).

2006-05-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_button_press): Fix
	an RTL problem with toggles in expander columns. 
	(#341896, Roozbeh Pournader) 

Mon May 15 15:12:05 2006  SÃ¸ren Sandmann  <sandmann@redhat.com>

	* btk/btklayout.c (btk_layout_realize),
	* btk/btkiconview.c (btk_icon_view_realize),
	* btk/btktreeview.c (btk_tree_view_realize): Set the background of
	the clip windows to NULL, since they are generally invisible and
	don't have EXPOSURE set, which means they temp-unvlicker code
	doesn't apply to them.

	* bdk/x11/bdkgeometry-x11.c (_bdk_window_move_resize_child): Unset
	the background of the parent window during resizing. Invalidate
	the uncoered area of the parent window. Bug 341332.

2006-05-15  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkevents-quartz.c (_bdk_events_init): Remove obsolete 
	comment.
	(poll_func): Remove assert and add a comment on how to fix properly.
	(bdk_events_pending): Implement.

2006-05-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperation.c: Reverse the order of
	ranges when printing in reverse.  (#341578)

2006-05-15  Alexander Larsson  <alexl@redhat.com>
	
	* btk/btkprintjob.[ch]:
	Added btk_print_job_set/get_track_print_status

	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation.[ch]:
	Add btk_print_operation_set_track_print_status.
	
	* btk/btkprintoperation-unix.c:
	Implement track_print_status on unix
	
	* btk/btkprintoperation-win32.c:
	Implement track_print_status on win32
	
	* btk/btk.symbols:
	Added symbols
	
	* modules/printbackends/cups/btkprintbackendcups.c:
	Implement track_print_status for cups
	
	* tests/print-editor.c:
	Test track_print_status.

2006-05-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintoperation.c: Do page rendering in an idle when
	running asynchronous. 

2006-05-15  Alexander Larsson  <alexl@redhat.com>

	* btk/btk.symbols: 
	* btk/btkprintbackend.[ch]: (_btk_print_backend_create):
	Never unload print backends.
	Remove btk_print_backend_unref_at_idle.

	* modules/printbackends/cups/btkprintbackendcups.c:
	(cups_dispatch_watch_finalize):
	Don't use the unref_at_idle hack since that caused
	deadlocks. Instead we never unload print backends, which
	is not really a big problem.

2006-05-14  Murray Cumming  <murrayc@murray.com>

	* btk/btkframe.c: Restored the / at the start of the comment 
	block, to fix the build.

2006-05-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/*.c:
	* bdk-pixbuf/*.c:
	* bdk/*.c: Remove erroneous ; after G_DEFINE_TYPE 
	macros.  (#341692, Yevgen Muntyan)

	* btk/btktextbtree.c: 
	* btk/btktextview.c: Move some asserts to the right 
	place.  (#341661, #341665, Pascal Terjan)

2006-05-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c: Fix some corner cases in the size
	allocation logic for tabs.  (#341577, Carlos Garnacho Parro)

	* btk/btkprintunixdialog.c: Some fixes to capitalization of
	labels.  (#341558, Dennis Cranston)

	* btk/btknotebook.c: Handle tab_label being NULL better.
	(#341455, William Jon McCann, patch by Carlos Garnacho Parro)

	* btk/btkruler.c: Reinstate the ruler metrics strings, since
	they are used by glade, pointed out by Damon Chaplin.

2006-05-12  Alexander Larsson  <alexl@redhat.com>

	* btk/btkwindow.c:
	Better handling of the window group on unsetting transient-for, since
	the transient parent might have changed group.
	
	* btk/btkmenu.c:
	Combine the handling of transient for the attach-widget and the
	window group handling by setting transient-to on popup/popdown only.

	See bug #340401
	
	* btk/btkprintunixdialog.c:
	Remove part of old fix no longer needed.

2006-05-12  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprintoperation.c (btk_print_operation_set_n_pages):
	Update g_object_notify to new property name.

2006-05-12  Alexander Larsson  <alexl@redhat.com>

	* btk/btkrecentmanager.c:
	Fix build errors.
	
	* btk/btk.symbols:
	* demos/btk-demo/printing.c:
	* btk/btkprintoperation-win32.c:
	* btk/btkprintoperation.[ch]:
	* btk/btkprintsettings.[ch]: 
	* modules/printbackends/cups/btkprintbackendcups.c:
	* modules/printbackends/lpr/btkprintbackendlpr.c:
	* modules/printbackends/pdf/btkprintbackendpdf.c:
	* tests/print-editor.c:
	* tests/testnouiprint.c:
	* tests/testprint.c:
	* tests/testprintfileoperation.c:
	Rename functions from nr_of_pages to n_pages, and num_copies to
	n_copies to match other btk+ names.
	
	* btk/btkmenu.c: (btk_menu_popdown):
	Only re-set window group on popdown if we set it on popup (i.e.
	if there is a parent menu shell).
	Fixed part of bug #340401

	* btk/btkwindow.c:
	Add (contruct) property "transient-for" to BtkWindow. This
	is needed for the fix to bug #340401.
	
	* btk/btkprintunixdialog.c:
	Use the transient-for property on construction and populate the dialog
	with widgets after that. This fixes bug #340401.
	More n_pages renames.

2006-05-11  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	* btk/btkrecentmanager.h: Remove the error parameter to the
	btk_recent_manager_add() and btk_recent_manager_add_full()
	functions; remove the unneeded error codes from the error
	enumeration.  (#336774).

	* btk/btkrecentmanager.c: Make btk_recent_manager_add() and
	btk_recent_manager_add_full() complain loudly about wrong or
	missing meta-data, instead of using a GError.  (#336774)

2006-05-11  Matthias Clasen  <mclasen@redhat.com>

	* demos/btk-demo/Makefile.am (demos): Add it here.

	* demos/btk-demo/printing.c (do_printing): Add a BtkPrintOperation demo.

2006-05-11  Carlos Garcia Campos  <carlosgc@bunny.org>

	* btk/btkfilechooserembed.c: use I_() instead of _() when creating
	response-requested signal. Fixes bug #341416

2006-05-11  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkkeysyms.h: Regenerated from Xorg 7.1 keysyms.h, using
	bdkkeysyms-update.pl.

	* bdk/bdkkeysyms-update.pl: Script to sync bdkkeysyms.h
	with Xorg.  (#321896, Simos Xenitellis)

	* bdk/Makefile.am (EXTRA_DIST): Add bdkkeysyms-update.pl

	* bdk/bdkkeysyms.h: Consistently use lowercase in hex numbers.

2006-05-10  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btknotebook.c: check that tab_label is not NULL before checking
	that it's notebook's child. Closes #341247.

Wed May 10 15:57:53 2006  Tim Janik  <timj@imendio.com>

	* applied unified patch for configurable scroll arrow sizes from
	bug #333632 and bug #325282.

	* btk/btkwidget.c (btk_widget_class_init): added ::scroll-arrow-hlength
	and ::scroll-arrow-vlength style properties. fixed upper limit for
	::separator-width and ::separator-height to be MAXINT.

	* btk/btkmenu.c: use BtkWidget::scroll-arrow-vlength to determine the
	scroll arrow size, instead of using a hard coded constant.

	* btk/btknotebook.c: use BtkWidget::scroll-arrow-vlength and
	BtkWidget::scroll-arrow-hlength to determine scroll arrow sizes.
	added BtkNotebook::arrow-spacing style property to configure the
	spacing between scroll arrows.

2006-05-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpagesetupunixdialog.c: Don't include langinfo.h
	unconditionally.  (#341217)

2006-05-10  John (J5) Palmieri  <johnp@redhat.com>

	* modules/printbackends/cups/btkprintbackendcups.c:
	make the _CUPS_MAP_ATTR_STR macro not dup the string so we don't
	leak 

2006-05-10  Francisco Javier F. Serrador  <serrador@cvs.bunny.org>

	* btk/paper_names.c: Correct #11 Envelope typo.

2006-05-09  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkevents-win32.c (doesnt_want_scroll): Look at both
	BDK_SCROLL_MASK and BDK_BUTTON_PRESS_MASK. (#139628)

2006-05-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextbuffer.c (btk_text_buffer_class_init): Add a :cursor-position
	property.  (#334412, Yevgen Muntyan)

	* btk/btk.symbols:
	* btk/btkmessagedialog.[hc]: Add an image property.  (#337306, Alex Graveley)

2006-05-09  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btknotebook.c: create an independent BdkWindow to behave nicely
	during reordering with tab_labels with their own window, also use
	btk_drag_set_icon_widget() for the DnD icon to avoid drawing garbage
	from offscreen rebunnyions. Closes bug #335707.
	(btk_notebook_tab_space), (btk_notebook_calculate_shown_tabs),
	(btk_notebook_calculate_tabs_allocation): new functions, 
	btk_notebook_pages_allocate() functionality has been splitted into
	these.

2006-05-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_add_shortcut_folder): 
	* btk/btktextbufferserialize.c (parse_attr_element): Fix some typos in
	messages.  (#341091, Tino Meinen)

	* btk/btkstatusicon.c: Some cleanups.
	
	* btk/btkstatusicon.c (btk_status_icon_get_property): Silently return
	NULL if the storage type of the image does not match.  (#340516, Christian
	Persch)

	* btk/btktoolbar.c (_btk_toolbar_elide_underscores): Elide (_x) in the middle
	of the string, too.  (#323956, Abel Cheung)

	* btk/btkuimanager.c (update_node): Fix tooltips. (#340527, Jon-Kare Hellan)

	* configure.in: Require Bango 1.13.0

	* btk/btknotebook.c: 
	* btk/btkwindow.c: 
	* btk/btkrange.c: Fix doc typos.

2006-05-08  Francisco Javier F. Serrador  <serrador@cvs.bunny.org>

	* btk/btkprintunixdialog.c (btk_print_unix_dialog_class_init):
	Corrected a duplicate word.

	* btk/btkrecentmanager.c (btk_recent_manager_add_full): Corrected
	a typo.

2006-05-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrange.c (btk_range_key_press):  Chain up, to
	make bindings work.  Noticed by Al Puzzuoli.
	
2006-05-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkseparator.c: 
	* btk/btkscrollbar.c: 
	* btk/btkpaned.c: 
	* btk/btkoldeditable.c: 
	* btk/btkmisc.c: 
	* btk/btkitem.c: 
	* btk/btkimcontext.c: 
	* btk/btkrange.c:
	* btk/btkscale.c: Make types abstract again.

2006-05-06  Matthias Clasen   <mclasen@redhat.com>
	
	* bdk/bdkwindow.c (bdk_window_get_toplevels): Fix a wrong
	reference in the docs.  (#340870, Ed Catmur)

2006-05-05  Christian Persch  <chpe@cvs.bunny.org>

	* modules/printbackends/cups/btkprintbackendcups.c:
	* modules/printbackends/lpr/btkprintbackendlpr.c:
	* modules/printbackends/pdf/btkprintbackendpdf.c: Always register
	  the type with the type module, even if it had been registered
	  before. Fixes bug #340676.

2006-05-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintunixdialog.c: Use theme colors for 
	the page layout indicator, and do RTL flipping for
	the collate indicator.

2006-05-05  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Require GLib 1.11.0

	* configure.in: Bump version

	* === Released 2.9.0 ===

	* configure.in: Require bairo 1.1.6

	* btk/Makefile.am: Tweaks to make distcheck work.

2006-05-05  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprintoperation-unix.c:
	Implement per-page paper sizes.
	
	* btk/btkprintoperation.c:
	Implement per-page paper sizes for pdf output.
	Make btk_print_operation_set_pdf_target() work again
	
	* tests/Makefile.am:
	* tests/testprint.c:
	* tests/testprintfileoperation.[ch]:
	Add more test code for printing support.
	This tests per-page paper sizes & orientation and
	deriving from BtkPrintOperation.

2006-05-04  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkkeys-directfb.c: DIKI_ALTGR to compile with
	directfb 0.9.25.1

2006-05-04  Michael Natterer  <mitch@imendio.com>

	* btk/btk.symbols: remove btk_printer_set_backend so it compiles
	again.

2006-05-04  Alexander Larsson  <alexl@redhat.com>

	* btk/btk.symbols:
	Added new symbols
	
	* btk/btkpagesetupunixdialog.c:
	* btk/btkprintunixdialog.c:
	Destroy backends when finalizing dialogs.
	Fix printer leak in selected_printer_changed.
	
	* btk/btkprintbackend.[ch]:
	Convert from interface to baseclass.
	Move printer hashtable here so that the baseclass can handle
	the slightly complicated ownership model.
	Add btk_print_backend_destroy which runs the dispose method,
	causing the ref-cycles between the backend and its printers
	to be broken.
	Add btk_print_backend_unref_at_idle().
	
	* btk/btkprinter.[ch]:
	BtkPrinter objects now ref their backend so that its always
	availible, since its needed for the printer object to work.
	This causes a reference-cycle that is broken using
	btk_print_backend_destroy.
	Add btk_printer_compare.
	
	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation-unix.c:
	* btk/btkprintoperation.c:
	Implement !show_dialog for unix.
	Make sure the print data is fully spooled before returning
	from a sync run_dialog.
	
	
	* modules/printbackends/cups/btkcupsutils.[ch]:
	Add btk_cups_request_ipp_add_strings
	
	* modules/printbackends/cups/btkprintbackendcups.c:
	* modules/printbackends/cups/btkprintercups.c:
	* modules/printbackends/lpr/btkprintbackendlpr.c:
	* modules/printbackends/pdf/btkprintbackendpdf.c:
	Convert backends to derive instead of implementing interface.
	Move common code into baseclass.
	CUPS:
	  Remove the printer polling in dispose, not finalize.
	  In the cups watch, remove the backend at idle instead of
	  immediately, since the unref can cause the module to be unloaded.
	  Limit the number of printer attributes requested
	  Get printer uri in initial printer listing so that we can use
	  the printer object immediately.
	
	* tests/Makefile.am:
	* tests/testnouiprint.c:
	Add testcase for !show_dialog.

2006-05-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols:
	* btk/btkfilesystem.c:
	* btk/btkfilesystemunix.c:
	* btk/btkprintbackend.h:
	* btk/btkrecentchooserdefault.c:
	* btk/btkrecentchooserdefault.h:
	* btk/paper_names_offsets.c: Make symbol list mstch reality.
	
	* btk/Makefile.am: Fix a typo.
	
	* bdk/x11/Makefile.am (EXTRA_DIST): Add bdksettings.c

2006-05-03  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Updates

2006-05-04  Murray Cumming <murrayc@murrayc.com>

	* btk/btktreemodel.c: (btk_tree_model_base_init): Changed the 
	language of the signals documentation slightly. Bug #340205.

2006-05-03  Federico Mena Quintero  <federico@novell.com>

	Merged the federico-filename-entry branch, to fix bug #136541.
	Combined ChangeLogs:

	2006-04-17  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserdefault.c (pending_select_paths_process):
	Oops, we *do* need to check that we are in OPEN mode before
	selecting the first row in the file list.  See
	https://bugzilla.novell.com/show_bug.cgi?id=166906
	(btk_file_chooser_default_get_paths): If we are in the case for
	the file list, and the list has no selected rows, jump to the case
	for the filename entry.  This is so that

	       1. The user types a filename in the SAVE filename entry
	          ("foo.txt").

	       2. He then double-clicks on a folder ("bar") in the file
		  list.

	will yield the expected "bar/foo.txt" selection.

	2006-03-29  Federico Mena Quintero  <federico@novell.com>

	* btk/btkpathbar.c (btk_path_bar_init): Reduce the inter-button
	spacing to 0.

	* btk/btkfilechooserdefault.c (browse_widgets_create): Make the
	location label bold.

	2006-03-29  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserdefault.c (location_mode_set): Just change the
	location_mode field if we are in SAVE/CREATE_FOLDER modes.
	(btk_file_chooser_default_get_paths): Get the path based on the
	currently focused widget, or the last-focused widget.  This is
	what we should have been doing in the beginning, but it worked out
	fine because we didn't have the possibility of a filename entry in
	OPEN mode.
	(btk_file_chooser_default_should_respond): Handle the case where
	the last focused widget is the location_entry.

	2006-03-28  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechoosersettings.[ch]: New files with a simple
	framework for saving/loading settings from the file chooser in
	$XDG_CONFIG_HOME/btk-2.0/btkfilechooser.

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_unmap):
	Save the current settings.
	(settings_save): New helper function.  We save the location_mode
	and show_hidden flags.
	(btk_file_chooser_default_map): Load the settings.
	(settings_load): New helper function.

	* btk/btkfilechooserentry.c
	(_btk_file_chooser_entry_set_file_part): Oops, don't modify
	in_change.  Our handlers are what set the file_part, so they
	*must* be run when we modify the text.

	2006-03-27  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserprivate.h (struct _BtkFileChooserDefault):
	Removed the save_file_name_entry.  We'll make this be the same as
	the location_entry widget.
	(struct _BtkFileChooserDefault): Leave only location_button,
	location_entry_box, location_label, location_entry.  We'll use a
	single toggle button for the location entry, which will appear
	below the path bar.
	(struct _BtkFileChooserDefault): Added a
	processing_pending_selections flag.

	* btk/btkfilechooserdefault.c (save_widgets_create): Destroy the
	old location_entry if necessary, and hide the location toggle
	widgets.
	(update_chooser_entry): In multiple selection mode, just clear the
	location_entry.
	(check_save_entry): Allow running in OPEN or SELECT_FOLDER modes
	if we are in LOCATION_MODE_FILENAME_ENTRY.
	(btk_file_chooser_default_should_respond): Switch to a folder if
	the location_entry contains a folder name in OPEN and SAVE mode,
	not just SAVE mode.  If the entry doesn't contain a folder name,
	but is otherwise well-formed, and we are in OPEN mode, return that
	we should respond with that filename.
	(btk_file_chooser_default_initial_focus): Focus the location_entry
	if appropriate.
	(browse_widgets_create): Create the location_entry_box and the
	location_label here.
	(update_appearance): Call location_mode_set() when switching back
	to OPEN/SELECT_FOLDER mode.  Hide the location_button when
	switching to SAVE/CREATE_FOLDER mode.
	(pending_select_paths_process): Turn the
	processing_pending_selections flag on and off around changes to
	the current selection.  Don't special-case OPEN mode anymore,
	since the new flag will take care of things in
	update_chooser_entry().
	(update_chooser_entry): Don't do anything if
	processing_pending_selections is TRUE.  This keeps the entry from
	being polluted when changing folders.
	(location_popup_handler): In OPEN/SELECT_FOLDER modes, toggle
	between the path bar and the entry.  In SAVE/CREATE_FOLDER modes, simply focus the
	location_entry.
	(update_from_entry): Removed.
	(location_entry_create): Removed.
	(open_location_cb): Removed.
	(file_list_build_popup_menu): Don't add an "Open _Location" menu item.
	(location_entry_set_initial_text): Don't do anything if
	current_folder is NULL.

	* btk/btkfilechooserentry.c
	(_btk_file_chooser_entry_set_file_part): Turn in_change on and off
	around the call to btk_entry_set_text().  This makes completion
	not happen when the caller has explicitly set a name.

	2006-03-24  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserprivate.h (struct _BtkFileChooserDefault):
	Added fields location_mode_box, location_pathbar_radio,
	location_filename_radio, location_widget_box, location_label,
	location_entry.  The radio buttons will switch between the pathbar
	and the location entry; the other boxes are for layout purposes.
	(enum LocationMode): New enum.
	(struct _BtkFileChooserDefault): Added a location_mode field.

	* btk/btkfilechooserdefault.c (browse_widgets_create): Create the
	location radio buttons to switch between the pathbar and the
	location entry.  Pack the browse_path_bar in the new
	location_widget_box instead of a generic hbox.
	(location_buttons_create): New function.
	(btk_file_chooser_default_init): Initialize impl->location_mode.
	(location_switch_to_path_bar): New function.
	(location_switch_to_filename_entry): New function.

	* btk/btkfilechooserbutton.c (model_add_special): The display_name
	should not be const.

2006-05-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprintunixdialog.c: Replace the xpm collate icons
	by bairo drawing that respects themes.

	* bdk/quartz/Makefile.am (libbdk_quartz_la_SOURCES): Add
	missing files.  (#340533, Ludovic Rousseau)

	* btk/btkprintunixdialog.c (draw_page_cb): Don't leak the
	bairo context here.  (#340522, Christian Persch)

	* btk/btkprintoperation-unix.c (unix_finish_send): Don't
	use btk_dialog_run for the error dialog, and improve the
	dialog in other ways.  (#340510, Christian Persch)

	* btk/btkpagesetupunixdialog.c: Beautify the custom
	paper size dialog.  (#339590, patch by Christian Persch)
	
	* btk/btkaccessible.c:
	* btk/btkclipboard.c:
	* btk/btkfilefilter.c:
	* btk/btkimmodule.c:
	* btk/btkmenubar.c: More G_DEFINE_TYPE conversion.

	* btk/btkwidget.c: Make BtkWidget abstract again.

2006-05-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/*.c: Use G_DEFINE_TYPE and g_type_register_static_simple()
	where applicable, for ~5000 lines of code reduction. This also
	reduces the size of the data section by ~9k. The overall library
	sizes shrinks a bit less, since the text section gets a bit
	larger.

2006-05-02  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreeview.c (btk_tree_view_row_inserted): set tmpnode to
	the return value of the _btk_rbtree_insert* functions, since that
	is the node we really want to check for visibilty.

2006-05-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprinter.[hc]: Don't use virtual as a parameter name.
	(#340394, Christian Persch)

2006-05-02  Christian Persch  <chpe@cvs.bunny.org>

	* btk/btkpagesetupunixdialog.c:
	* btk/btkprintcontext.c: 
	* btk/btkprinter.c:
	* btk/btkprinteroptionwidget.c:
	* btk/btkprintjob.c:
	* btk/btkprintoperation-unix.c:
	* btk/btkprintoperation.c:
	* btk/btkprintunixdialog.c: Use a priv variable when accessing priv
	  multiple times in the same function. Bug #340288.

2006-05-02  Michael Natterer  <mitch@imendio.com>

	* btk/btklabel.c (btk_label_set_line_wrap): added note about the
	inablity to do height-for-width text layout and suggest to use
	btk_widget_set_size_request() for getting a label that wraps at
	some specific position.

2006-05-02  Kristian Rietveld  <kris@imendio.com>

	* ChangeLog.btk-async-file-chooser: added ChangeLog entries from
	the kris-async-branch.

	* Makefile.am: updated EXTRA_DIST

2006-05-02  Alexander Larsson  <alexl@redhat.com>

	* ChangeLog.btk-printing: 
	* Makefile.am (EXTRA_DIST):
	Add ChangeLog.btk-printing

2006-05-01  Matthias Clasen  <mclasen@localhost.localdomain>

	* NEWS: Updates

2006-05-02  Kristian Rietveld  <kris@imendio.com>


	* configure.in: Up ABI version to 2.10.0 (by Matthias' request).

2006-05-01  Kristian Rietveld  <kris@imendio.com>

	Merge of the BTK+ asynchronous file chooser branch.  Please see
	the kris-asynch-branch for more detailed ChangeLog entries.

	* configure.in: increase binary version to 2.9.0.

	* btk/btk.symbols:
	* btk/btkfilechooser.c:
	* btk/btkfilechooserbutton.c:
	* btk/btkfilechooserdefault.c:
	* btk/btkfilechooserdialog.c:
	* btk/btkfilechooserembed.c:
	* btk/btkfilechooserembed.h:
	* btk/btkfilechooserentry.c:
	* btk/btkfilechooserentry.h:
	* btk/btkfilechooserprivate.h:
	* btk/btkfilesystem.c:
	* btk/btkfilesystem.h:
	* btk/btkfilesystemmodel.c:
	* btk/btkfilesystemmodel.h:
	* btk/btkfilesystemunix.c:
	* btk/btkpathbar.c:
	* btk/btkpathbar.h:
	Merge from kris-async-branch.

2006-05-01  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Updates

2006-04-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreemodel.c (btk_tree_model_base_init): Document
	BtkTreeModel signals.

2006-04-19  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkdrawable-directfb.c: removed all subtracting one on
	clipping

2006-04-30  Kristian Rietveld  <kris@imendio.com>

	Fix for #340200, spotted by Torsten Schoenfeld.

	* btk/btktreeview.c (btk_tree_view_get_cell_area): fix up logic
	calculating the level indentation,
	(btk_tree_view_start_editing): remove code calculating the
	level indentation, since _get_cell_area() takes care of this for us.

2006-04-30  Matthias Clasen  <mclasen@redhat.com>

	Fix problems with setting symbolic colors from rc files.
	(#338345, Benjamin Berg)
	
	* btk/btkrc.c (btk_rc_settings_changed, btk_rc_font_name_changed) 
	(btk_rc_color_hash_changed, btk_rc_reparse_all_for_settings): Don't
	freeze notification for settings changes while parsing; instead
	manually avoid recursion, and update the color hashes.

2006-04-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksettings.c (btk_settings_class_init): Change the default
	value of the btk-color-scheme setting to "".

	* btk/btkprinteroption.c: 
	* btk/btkprinteroptionwidget.c: 
	* btk/btkprintunixdialog.c: Improve the print dialog layout,
	mark some more strings for translation.  (#340139, Christian Persch)

	* btk/btkstatusicon.c (btk_status_icon_class_init): Fix the definition
	of the ::size-changed signal, and improve its documentation.
	(#340112, Christian Persch)

2006-04-29  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkwidget.c (btk_widget_create_bango_layout)
	(btk_widget_get/create_bango_context): Change colormap to font map in
	docs. (#340093)

2006-04-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols: 
	* btk/btkstatusicon.h: 
	* btk/btkstatusicon.c (btk_status_icon_position_menu): Add a menu
	position function for use with popups on status icons.  (#334573, 
	Christian Persch)

	* btk/btkwidget.c (btk_widget_is_composited): Fix a C99ism.  (#340055,
	Kazuki Iwamoto)

2006-04-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrenderertext.c (get_size): Use _static variants when
	copying and merging short-lived Bango layouts. (#340033, Morten Welinder)

2006-04-28  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkwidget.c (btk_widget_create_bango_layout): Fix typo in
	docs. (#340063)

2006-04-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_drag_begin): Don't force
	the standard DND icon if the user has a custom DND source.  
	(#339522, Joe Wreschnig)

2006-04-28  Michael Natterer  <mitch@imendio.com>

	* btk/btktextbuffer.c (create_clipboard_contents_buffer): keep a
	reference to the source buffer while the clipboard contents buffer
	exists, because it is needed for serializing the contents buffer.
	Makes copying from the contents buffer possible even after the
	resp. text view is destroyed (for example when there is a
	clipboard manager running on app exit) (bug #339195).

2006-04-27  Behdad Esfahbod  <behdad@bunny.org>

	* bdk/bdkbango.c (bdk_bango_renderer_draw_glyphs): Cast to double
	before dividing by BANGO_SCALE. (#334582)

2006-04-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (popup_position_func): Improve positioning
	of the menu when popped up by keynav.  (#334987, Christian
	Persch)

	* btk/btkdnd.c (btk_drag_set_icon_window): Handle the case
	of being called after the drag is cancelled.  (#339224, 
	Benjamin Otte)

	* bdk/x11/bdkscreen-x11.c (_bdk_x11_screen_process_owner_change):
	Use XFixes only if it is available.  (#339839, Marko Anastasov)

2006-04-26  Federico Mena Quintero  <federico@novell.com>

	* btk/btkdialog.c (btk_dialog_close): Don't make this conditional
	on having a BTK_RESPONSE_CANCEL button -> end the idiocy.  Fixes
	bug #101293.

2006-04-26  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreeview.c (node_is_visible): new function,
	(validate_visible_area): when a node is validated, only queue a
	redraw for that node, not for the entire widget (a redraw for the
	entire widget is only needed when the sizes change, and
	_queue_resize() will take care of that),
	(do_validate_rows): do not queue a redraw, redraws are only needed
	for changes in the visible area and validate_visible_area() takes
	care of that,
	(btk_tree_view_row_inserted): for fixed height mode, only queue
	a resize and redraw if the node is visible, else no redraw is needed.

2006-04-26  Kristian Rietveld  <kris@imendio.com>

	If this new "row-ending-details" property is turned on, more
	detailed "details" will be passed to the theme engine for drawing
	the background, drop indicator and focus rectangle.  Requirement is
	that the theme engine supports these details. (#333760).

	* btk/btktreeview.c (btk_tree_view_class_init): add row-ending-details
	style property,
	(btk_tree_view_bin_expose): pass more detailed detail to
	btk_paint_flat_box() if the property is turned on,
	(btk_tree_view_bin_expose): likewise for the drop indicator,
	(btk_tree_view_bin_expose): likewise for the focus rectangle.

2006-04-26  Kristian Rietveld  <kris@imendio.com>

	New "show-expanders" and "level-indentation" properties, which can
	be used for customizing the tree view.  (For example to do
	grouping as demonstrated in the test application).
	Discussion in #80869.

	* btk/btktreeprivate.h: add level_indentation field.

	* btk/btktreeview.c (btk_tree_view_class_init),
	(btk_tree_view_init), (btk_tree_view_set_property),
	(btk_tree_view_get_property): add the properties to the object,
	(btk_tree_view_button_press), (do_prelight),
	(btk_tree_view_bin_expose), (validate_row),
	(btk_tree_view_discover_dirty_iter), (btk_tree_view_get_cell_area),
	(btk_tree_view_create_row_drag_icon): take the new properties
	into account,
	(btk_tree_view_start_editing): fix cell placement code.

	* tests/testgrouping.c: new test application, showing how to
	implement grouping.

	* tests/Makefile.am: updated.

2006-04-25  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdk.symbols: Add bdk_screen_is_composited

	* btk/btkprintjob.c (btk_print_job_set_source_file): Add docs.

	* btk/btkprintoperation.c: Add docs.

Tue Apr 25 10:25:28 2006  SÃ¸ren Sandmann  <sandmann@redhat.com>

	* tests/testbtk.c (create_alpha_window): Create 'composited' label.

	* tests/testbtk.c (on_composited_changed): New function, change
	the label to say whether the screen is composited or not.

	* btk/btkwindow.c (btk_window_on_composited_changed): When
	composited status change, invalidate the window and propagate the signal;.

	* btk/btkwindow.c (btk_window_map): Set the appropriate type hint
	if reset_type_hint is TRUE.

	* btk/btkwindow.c (btk_window_set_type_hint): If hint is one of
	the old hints, store a shadow copy in the public window->type_hint
	bitfield, otherwise set this field to normal. Set the private
	field to the type hint.

	* btk/btkwindow.c (btk_window_init): Initialize priv->type_hint. 

	* btk/btkwindow.c (struct _BtkWindowPrivate): New field
	"reset_type_hint" indicating whether the type hint needs to be
	reset. New field type_hint containing a BdkWindowTypeHint.

	* btk/btkwidget.c (propagate_composited_changed): New function to
	propagate changes in composited status.
	(btk_widget_class_init): Add composited_changed signal.
	
	* btk/btkwidget.h (struct _BtkWidgetClass): New signal composited-changed.

	* btk/btkwidget.c (btk_widget_is_composited): New function.

	* btk/btktooltips.c (btk_tooltips_draw_tips): Set transient for.

	* btk/btktooltips.c (btk_tooltips_force_window): Set the type hint

	* btk/btkmenuitem.c (btk_menu_item_position_menu): Compute whether
	the item belongs to a menubar. Set the type_hint appropriately
	depending on the outcome.

	* btk/btkmenu.c (btk_menu_position): Set the default type hint here.

	* btk/btkmenu.c (btk_menu_attach_to_widget): connect to hierarchy
	changed on the attach widget.

	* btk/btkmenu.c (attach_widget_hierarchy_changed): New function to
	set the transient_for property for menus.

	* btk/btkdnd.c (set_icon_stock_pixbuf): Set the appropriate type hint.

	* btk/btkcombo.c (btk_combo_popup_list): Make the popup window
	transient for the toplevel.

	* btk/btkcombobox.c (btk_combo_box_set_popup_widget): Set
	transient-for, for the popup window.

	* bdk/x11/bdkwindow-x11.c (bdk_window_get_type_hint): Support for
	new window types.

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_type_hint): Add support
	for new window types.

	* bdk/x11/bdkscreen-x11.c (_bdk_x11_screen_process_owner_change):
	New function called whenever the compositing manager comes and goes.

	* bdk/x11/bdkscreen-x11.c (bdk_screen_is_composited): New function.

	* bdk/x11/bdkscreen-x11.c
	(_bdk_x11_screen_request_cm_notification, make_cm_atom,
	check_is_composited): New functions

	* bdk/x11/bdkevents-x11.c (bdk_event_translate): Call
	_bdk_x11_screen_process_owner_change when an
	XFixesSelectionNotifyEvent is received.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Call
	_bdk_x11_screen_request_cm_notification() on all screens.

	* bdk/quartz/bdkscreen-quartz.c (bdk_screen_is_composited): Dummy
	implementation. 

	* bdk/bdkscreen.c (bdk_screen_class_init): New signal,
	'composited-changed'.

	* bdk/bdkwindow.h: Add new EWMH window types.

	* bdk/win32/bdkscreen-win32.c (bdk_screen_is_composited) 

2006-04-25  Matthias Clasen  <mclasen@redhat.com>
	
	* modules/printbackends/cups/btkprintbackendcups.c: 
	Add some more translatable PPD option names.

2006-04-24  Matthias Clasen  <mclasen@redhat.com>

	* po/POTFILES.in:
	* po-properties/POTFILES.in: Updates

	* btk/paper_names.c: Declare PaperInfo here.

	* btk/gen-paper-names.c: Add a prefix to gettext msgids.

	* btk/paper_names_offsets.c: Regenerated.
	
	* btk/btkpapersize.c (btk_paper_size_get_display_name):
	Use g_strip_context() to strip the prefix.

2006-04-24  Matthias Clasen  <mclasen@redhat.com>
	
	* btk/btkfontbutton.c: Small doc fixes.

	* btk/btkprintunixdialog.h: 
	* btk/btkpagesetupunixdialog.h: Fix includes (#338665)

	* btk/btkprintsettings.h (BtkPageRange): Declare in a way grokked by btk-doc.

	* bdk/bdkrebunnyion-generic.c: Documentation fixes.

	* bdk/directfb/bdkmain-directfb.c: Make the comment not look like
	a doc comment.

	* btk/btkprintunixdialog.c: Add docs.

	* btk/btkstatusicon.c (btk_status_icon_get_visible): Typo fix.

2006-04-24  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprinter.c:
	Don't ref the backend since the backend owns the printer.

2006-04-24  Alexander Larsson  <alexl@redhat.com>

	* btk/btkpagesetupunixdialog.c (update_combo_sensitivity_from_printers):
	Remove spew.

2006-04-24  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprintunixdialog.c (create_page_setup_page):
	Even/Odd Pages -> Even/Odd Sheets

2006-04-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols:
	* btk/btkprintoperation.c (btk_print_operation_run_async): Refactor the
	btk_print_operation_run() code and add an _async version.

	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation-unix.c
	(_btk_print_operation_platform_backend_run_dialog_async)
	(btk_print_run_page_setup_dialog_async): Variants of the run functions
	which don't call btk_dialog_run(), but only show the dialog and return,
	and handle the response in a signal handler.

	* btk/btkprintoperation-win32.c (btk_print_run_page_setup_dialog_async) 
	(_btk_print_operation_platform_backend_run_dialog_async): Implement these 
	by calling the sync versions.

	* btk/btkprintoperation-unix.c: Cleanups.

	* btk/btkpagesetupunixdialog.c (btk_page_setup_unix_dialog_get_page_setup):
	Remove redundant code.

	* btk/Makefile.am: Install btkprintjob.h as Unix-specific print API.

	* btk/btkprintoperation-unix.c (btk_print_run_page_setup_dialog): 
	Return a copy of the original page setup if the dialog was canceled.

2006-04-24  Alexander Larsson  <alexl@redhat.com>

	* btk/btkprintjob.h:
	Declare BtkPrintJob.
	
	* btk/btkprintunixdialog.c: (btk_print_unix_dialog_get_settings):
	Change g_return_if_fail to g_return_val_if_fail.

2006-04-24  Alexander Larsson  <alexl@redhat.com>

	* configure.in:
	Check for bairo-pdf.h.
	Check for bairo-ps.h on non-win32.

2006-04-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkclipboard.h: 
	* btk/btkprinter.c: 
	* btk/btkprintsettings.h: 
	* btk/btkprintsettings.c: Match parameter names with the headers.

	* btk/btkprintoperation-unix.c (btk_print_run_page_setup_dialog): 
	Add docs.

	* btk/btktextbufferrichtext.c (btk_text_buffer_deserialize): 
	* btk/btkstatusicon.c (btk_status_icon_get_storage_type): 
	* btk/btktreeview.c (btk_tree_view_set_search_position_func): 
	* btk/btktreeview.c (btk_tree_view_get_headers_clickable): 
	* btk/btkcellrendererspin.c (btk_cell_renderer_spin_new): 
	* btk/btkmenu.c (btk_menu_get_for_attach_widget): Fix the docs.

	* btk/btkprinter.h: Don't declare BtkPrintJob here.
	* btk/btkprinter-private.h: Instead include btkprintjob.h.

2006-04-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkprinter-private.h: 
	* btk/btkprintbackend.h: 
	* btk/btkprinter.[hc]: 
	* btk/btkprintjob.[hc]: Use g types, add documentation, and some
	stylistic fixups.

	* btk/btkaboutdialog.c (activate_url): Avoid a compiler warning.

	* btk/btkpapersize.[hc]: Use g types, add documentation.

	* btk/btkprintunixdialog.c (btk_print_unix_dialog_get_settings): 
	Use g_return_val_if_fail in non-void functions.

	* btk/Makefile.am: Add btkprintutils.[hc]

	* btk/btkprintutils.[hc]: New files, move the unit conversion
	functions here.

	* btk/btkpagesetupunixdialog.c: 
	* btk/btkprintsettings.c: 
	* btk/btkpagesetup.c: 
	* btk/btkpapersize.c: Replace all static copies of to_mm/from_mm
	by the copies in btkprintutils.c.

	* btk/btkpagesetup.[hc]: Use g types, add documentation.

	* btk/btkprintsettings.c: More documentation

2006-04-22  Tor Lillqvist  <tml@novell.com>

	* btk/Makefile.am (btk_private_h_sources): Small workaround for
	weird bug in some versions of Automake at least on Windows.

2006-04-21  Alexander Larsson  <alexl@redhat.com>

        Merge the btk-printing branch.
	For more detailed ChangeLog entries, see the ChangeLog.btk-printing.
	
	* .cvsignore:
	* Makefile.am:
	* configure.in:
	* docs/tools/widgets.c:
	* btk+-unix-print-2.0.pc.in:
	* btk/Makefile.am:
	* btk/gen-paper-names.c:
	* btk/btk.h:
	* btk/btk.symbols:
	* btk/btkenums.h:
	* btk/btkiconfactory.c:
	* btk/btkmarshalers.list:
	* btk/btkpagesetup.[ch]:
	* btk/btkpagesetupunixdialog.[ch]:
	* btk/btkpapersize.[ch]:
	* btk/btkprint-win32.[ch]:
	* btk/btkprintbackend.[ch]:
	* btk/btkprintcontext.[ch]:
	* btk/btkprinter-private.h:
	* btk/btkprinter.[ch]:
	* btk/btkprinteroption.[ch]:
	* btk/btkprinteroptionset.[ch]:
	* btk/btkprinteroptionwidget.[ch]:
	* btk/btkprintjob.[ch]:
	* btk/btkprintoperation-private.h:
	* btk/btkprintoperation-unix.c:
	* btk/btkprintoperation-win32.c:
	* btk/btkprintoperation.[ch]:
	* btk/btkprintsettings.[ch]:
	* btk/btkprintunixdialog.[ch]:
	* btk/paper_names.c:
	* btk/paper_names_offsets.c:
	Platform independent printing API and implementations
	for unix and windows.

	* btk/btkstock.h:
	* btk/stock-icons/24/btk-orientation-landscape.png:
	* btk/stock-icons/24/btk-orientation-portrait.png:
	* btk/stock-icons/24/btk-orientation-reverse-landscape.png:
	Add stock icons for page orientation.
	
	* modules/Makefile.am:
	* modules/printbackends/Makefile.am:
	* modules/printbackends/cups/Makefile.am:
	* modules/printbackends/cups/btkcupsutils.[ch]:
	* modules/printbackends/cups/btkprintbackendcups.[ch]:
	* modules/printbackends/cups/btkprintercups.[ch]:

	Cups printing backend for unix.
	
	* modules/printbackends/lpr/Makefile.am:
	* modules/printbackends/lpr/btkprintbackendlpr.[ch]:
	lpr printing backend for unix.
	
	* modules/printbackends/pdf/Makefile.am:
	* modules/printbackends/pdf/btkprintbackendpdf.[ch]:
	print-to-pdf printing backend for unix.
	
	* tests/.cvsignore:
	* tests/Makefile.am:
	* tests/print-editor.c:
	Test application for printing.

	* bdk/bdk.symbols:
	* bdk/win32/bdkevents-win32.c:
	* bdk/win32/bdkwin32.h:
	Add bdk_win32_set_modal_dialog_libbtk_only so that we can pump the
	mainloop while displaying a win32 common dialog.

	* bdk/directfb/Makefile.am:
	Whitespace cleanup.
	
2006-04-20  Paolo Borelli  <pborelli@katamail.com>

	* btk/btkcombobox.c: plug small leak (#339132)
	* tests/testcombo.c: ditto

2006-04-19  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkdrawable-directfb.c: fixed off by one error in
	clip patch from (#330824)

2006-04-19  Murray Cumming  <murrayc@murrayc.com>

	* btk/btkfilechooserbutton.c: _BtkFileChooserButtonPrivate:
	Added has_title flag so we can remember whether a title has 
	been set.
	(btk_file_chooser_button_constructor): If no title has been
	set then set it to the default title. This means that the 
	default title will be used if the dialog was instantiated with 
	g_object_new(), without using the btk_file_chooser_button_new() 
	convenience function. This helps language bindings.
	(btk_file_chooser_button_set_property): Set has_title when 
	setting the title.

2006-04-19  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkkeys-win32.c (handle_special): Map VK_NUMPAD[0-9]
	to BDK_KP_[0-9]. (#337562)

2006-04-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrc.c: Allocate pixmap_path dynamically, rather than
	using a fixed array of size 128.

	* btk/btkiconcache.c: Apply a patch by Paolo Borelli to factor
	out a strip_suffix() function and save some memory.  (#338307)

2006-04-18  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btknotebook.c (btk_notebook_pages_allocate): removed wrong
	condition check that caused tab labels not to be drawn under certain
	circumstances. Bug #338734.

2006-04-17  Kjartan Maraas  <kmaraas@bunny.org>

	* configure.in: Remove obsolete entry for no_NO
	* po-properties/no.po: And the translation
	* po/no.po: And the translation.

2006-04-17  Matthias Clasen  <mclasen@redhat.com>

	* demos/btk-demo/colorsel.c (expose_event_callback): Small formatting
	fix.

2006-04-17  Christian Persch  <chpe@cvs.bunny.org>

	* btk/btkdnd.c: (btk_drag_dest_set), (btk_drag_dest_set_proxy): Fix
	UMR in btk_drag_dest_motion. Bug #338725.

2006-04-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksettings.c (btk_settings_class_init): 
	* btk/btkentry.c (btk_entry_class_init): Fix typos
	in property blurbs.  (#338772, Clytie Siddall)

2006-04-16  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkdrawable-quartz.c: (bdk_quartz_draw_drawable): Add check 
	for source being a window.

	* bdk/quartz/bdkwindow-quartz.c: (_bdk_windowing_window_get_pointer):
	Don't assert on window not being the root window.

2006-04-16  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkdrawable-quartz.c: Remove leading bairo/ in include.

2006-04-16  Matthias Clasen <mclasen@redhat.com>

	* bdk/x11/bdkwindow-x11.c (set_initial_hints ): Avoid a
	possible array overrun.  (Coverity)

	* btk/btkcalendar.c (btk_calendar_key_press): Avoid a
	possible array overrun.  (Coverity)

	* btk/btktextbuffer.c (_btk_text_buffer_remove_all_tags):
	Avoid a NULL dereference.  (Coverity)

2006-04-15  Matthias Clasen <mclasen@redhat.com>

	* btk/btkrecentmanager.c: Make filename_warning() static,
	and use caseless matching when looking for file:/.  
	(#336772, Morten Welinder)

2006-04-13  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkevents-quartz.c:
        (synthesize_enter_event):
        (synthesize_leave_event):
        (synthesize_crossing_events):
        Take grabs into account.

        (find_window_for_event):
        Only return grabbed window when owner_events is FALSE.

2006-04-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_header_focus): Reorganize slightly
	to avoid a possible NULL dereference.  (Coverity)

2006-04-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_get_arrow_xrange): Don't
	allow passing NULL for x1 or x2, adjust callers.

	* btk/btktreeviewcolumn.c (_btk_tree_view_column_get_neighbor_sizes): 
	Reorganize to avoid a possible NULL pointer dereference.  (Coverity)

        * btk/btknotebook.c (btk_notebook_page_allocate): Reorganize
        to avoid a possible NULL dereference.  (Coverity)

	* bdk/x11/bdkimage-x11.c (bdk_image_new_bitmap): Handle
	closed displays correctly.  (Coverity)

        * contrib/bdk-pixbuf-xlib/Makefile.am:
        * modules/engines/pixbuf/Makefile.am
        * bdk-pixbuf/Makefile.am: Build fixes for Cygwin.  (#338262)

	* bdk/x11/bdkselection-x11.c (make_list): Make this work
	for list == NULL.  (Coverity)

	* bdk/x11/bdkkeys-x11.c (bdk_keymap_get_entries_for_keycode): 
	Rearrange the code a bit.

	* btk/btktextlayout.c (btk_text_layout_validate_yrange): 
	Handle _btk_text_line_get_data() returning NULL in all
	cases.  (Coverity)

	* btk/btkuimanager.c: Make find_menu_position and
	find_toolbar_position void.  (#338100)

2006-04-12  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkkeys-quartz.c:
        Handle page up and page down.

2006-04-12  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkdrawable-quartz.c:
        (_bdk_quartz_drawable_release_context):
        Don't flush if we're inside a begin_paint/end_paint pair.
        
        * bdk/quartz/bdkwindow-quartz.c:
        (bdk_window_impl_quartz_end_paint):
        Free clip rebunnyion here.

2006-04-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (start_element_handler): Don't pass
	a negative value as string length to get_child_node().  (Coverity)

	* btk/btkicontheme.c (insert_theme): Handle dirs == NULL
	gracefully.  (Coverity)

	* btk/btknotebook.c (btk_notebook_remove): Silently do nothing
	if the widget is not a child.  (Coverity)

2006-04-11  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkkeys-x11.c (get_xkb): Return early in error
	cases.  (Coverity)

	* btk/btktextview.c (selection_motion_event_handler): Remove
	some unused variables.

	* btk/btktreeview.c ((btk_tree_view_search_position_func): Apply
	a patch from David Trowbridge to improve the positioning of the
	search popup.  (#338047)

2006-04-11  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	* btk/btkrecentmanager.c (btk_recent_manager_init)
	(btk_recent_manager_new): Remove the unneeded setting of the
	storage file inside the constructor. (Murray Cumming)
	(build_recent_items_list): Reset the dirty bit when done rebuilding
	the list from the storage file.

2006-04-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkscale.c (btk_scale_get_layout_offsets): Silence
	compiler warnings.

	* btk/btkinputdialog.c (btk_input_dialog_set_mapping_mode): Don't
	dereference info before checking it for NULL.  (Coverity)

2006-04-11  Anders Carlsson  <andersca@mac.imendio.com>

        * bdk/quartz/BdkQuartzView.c:
        (-[BdkQuartzView drawRect:]):
        * bdk/quartz/bdkdrawable-quartz.c:
        (bdk_quartz_ref_bairo_surface):
        (_bdk_quartz_drawable_get_context):
        (_bdk_quartz_drawable_release_context):
        * bdk/quartz/bdkwindow-quartz.c:
        (bdk_window_impl_quartz_finalize):
        (bdk_window_impl_quartz_class_init):
        (bdk_window_impl_quartz_begin_paint_rebunnyion):
        (bdk_window_impl_quartz_end_paint):
        (bdk_window_impl_quartz_invalidate_maybe_recurse):
        (bdk_window_impl_quartz_process_updates):
        (bdk_window_impl_quartz_paintable_init):
        (_bdk_window_impl_quartz_get_type):
        * bdk/quartz/bdkwindow-quartz.h:
        Have BdkWindowImplQuartz implement BdkPaintable.

2006-04-10  Michael Natterer  <mitch@imendio.com>

	* btk/btktextbufferrichtext.c (btk_text_buffer_deserialize):
	pasted rich text should not be affected by tags that are active at
	the insertion point. Therefore, remove and remember all active
	tags, and re-apply them left and right of the inserted text after
	pasting. Fixes bug #337653.

2006-04-11  Anders Carlsson  <andersca@imendio.com>

        * bdk/bdkinternals.h:
        * bdk/bdkwindow.c:
        (_bdk_paintable_get_type):
        (bdk_window_begin_paint_rebunnyion):
        (bdk_window_end_paint):
        (bdk_window_process_updates):
        (bdk_window_invalidate_maybe_recurse):
        Add new BdkPaintable interface which implementation objects can 
        implement in order to override bdk painting functions.

2006-04-10 Vladimer Sichinava  <vlsichinava@gmail.com>

        * configure.in: Added "ka" (Georgian) to ALL_LINGUAS

2006-04-07  Hans Breuer  <hans@breuer.org>

	* btk/makefile.msc.in tests/makefile.msc : updated

2006-04-06  Tor Lillqvist  <tml@novell.com>

	Correct the appearance of non-square icons and cursors: pad them
	to square so that Windows won't stretch them.

	* bdk/win32/bdkcursor-win32.c (create_alpha_bitmap)
	(create_color_bitmap): Always create square bitmaps, take only
	side length as argument.
	(pixbuf_to_hbitmaps_alpha_winxp, pixbuf_to_hbitmaps_normal):
	Corresponding changes.

2006-04-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c (text_window_realize): Lower the window, to
	prevent late-constructed text windows from covering child 
	widgets.  (#336796, Yevgen Muntyan)

	* btk/btkmain.c (btk_grab_add, btk_grab_remove, btk_grab_notify) 
	(btk_grab_notify_foreach): Rework the code which emits ::grab-notify
	signals to ensure that we emit enough signals. Also optimize the
	code to not do unnecessary tree walking.

	* btk/btkwidget.c (btk_widget_class_init): Document ::grab-notify.

2006-04-05  Paolo Borelli  <pborelli@katamail.com>

	* btk/btktextiter.c (btk_text_iter_ends_line): handle the case of \r
	and \n split across lines. Bug #337022.
	* tests/testtextbuffer.c: add unit test.

Tue Apr  4 12:25:36 2006  SÃ¸ren Sandmann  <sandmann@redhat.com>

	* bdk/x11/bdkimage-x11.c (bdk_image_class_init): Add "_private" to
	make it build.

2006-04-04  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkdisplay.c: 
	* bdk/bdkdisplaymanager.c:
	* bdk/bdkdraw.c:
	* bdk/bdkkeys.c:
	* bdk/bdkpixmap.c:
	* bdk/bdkscreen.c:
	* bdk/bdkwindow.c:
	* bdk/x11/bdkcolor-x11.c:
	* bdk/x11/bdkdisplay-x11.c:
	* bdk/x11/bdkdnd-x11.c:
	* bdk/x11/bdkdrawable-x11.c:
	* bdk/x11/bdkgc-x11.c:
	* bdk/x11/bdkimage-x11.c:
	* bdk/x11/bdkinput.c:
	* bdk/x11/bdkpixmap-x11.c:
	* bdk/x11/bdkscreen-x11.c:
	* bdk/x11/bdkwindow-x11.c: Use G_DEFINE_TYPE.

	* bdk/x11/bdkcolor-x11.c: 
	* bdk/x11/bdkdnd-x11.c:
	* bdk/x11/bdkimage-x11.c: Use instance private data.

2006-04-03  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkrgb.c: Get rid of a duplicate copy of the visual names.

	* btk/btkmain.c: Make btk_args const.

	* btk/btkicontheme.c (pixbuf_supports_svg): Save one static.

	* btk/btkrecentchooser.c (btk_recent_chooser_error_quark):
	* btk/btkrecentmanager.c (btk_recent_manager_error_quark):
	* btk/btkfilechooser.c (btk_file_chooser_error_quark):
	* btk/btkfilesystem.c (btk_file_system_error_quark):
	* btk/btkicontheme.c (btk_icon_theme_error_quark): No point
	in making the error path fast by caching quarks. 

	* btk/btkfilesel.c (no_stat_dirs): Avoid relocation.

	* bdk/bdk.c: Here too.

	* bdk/bdkinternals.h: 
	* bdk/x11/bdkmain-x11.c: 
	* bdk/win32/bdkmain-win32.c: 
	* bdk/directfb/bdkdisplay-directfb.c: 
	* bdk/quartz/bdkmain-quartz.c: Make _bdk_windowing_args const.

	* bdk/win32/bdkpixmap-win32.c: Include bdkscreen.h  (#337032,
	 Kazuki IWAMOTO)

	* btk/btkprogressbar.c (btk_progress_bar_set_text): Mention
	that %NULL is allowed.  (#336937, Christian Neumair)

	* btk/btkmain.c: Get rid of an unnecessary static variable.

	* btk/btktextlayout.c: Fix a warning.
	
	* btk/btktextsegment.h: 
	* btk/btktextsegment.c: 
	* btk/btktextchild.c:
	* btk/btktextbtree.c:
	* btk/btktextmark.c: 
	* btk/btktexttypes.h: Make the segment class pointers const.

	* btk/btktextbufferserialize.c: Make parser struct const.
	
	* btk/btkuimanager.c: Make parser struct const.

	* btk/btklinkbutton.c: Make the default colors const.

	* btk/btkuimanager.c: Avoid relocations. 

	* btk/btkxembed.c (_btk_xembed_message_name): Reduce size of static
	buffer.

	* btk/btktext.c (btk_text_key_press): Avoid relocations.

	* btk/btkrc.c (btk_rc_add_initial_default_files) 
	(btk_rc_add_default_file): Allocate the btk_rc_default_files array
	dynamically.

2006-04-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrc.c: Avoid relocations for the array of symbol names. 

	* btk/btkruler.c: Remove unused strings from the ruler_metrics 
	structs, to avoid relocations.  (#336917, Stephane Chauveau)

2006-04-02  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	* btk/btkrecentmanager.c (btk_recent_manager_set_filename): Build
	the items list after setting the storage file.

	* btk/btkrecentmanager.c (display_closed): Use the right string
	for unsetting the default manager object from the screen.	

2006-04-01  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkfilesel.c (btk_file_selection_get_filename): Oops. (#336784)

2006-04-01  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkfilesel.c (btk_file_selection_get_filename): Use a GString
	instead of static buffer to reduce .bss by 8kb. (#336784)

2006-04-01  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/msw_style.c (draw_hline): Emulate WinXP's
	drawing of menu separators
	
2006-03-31  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkrecentmanager.c: Convert filenames to UTF-8 before printing
	them out in warning messages. (#336770, Morten Welinder)

2006-03-31  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkrecentmanager.c (btk_recent_info_last_application): Update
	last_stamp inside the look. (#336771, Morten Welinder)

2006-03-31  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkrecentchoosermenu.c (btk_recent_chooser_menu_get_property):
	Add missing break. (#336769, Morten Welinder)

2006-03-31  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkfilesystem.c (btk_file_system_get_bookmark_label):
	* btk/btklinkbutton.c (btk_link_button_new_with_label): Return NULL
	instead of FALSE in g_return_val_if_fail in a pointer-returning
	function. (#336764, Morten Welinder)

2006-04-01  Gora Mohanty  <gmohanty@cvs.bunny.org>

	* configure.in: Added 'or' (Oriya) to ALL_LINGUAS.

2006-03-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrecentmanager.c (btk_recent_info_get_age): Don't
	assert that the age is positive.  (#336773, Morten Welinder)

2006-03-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c (load_icon_data): Don't leak the keyfile 
	parser in the error case. 
	
	* btk/btkicontheme.c (load_icon_data, free_unthemed_icon) 
	(icon_data_free, load_themes):
	* btk/btkiconcache.c (_btk_icon_cache_get_icon_data): Use the slice
	allocator for BtkIconData and UnthemedIcon structs.

2006-03-30  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkcalendar.c: Fix translation comments for localizable
	digit formats. (fixes bug #336650)

2006-03-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrecentmanager.h (struct _BtkRecentData): Fix the doc
	comment format.

	* btk/btkrecentmanager.c (btk_recent_manager_has_item) 
	(btk_recent_manager_purge_items, btk_recent_manager_lookup_item) 
	(btk_recent_manager_get_limit, btk_recent_manager_add_full) 
	(btk_recent_manager_get_items, btk_recent_manager_remove_item): 

	* btk/btkrecentfilter.c (btk_recent_filter_add_age): 
	* btk/btkrecentchooser.c (btk_recent_chooser_set_show_numbers) 
	(btk_recent_chooser_set_sort_func): 
	* btk/btknotebook.h (btk_notebook_set_tab_detachable): Sync
	parameter names between .c and .h files to help btk-doc.

	* bdk/bdkrebunnyion-generic.c (bdk_rebunnyion_get_clipbox): Reword
	docs to help btk-doc.

	* docs/tools/widgets.c (get_all_widgets): Add 
	BtkRecentChooserDialog.

	* btk/btkdnd.c (btk_drag_get_icon): Make sure to get an
	icon window when constructing the fallback_icon. This
	fixes a crash when dragging icons between screens in
	nautilus.  (#325751, Hylke van der Schaaf)

2006-03-30  Michael Emmel  <mike.emmel@gmail.com>

	* bdk/directfb/bdkpixmap-directfb.c implement
	    (bdk_pixmap_foreign_new_for_screen)

2006-03-30  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	Add documentation for the BtkLinkButton (#336592)

	* docs/reference/tmpl/btklinkbutton.sgml: Add description
	of the BtkLinkButton.

	* docs/reference/btk/migrating-BtkLinkButton.sgml: Guidelines
	for migrating code from BunnyHRef to the BtkLinkButton.

	* docs/reference/btk/btk-docs.sgml:
	* docs/reference/btk/Makefile.am: Build glue for the porting
	guide.

2006-03-29  Matthias Clasen <mclasen@redhat.com>

	* bdk/bdk.symbols:
	* bdk/bdkpixmap.h:
	* bdk/win32/bdkpixmap-win32.c:
	* bdk/x11/bdkpixmap-x11.c (bdk_pixmap_foreign_new_for_screen):
	New function to allow wrapping a native pixmap without
	a server roundtrip.  (#334954, David Baron) 

	* btk/btk.symbols:
	* btk/btkrecent*.c: Fix some symbol aliasing glitches.

2006-03-29  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	* btk/btkrecentchoosermenu.c: Make btkalias.h the last included file.

2006-03-29  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	* btk/btk.symbols: Fix a typo that broke aliasing rules.

2006-03-29  Richard Hult  <richard@imendio.com>

	* bdk/quartz/bdkproperty-quartz.c: Add missing CLIPBOARD atom.

2006-03-29  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	* docs/reference/btk/migrating-BtkRecentChooser.sgml: Add a migration
	guide for porting to the new BtkRecent stuff from the old EggRecent
	code.

	* docs/reference/btk/tmpl/btkrecentchooser.sgml:
	* docs/reference/btk/tmpl/btkrecentchooserdialog.sgml:
	* docs/reference/btk/tmpl/btkrecentchoosermenu.sgml:
	* docs/reference/btk/tmpl/btkrecentchooserwidget.sgml:
	* docs/reference/btk/tmpl/btkrecentfilter.sgml:
	* docs/reference/btk/tmpl/btkrecentmanager.sgml: Add template files
	for the reference guide.

	* docs/reference/btk/btk-docs.sgml:
	* docs/reference/btk/btk-sections.txt:
	* docs/reference/btk/Makefile.am: Build glue for add BtkRecent to
	the reference guide.

2006-03-29  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	* tests/Makefile.am:
	* tests/testrecentchooser.c: Add a test suite for BtkRecentChooser.

2006-03-29  Emmanuele Bassi  <ebassi@cvs.bunny.org>

	Import BtkRecent* from libegg.

	* btk/btkrecentmanager.[ch]: Add BtkRecentManager, an object
	for managing a list of recently used resources.

	* btk/btkrecentchooser.[ch]:
	* btk/btkrecentchooserdefault.[ch]:
	* btk/btkrecentchooserdialog.[ch]:
	* btk/btkrecentchoosermenu.[ch]:
	* btk/btkrecentchooserprivate.h:
	* btk/btkrecentchooserutils.[ch]:
	* btk/btkrecentchooserwidget.[ch]: Add BtkRecentChooser, a
	GTypeInterface for widgets implementing viewers for recently
	used resources.

	* btk/btkrecentfilter.[ch]: BtkRecentFilter, a filter object
	for BtkRecentChooser implementations.

	* btk/btk.h:
	* btk/btk.symbols:
	* btk/Makefile.am: Build glue for BtkRecent*.

2006-03-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c (btk_notebook_real_insert_page): Emit
	page-added before switch-page.  (#335691, Christian Persch)

2006-03-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (queue_edited_idle): Handle
	double queuing, rather than asserting that it does not 
	happen.  (#330617)

2006-03-28  Matthias Clasen  <mclasen@redhat.com>	

	* btk/btknotebook.c (btk_notebook_set_tab_detachable): Fix
	docs syntax, also commit a patch from #335707 to improve
	notebook DND with window widgets.

	* btk/btktextview.c (btk_text_view_start_selection_drag): 
	(selection_motion_event_handler): Fix drag-selection after
	double-click.  (#323862, Benjamin Berg)

	* btk/btktextview.c (get_iter_at_pointer): Factor this out
	into a function and use it in move_mark_to_pointer_and_scroll,
	drag_scan_timeout and selection_motion_event_handler.
	(Paolo Borelli)

2006-03-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c (btk_text_view_do_popup) 
	(btk_text_view_grab_notify): Move the call to 
	btk_text_view_end_selection_drag() from btk_text_view_do_popup
	to btk_text_view_grab_notify, so that it works not only
	for the text views own popup, but also for other ways in which
	we might become grab-shadowed during a selection drag.
	(#74620, Li Yuan)

2006-03-28  Sven Herzberg  <herzi@bunny-de.org>

        reviewed by: Tim Janik
	
	* btk/btkpixmap.c: (btk_pixmap_set): only check for equal colormaps if
	the new pixmap is not NULL; fixes a warning when btk_pixmap_set is
	called from btk_pixmap_finalize (bug 336254)

2006-03-27  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkevents-quartz.c:
        (select_thread_func):
        (got_fd_activity):
        (poll_func):
        (bdk_event_translate):
        Make the poll func work with real file descriptors.
        We do this by creating a thread which calls poll and then
        signals the main thread using a run loop source.
        
        * btk/btkclipboard-quartz.c:        
        (-[BtkClipboardOwner pasteboard:provideDataForType:]):
        Remove debugging output

2006-03-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmnemonichash.c (_btk_mnemonic_hash_activate): Check that 
	the widget is viewable.  (#336200, Bastian Nocera)

2006-03-27  Michael Natterer  <mitch@imendio.com>

	* btk/btkmenu.c (btk_menu_scroll_by): bail out if there is no need
	for scrolling (more obvious than adding additional conditions to
	the scroll offset calculation). Fixes bug #335912.

2006-03-27  Anders Carlsson  <andersca@imendio.com>

        * btk/Makefile.am:
        Add -xobjective-c to cflags.
        (#335956, Lllian Angel)
        
        * btk/btkdnd-quartz.c:
        (btk_drag_dest_set_track_motion):
        (btk_drag_dest_get_track_motion):
        Add stubs for new functions.
        (#335955, Lillian Angel)
        
2006-03-27  Richard Hult  <richard@imendio.com>

	* bdk/quartz: Add more stubs.

2006-03-27  Michael Natterer  <mitch@imendio.com>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_get_property):
	add missing ')'.

2006-03-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/Makefile.am: Fix a srcdir != builddir build problem.
	(#335915, Yevgen Muntyan)

	* btk/btktextbuffer.c (btk_text_buffer_get_property):
	* btk/btksettings.c (btk_settings_get_property):
	* btk/btkuimanager.c (btk_ui_manager_get_property): Fix leaks.

	* btk/btktexttag.c (btk_text_tag_get_property):
	* btk/btkcellrenderertext.c (btk_cell_render_text_get_property):
	Avoid an unnecessary strdup.  (#336013)

2006-03-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c (btk_text_view_value_changed): Don't call
	bdk_window_invalidate_rect() on unrealized widgets.  (#335717,
	Nicolas Setton)

Fri Mar 24 14:53:20 2006  Tim Janik  <timj@imendio.com>

	* btk/btktreemodel.h: 
	* btk/btktextbtree.h: back out B_GNUC_WARN_UNUSED_RESULT on iterator
	functions which turned out to cause too much trouble.

2006-03-23  Matthias Clasen  <mclasen@redhat.com>

	* AUTHORS: small update

2006-03-23  Matthias Clasen  <mclasen@redhat.com>

	Support subclasses in RC files.  (#142417, Todd Berman, patch
	based on a patch by Benjamin Berg)
	
	* btk/btkrc.h: 
	* btk/btkrc.c: Support <classname> elements in widget_class paths 
	in rc files which match any classes derived from named class.

	(_btk_rc_init): Use the new syntax in the default rc string.

	* btk/btkbindings.c: Support the new syntax for bindings too.
	
	* tests/testrc.c: Tests for widget_class path matching

2006-03-23  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btkdnd.c (btk_drag_dest_motion): make sure that bdk_drag_event()
	is called when track_motion is TRUE to receive drag_motion and
	drag_leave events properly.

2006-03-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c (btk_notebook_remove): Emit the ::page-removed
	signal after removing the page.  (#335238, Christian Persch)

2006-03-22  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btkexpander.c: Make it to expand when hovering during DnD

2006-03-22  Matthias Clasen  <mclasen@redhat.com>

	Improved DND support for BtkNotebook  (#332991, Carlos Garnacho)
	
	* btk/btk.symbols: 
	* btk/btkdnd.h: 
	* btk/btkdnd.c: Add a track_motion flag on BtkDragDest
	with getter and setter, for cases where the drag destination
	is interested in drag motion events independent of targets.

	* btk/btksettings.c (btk_settings_class_init): Add a setting
	for the timeout used when expanding during DND.

	* btk/btknotebook.c: Use the track_motion flag to switch
	notebook tabs when hovering over tabs during DND.
	
2006-03-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_bin_expose): Use fg_gc to
	draw the inter-row drop highlight. Also draw the line all the 
	way across, and flip it in RTL mode. (#334906, Ian McDonald)

2006-03-22  Johan Dahlin  <jdahlin@async.com.br>

	* tests/testtreeview.c: Add a column that demonstrates how to use
	the new spinbutton cellrenderer.

2006-03-22  Matthias Clasen  <mclasen@redhat.com>

	* tests/prop-editor.c: 
	* tests/testtreeview.c: Remove pointless includes of config.h,
	to make it easier compilable against system BTK+.

2006-03-22  Michael Natterer  <mitch@imendio.com>

	* btk/btkentry.c: renamed last-char-timeout to
	password-hint-timeout and store all its data in a struct attached
	as QData.

	* btk/btkcellrendererspin.c: fix typo in #include.

2006-03-22  Carlos Garnacho  <carlosg@bunny.org>

	* btk/btknotebook.c: send a BtkWidget** instead of a BtkNotebookPage*
	when doing tabs DnD, this allows DnD interaction with other widgets,
	added some docs for this too.
	* tests/testnotebookdnd.c: add some code to test it.

2006-03-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols: 
	* btk/btkcellrendererspin.h:
	* btk/btkcellrendererspin.c: Add a cell renderer which 
	uses a spinbutton to edit the value of a cell. (#156023,
	Daniel Kasak, Lorenzo Gil Sanchez, Carlos Garnacho)

	* btk/btk.h: 
	* btk/Makefile.am: Glue it in.

2006-03-21  Matthias Clasen  <mclasen@redhat.com>

	* tests/testtreeview.c (drag_begin_cb): Test setting up
	drag icons for tree dnd.

2006-03-22  Michael Natterer  <mitch@imendio.com>

	* btk/btkentry.c: applied modified patch from maemo-btk which
	allows the most recently entered character in a hidden entry to be
	shown for a configurable period of time. Fixes bug #334560.

2006-03-22  Michael Natterer  <mitch@imendio.com>

	* btk/btktextbuffer.h (enum BtkTextBufferTargetInfo): count down
	from G_MAXUINT to avoid clashes with application-added DND
	targets.

	* btk/btktextview.c (btk_text_view_init): set an empty
	BtkTargetList on the drag_dest so it is not NULL when a derived
	class' init() function is called.

	(btk_text_view_target_list_notify): copy the text buffer's paste
	targets into the view's destinstion target list (preserving
	application-added DND targets), instead of replacing the view's
	target list. Fixes bug #334399.

2006-03-21  Anders Carlsson  <andersca@imendio.com>

        * btk/Makefile.am:
        Add new files.
        
        * btk/btkclipboard-quartz.c: Added.
        * btk/btkdnd-quartz.c: Added.
        * btk/btkquartz.c: Added.
        * btk/btkquartz.h: Added.
        Add dnd and clipboard implementations.

2006-03-21  Michael Natterer  <mitch@imendio.com>

	* bdk/quartz/Makefile.am: removing trailing \ fixes the build.

2006-03-21  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkgeometry-quartz.c:
        (bdk_window_scroll):
        Implement bdk_window_scroll.

2006-03-21  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/BdkQuartzWindow.c:
        (drag_operation_to_drag_action):
        (drag_action_to_drag_operation):
        (update_context_from_dragging_info):
        (-[BdkQuartzWindow draggingEntered:]):
        (-[BdkQuartzWindow draggingEnded:]):
        (-[BdkQuartzWindow draggingExited:]):
        (-[BdkQuartzWindow draggingUpdated:]):
        (-[BdkQuartzWindow performDragOperation:]):
        (-[BdkQuartzWindow wantsPeriodicDraggingUpdates]):
        (-[BdkQuartzWindow draggedImage:endedAt:operation:]):
        * bdk/quartz/bdkdnd-quartz.c:
        (bdk_drag_context_finalize):
        (bdk_drag_context_init):
        (bdk_drag_context_class_init):
        (bdk_drag_begin):
        (bdk_drag_status):
        Add the BDK part of the DND implementation.

        * bdk/quartz/Makefile.am:
        Add some missing headers.
        
        * bdk/quartz/bdkdrawable-quartz.h:
        * bdk/quartz/bdkprivate-quartz.h:
        * bdk/quartz/bdkquartz.h:
        * bdk/quartz/bdkwindow-quartz.c:
        (bdk_quartz_window_get_nsview):
        New function, for use by the BTK part of the DND implementation

2006-03-21  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkdrawable-quartz.c:
        (bdk_quartz_ref_bairo_surface):
        (bdk_quartz_draw_rectangle):
        (bdk_quartz_draw_arc):
        (bdk_quartz_draw_polygon):
        (bdk_quartz_draw_drawable):
        (bdk_quartz_draw_segments):
        (bdk_quartz_draw_lines):
        (bdk_quartz_draw_pixbuf):
        (bdk_quartz_draw_image):
        (_bdk_quartz_drawable_get_context):
        * bdk/quartz/bdkdrawable-quartz.h:
        Offset coordinates by 0.5 pixels to get consistant results for both
        image contexts and screen contexts.

2006-03-21  Anders Carlsson  <andersca@imendio.com>

	* bdk/quartz/BdkQuartzWindow.c 
	([BdkQuartzWindow -windowDidMove:]): Synthesize BDK_CONFIGURE events
	when the window position changes.

2006-03-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkdnd.c (btk_drag_get_cursor): Remove an unused variable.

	* btk/btknotebook.c (btk_notebook_remove_tab_label): Don't leave
	page->tab_label dangling.
	(btk_notebook_real_remove): Use BTK_IN_DESTRUCTION to determine
	if we are being called during destruction of the notebook, rather
	than maintaining that information as a passed-in parameter.
	(btk_notebook_destroy): Leave the removal of the children
	to the container destroy method.  (#319032, Yevgen Muntyan)

2006-03-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_remove): Use the existing
	BTK_IN_DESTRUCTION flag, rather than roll our own.

2006-03-20  Matthias Clasen  <mclasen@redhat.com>
	
	* btk/btk.symbols: 
	* btk/btkscrolledwindow.h: 
	* btk/btkscrolledwindow.c: Add a window-placement-set property
	and a btk-scrolled-window-placement setting.  (#157025, Christian
	Neumair)

2006-03-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmain.c (btk_get_option_group): Make sure gettext
	is initialized before using it.  (#335129, Christian Persch)

2006-03-19  Matthias Clasen  <mclasen@redhat.com>

	* MAINTAINERS: Add this, at the request of the BUNNY sysadmin team.

	* AUTHORS: Updates, typo fix

	* btk/btkiconview.c (btk_icon_view_set_cursor): Document that
	@cell must be one of the renderers of the icon view, warn if 
	it is not, and ignore @start_editing if @cell is not set.
	(#335001, Emmanuel Rodriguez)

2006-03-16  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Add a missing comma.  (#334774, Peter Breitenlohner)

	* btk/btkactiongroup.c (btk_action_group_add_actions_full) 
	(btk_action_group_add_toggle_actions_full) 
	(btk_action_group_add_radio_actions_full): Check for a stock 
	icon, not a stock item, when deciding whether to use stock-id 
	or icon-name.  (#334760, Jody Goldberg)

	* btk/btkimage.c (btk_image_clear): Update the size of the image, 
	by swapping the implementations of btk_image_clear and
	btk_image_reset.  (#334657)

	* README.in: Add a note about BtkNotebook signals.

2006-03-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_list_button_released) 
	(btk_combo_box_list_key_press): Popdown the list before changing
	the active iter, otherwise people will be surprised by the
	grabs that are still in place when their ::changed handler
	runs. 

2006-03-15  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/msw_style.c: Override style->realize/
	style->unrealize, so that BTK+ doesn't automatically attempt to apply
	shading to the GC colors, causing a mismatch with the Win32 native
	colors. Problem found by (and suggested solution by) "Cosmic Integer"

	* modules/engines/ms-windows/Theme/btk-2.0/btkrc: Make expander-size
	a bit closer to Microsoft's values (bug 325699, Brad Taylor)
	
2006-03-14  Matthias Clasen  <mclasen@redhat.com>

	* tests/testcellrenderertext.c: Add test cases for alignment.

	* btk/btkcellrenderertext.c: Add an alignment property,
	and fix some cases where ellipsize_set was being used to
	mean "we're ellipsizing" even when ellipsize was set to NONE.  
	(#318761, Ross Burton)

	* btk/btkimcontextsimple.c: Make return and release work again
	to commit a hex sequence. Additionally, make escape reset the
	im context when in a hex sequence.  (#334423, Behdad Esfahbod)

2006-03-13  Matthias Clasen  <mclasen@redhat.com>

	Make actions work with named icons.  (#323484, Jorn Baayen)
	
	* btk/btkactiongroup.c: If the stock-id field of a BtkActionEntry
	does not contain a registered stock id, interpret it as an
	icon name.

	* btk/btkaction.c: Add an icon-name property to actions and
	use it for icons if a stock-id is not specified.

2006-03-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwindow.c (btk_window_compute_configure_request): Don't
	for the creation of geometry info here.  (#114533)

2006-03-11  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkdrawable-win32.c (draw_polygon): Use Polygon() for
	outlined polygons, too. Same idea as in draw_rectangle(): Set pen
	to NULL_PEN if drawing a filled polygon, set brush to HOLLOW_BRUSH
	if drawing a polygon outline. (#332662)
	(bdk_win32_draw_polygon): Corresponding simplification: no need to
	add an extra final copy of the starting point.

2006-03-11  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows: Speed up the Windows theme
	considerably (#163724, John Ehresman)
	Be more careful about setting Bango font descriptions (#333372)
	
2006-03-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrange.c (btk_range_key_press): Allow to cancel 
	a drag with ESC.  (#58389, SÃ¸ren Sandmann)

2006-03-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrange.c: Add a style property ::activate_slider that
	allows themes to draw the slider active while dragged.  (#311992,
	Benjamin Berg)

	* btk/btkcolorsel.c (btk_color_selection_init): Fix two labels.

	* btk-engine-check-abi.sh: Add a script to check that theme
	engines don't export any extra functions. 

2006-03-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcolorsel.c (btk_color_selection_init): Avoid a mnemonic
	conflict.  (#163850, Dennis Cranston)

	* btk/btkaboutdialog.c (btk_show_about_dialog): Make the behaviour
	of the about dialog consistent with other dialogs in btk. If the
	dialog is constructed with btk_about_dialog_new(), the creator
	is reponsible for handling the response by hiding or closing the
	dialog. btk_show_about_dialog() handles it by hiding the dialog.
	(#333360, Daniel Drake)

	* README.in: Mention this change.

2006-03-10  Matthias Clasen  <mclasen@redhat.com>

	Apply a patch from Dennis Cranston to make dialogs more
	consistent  (#163850)
	
	* btk/btkcolorsel.c (make_label_spinbutton): Left-align labels.
	
	* btk/btkfontsel.c (btk_font_selection_init): 
	* btk/btkfontsel.c (btk_font_selection_dialog_init): 
	* btk/btkcolorsel.c (btk_color_selection_init): 
	* btk/btkcolorseldialog.c (btk_color_selection_dialog_init): 
	* btk/btkinputdialog.c (btk_input_dialog_init): Update the layout
	of the dialog to follow HIG recommendations. Also update labels.

	* btk/btkmessagedialog.c (btk_message_dialog_init): HIG-compatible 
	spacing.
	(btk_message_dialog_font_size_change): Merged into 
	 btk_message_dialog_style_set.

2006-03-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkstyle.c: Remove g_return_if_fail() checks
	from static functions.

2006-03-10  Federico Mena Quintero  <federico@novell.com>

	Make Shift-P and Shift-N activate typeahead in BtkTreeView
	(i.e. they are just normal capital letters).  Fixes bug #334098.

	* btk/btktreeview.c (btk_tree_view_add_move_binding): Add an
	"add_shifted_binding" argument which determines whether we'll add
	the same binding with BDK_SHIFT_MASK.
	(btk_tree_view_class_init): Use add_shifted_binding=FALSE for BDK_p
	and BDK_n; use TRUE for all the rest.

2006-03-10  Michael Natterer  <mitch@imendio.com>

	* btk/btkentry.[ch]: applied refactored patch from maemo-btk that
	replaces the INNER_BORDER define by an "inner-border" style
	property of type BtkBorder. Additionally, add an "inner-border"
	object property plus API which allows to override any theme
	border, to allow pixel-perfect positioning of entries for inline
	editing. Fixes bug #333922.

	* btk/btk.symbols: add the new public functions.

2006-03-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_class_init): Replace the
	popup-show and popup-hide signals with a readonly popup-shown
	property.  (#162531, Christian Persch)

2006-03-09  Ross Burton  <ross@openedhand.com>

	* btk/btkwidget.c:
	* btk/btkrange.c:
	* btk/btktogglebutton.c:
	Turn off prelighting when btk-touchscreen-mode is enabled (#135666)

Thu Mar  9 14:29:43 2006  Tim Janik  <timj@btk.org>

	* btk/btkobject.c (btk_object_init): move the floating flag from
	the GInitiallyUnowned bit to BTK_FLOATING. fixes tests/floatingcheck.
	kudos to mitch for debugging this.

2006-03-09  Matthias Clasen <mclasen@redhat.com>

	* Makefile.am: Add ChangeLog.pre-2.8 to EXTRA_DIST.

2006-03-09  Tor Lillqvist  <tml@novell.com>

	* btk/btk.symbols: No btk_tray_icon_get_type on Win32.

2006-03-08  Carlos Garnacho  <carlosg@bunny.org>

	Rename ::tab-added and ::tab-removed signals to ::page-added and
	::page-removed for not conflicting with other tab reordering
	implementations. Fixes bug #333743.

	Also rename ::tab-reordered to ::page-reordered, and emit it in
	btk_notebook_reorder_child () to make it behave consistently with the
	other two signals.

	* btk/btknotebook.c (btk_notebook_class_init): rename signals.
	(btk_notebook_reorder_tab)
	(btk_notebook_button_release)
	(btk_notebook_remove)
	(btk_notebook_real_insert_page): emit respectively renamed signals
	(btk_notebook_reorder_child): also emit ::page-reordered here

	* tests/testnotebookdnd.c: use renamed signals

2006-03-08  Michael Natterer  <mitch@imendio.com>

	* bdk/bdkscreen.h
	* bdk/x11/bdkscreen-x11.c
	* bdk/bdk.symbols: added bdk_screen_get_active_window() and
	bdk_screen_get_window_stack() (patch from maemo-btk).
	Fixes bug #320881.

	* bdk/directfb/bdkscreen-directfb.c
	* bdk/quartz/bdkscreen-quartz.c
	* bdk/win32/bdkscreen-win32.c: added the functions as stubs.

2006-03-08  Michael Natterer  <mitch@imendio.com>

	* tests/prop-editor.c (unichar_changed): zero-initialize the
	GValue before calling g_value_init().

2006-03-08  Michael Natterer  <mitch@imendio.com>

	* btk/btkentry.c (btk_entry_adjust_scroll): make sure that the
	text_area_width is always >= 0. Fixes bug #316712 (Dan Winship).

2006-03-07  Federico Mena Quintero  <federico@novell.com>

	Cancel drags when the grabs get broken.  Fixes bug #333056:

	* btk/btkdnd.c (btk_drag_selection_received): The time argument is
	a guint, not guint32.
	(btk_drag_source_event_cb): Return gboolean, not gint.
	(btk_drag_anim_timeout): Likewise.
	(btk_drag_motion_cb): Likewise.
	(btk_drag_key_cb): Likewise.
	(btk_drag_button_release_cb): Likewise.
	(btk_drag_abort_timeout): Likewise.
	(btk_drag_begin_internal): Connect to "grab-broken-event" on the
	ipc_widget.
	(btk_drag_source_info_destroy): Disconnect from the
	"grab-broken-event" callback.
	(btk_drag_end): Likewise.
	(btk_drag_grab_broken_event_cb): New callback.  We cancel the drag
	if the grab was broken and not regrabbed by the DnD code.

2006-03-07  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserdefault.c (shortcuts_button_press_event_cb):
	Hack to let the treeview's button-press-event handler run before
	ours.  This lets the selection be updated before we pop up a
	context menu.

Tue Mar  7 17:16:34 2006  Tim Janik  <timj@btk.org>

	* configure.in: depend on bunnylib-2.10.1.

	* btk/btkobject.c: fixed up messing with non-BtkObject floating flags.
	this requires bunnylib-2.10.1.

2006-03-07  Michael Natterer  <mitch@imendio.com>

	Add infrastructure for copy/paste and DND of rich text for
	BtkTextBuffer. Fixes bug #324177.

	* btk/btktextbufferrichtext.[ch]: new files implementing a
	per-buffer registry of rich text formats.

	* btk/btk.h: #include btktextbufferrichtext.h

	* btk/btktextbufferserialize.[ch]: new files implementing an
	internal serialization format that can handle all of a text
	buffer's tags and pixbufs. It's not useful for anything except
	tranfer between instances of BtkTextBuffer (Anders Carlsson).

	* btk/Makefile.am: build the new files.

	* btk/btkclipboard.[ch]: added convenience APIs for rich text,
	just as they exist for plain text and pixbufs.

	* btk/btkselection.[ch]: added rich text convenience APIs here
	too.  Return the target list from btk_target_list_ref(). Register
	BtkTargetList as boxed type. Added
	btk_target_table_new_from_list() and btk_target_table_free(),
	which make converting between BtkTargetList and arrays of
	BtkTargetEntry considerably easier.

	* btk/btktextutil.[ch]: added _btk_text_util_create_rich_drag_icon()
	which creates a fancy rich text icon (Matthias Clasen).

	* btk/btktextbuffer.[ch]: use all the new stuff above and
	implement copy and paste of rich text. Added APIs for getting the
	target lists used for copy and paste. Added public enum
	BtkTextBufferTargetInfo which contains the "info" IDs associated
	with the entries of the target lists.

	* btk/btktextview.c: use the new rich text APIs and
	BtkTextBuffer's new target list API to enable DND of rich text
	chunks.

	* btk/btk.symbols: export all the new symbols added.

	* tests/testtext.c: added rich text testing stuff.

2006-03-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c (text_window_invalidate_cursors): Take
	cursor width into account when calculating the area to 
	be invalidated.  (#333377, #323401 Steve FrÃ©cinaux)

	* btk/btkmain.c (post_parse_hook): Set error when returning
	FALSE.  (#333268, Paolo Maggi, Christian Persch)
	
	* btk/btkpixmap.c (btk_pixmap_set): Check that the pixmap
	has the right depth.  (#333363, Ed Catmur)

2006-03-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (adjust_wrap_width): Apply some
	arbitrary lower limit for the guessed wrap width. (#332466,
	Donald Straney)

2006-03-05  Matthias Clasen  <mclasen@redhat.com>

	Fix handling of image-only buttons.  (#332985, Kalle 
	Vahlmann, #333555)
	
	* btk/btkbutton.c (btk_button_construct_child): Don't
	return early if there an image to show.
	(show_image): Always return TRUE if there is no text.

2006-03-04  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkinput-x11 (bdk_input_translate_coordinates):
	Adjust the handling of min values for the x and y axes of 
	extended input devices  (#324562, #142536, Denis Auroux and 
	Robert Ãgren)

	* btk/btkexpander.c (btk_expander_paint_focus): Position
	the focus rectangle correctly in RTL mode.  (#333291,
	Benjamin Berg)

2006-03-03  Tor Lillqvist  <tml@novell.com>

	* btk/btkimcontextsimple.c (btk_im_context_simple_commit_char)
	(btk_im_context_simple_reset): Avoid emitting superfluous
	preedit_changed signals. Thanks to Matthias. (#319407)

2006-03-03  Michael Natterer  <mitch@imendio.com>

	Applied modified patch from maemo-btk which makes separators more
	themeable. Fixes bug #332022.

	* btk/btkwidget.c: added style properties "wide-separators",
	"separator-width" and "separator-height".

	* btk/btkhseparator.c
	* btk/btkvseparator.c
	* btk/btkmenuitem.c
	* btk/btktoolbar.c: honor the new settings and paint separators
	using btk_paint_box() if wide-separators is true.

2006-03-02  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/msw_style.c: Fix combobox theming
	regression noted in bug 321301
	* modules/engines/ms-windows/Theme/btk-2.0/btkrc: Ditto
	
2006-03-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_layout) 
	(btk_icon_view_row_inserted, btk_icon_view_scroll_to_path): 
	Make scroll_to_path work for newly inserted items, by delaying
	the scroll until layout is done.  (#332923, Cory Dodt)

	* btk/btkcolorbutton.c (render): Use BTK_WIDGET_IS_SENSITIVE,
	not BTK_WIDGET_SENSITIVE.  (#333133, Christian Persch)

2006-03-02  Ross Burton  <ross@openedhand.com>

	* btk/btktooltips.c:
	Disable tooltips if btk-touchscreen-mode is activated (#315112).

2006-03-01  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreeselection.c (row_is_selectable): rename to
	_btk_tree_selection_row_is_selectable and export internally,
	(btk_tree_selection_real_select_node): changed so it is always
	possible to unselect insensitive nodes, changed the logic a bit to
	be more clear.

	* btk/btktreeprivate.h: add _btk_tree_selection_row_is_selectable.

	* btk/btktreeview.c (btk_tree_view_row_changed): Unselect a row if
	it became insensitive.

2006-02-27  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfontsel.c (btk_font_selection_set_font_name): Check that
	the fontsel has a screen assigned before doing anything.  This
	will at least warn the caller of what is wrong, since we only
	populate the family_list until we get a screen.  Also, put the
	reference docs here.  Fixes bug #332756.
	(btk_font_selection_dialog_get_font_name): Document this here.
	(btk_font_selection_get_font_name): Document this here; mention
	that the font names get normalized, so the result of this function
	may not be the same as what you set with
	btk_font_selection_set_font_name().

2006-02-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols:
	* btk/btktrayicon-x11.c: Fix symbol lists for make check.

2006-02-27  Michael Natterer  <mitch@imendio.com>

	* bdk/x11/bdksettings.c: map "btk-touchscreen-mode" to the
	"Btk/TouchscreenMode" XSettings property, remove trailing
	whitespace.

	* bdk/x11/checksettings.c: #include <string.h> and sprinkled some
	newlines.

Mon Feb 27 14:52:50 2006  Tim Janik  <timj@imendio.com>

	* bdkevents-x11.c:
	* bdksettings.c: moved and renamed the bdk_settings_names and 
	bdk_settings_map.

	* bdk/x11/checksettings.c: test program for the bdk_settings_map array.

	* bdk/x11/Makefile.am: run checksettings as part of make check.

2006-02-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkdnd.c (btk_drag_get_cursor): Comment out some unused
	code, and fix the reference point of composited drag cursors.
	(#320132, Christian Neumair)

Sun Feb 26 10:24:10 PST 2006  Michael Emmel  <mike.emmel@gmail.com>
	
	*bdk/directfb/README
	Updated README to remove old build instructions

Sat Feb 25 10:35:23 PST 2006  Michael Emmel  <mike.emmel@gmail.com>
	
	*bdk/directfb/bdkdisplay-directfb.c
	*bdk/directfb/bdkwindow-directfb.c
	Added stubs for shape window functions to fix compile problems

2006-02-24  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserdefault.c (shortcuts_list_create): Make the
	column header visible, and make it be "_Places".  Changed the
	accessible object name to Places as well.  Fixes bug #331306.
	(file_pane_create): Do not create the path bar and "create folder"
	button here...
	(browse_widgets_create): ... but create them here instead.  This
	moves the path bar to be above both the hpaned, giving it the full
	width of the dialog.  Fixes bug #327733.

Thu Feb 23 13:28:21 2006  Tim Janik  <timj@imendio.com>

	* bdk/x11/bdkim-x11.c (_bdk_x11_initialize_locale): remove unconditional
	warnings about missing X locale support. Bdk properly handles this
	situation anyway.

Fri Feb 17 14:20:29 2006  Tim Janik  <timj@imendio.com>

	* btk/btktreemodel.h: 
	* btk/btktextbtree.h: added B_GNUC_WARN_UNUSED_RESULT warnings for
	iterator functions, to avoid invalid iterators go unnoticed,
	suggested by Markku Vire <markku.vire@movial.fi>.

2006-02-23  Matthias Clasen  <mclasen@redhat.com>

	* tests/Makefile.am: 
	* tests/testnotebookdnd.c: Add notebook DND tests.

	* btk/btknotebook.h: Add a reorder_tab keynav signal and an
	insert_page vfunc to BtkNotebook.

	* btk/btk.symbols:
	* btk/btknotebook.c: Support notebook DND. New API includes
	btk_notebook_set_window_creation_hook, 
	btk_notebook_[gs]et_group_id,
	btk_notebook_[gs]et_tab_reorderable, 
	btk_notebook_[gs]et_tab_detachable (#73240, Carlos Garnacho)

2006-02-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextiter.c: Fix macro declaration

	* btk/btkaboutdialog.c: Remove an accidentally included function.

2006-02-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextbtree.c: 
	* btk/btktextiter.c: Minor optimizations.  (#332059, Arnaud Charlet)

	* btk/btkradiobutton.c (btk_radio_button_clicked): Emit notify::active
	here, when changing the value of this property.  (#331651)

	* btk/btknotebook.c: Apply a patch by Paolo Borelli to
	make the tab menu keynavigatable.  (#331440)

2006-02-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaboutdialog.c: Change Close buttons to BTK_RESPONSE_CANCEL
	so Escape works. (#331940, Daniel Drake)

2006-02-22  Michael Natterer  <mitch@imendio.com>

	* btk/btksettings.c: added boolean property btk-touchscreen-mode,
	which essentially means "there are no motion notify events", so
	widgets can't use the pointer hovering them for anything.

	* btk/btkmenu.c: if btk-touchscreen-mode is TRUE, scroll menus
	when clicking the scroll arrows, since hovering goes undetected.
	Fixes bug #323028.

	Added boolean style property "double-arrows" which always makes
	both scroll arrows visible when the menu is too long.
	For pushed-in popup menus, both arrows are always shown
	(regardless of double-arrows), in order to fix user confusion
	about the blank area. Fixes bug #129463.

2006-02-21  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_rows_reordered):
	Make sure we always update the virtual root, also when ->priv->root
	is still NULL.  (Markku Vire)

2006-02-21  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkselection-quartz.c:
        (make_list):
        (bdk_text_property_to_utf8_list_for_display):
	Add these from the win32 backend.

2006-02-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c: Properly update internal state
	when child visibility changes.  (#331785, Sebastien Bacher)

	* bdk/bdkgc.c (_bdk_gc_update_context): Obtain the
	background color from the gc when it is needed.  (#331820)

2006-02-19  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkgc.c (_bdk_gc_update_context): Add a gc_changed
	argument, and avoid setting the clip rebunnyion if the gc
	has not changed. 

	* bdk/bdkgc.c: Update all callers.

	* bdk/bdkbango.c (get_bairo_context): Avoid updating the
	context if nothing changed.

2006-02-20  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkdisplay-quartz.c:
        (bdk_display_supports_shapes):
        (bdk_display_supports_input_shapes):
        * bdk/quartz/bdkwindow-quartz.c:
        (bdk_display_warp_pointer):
        (bdk_window_input_shape_combine_mask):
        (bdk_window_input_shape_combine_rebunnyion):
        (bdk_window_set_child_input_shapes):
        (bdk_window_set_accept_focus):
        (bdk_window_merge_child_input_shapes):
	Add stubs for input shape functions.

2006-02-20  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkevents-quartz.c:
        (get_keyboard_modifiers_from_nsevent):
	Fix typo so ctrl gets passed on to the bdk event.
	
        * bdk/quartz/bdkproperty-quartz.c:
        (bdk_atom_name):
	g_strdup the atom name.

2006-02-20  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkdisplay-win32.c (bdk_display_supports_shapes):
	New function, return TRUE.
	(bdk_display_supports_input_shapes): New function, return FALSE.

	* bdk/win32/bdkwindow-win32.c (do_shape_combine_rebunnyion): New
	function. Factor out code from bdk_window_shape_combine_mask().
	(bdk_window_shape_combine_rebunnyion): Actually do something. Convert
	rebunnyion to a HRGN and call do_shape_combine_rebunnyion().
	(bdk_window_input_shape_combine_mask)
	(bdk_window_input_shape_combine_rebunnyion)
	(bdk_window_set_child_input_shapes)
	(bdk_window_merge_child_input_shapes): New functions, dummy
	implementations.

2006-02-20  Michael Natterer  <mitch@imendio.com>

	* bdk/x11/bdkdisplay-x11.h (struct _BdkDisplayX11): adding boolean
	have_shapes and have_input_shapes members fixes the build.

2006-02-20  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkfont-win32.c: Replace all calls to g_strcasecmp()
	with g_ascii_strcasecmp().

2006-02-19  Matthias Clasen  <mclasen@redhat.com>

	Support input shapes:  (#331070)
	
	* bdk/bdk.symbols: 
	* bdk/bdkdisplay.h: 
	* bdk/bdkwindow.h: 
	* bdk/x11/bdkdisplay-x11.c (bdk_display_supports_shapes) 
	(bdk_display_supports_input_shapes): Functions to determine
	if a display supports shaped windows or input shapes.

	* bdk/x11/bdkwindow-x11.c (bdk_window_input_shape_combine_rebunnyion): 
	(bdk_window_input_shape_combine_mask): 
	(bdk_window_set_child_input_shapes): 
	(bdk_window_merge_child_input_shapes): Input shape versions
	of the window shape API.

	* btk/btk.symbols: 
	* btk/btkwidget.h: 
	* btk/btkwidget.c (btk_widget_input_shape_combine_mask): 
	New function to set an input shape on a widget.

2006-02-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklinkbutton.c (btk_link_button_class_init): Fix
	a cast.

2006-02-17  Matthias Clasen  <mclasen@redhat.com>

	DND keynav support:
	
	* btk/btkdnd.c (btk_drag_update_idle): Protect against 
	info->last_event being NULL.
	(btk_drag_key_cb): Handle arrow keys to move the drag icon
	and space or enter to drop.

2006-02-17  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkrebunnyion-generic.c (bdk_rebunnyion_union_with_rect):
	Be robust and reject rectangles with negative width or
	height.  (#331467, Benjamin Berg)


2006-02-17  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_rows_reordered):
	Only update the virtual root if the child path is an ancestor
	of the virtual root.  (Patch from Markku Vire).

2006-02-16  Federico Mena Quintero  <federico@novell.com>

	* btk/btkfilechooserdialog.c (btk_file_chooser_dialog_map): Call
	::initial_focus() on the child before calling ::map() on our
	parent class.  This will prevent the shortcuts treeview from
	highlighting its first row as a result of getting assigned focus
	by btk_dialog_map().

2006-02-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwidget.c (btk_widget_send_expose): Remove redundant
	check.  Pointed out by Bodo-Merle Sandor.

	* btk/btkcolorbutton.c (btk_color_button_[un]realize):
	Remove unnecessary checks.  

2006-02-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c (btk_icon_theme_list_icons): Give working
	examples in the docs.  (#330944, John Spray)

2006-02-10  Matthias Clasen  <mclasen@redhat.com>
	
	* btk/btkiconview.c (btk_icon_view_get_item_at_coords): Fix
	row_spacing/column_spacing confusion.  (#330732, Donald Straney)

2006-02-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkstyle.c: Add some docs. (#330073, Mart Raudsepp)

	* btk/btkentrycompletion.c (btk_entry_completion_match_selected): 
	Guard against NULL.  (#330177, Raphael Slinckx)

2006-02-10  Murray Cumming  <murrayc@murrayc.com>

	* docs/reference/btk/tmpl/btkcomboboxentry.sgml: Mention that 
	the changed signal is emitted when typing - not just when 
	selecting from the list. Suggest use of BtkEntry::action to 
	etect end of typing.
	 btk/btkcombobox.c: (btk_combo_box_class_init): changed signal 
	ocumentation: Mention that the BtkComboBoxEntry emits it when 
	he users types, not just when he selects from the list.

2006-02-10  Murray Cumming  <murrayc@murrayc.com

	* btk/btkassistant.h: Correct the declaration of the prepare 
	default signal handler to match its registration and use.

2006-02-09  Ross Burton  <ross@burtonini.com>

	* btk/btkfontbutton.c:
	Work out the font size in floating point, and display the font
	size with %g instead of %d (#317590)

2006-02-09  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate)
	<WM_MOUSELEAVE>: If we don't know where we went, and have
	generated a leave event, set current_window to the root
	window. This assures we will generate proper enter and leave
	events for popup windows. (#325521)

2006-02-08  John Ehresman  <jpe@wingware.com>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate)
	<WM_MOUSEACTIVATE>
	* bdk/win32/bdkwindow-win32.c (show_window_internal)
	(bdk_window_raise): Call SetWindowPos() instead of
	SetForegroundWindow() or BringWindowToTop() if the window
	shouldn't accept focus. (#327375)
	
2006-02-08  John Ehresman  <jpe@wingware.com>

	* bdk/win32/bdkwindow-win32.c: Let bdk_window_set_decorations()
	take precedence over anything derived from hints. Restructure
	related code and logic, add some new helper functions. (#327217)

2006-02-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c: Don't put relevant callss
	in g_assert().  (#329876, Kristian Rietveld)

2006-02-08  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkevents-win32.c (bdk_pointer_grab)
	(bdk_display_pointer_ungrab, bdk_keyboard_grab)
	(bdk_display_keyboard_ungrab): Consistenly use assign_object()
	when assigning BdkWindow pointers so that the ref counting doesn't
	get off whack.

	(handle_stuff_while_moving_or_resizing): Don't use deprecated API.

	(bdk_event_translate) <WM_MOUSEMOVE>: When the pointer is grabbed
	with owner_events FALSE, generate enter and leave events only for
	the grab window. (#321054)

2006-02-08  Kristian Rietveld  <kris@imendio.com>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_ref_path),
	(btk_tree_model_filter_unref_path): free temporary paths after
	usage (patch from maemo-btk),
	(btk_tree_model_filter_clear_cache): fix little typo in the docs
	(patch from maemo-btk).

	* btk/btktreemodelsort.c (btk_tree_model_sort_row_deleted): remove
	stale FIXME.

2006-02-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystem.c (btk_file_info_copy): Copy the display_key
	as well.  (#330389, Markku Vire)

2006-02-08  Tor Lillqvist  <tml@novell.com>

	* btk-zip.sh.in: Drop the timestamp from the zipfile names.

2006-02-07  Sven Neumann  <sven@gimp.org>

	* bdk/directfb/AUTHORS: updated mine and Dok's email address.

2006-02-06  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_get_search_entry): fix compiler
	warning.

2006-02-05  Dom Lachowicz <cinamod@hotmail.com>

	* bdk/bdkbairo.c (bdk_bairo_set_source_pixbuf): Bug #330022
	Wrong pixel values are computed when color = 0xFF and alpha = 0xFF
	
2006-02-04  Michael Emmel  <mike.emmel@gmail.com>
	Added new directfb backend located in bdk/directfb
	plus patches to compile new backend
	compile with --with-bdktarget=directfb

2006-02-03  Federico Mena Quintero  <federico@ximian.com>

	Work around https://bugs.freedesktop.org/show_bug.cgi?id=4320,
	which used to be our own
	http://bugzilla.bunny.org/show_bug.cgi?id=314616.  If one uses a
	pixmap for a pattern in Bairo, and sets the pattern to
	BAIRO_EXTEND_REPEAT; and if the destination surface is also a
	pixmap, Bairo does a slow copy instead of using XCopyArea().  So,
	we use the same code that we used in BTK+ 2.6 (pre-bairo), by
	filling the double-buffer pixmap with a tiled GC and
	XFillRectangle().

	* bdk/bdkwindow.c (BackingRectMethod): New structure with a
	bairo_t and a BdkGC field.  Depending on which of these fields
	gets filled in, we'll use Bairo or BDK to clear the double-buffer
	pixmap when painting a window.
	(setup_backing_rect_method): Fill a BackingRectMethod as
	appropriate, depending on the window's configuration and our
	knowledge of whether Bairo is fast or slow when doing repeating
	patterns.
	(bdk_window_clear_backing_rect): Call
	setup_backing_rect_method().  Depending on what it returns, use
	Bairo to clear the double-buffer pixmap, or plain BDK.

2006-02-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c (get_layout_location): Fix handling
	of padding in RTL.  (#329099, Hooman Mesgary) 

2006-02-02  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkdnd-x11.c (_bdk_drag_get_protocol_for_display):
	Make drops on the root window work again.  (#145243, Andrew S. Dixon)

2006-02-01  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwidget.c (btk_widget_class_init): Wrap dnd signal
	docs to 80 columns.

2006-01-31  Matthias Clasen  <mclasen@redhat.com>

	* autogen.sh: Touch README and INSTALL here to pacify 
	automake.  (#329124, Kjartan Maraas, Tim Janik)

2006-01-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols:
	* btk/btkassistant.h: 
	* btk/btkassistant.c: Actually implement visibility handling,
	and add btk_assistant_update_buttons_state.

	* tests/testassistant.c: Test visibility handling.

2006-01-31  Kristian Rietveld  <kris@imendio.com>

	* btk/btkstyle.c (btk_default_draw_flat_box): Add support for row
	hinting for the selected state.

2006-01-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Make sure the tree view is realized, since we grab the
	focus to it.  (#329144, Wouter Bolsterlee)

	* btk/btkspinbutton.h: 
	* btk/btkspinbutton.c: Add a wrapped signal.  (#322933,
	Carlos Garnacho Parro)

	* btk/btkassistant.c: More generous spacing. (#328082,
	Christian Persch, patch by Carlos Garnacho)
	
	* btk/btktoggletoolbutton.c (btk_toggle_tool_button_set_property): 
	Use the setter for active.  (#329208, Guillaume Cottenceau)

	* docs/tools/widgets.c (get_all_widgets): Add BtkLinkButton

	* btk/btkassistant.c (btk_assistant_init): Move the
	last button to the left where it does not affect
	the positioning of forward/back.

2006-01-29  Matthias Clasen  <mclasen@redhat.com>

	More BtkAssistant work, by Carlos Garnacho.
	
	* tests/testassistant.c: Additions.

	* btk/btkassistant.c: Handle page visibility, other 
	small fixes.

	* docs/tools/widgets.c: Add BtkAssistant.

2006-01-28  Behdad Esfahbod  <behdad@bunny.org>

	* configure.in: If major.minor of required and available bunnylib versions
	are the same, add -DG_DISABLE_DEPRECATED to BUNNYLIB_CFLAGS. (bug #328617)

	* */Makefile.am: Remove hardcoded -DG_DISABLE_DEPRECATED.

2006-01-28  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/msw-style.c: Re-sync with btk-wimp
	* modules/engines/ms-windows/Theme/btk-2.0/btkrc: Ditto
	
2006-01-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols: 
	* btk/btklinkbutton.h: 
	* btk/btklinkbutton.c: Allow to set a global hook function
	thats called whenever a link button is clicked.

	More work on BtkAssistant by Carlos Garnacho:
	
	* demos/btk-demo/Makefile.am: 
	* demos/btk-demo/assistant.c: Add a  BtkAssistant demo.

	* btk/btkassistant.c: Handle focus, several small fixes to the
	flow computations.

2006-01-27  Federico Mena Quintero  <federico@ximian.com>

	Fixes bug #328820:

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_class_init): Make BDK_KP_Divide pop up
	the location dialog populated to "/".
	(tree_view_keybinding_cb): Likewise.
	(trap_activate_cb): Likewise.

2006-01-25  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkcalendar.c (btk_calendar_size_request): Use translated format
	strings for L10n in size calculation too.

	* btk/btkcalendar.c (calendar_paint_week_numbers): Expand buffer to
	accomodate localized digits.

2006-01-26  Matthias Clasen  <mclasen@redhat.com>

	* tests/prop-editor.c: Introspect child properties. too.

2006-01-25  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btkcalendar.c (calendar_paint_week_numbers, calendar_paint_day):
	Use contexed translated strings calendar:week:digits|%d and
	calendar:day:digits|%d to let translators choose localized digits for
	week and day numbers. (bug #317171, Hamed Malek)

2006-01-25  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btklabel.c (get_layout_location): Use logical extents of the
	layout instead of ink extents.  According to Bango docs, that's what
	should be used for placement.  Moreover, simply use
	bango_layout_get_pixel_size instead of getting the extents and
	dividing ourselves.

2006-01-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c: 
	* btk/btkentry.c: Be more careful when blocking signals. 

	* bdk/x11/bdkcursor-x11.c (bdk_x11_display_set_cursor_theme): Only
	set the cursor size if it is != 0.

	* btk/btksettings.c (btk_settings_class_init): Change the default value
	of btk-cursor-theme-size to 0, meaning "use default".

2006-01-24  Kristian Rietveld  <kris@btk.org>

	#322591, Jonathan Blandford.

	* btk/btktreeview.[ch] (btk_tree_view_get_search_entry),
	(btk_tree_view_set_search_entry),
	(btk_tree_view_get_search_position_func),
	(btk_tree_view_set_search_position_func): New functions,
	and small adaptions to the tree view code to allow for setting
	the entry and search position function.

	* btk/btktreeprivate.h: Removed BtkTreeViewSearchDialogPositionFunc
	typedef, which is now in btktreeview.h as
	BtkTreeViewSearchPositionFunc.  Add/update fields.

	* btk/btk.symbols: Add new functions.

	* tests/testtreesort.c: Add a little test for _set_search_entry().

2006-01-23  Matthias Clasen  <mclasen@redhat.com>

	Add BtkLinkButton, a port of BunnyHRef.  (#314808, Emmanuele Bassi)
	
	* btk/btklinkbutton.h: 
	* btk/btklinkbutton.c: New files.

	* btk/btk.h:
	* btk/btk.symbols: 
	* btk/Makefile.am: Glue.

	* btk/btkaboutdialog.c: Use BtkLinkButton.
	
	* btk/btkwidget.c: Add link-color and visited-link-color style
	properties.  (#113649, Leena Gunda)

	* btk/btkaboutdialog.c: Use the new style properties here instead
	of the about dialogs own link-color property. 

2006-01-23  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodel.c (btk_tree_model_base_init): don't copy
	tree paths when emitting signals. (#325041, Matthias Clasen).

2006-01-23  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btklabel.c (get_layout_location): Fix misalignment of RTL
	text in ellipsized BtkLabel: use layout width if set, otherwise
	fallback to ink extents width. (#322042)

2006-01-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkassistant.c (compute_last_button_state): Only show the
	last button if we can jump to the end. 
	(btk_assistant_init): Make the spacing and button order more
	HIG compliant.

	Fix drawing issues in progress bars.  (#328081, Christian Persch)
	
	* btk/btkprogressbar.c (btk_progress_bar_size_request): Always
	request enough space. 
	(btk_progress_bar_paint_activity) 
	(btk_progress_bar_paint_continuous) 
	(btk_progress_bar_paint_discrete): Clip when drawing the bar.

2006-01-23  Michael Natterer  <mitch@imendio.com>

	* btk/btkcolorbutton.c: move destruction of the private BdkGC
	from finalize() to unrealize(). Fixes BadMatch on display change
	(bug #85715).

2006-01-22  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_bin_expose): Revert previous
	commit after more searching in the bugzilla archives (see #309221).

2006-01-22  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_bin_expose): Remove second call
	to btk_tree_view_column_cell_set_cell_data, since we also set the
	cell data before iterating over the columns for exposure. (Fixes
	#322471, Duncan Coutts).

2006-01-21  Matthias Clasen  <mclasen@redhat.com>

	* tests/testassistant.c: Add some tests for BtkAssistant

	* tests/Makefile.am: Glue

2006-01-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkassistant.c: Fix the docs to reflect the actual signal
	signatures.

	* btk/btktextview.c (btk_text_view_set_virtual_cursor_pos): Don't
	crash if layout is NULL.  (#327934, Christian Kirbach)

2006-01-20  Dan Winship  <danw@novell.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_class_init,
	tree_view_keybinding_cb, trap_activate_cb): On "unix", pop up the
	"Open Location" window on "~" as well as "/". #153213
	(location_entry_create): Fix this so autocompletion still works
	correctly in that case.

2006-01-19  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Explicitly link against Xrender.  
	(#327538, Christophe Belle)
	
	* bdk/x11/bdkprivate-x11.h (XID_FONT_BIT): 
	* bdk/x11/bdkfont-x11.c: 
	* bdk/x11/bdkxid.c: Use an unused high bit in the
	XID to mark fonts in the global xid hash table.

	* bdk/x11/bdkcursor-x11.c (update_cursor): Skip fonts
	when iterating over the xid hash table, since calling
	BDK_IS_WINDOW () on an BdkFont can cause a segfault.
	(#327751, Ryan Lovett)

2006-01-19  Matthias Clasen  <mclasen@redhat.com>
	
	* btk/btkassistant.[hc]: Use a priv pointer for
	cheap access to the priv struct.  (#327725, Christian
	Persch)

	* btk/btkassistant.h: Fix line endings.

2006-01-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkassistant.[hc]: Add BtkAssistant, a widget to
	construct multi-step wizards.  (#115348, Martyn Russell, 
	Matthias Clasen, Carlos Garnacho Parro)

	* btk/btk.symbols:
	* btk/Makefile.am: 
	* btk/btk.h: Necessary glue.

2006-01-18  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkevents-quartz.c:
        (get_mm_from_pixels):
        (bdk_screen_get_width_mm):
        (bdk_screen_get_height_mm):
	Implement these functions.
	(#327228, Thomas Broyer).

2006-01-18  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkdrawable-quartz.c:
        (bdk_quartz_draw_polygon):
        (bdk_quartz_draw_lines):
	Implement these functions.
	(#327226, Thomas Broyer)
	
2006-01-18  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkkeys-quartz.c:
	(maybe_update_keymap):
	Support non-MacRoman keyboard layouts.
	(#322585, Wolfgang Thaller)
	
2006-01-18  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkmain-quartz.c:
        (_bdk_windowing_init):
        Make the process a foreground application.
        (#322481, Wolfgang Thaller)
        
2006-01-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrbtree.c: 
	* btk/btktreemodel.c: Fix several g_new() calls which
	were using extra indirections or pointless casts.  
	(#327423, Morten Welinder)

Tue Jan 17 19:27:59 2006  Tim Janik  <timj@imendio.com>

	* btk/btkprogress.c: fix adopted from maemo-btk.
	btk_progress_create_pixmap(): clear out the newly created offscreen 
	pixmap, so themes making use of transparency don't draw onto garbage.

2006-01-17  Michael Natterer  <mitch@imendio.com>

	* btk/btkbutton.c: remove the "child-spacing" style property again
	and add "inner-border" instead. That's far more flexible and
	"child-spacing" was a bad name anyway.

2006-01-17  Michael Natterer  <mitch@imendio.com>

	* configure.in (ALL_LINGUAS): remove "ang" again until all po
	files are there.

2006-01-16  Abel Cheung  <maddog@linuxhall.org>

	* configure.in: Added "ang" "zh_HK" to ALL_LINGUAS.

2006-01-16  Matthias Clasen  <mclasen@redhat.com>

	* README.in: Mention new pixbuf engine features.

	* btk/btk.symbols: 
	* btk/btkradioaction.[hc]: Add a current-value property and a
	setter for it.  (#322735, Jorn Baayen)
	
2006-01-16  Michael Natterer  <mitch@imendio.com>

	* btk/btkbutton.c: applied patch from maemo-btk which adds a
	child-spacing style property. Fixes bug #327202.

2006-01-16  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkdisplay-quartz.c:
        * bdk/quartz/bdkevents-quartz.c:
        (bdk_keyboard_grab):
        (bdk_display_keyboard_ungrab):
        (bdk_keyboard_grab_info_libbtk_only):
        (find_window_for_event):
        Implement keyboard grabs.
        
        (_bdk_quartz_send_map_events):
        * bdk/quartz/bdkmain-quartz.c:
        * bdk/quartz/bdkprivate-quartz.h:
        New function that synthesizes map events.
        
        * bdk/quartz/bdkwindow-quartz.c:
        (_bdk_windowing_window_init):
        The root window is always visible.
        
        (all_parents_shown):
        (show_window_internal):
        Send map events.
        
        (bdk_window_hide):
        Ungrab keyboard and pointer

2006-01-15  Kristian Rietveld  <kris@btk.org>

	Fixes #324099, Tommi Komulainen.

	* btk/btktreestore.[ch] (btk_tree_store_insert_with_values),
	(btk_tree_store_insert_with_valuesv): new functions, analog to
	those found in BtkListStore.

	* btk/btktreestore.c (btk_tree_store_real_set_value),
	(btk_tree_store_set_valist), (btk_tree_store_set_valist_internal),
	(btk_tree_store_sort_iter_changed): refactored.

	* btk/btk.symbols: updated.

	* tests/treestoretest.c: added a test for this new functionality.

2006-01-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (btk_entry_drag_data_received): Remove 
	an unused variable.

	* btk/btkiconfactory.c (get_default_icons): Register RTL 
	versions of the indent and unindent icons.  (#326857,
	Itai Bar-Haim)

	* btk/Makefile.am (STOCK_ICONS): And add them here.

	Fix a crash with combo boxes in RESIZE_IMMEDIATE
	containers.  (#326806, Sebastian Bacher)
	
	* btk/btkcombobox.c (btk_combo_box_size_allocate) 
	(btk_combo_box_size_request): Don't call 
	btk_combo_box_check_appearance() from here, as that 
	can lead to recursion. 
	(btk_combo_box_init): Instead, call it here.

2006-01-14  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelsort.c (btk_tree_model_sort_iter_children): fix
	a typo which caused this whole thing to not function ...

2006-01-14  Kristian Rietveld  <kris@btk.org>

	* btk/btktreeview.c (btk_tree_view_size_allocate),
	(validate_visible_area): fixup adjustments and top_row if the
	current dy + page_size exceeds the new tree view height. (Fixes
	#316689, reported by Chris Lord).

2006-01-13  Matthias Clasen  <mclasen@redhat.com>

	* */abicheck.sh: Make this work on more platforms.

2006-01-13  Kristian Rietveld  <kris@imendio.com>

	* tests/testtreefocus.c (set_indicator_size), (main): add a little
	test for the newly introduced indicator-size property.

2006-01-13  Kristian Rietveld  <kris@imendio.com>

	* btk/btkcellrenderertoggle.c (btk_cell_renderer_toggle_init):
	initialize the inconsistent field in the private structure,
	(btk_cell_renderer_toggle_class_init),
	(btk_cell_renderer_toggle_{set,get}_property),
	(btk_cell_renderer_toggle_get_size): introduce a indicator-size
	property.

2006-01-13  Michael Natterer  <mitch@imendio.com>

	* btk/btktreeview.c (btk_tree_view_real_expand_row)
	(btk_tree_view_real_collapse_row): don't animate the expander
	arrows if btk-enable-animations is FALSE (bug #142582).

2006-01-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c: Replace hardcoded values for tab-overlap and
	tab-curvature with style properties.  (#325282, Alexander Nedotsukov)

	* btk/btktextview.c (btk_text_view_commit_text) 
	(btk_text_view_delete_from_cursor, btk_text_view_backspace): 
	Reset the virtual cursor position.  (#326003, Evert Verhellen)

	* btk/btkwidget.c (btk_widget_set_app_paintable): Add some docs
	about RGBA windows. (#326486, Benjamin Otte)

2006-01-12  Michael Natterer  <mitch@imendio.com>

	* bdk/bdkimage.c (scratch_image_info_for_depth): connect to the
	display's "closed" signal and free the cached scratch images upon
	display closing (bug #85715).

2006-01-12  Michael Natterer  <mitch@imendio.com>

	* btk/btkexpander.c (btk_expander_set_expanded): skip the
	animation if the btk-enable-animations setting is FALSE
	(bug #142582).

2006-01-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c: Fix a C99ism (#326658, Kazuki Iwamoto)

2006-01-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c: Add some notify batching, always
	emit notify after setting the new value.

	* btk/btkmessagedialog.c: Add properties.  (#311254,
	Johan Dahlin)
	(btk_message_dialog_new): Remove some redundant code, pointed
	out by Gustavo Carneiro.

	* bdk/x11/bdkwindow-x11.c (create_moveresize_window): Clean
	up properly if the grab fails.
	(finish_drag): Don't leak a reference to moveresize_window
	here.

2006-01-11  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkevents-x11.c: Fix string offsets.

	Allow falling back to another icon theme before 
	hicolor.   (#325546, Rodney Dawes)
	
	* btk/btksettings.c: Add a btk-fallback-icon-theme setting.

	* bdk/x11/bdkevents-x11.c: Map it to the XSetting Net/FallbackIconTheme.
	
	* btk/btkicontheme.c: Consult the fallback icon theme before
	looking in hicolor. 

2006-01-10  Matthias Clasen  <mclasen@redhat.com>

	* tests/testbtk.c: Add an expander example.

	* btk/btkcalendar.c (btk_calendar_focus_out): Queue a draw
	when losing the focus.  (#326064, Andrew Conkling)

	* btk/btkimmulticontext.c: 
	* btk/btkhsv.c: 
	* btk/btkhandlebox.c: Convert to use instance private data.

	* btk/btk.h: Remove duplicate include.  (#326429, 
	BenoÃ®t Carpentier)

	* btk/btkpaned.c: Convert to use instance private data.

2006-01-10  Michael Natterer  <mitch@imendio.com>

	* bdk/bdkbango.c (on_renderer_display_closed): disconnect from the
	right object ("closed" is emitted by the display, not the screen).
	(bug #85715)

2006-01-10  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/bdkproperty-quartz.c:
        (ensure_atom_tables):
        (intern_atom_internal):
        (bdk_atom_intern):
        (bdk_atom_intern_static_string):
        (bdk_atom_name):
        Implement local-only atoms.

2006-01-09  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkgc.c (gc_get_foreground): Correct a warning.
	(#326341, BenoÃ®t Carpentier)

	* btk/btk.symbols:
	* btk/btkwindow.h:
	* btk/btkwindow.c (btk_window_get_group): Make this function
	public API.  (#307099, Todd Berman)

	* btk/btkmenu.c: 
	* btk/btkmain.c: 
	* btk/btkentrycompletion.c: 
	* btk/btkcombo.c: 
	* btk/btkcombobox.c: Update all callers.

	* btk/btkentry.c (paste_received):  Make BtkEntryCompletion
	complete on pastes at the end.  (#165714, Christian Neumair)

	* btk/btkentrycompletion.c (_btk_entry_completion_popup): 
	Prevent the first row being focused on map.  (#137351,
	Niklas Knutsson)

2006-01-09  Johan Dahlin  <jdahlin@async.com.br>

	* btk/btk.symbols:
	* btk/btkeditable.h:
	* btk/btksizegroup.c: (btk_size_group_get_widgets):
	* btk/btksizegroup.h:
	(struct _BtkSizeGroup): 

	Add btk_size_group_get_widgets, fixes #326324.
	Also mark all fields of BtkSizeGroup as private

2006-01-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextlayout.c (btk_text_layout_finalize): Don't
	leak preedit_string and preedit_attrs.  (#322332, Paolo
	Borelli)

	* btk/btk.symbols:
	* btk/btkaction.h: 
	* btk/btkaction.c (btk_widget_get_action): New function to
	get the action for a proxy.  (#326288)

	* btk/btkaction.c: Go back to the old key for attaching the
	action to the proxy.  (#326288, Diego GonzÃ¡lez)

2006-01-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkactiongroup.c (dgettext_swapped): Don't translate
	empty strings.  (#326200, Christian Stimming)

2006-01-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.[hc]: 
	* btk/btklabel.[hc]: Shrink the private structs of these a bit.

	* btk/btklabel.c (get_layout_location): Fix label alignment 
	when width-chars is set.  (#326098, Benjamin Otte)

	* bdk/bdkrebunnyion-generic.c (miRebunnyionCopy): Fix this for the 
	single-rectangle case.  (#326127, Benjamin Berg)
	(bdk_rebunnyion_copy): Use miRebunnyionCopy() here.

2006-01-07  Matthias Clasen  <mclasen@redhat.com>

	Fix actiongroup-action interaction that relied on 
	actions connecting to notify on themselves:
	
	* btk/btkaction.[hc]: Factor out the code updating the
	visibility/sensitivity of proxies into _btk_action_sync_visible()
	and _btk_action_sync_sensible().

	* btk/btkactiongroup.c: Call the new functions when the
	group visibility/sensitivity changes. 

2006-01-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkactiongroup.c (btk_action_group_set_sensitive) 
	(btk_action_group_set_visible): Add missing property change
	notification.

2006-01-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c (model_add_special): Just use the
	directory name for the home dir.  (#325817, Federico Mena Quintero)
	
	* btk/btktexttag.c (btk_text_attributes_new): Initialize editable 
	to TRUE. 
	(btk_text_tag_class_init): The default value for the direction 
	property is BTK_TEXT_DIR_NONE. Add notes about the initial values 
	of the font and language properties.

	* btk/btktoolbutton.c (btk_tool_button_class_init): Make clicked
	an action signal.  (#325782, Martyn Russell)

	* btk/btkviewport.c (viewport_set_adjustment): Disconnect from
	the old adjustments signals.  (#325869, Jorn Baayen)

2006-01-06  Hans Breuer  <hans@breuer.org>

	* tests/makefile.msc : added a bunch of tests
	* tests/testcellrenderertext.c : use g_snprintf()
	* tests/testfilechooserbutton.c : don't include unistd.h twice.
	Removed the unconditional one and added direct.h for G_OS_WIN32
	
2006-01-05  Hans Breuer  <hans@breuer.org>

	* bdk/makefile.msc : also recurse into win32 for ::clean
	* btk/makefile.msc.in : create btkbuiltincache.h (most code
	to simulate links) and file renames

2006-01-05  Johan Dahlin  <jdahlin@async.com.br>

	* btk/btkprogressbar.c: Set minimum for activity-step property to 0
	instead of -G_MAXUINT.
	
2006-01-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwindow.c: Only connect to the event if we have
	a frame, since the handler is only relevant in that case.

	* btk/btkaction.c (connect_proxy, disconnect_proxy): 
	Use a weak reference rather than the destroy signal to track 
	proxies going away.

	* btk/btkbindings.c (binding_signal_new): Revert the last change.

	* btk/btkaction.c (btk_action_sync_property): 
	(btk_action_sync_stock_id): Removed.

2006-01-05  Rodrigo Moya <rodrigo@novell.com>

	* btk/btkbindings.c (binding_signal_new): allocate correct amount for
	signal and arguments.

2006-01-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c (btk_label_grab_focus): Don't return a value from
	a void function.

2006-01-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbindings.h (struct _BtkBindingSignal): Revert questionable
	changes.
	
	* btk/btkbindings.c: Use the slice allocator and allocate signal
	and arguments in one block.

	* btk/btkuimanager.c (btk_ui_manager_get_toplevels): Don't return
	a list of NULLs.  (#325723, Steve Chaplin)

2006-01-04  Rodrigo Moya <rodrigo@novell.com>

	* btk/btkbindings.c (binding_signal_new): guard against multiplying
	by -1 (when n_args is 0).

2006-01-04  Michael Natterer  <mitch@imendio.com>

	* btk/btkmenutoolbutton.c
	(btk_menu_tool_button_set_menu)
	(btk_menu_tool_button_destroy): use btk_menu_attach_to_widget()
	and btk_menu_detach() instead of reffing/unreffing the menu
	manually. Also fixes brokenness on screen change (bug #85715).

2006-01-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaccelmap.c: 
	* btk/btkactiongroup.c: 
	* btk/btkdialog.c: 
	* btk/btkfilesystemunix.c: 
	* btk/btkgc.c: 
	* btk/btkkeyhash.c: 
	* btk/btkplug.c: 
	* btk/btktextiter.c: 
	* btk/btktextlayout.c: 
	* btk/btkuimanager.c: 
	* btk/btkwidget.c: 
	* btk/btkwindow.c: 
	* btk/btkxembed.c: Use the slice allocator for many small 
	allocations.

	* btk/btkcolorsel.c: 
	* btk/btktreeview.c: Use IPN.

	* btk/btkwidget.c: Remove an unused field from the AccelPath 
	struct.

2006-01-04  Tor Lillqvist  <tml@novell.com>

	* btk-zip.sh.in: Include also the btk20-properties message catalogs.

2006-01-03  Matthias Clasen  <mclasen@redhat.com>
	
	* btk/btkdnd.c: Make it compile

	* btk/btkdnd.c (btk_drag_begin_internal): Call btk_drag_update
	for non-motion events.  (#325443, Peter Harvey)

	* btk/btkaction.c: Avoid connecting to notify on our own
	properties. 

2006-01-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (btk_entry_delete_from_cursor): When deleting
	words, delete preceding whitespace as well.  (#325358,  Akkana Peck)

2006-01-02  Anders Carlsson  <andersca@imendio.com>

        * bdk/quartz/BdkQuartzWindow.c:
        (-[BdkQuartzWindow canBecomeMainWindow]):
        (-[BdkQuartzWindow canBecomeKeyWindow]):
        Have these return TRUE
        
        * bdk/quartz/bdkevents-quartz.c:
        (pointer_grab_internal):
        Remove FIXME
        
        (find_child_window_by_point_helper):
        Fix bug in offset calculation
        
        (find_window_for_event):
        Use grab window toplevel when a grab is in effect
        
        (bdk_event_translate):
        Don't call _bdk_event_button_generate on mouse up
        
        * bdk/quartz/bdkgc-quartz.c:
        (_bdk_quartz_gc_new):
        Fix indentation
        
        * bdk/quartz/bdkwindow-quartz.c:
        (bdk_window_new):
        Make TEMP windows borderless
        
        (bdk_window_hide):
        Hide window
        
        (bdk_window_get_origin):
        Implement
        
2006-01-02  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkwindow-win32.c
	(bdk_window_impl_win32_get_visible_rebunnyion): Make identical to the
	X11 implementation. (#322264, John Ehresman)

	* bdk/win32/bdkgeometry-win32.c (bdk_window_scroll): Get the
	invalidated rebunnyion from ScrollWindowEx() instead of an incorrect
	attempt to calculate it ourselves. Fix by John Ehresman. (#323666)

	* bdkevents-win32.c: Make _bdk_win32_hrgn_to_rebunnyion() non-static.

	* bdkprivate-win32.h: Declare it.

2005-12-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaction.c: 
	* btk/btkentry.c: Connect to notify instead of multiple
	detailed signals.

2005-12-30  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdk.symbols: 
	* bdk/bdkbairo.h: 
	* bdk/bdkbairo.c: Add bdk_bairo_set_source_pixmap.  (#318805,
	Alexander Larsson)

	* bdk/bdkdisplaymanager.c (bdk_display_manager_set_property): Call
	bdk_display_manager_set_default_display() to change the default
	display.  (#153623, Stefan Kost)

	* btk/btkmessagedialog.c (btk_message_dialog_init):
	 (setup_type): Alert dialogs should not have titles and should 
	not be displayed in the taskbar.  (#310443, Carlos Garnacho Parro,
	Dennis Cranston)

2005-12-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkliststore.c: 
	* btk/btktreestore.c: Always call the get_path and get_iter
	implementations directly, rather than the current mixture whith
	some calls going through the BtkTreeModel interface.

	* btk/btktreemodelsort.c: 
	* btk/btkliststore.c: 
	* btk/btktreestore.c: Remove excessive g_return_if_fail() checks
	in static functions.
	
	* btk/btktreedatalist.c: Use the slice allocater for 
	BtkTreeDataSortHeader.

	* btk/btktreedatalist.h: 
	* btk/btktreedatalist.c (_btk_tree_data_list_set_header): New function.

	* btk/btktreemodelsort.c (btk_tree_model_sort_set_sort_func): 
	* btk/btkliststore.c (btk_list_store_set_sort_func): 
	* btk/btktreestore.c (btk_tree_store_set_sort_func): Use it here.

2005-12-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbindings.h (BtkBindingSignal): 
	* btk/btkbindings.c (binding_signal_new): Make the
	args a flexible array inside the struct, and allocate them
	together.

Wed Dec 28 00:45:46 2005  Tim Janik  <timj@btk.org>

	* btk/btkctree.c (row_delete): delete BtkCTreeRow as BtkCTreeRow, not
	clist rows which crashes in gslice later on.

2005-12-27  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilefilter.c (btk_file_filter_filter): In the case for
	FILTER_RULE_PIXBUF_FORMATS, check that filter_info->mime_type is
	not NULL.  Fixes bug #317687.

2005-12-27  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkevents-x11.c (check_transform): Fix a typo.
	(bdk_screen_get_setting): Avoid relocations for the settings
	map.

	* bdk/x11/bdkproperty-x11.c: Avoid relocations for the list
	of standard atoms.

	* btk/btkbindings.c (btk_binding_set_new): Avoid copying
	the set_name by interning it.

2005-12-26  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Precache atoms
	before calling bdk_window_new().

	* btk/btktextbtree.c: Use the slice allocator for some other small
	auxiliary structures as well.

	* btk/btkimcontext.c (btk_im_context_filter_keypress): Clarify
	docs.  (#324996)

	* btk/btktextbtree.c (btk_text_btree_get_tag_info) 
	(btk_text_btree_remove_tag_info): Use the slice allocator for 
	tag info.

	* README.in: Mention the stripping of (_F) suffixes.

	* btk/btktoolbar.c (_btk_toolbar_elide_underscores): Strip a suffix of 
	the form "(_<single character>)", since this is the preferred way
	for some languages to indicate accelerators.  (#323956, Yang Hong)

	* btk/btklabel.c (btk_label_class_init): Add a btk-label-select-on-focus
	setting.
	(btk_label_grab_focus): And use it here to select the contents of
	the label when appropriate.
	(btk_label_class_init): Use the same keybindings for select all/
	unselect all as BtkEntry and BtkTextView.

	* btk/btkdialog.c (btk_dialog_map): When looking for the initial
	focus, avoid leaving a selection in a label.

2005-12-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwindow.c: Documentation fixes.  (#324815, 
	Ross Burton)

	* configure.in: Require GLib 2.9.2

2005-12-24  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkrebunnyion-generic.c: 
	* bdk/bdkpolyreg-generic.c: 
	* bdk/bdkrebunnyion.h: 
	* bdk/bdkrectangle.c: Inline docs, use g_assert(), avoid 
	extra allocation for rectangular rebunnyions.

Thu Dec 22 18:53:14 2005  Tim Janik  <timj@btk.org>

        * btk/btkobject.[hc]: renamed GUnowned to GInitiallyUnowned.

Thu Dec 22 17:55:11 2005  Tim Janik  <timj@btk.org>

	* btk/btkobject.h: parent type fixups in structure declarations.

Thu Dec 22 16:01:27 2005  Tim Janik  <timj@imendio.com>

	* btk/btkobject.c: derive BtkObject from GUnowned,
	so it initially has a floating reference count.
	btk_object_class_init(): installa floating flag handler with
	libbobject, so for BtkObjects the flag is stored as BTK_FLOATING
	in the ->flags member.

	* tests/floatingtest.c: test floating flag uses.

2005-12-21  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkrebunnyion-generic.c: Use the slice allocator
	for rebunnyions. Still todo: avoid extra allocations for
	the single-rectangle case.

	* btk/btksettings.c (btk_settings_class_init): Update
	class_n_properties after installing color-hash, since
	other classes install settings, too.

	* btk/btkctree.c: 
	* btk/btkclist.c: Fix some mistakes in the conversion
	from mem chunks to slice allocator.

	* btk/btkiconview.c (adjust_wrap_width): Adjust the 
	wrap-width also if an explicit item width is set.  
	(#322475, Alex Graveley)
	
2005-12-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_button_press): Reset 
	pressed_button to -1 after handling a double click, so that
	motion events occurring between here and the release event
	don't trigger DND.  (#324588, Dave Andreoli)

2005-12-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrenderer.c: 
	* btk/btkselection.c: 
	* btk/btkcalendar.c: 
	* btk/btkitemfactory.c: 
	* bdk/btkcombo.c: 
	* bdk/bdkpixbuf-render.c: Documentation updates

	* btk/btktreemodel.c: 
	* btk/btkplug.c: 
	* btk/btkwindow.c: Documentation fixes.

2005-12-19  Michael Natterer  <mitch@imendio.com>

	* btk/btkentry.c: implement boolean property "truncate-multiline"
	which, when enabled, truncates multi-line pastes or drops to their
	first line. Fixes bug #322252.

	* btk/btkfilechooserentry.c (btk_file_chooser_entry_init): enable
	truncate-multiline here.

2005-12-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksettings.c (get_color_hash): Don't crash if
	there is no color scheme.  (#324429, Diego Gonzalez)

2005-12-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystem.c (btk_file_system_module_load): 
	* btk/btkimmodule.c (btk_im_module_load): 
	* btk/btkthemes.c (btk_theme_engine_load): 
	* btk/btkmodules.c (find_module): Use G_MODULE_BIND_LAZY when
	opening modules.

	* btk/btksettings.[hc]: Rework the way the color scheme setting
	is inherited. Now the overriding is done on a per-color basis,
	rather than for the setting as a whole. This has the effect
	that themes can declare defaults for all the symbolic colors they
	use by specifying a value for the btk-color-scheme setting in 
	their rc file, while still allowing the XSetting to override
	"standard" symbolic colors. The hash table is now available
	through the color-hash property.
	
	* btk/btkrc.c: Use the new color-hash property.
	
2005-12-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcontainer.c (_btk_container_focus_sort): Skip unrealized
	children when doing focus sorting.  (#323995, Dan Winship)

2005-12-14  Rodney Dawes  <dobey@novell.com>

	* btk/btkfilesystemunix.c (btk_file_system_unix_volume_render_icon):
	Default to "drive-harddisk" and then fall back to bunny-dev-harddisk
	(get_icon_for_mime_type): Look up the mime type icons according to the
	Icon Naming Specification and then fall back to the bunny-mime- prefix
	for the mime type icons

	Fixes #323655
	
2005-12-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkdnd.c (btk_drag_set_icon_name): Warn if the icon
	cannot be loaded.  (#323504, Kjartan Maraas)

	* btk/btktreeview.c (btk_tree_view_class_init): Add docs 
	for the row-activated signal.  (#324044, Davyd Madeley)

2005-12-14  Michael Natterer  <mitch@imendio.com>

	* tests/test-images/valid_jpeg_progressive_test: new test image.

Tue Dec 13 09:47:20 2005  Tim Janik  <timj@btk.org>

	* README.in: added a link to the floating reference docs in the
	2.10 release NEWS section.

2005-12-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextiter.c (btk_text_iter_set_visible_line_index): 
	Speed this function up, using the fact that visibility is 
	constant across segments. (#321548, Paolo Borelli)

	* btk/btktextbtree.c (_btk_text_line_char_to_byte_offsets): 
	* btk/btktextiter.c (btk_text_iter_backward_chars): Speed up
	stepping backwards.  (#320638, Larry Ewing, Paolo Borelli)

	* btk/btkicontheme.c (ensure_valid_themes): Only broadcast
	_BTK_LOAD_ICONTHEMES if we detect a real theme change, not
	upon initial theme load.  (#323876, Peter Lund)

	* btk/btkstatusicon.c (btk_status_icon_class_init): Register
	the size-changed signal correctly.  (#323848, Murray Cumming)

	* btk/btkmarshalers.list: Add necessary marshaller.

	* btk/btktextview.c (btk_text_view_get_border_window_size): Don't
	fall thru to the wrong window types.  (#323843)

	Make the btk-color-scheme setting work.
	
	* btk/btksettings.h: 
	* btk/btksettings.c (_btk_settings_get_color_hash): Add a getter
	that takes care of initializing the color hash if it is not 
	already there.  

	* btk/btkrc.c (btk_rc_color_scheme_changed, btk_rc_context_get): 
	And use it here.	

2005-12-10  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdk.c (bdk_parse_args): Warn if parsing fails,
	not if it succeeds. 

2005-12-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkselection.c (btk_selection_data_get_uris): Don't
	leak list[0].  (#323629, Markku Vire)

	* btk/btktextbuffer.c (paste_from_buffer): Unref the buffer
	when freeing the RequestData.  (#323577)

2005-12-07  Matthias Clasen  <mclasen@redhat.com>

	* demos/btk-demo/iconview_edit.c (set_cell_color): Don't
	leak text.

	* btk/btktoolbutton.c (clone_image_menu_size): Fix a 
	variable name clash.  (#323475, Ross Burton)

2005-12-07  Ross Burton  <ross@burtonini.com>

	* docs/reference/btk/tmpl/btkenums.sgml:
	* btk/btktoolbutton.c:
	If the toolbar mode is ICONS and there is no icon set then show
	the label, and vice versa (#322019)

2005-12-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktoolbutton.c (clone_image_menu_size): Fix a 
	variable name clash.  (#323475, Ross Burton)

	* btk/btktreeview.c (btk_tree_view_key_press): Use the correct
	window when synthesizing the key event.  (#323077,
	Sadrul Habib Chowdhury)
	
	(btk_tree_view_search_key_press_event): Also listen for
	BDK_ISO_Left_Tab.  (#323077, Sadrul Habib Chowdhury)

	* btk/btktextview.c (btk_text_view_preedit_changed_handler): 
	Only scroll if we have focus.  (#316310, Paolo Borelli)

	* btk/btkfilesystemunix.c (cb_fill_in_mime_type): Fix a C99ism,
	spotted by Crispin Flowerday.

2005-12-06  Behdad Esfahbod  <behdad@bunny.org>

	* btk/btksettings.c (settings_update_font_options): Turn metrics
	hinting on (part of #307196)

2005-12-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkimcontextsimple.c (btk_im_context_simple_reset): Don't
	commit from reset, it upstets BtkTextView.

	* btk/btktextview.c (btk_text_view_check_cursor_blink): Be more
	careful when turning blinking on and off.
	(btk_text_view_focus_out_event): Make the cursor really invisible
	when the focus goes away.  (#323087, Sadrul Habib Chowdhury)
	(cursor_blinks): Check the btk-cursor-blink setting first.

	* btk/btktreeview.c (btk_tree_view_key_press): Fix refcounting
	issues with new_event and its window.

	* btk/btkmenu.c (btk_menu_attach_to_widget): Accept NULL
	as a detach func.  (#323386, Jorn Baayen)

	* btk/btkcalendar.c: Avoid conflict with win32 headers in
	the libdate routines.  (#323045, Kazuki Iwamoto)

	* bdk/bdk.c (bdk_parse_args): 
	* btk/btkmain.c (btk_parse_args): Don't ignore errors
	from g_option_context_parse(). 

Tue Dec  6 11:37:59 2005  Tim Janik  <timj@btk.org>

	* bdk/bdkevents.c (bdk_event_new): fix missing hash table 
	initialization.

Tue Dec  6 10:32:17 2005  Tim Janik  <timj@btk.org>

	* btk/btkstatusbar.c: ported memchunk uses to g_slice, so the code
	compiles again.

2005-12-05  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (trap_activate_cb): "event->state &
	modifiers", not "event->state && modifiers".  Patch by Sadrul
	Habib Chowdhury <imadil@gmail.com>.  Fixes bug #323073.

2005-12-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwidget.c: 
	* btk/btkuimanager.c: 
	* btk/btktreedatalist.c: 
	* btk/btktext.c: 
	* btk/btkmain.c: 
	* btk/btkitemfactory.c: 
	* btk/btkseparator.[hc]:
	* btk/btkclist.[hc]: 
	* btk/btkctree.c:
	* btk/btkgc.c: Use g_slice instead of mem chunks.

2005-12-05  Michael Natterer  <mitch@imendio.com>

	* bdk/x11/bdkevents-x11.c: map the new BtkSettings properties
	"timeout-initial", "timeout-repeat", "color-scheme" and
	"enable-animations" to X settings.

2005-12-05  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkevents.c: 
	* bdk/bdkcolor.c: Use g_slice instead of mem chunks.

	* btk/btktreeview.c (btk_tree_view_key_press): Free new_event
	after sending it to the search entry.  (#323209, Crispin Flowerday)

	* README.in: Add a note about BTK_FLOATING.

	* btk/btkobject.h (BTK_OBJECT_FLOATING): Use g_object_is_floating.

2005-12-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktoolbutton.c (clone_image_menu_size): Don't leak
	a pixbuf.  (#323024, Paolo Borelli)

2005-12-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystemunix.c (get_icon_for_mime_type): Don't crash
	if mime_type is NULL.  (#322998, Sadrul Habib Chowdhury)

2005-12-02  Michael Natterer  <mitch@imendio.com>

	* btk/btkmenu.c: applied modified patch from maemo-btk which
	adds a "horizontal-padding" style property. Fixes bug #323036.

2005-12-01  Michael Natterer  <mitch@imendio.com>

	Merged modified patch from maemo-btk that allows to disable
	toolbar animations. Addresses bug #142582.

	* btk/btksettings.c: added boolean property "btk-enable-animations".
	(patch from Christian Neumair)

	* btk/btktoolbar.c: don't animate toolbar changes if the settings
	property is FALSE. Replaced the individual "notify::foo"
	connections to BtkSettings by a single "notify" callback and
	dispatch internally.

2005-12-01  Michael Natterer  <mitch@imendio.com>

	* btk/btkmenu.c (btk_menu_class_init): removed redundant
	assignment of widget_class->motion_notify_event

2005-11-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktoggleaction.c (btk_toggle_action_class_init): Add 
	an active property.  (#322673, Jorn Baayen)

	Properly handle model changes in BtkTreeSelection: (#322569,
	Milosz Derezynski)
	
	* btk/btktreeselection.c (btk_tree_selection_selected_foreach): 
	Get a reference to the model, and stop the iteration if the model
	of the treeview is changed on the way.

	* btk/btktreeprivate.h: 
	* btk/btktreeselection.c (_btk_tree_selection_emit_changed): New 
	private function to emit the BtkTreeSelection::changed signal.

	* btk/btktreeview.c (btk_tree_view_set_model): Call 
	_btk_tree_selection_emit_changed() when the model changes.

2005-11-28  Federico Mena Quintero  <federico@ximian.com>

	Fixes the critical warnings from bug #317999, thus fixing the bug
	completely:

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_paths): In SELECT_FOLDER mode,
	use _btk_file_chooser_get_current_folder_path() instead of fetching the
	impl->current_folder directly.  The latter may be null if we are
	in RELOAD_NONE state.

2005-11-28  Federico Mena Quintero  <federico@ximian.com>

	Fix bug #321560, based on a patch by Bogdan Nicula (bogdanni@hotmail.com):

	* btk/btkfilechooserdefault.c (up_folder_handler): Don't add the
	current_folder to the pending select paths here; the path bar will
	give it to us now.
	(path_bar_clicked): Add the child_path to the pending select paths
	here.
	(show_and_select_paths): Don't filter out folders.
	(show_and_select_paths): Don't take separate arguments for
	only_one_path and multiple paths.

	* tests/autotestfilechooser.c (test_folder_switch_and_filters):
	New test about preserving the filters when we change folders.

2005-11-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkscale.c (_btk_scale_format_value): Insert an LRM, to prevent
	-20 to come out as 20- in RTL locales.  (#322571, Tze'ela Hebron)

	* btk/btkaction.c (btk_action_sync_button_stock_id) 
	(connect_proxy): Buttons use the label property for stock ids.  (#322565,
	Milosz Derezynski)

	* btk/btkiconview.c (update_text_cell, update_pixbuf_cell): Correctly
	handle the cell list and indices into it.  (#321856)

2005-11-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktooltips.c (btk_tooltips_timeout): Set timer_tag to 0 when
	the timeout is done.  (#322291, Jean-Yves Lefort)

2005-11-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (shortcuts_key_press_event_cb): Make
	F2 work for renaming bookmarks.  (#320822, Jaap A. Haitsma, patch
	by Paolo Borelli)

2005-11-28  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_urgency_hint):
	Implement the conditional use of FlashWindowEx() properly for MSVC
	compilations. The code was confusingly assuming that if compiled
	with a "new" compiler, it will only be run on "new" Windows
	versions. We want it to run on "old" versions, too, even if
	compiled with a "new" compiler. There are two orthogonal issues:
	whether the compiler defines the necessary API in its headers, and
	whether it is present at run-time. (#318077)

	* btk/btkcalendar.c (btk_calendar_init): Use GetLocaleInfo() on
	Windows to get the localized weekday and month names. strftime()
	in the Microsoft C library returns strings in the default codepage
	for the locale of the process, not the system codepage. Thus
	g_locale_to_utf8() isn't useable on the return value from
	strftime(). (#322603)

2005-11-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmessagedialog.c (btk_message_dialog_new_with_markup): 
	Fix an example.  (#322493, Elie De Brauwer)
	
	Fix two memory handling problems in BtkTreeView: (#322350, 
	SÃ¸ren Sandmann)
	
	* btk/btktreeview.c (btk_tree_view_destroy) 
	(btk_tree_view_set_model): Remove all references to nodes in
	the old model.
	(btk_tree_view_real_collapse_row): Unmark expanded_collapsed_node
	before removing the children.

	* btk/btkcolorbutton.c (btk_color_button_init): Don't leak a 
	BangoLayout here.  (#322505, Paolo Borelli)

2005-11-27  Tor Lillqvist  <tml@novell.com>

	Once again rework Win32 window decoration code. Doesn't break
	#104514. The dialogs in btk-demo now have the same decorations and
	behaviour as on X11. Tried to fix #322516 but it seems very hard
	to make the trivial sample program there behave as expected. OTOH,
	simply moving the btk_window_decorate() call in the #322516 sample
	program after the call to btk_widget_show() helps...
	    
	* bdk/win32/bdkwindow-win32.c (set_or_clear_style_bits): Revert to
	the correct semantics. Each call to bdk_window_set_decorations()
	which calls this function is supposed to affect all decorations.

	(decorate_based_on_hints): New function, looks at both geometry
	hints and type hint and sets window decorations based on
	that. Consolidate code from bdk_window_set_geometry_hints() and
	bdk_window_set_type_hint() here.

	(bdk_window_set_geometry_hints, bdk_window_set_type_hint): Call
	decorate_based_on_hints().

2005-11-25  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/*.[ch]: Merge with btk-wimp's CVS.
	Includes improved menu icon spacing, [+]/[-] expander drawing,
	status-bar gippie drawing, and notebook tab drawing.
	
2005-11-24  Michael Natterer  <mitch@imendio.com>

	* btk/btktoolbar.h (struct _BtkToolbar): changed two private guint
	that used to hold signal handler IDs to two guint of padding.

	* btk/btktoolbar.c (struct _BtkToolbarPrivate): added them as
	gulong here.

	(btk_toolbar_screen_changed): changed accordingly.

Wed Nov 23 18:55:47 2005  Tim Janik  <timj@imendio.com>

	* btk/btkobject.[hc]: deprecated floating/sink API and implemented it
	in terms of the GObject floating/sink API.

	* btk/btkaboutdialog.c:
	* btk/btkaction.c:
	* btk/btkcellview.c:
	* btk/btkclist.c:
	* btk/btkcolorsel.c:
	* btk/btkcombobox.c:
	* btk/btkfilechooserdefault.c:
	* btk/btkiconview.c:
	* btk/btkinvisible.c:
	* btk/btkitemfactory.c:
	* btk/btklayout.c:
	* btk/btkmenu.c:
	* btk/btkmenutoolbutton.c:
	* btk/btknotebook.c:
	* btk/btkprogress.c:
	* btk/btkrange.c:
	* btk/btkspinbutton.c:
	* btk/btkstatusicon.c:
	* btk/btktext.c:
	* btk/btktextview.c:
	* btk/btktoolbar.c:
	* btk/btktoolbutton.c:
	* btk/btktoolitem.c:
	* btk/btktreeitem.c:
	* btk/btktreeview.c:
	* btk/btktreeviewcolumn.c:
	* btk/btkuimanager.c:
	* btk/btkviewport.c:
	* btk/btkwidget.c:
	* btk/btkwindow.c:
	ported to use GObject's g_object_ref_sink().

	* btk/btkcolorsel.c:
	* btk/btkfilechooserdefault.c:
	* btk/btkaboutdialog.c:
	fixed compiler warnings.

2005-11-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksettings.c (btk_settings_class_init): Add some docs
	about btk-color-scheme.

2005-11-23  Behdad Esfahbod  <behdad@bunny.org>

	* configure.in (enable_explicit_deps): Fix typo when checking
	libtool config deplibs_check_method. Moreover, enable explicit
	deps if we get anything other than pass_all from libtool. (part of
	#318750)

2005-11-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/updateiconcache.c (write_csource): Don't create a big
	string, since Visual C++ doesn't like strings longer than 64k. 
	(#322238, Kazuki IWAMOTO

	* btk/btkentry.c: Include btkimcontextsimple.h  (#322235,
	Kazuki IWAMOTO)

2005-11-23  Michael Natterer  <mitch@imendio.com>

	* btk/btkrc.c (btk_rc_reset_widgets): don't leak all toplevel
	windows on other screens (correctly remove all temporary
	references).

2005-11-23  Michael Natterer  <mitch@imendio.com>

	Added symbolic themable colors. Patch is a merged version of
	proposals from Matthias and maemo-btk. Fixes bug #114355.

	* configure.in: require bunnylib >= 2.9.1 for refcountable hashtables.

	* btk/btksettings.c: added property "color-scheme" which is a
	string defining colors like "foreground:black\nbackground:grey".
	Automatically provide a name->BdkColor hash table mapping for the
	color scheme.

	* btk/btkrc.[ch]: added list of color hashes that works like the
	list of icon factories. Append the color scheme hash from
	BtkSettings if it exists. Extended btkrc syntax to allow defining
	and referencing of logical colors. Also allow to modulate colors
	in btkrc by using arbitrary expressions of mix(), shade(),
	lighter() and darker(). Added internal function
	_btk_rc_style_get_color_hashes().

	* btk/btkstyle.[ch]: keep a private list of color hashes around.
	Get the list from _btk_rc_style_get_color_hashes(). Export
	internal function _btk_style_shade() (used by above color
	expressions). Added public API btk_style_lookup_color() which
	looks up a logical color by name.

	* btk/btk.symbols: add btk_style_lookup_color

	* tests/testbtkrc: use symbolic colors for making
	the scrollbars red.

2005-11-22  Michael Natterer  <mitch@imendio.com>

	Made button-press timeouts which work like key repeat timeouts
	configurable. Addresses bug #142582:

	* btk/btksettings.c: added properties "btk-timeout-initial" and
	"btk-timeout-repeat" which defalt to 200/20 (ms).

	Use the values from BtkSettings instead of hardcoding them
	(the repeat value is either taken as-is for fast repeat or
	multiplied by 5 for slow repeat). Changed all places to use these
	two standard initial/repeat timings:

	* btk/btkcalendar.c (unchanged 200/20)
	* btk/btknotebook.c (unchanged 200/100)
	* btk/btkpathbar.c (changed from 300/150 to 200/100)
	* btk/btkrange.c (changed from 250/100 to 200/100)
	* btk/btkspinbutton.c (unchanged 200/20)

2005-11-21  Anders Carlsson  <andersca@imendio.com>

        * configure.in:
        * btk/Makefile.am:
        * bdk/Makefile.am:
	* bdk/quartz/*:
	Add quartz backend.
	
        * docs/tools/Makefile.am:
	Only build docshooter when the X11 backend is used.
	
        * btk/btkplug-stub.c:
	Include btkplug.h here.
	
        * btk/btksocket-stub.c:
	Include btksocket.h here.
	
2005-11-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkinputdialog.c: Convert BtkInputDialog to 
	g_type_class_add_private.

	* btk/btksocket.c: Convert BtkSocket to g_type_class_add_private.

	* btk/btkmenu.c: Convert BtkMenu to g_type_class_add_private.

	* btk/btk.symbols:
	* btk/btkcombobox.[hc]: Add a tearoff-title property,
	with getter and setter.  (#316482, Olexiy Avramchenko)

	* tests/testcombo.c (main): Test btk_combo_box_set_title

	* btk/btkpathbar.c: Merge remaining fixes from the 2.8 branch,
	pointed out by Michael Natterer.

	Fix for bug #321542, Benedikt Meurer:
	
	* btk/btkcombobox.c (btk_combo_box_set_active_internal):
	Emit notify::active.
	
	(btk_combo_box_child_show, btk_combo_box_child_hide): Use
	g_signal_emit, not g_signal_emit_by_name.

2005-11-18  Matthias Clasen  <mclasen@redhat.com>

	Fix crashes in connection with pathbar scrolling (#321560,
	Bogdan Nicula)
	
	* btk/btkpathbar.c (btk_path_bar_update_slider_buttons): 
	Stop scrolling when desensitising slider buttons.
	(btk_path_bar_scroll_timeout, btk_path_bar_slider_button_press): 
	And use it here.  

	* btk/btkpathbar.h (struct _BtkPathBar): Add a separate
	scrolling_down flag.

2005-11-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpathbar.c (button_clicked_cb): Fix a C99ism.
	(#321777, Jens Granseuer)

	* btk/btkaction.c (disconnect_proxy): Disconnect the
	sync callback for the visibility property.  (#321761,
	Philip Langdale)

	Turn off input methods in invisible entries, since
	they are confusing.  (#317002, James Su)
	
	* btk/btkentry.c (btk_entry_set_visibility): Toggle input
	methods if visibility changes.
	(popup_targets_received): Don't show the input method
	menu if the entry is invisible.  

2005-11-17  Matthias Clasen  <mclasen@redhat.com>

	* README.in: Add a note about range arrow sensitivity.

	* perf/treeview.c: const correctness fixes
	found by Arjan van de Ven and gcc.

2005-11-16  Michael Natterer  <mitch@imendio.com>

	* btk/btkimage.c (animation_timeout): call
	btk_window_process_updates() so the animation keeps running even
	if the main loop is busy with sources that eat a lot of cpu with
	high priority. Fixes bug #321444.

	(btk_image_new_from_animation): document the fact that the
	animation will stop running if the main loop is busy with sources
	that have priorities higher than G_PRIORITY_DEFAULT.

	* tests/testimage.c: added test case that shows an animation even
	though a cpu-eating idle function is running.

2005-11-16  Michael Natterer  <mitch@imendio.com>

	* bdk/x11/bdkevents-x11.c (_bdk_events_uninit): new internal
	function which destroys the display's event source. Also removes
	the source from the global display_sources list and unrefs it.

	* bdk/x11/bdkprivate-x11.h: declare the function.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_x11_dispose): call it
	instead of half-destroying the source here.

2005-11-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreestore.c (btk_tree_store_move): Fix a memory
	leak.  (#321032, Peter Zelezny)

2005-11-15  Michael Natterer  <mitch@imendio.com>

	* bdk/x11/bdkdisplay-x11.c (bdk_display_x11_finalize): destroy
	display->xid_ht as late as possible (right before XCloseDisplay)
	because it still needs to be around when the display's screens are
	finalized. (#85715)

2005-11-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkselection.c (btk_selection_data_set_uris): Don't
	leak result.  (#321441, Tommi Komulainen)

2005-11-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c (btk_icon_theme_get_icon_sizes):
	Don't crash if there is no builtin icon.

2005-11-14  Michael Natterer  <mitch@imendio.com>

	* btk/btkcellrenderertoggle.c (btk_cell_renderer_toggle_set_property):
	removed redundant calls to g_object_notify().

2005-11-13  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkcolor.c (bdk_color_parse): Documentation 
	improvements.  (#321338)

	* btk/btktextiter.c (btk_text_iter_forward_search): Make
	limit an inclusive boundary.  (#321299)

2005-11-12  Michael Natterer  <mitch@imendio.com>

	* btk/Makefile.am: fixed icon rules so btkbuiltincache.h is only
	rebuilt if needed.

2005-11-12  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/msw_style.c: Bug #313627. Make win32 
	theme's handling of toolbars, handleboxes, and menubars more in-line
	with Microsoft's IE style.
	* modules/engines/ms-windows/*.c: Indentation cleanups
	
2005-11-12  Matthias Clasen  <mclasen@redhat.com>

	Make builtin icons work in btk_window_set_icon_name() 
	(#321046, Maxim Udushlivy)

	* btk/btkicontheme.c (insert_theme): Always insert the default
	theme.
	(ensure_valid_themes): Call _btk_icon_theme_ensure_builtin_cache()
	from here.
	(theme_lookup_icon, find_builtin_icon): ...and not from here.
	(btk_icon_theme_lookup_icon): Remove an unncessary assert.
	(btk_icon_theme_get_icon_sizes): Also check builtin icons.

2005-11-12  Tor Lillqvist  <tml@novell.com>

	* btk/btkfilesystemwin32.c (filename_get_info): Don't hide
	dotfiles, no such convention on Win32. Just hide files with the
	hidden attribute. (#314627)

2005-11-11  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_insert_path): Do not
	check whether the path is a folder.  It is useful to bookmark
	files as well (e.g. todo.txt), and this will also help
	performance.
	(shortcuts_add_bookmark_from_path): Likewise.
	(shortcuts_activate_iter): Change folders or select files, as
	appropriate.

2005-11-11  Federico Mena Quintero  <federico@ximian.com>

	* tests/autotestfilechooser.c (main): Use
	g_log_set_default_handler() instead of explicitly setting a
	handler for each domain.

	* btk/btkfilechooserdefault.c (shortcuts_add_volumes): Only get
	the base path of the volume if it is mounted.

2005-11-11  Michael Natterer  <mitch@imendio.com>

	Added per-stepper API for BtkRange's stepper sensitivity as
	discussed in bug #321056:

	* btk/btkenums.h: added BtkSensitivityType which can be
	{ AUTO, ON, OFF }.

	* btk/btkrange.[ch]: added properties "lower-stepper-sensitivity"
	and "upper-stepper-sensitivity" and public getters/setters for
	them. Changed stepper drawing to honor the new properties.

	* btk/btk.symbols: added the new symbols.

2005-11-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c: Add show-popup and hide-popup signals and
	emit them when the popup is shown or hidden.  (#162531, Tommi
	Komulainen)

	* tests/testcombo.c: Add an example of popuplating a combobox
	on click.

	* btk/btktreeview.c (btk_tree_view_motion_resize_column): Another
	erroneous semicolon.

	* bdk/x11/bdkcolor-x11.c (bdkx_colormap_get): Remove an erroneous
	semicolon. 

	Don't corrupt odd keymaps (#316638, Kean Johnston)
	
	* bdk/x11/bdkkeys-x11.c (set_symbol): Auxiliary function to
	handle frobbing keymaps with odd numbers of syms/code.
	
	* bdk/x11/bdkkeys-x11.c (update_keymaps): Use set_symbol() to 
	frob the keymap.

	Improve navigation to parent folders.  (#318444, Andrei Yurkevich)
	
	* btk/btkpathbar.[hc]: Add a child_path argument to
	the path_clicked signal.
	* btk/btkfilechooserdefault.c (path_bar_clicked): Select the
	child_path, if it is provided.
	* btk/marshalers.list (path_bar_clicked): Add the necessary
	glue.

	* btk/btkmenu.c: Fix some compiler warnings. (#321141,
	Kjartan Maraas)
	
	* btk/btk.symbols: 
	* btk/btktreeview.h: 
	* btk/btktreeview.c: Implement a getter for headers-clickable.
	(#163851, Richard Hult)

2005-11-10  Michael Natterer  <mitch@imendio.com>

	Applied patch from maemo-btk that addresses many issues wrt
	display migration and display closing (bug #85715).

	* bdk/bdkdisplay.c (bdk_display_dispose): don't just set the
	default display to NULL when it's closed. Instead set the most
	recently opened display as new default (if one exists).

	* bdk/bdkbango.c (on_renderer_display_closed): fixed signature
	of this callback.

	* bdk/bdkscreen.c (bdk_screen_dispose): check if the GCs still
	exist before unrefing them.

	* bdk/bdkwindow.c (_bdk_window_destroy_hierarchy): if the screen
	is closed, allow destruction of the root window.

	* bdk/x11/bdkdisplay-x11.c: moved some stuff from finalize() to
	dispose(), free stuff that was leaked before.

	* bdk/x11/bdkevents-x11.c (_bdk_x11_events_uninit_screen): check if
	the xsettings_client still exists before destroying it.

	* bdk/x11/bdkkeys-x11.c: added finalization and free the allocated
	X resources.

	* bdk/x11/bdkpixmap-x11.c: moved stuff from finalize() to new
	dispose() implementation.

	* bdk/x11/bdkscreen-x11.c: moved stuff from finalize() to
	dispose() and check if it still exists before unrefing it. Set
	their pointers to NULL/None *after* upchaining in dispose(),
	because X11 implementations of members of the parent class still
	need them for their own destruction.

	* bdk/x11/bdkvisual-x11.c: removed finalize() implementation which
	was g_error()ing when finalizing a visual.

	* btk/btkclipboard.c (btk_clipboard_finalize): don't use
	get_clipboard_widget() because it would create the widget if it
	doesn't exist. Use g_object_get_data() directly instead.

	* btk/btktextdisplay.c (on_renderer_display_closed): fixed signature
	of this callback.

2005-11-10  Simos Xenitellis  <simos@bunny.org>

	* configure.in: Added Tatar (tt) to ALL_LINGUAS.

Wed Nov  9 16:29:42 2005  Tim Janik  <timj@imendio.com>

	* btk/btkrange.c: patch from maemo-btk that changes BtkRange
	to render its arrows insensitive when the adjustment is in
	its min or max position. this makes range arrow behaviour 
	consistent with spin button behaviour. (#321056)

2005-11-09  Tor Lillqvist  <tml@novell.com>

	* bdk/bdkinternals.h
	* bdk/bdk.c (bdk_debug_keys[]): Add new BDK_DEBUG_DRAW flag to
	the BdkDebugFlag enum.

	* bdk/win32/bdkdrawable-win32.c: Use DRAW to trigger BDK_NOTEs in
	this file instead of MISC. Now asking for MISC will give mainly
	window manipulation debugging output with the Win32 backend.

2005-11-09  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkwindow-win32.c: Remove unnecessary includes.

	(_bdk_win32_get_adjusted_client_rect): Remove this two-line
	function which was used only in one place.

	(get_outer_rect): Use _bdk_win32_adjust_client_rect().

	(bdk_window_set_geometry_hints): If we have identical minimum and
	maximum size hints, remove the resize and maximize
	decorations/functions. (#104514)

	If we have a maximum size hint, remove the maximize
	decoration/function but ensure the resize decoration/function is
	available. Otherwise ensure both resize and maximize
	decorations/functions are there.

	(set_or_clear_style_bits): Factored out common code from
	bdk_window_set_decorations() and bdk_window_set_functions(). 

	Hack the window style setting once more: Only touch the window
	style bits corresponding to the BdkWMDecoration or BdkWMFunction
	parameter bitmasks. Hopefully this finally is the correct thing to
	do. We used to clear all other bits than those that were being
	set, or set all other bits than those that were being cleared.

	Take into account that adding or removing decorations leaves the
	window's outer size unchanged, i.e., the client area's size and
	position change. This is apparently not what we want, so change
	also the window's (outer) position and size appropriately so that
	the client area's position and size stay constant.

	btk-demo's color selector dialog is now non-resizable like on X11
	(I tested with metacity in BUNNY). Torn off menus are shrinkable
	vertically but have a maximum size, and are not maximizable or
	minimizable, like on X11.

	(bdk_window_set_decorations, bdk_window_set_functions): Let
	set_or_clear_decorations() do most of the job.

	* bdk/win32/bdkprivate-win32.h: Remove declaration of
	_bdk_win32_get_adjusted_client_rect().

2005-11-09  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkwindow-win32.h (struct _BdkWindowImplWin32)
	* bdk/win32/bdkwindow-win32.c (bdk_window_impl_win32_init,
	bdk_window_get_type_hint, bdk_window_get_type_hint): Store the
	type hint. Implement bdk_window_get_type_hint() by just returning
	the hint stored.

2005-11-09  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_geometry_hints):
	Remove code that has been permanently ifdeffed out for two years.

2005-11-08  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkgc.c (bdk_gc_finalize): Unref tile and stipple when
	finalizing a gc.  (#320789, Nickolay V. Shmyrev)

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_icon_list): Ignore
	icons if they would make the request large enough to cause
	Xlib to loose the connection.  (#320909, Claudio Saavedra)

2005-11-08  Michael Natterer  <mitch@imendio.com>

	* bdk/bdk.symbols
	* bdk/bdkwindow.h
	* bdk/x11/bdkwindow-x11.c: added bdk_window_get_type_hint() (patch
	extracted from maemo-btk). Fixes bug #320872.

2005-11-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (shortcuts_reorder): Don't
	looks the bookmark label when reordering.  (#320720, Jeremy Cook)

	* btk/btkpathbar.[hc]: Set focus-on-click to FALSE for all buttons.
	Don't grab focus when a slider button is pressed, instead, use
	a bit in the pathbar struct to determine whether to scroll up
	or down.  (#314486, Carlos Garnacho)

	* btk/btkentrycompletion.c (_btk_entry_completion_popup): 
	Don't popup the completions if the focus has already been
	moved somewhere else.  (#319914, Christian Persch)

	* btk/btktoolitem.c (_btk_tool_item_toolbar_reconfigured): 
	Raise the drag_window after reconfiguring the 
	toolbar.  (#320803, Christian Persch)

	* btk/btk.symbols: 
	* btk/btkfilechooserbutton.h: 
	* btk/btkfilechooserbutton.c: Add a focus-on-click property
	with setter and getter.  (#318945, Christian Persch)
	
Mon Nov  7 16:15:16 2005  Tim Janik  <timj@imendio.com>

	* configure.in: fixed missing $X_CFLAGS setup in case x11.pc is present.

2005-11-07  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Adjust to the stock icon changes.
	
2005-11-07  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkcursor-win32.c (pixbuf_to_hbitmaps_normal):
	Correct the calculation of maskstride. (#320152, Peter Zelezny)
	
2005-11-06  Michael Natterer  <mitch@imendio.com>

	* btk/Makefile.am (icons): fixed rule to actually create the
	symlinks, erroring out if anything goes wrong.

2005-11-06  Tor Lillqvist  <tml@novell.com>

	* btk/updateiconcache.c (build_cache): Can't rename a file if the
	target exists on Win32. First rename the target temporarily, then
	if the renaming of the source to target fails, restore the
	original name for the target.

	* btk/Makefile.am: Use EXEEXT in the dependency on btk-update-icon-cache.

2005-11-06  Tor Lillqvist  <tml@novell.com>

	(pixbuf_to_hbitmaps_alpha_winxp): Use an 1-bit mask bitmap,
	like pixbuf_to_hbitmaps_normal().
	(_bdk_win32_pixbuf_to_hicon_supports_alpha): Check
	G_WIN32_IS_NT_BASED() first, so we can pretend being on Win9x by
	setting the G_WIN32_PRETEND_WIN9X environment variable.
	
2005-11-06  Tor Lillqvist  <tml@novell.com>

	Make icon masks work on Win98 (#320152, Peter Zelezny)

	* bdk/win32/bdkcursor-win32.c (create_color_bitmap): Take also a
	parameter for the depth of the bitmap, so that this function can
	be used to create 1-bit bitmaps, too.
	(pixbuf_to_hbitmaps_normal): Create an 1-bit bitmap for the mask,
	and initialize it properly.

2005-11-04  Matthias Clasen  <mclasen@redhat.com>

	Store builtin stock icons in an icon cache, instead of
	populating a hash table with pixbufs at startup, to save both
	memory and startup time.

	* btk/stock-icons/*: Reorganize the icons in a directory structure
	suitable for btk-update-icon-cache, and rename them to match the
	stock ids.

	* btk/btkiconcache.[hc]: Support non-mmapped icon caches, and
	add _btk_icon_cache_has_icon_in_directory().

	* btk/updateiconcache.c: Support a --source <VARIABLE> argument
	to store the contents of the icon cache in a C header.

	* btk/btkbuiltincache.h: Generated private header which contains 
	the icon cache for the builtin icons.

	* btk/btkicontheme.c: Create a BtkIconCache for the builtin
	icons, and use that in addition to the hash table whenever
	builtin icons are searched.

	* btk/btkiconfactory.c: Add BTK_ICON_SOURCE_STATIC_ICON_NAME and
	use it for static stock ids. 
	(get_default_icons): Don't add the builtin
	icons to the icon theme, just register the stock ids.
	(render_fallback_image): Take the fallback image out of the
	builtin icon cache.
	
	* btk/Makefile.am: Remove stock-icons from SUBDIRS and add 
	the necessary machinery to rebuild btkbuiltincache.h.

2005-11-04  Michael Natterer  <mitch@imendio.com>

	* btk/btkrc.c (btk_rc_reparse_all_for_settings): applied patch
	from maemo-btk that changes the mtime check for rc files from
	'>' to '!=', otherwise theme changes go unnoticed when turning
	back the clock (Tommi Komulainen).

2005-11-04  Tor Lillqvist  <tml@novell.com>

	* btk/btkstatusicon.c (btk_status_icon_set_tooltip): Plug memory
	leak on Win32.

2005-11-03  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkcursor-win32.c: As there is only one BdkDisplay in
	the Win32 backend, check that BdkDisplay* parameters are equal to
	_bdk_display instead of using the unnecessarily general
	BDK_IS_DISPLAY().

	(pixbuf_to_hbitmaps_alpha_winxp): Rename the variables for the
	color bitmap to have "color" in their name, for similarity with
	pixbuf_to_hbitmaps_normal(). Create a color bitmap for the mask,
	too, instead of creating a b&w bitmap with CreateBitmap(). Set up
	the mask bitmap's contents, ones for those pixels in the color
	bitmap where the alpha is zero, zero for other pixels. We used to
	use an uninitialized mask bitmap! This meant that icons and
	cursors created presumably worked more or less by accident.
	Totally blank icons with zero alpha everywhere (as used by
	btktrayicon.c) definitely did not work as expected.

	* btk/Makefile.am: Include btkstatusicon.c on all platforms.

	* btk/btkstatusicon.c: Implement for Win32. Use code from
	btktrayicon-win32.c as applicable. (btktrayicon-win32.c is not
	necessary and can be removed from CVS. It has never been mentioned
	in btk/Makefile.am.) No tray icon widget, BtkImage or BtkTooltips
	are used on Win32. One label widget is used (but never shown) as
	btk_widget_render_icon() needs a widget.

	Ifdefs used as necessary in several places. It might be cleaner to
	split out the backend-specific parts to separate files, or at
	least collect them into separate blocks in the file.

	(wndproc): New function. Window procedure to monitor mouse events
	in the system tray icon. Call btk_status_icon_button_press() as
	needed.
	(create_tray_observer): New function. Creates a hidden window that
	only serves as a tray icon message observer.

	* tests/teststatusicon.c (icon_activated): Position the dialog
	with BTK_WIN_POS_CENTER.
	(do_quit): New function, hide and unref the BtkStatusIcon, and
	call btk_main_quit().
	(popup_menu): Add a Quit menu item that calls do_quit().
	
2005-11-02  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkcolor-win32.c
	* bdk/win32/bdkscreen-win32.c
	* bdk/win32/bdkwindow-win32.c: Whitespace consistency
	fixes. Remove superfluous test for BdkWindow* parameters being
	non-NULL. Testing BDK_IS_WINDOW() is enough. As there is only one
	BdkScreen and one BdkDisplay in the Win32 backend, use those
	variables instead of the getter functions. For BdkDisplay* and
	BdkScreen* parameters, check that they are equal to the
	corresponding singleton variables instead of the more general
	BDK_IS_DISPLAY() or BDK_IS_SCREEN().

2005-11-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c: Remove some g_return_if_fail() from
	static functions, replace some others by g_assert().
	
	* btk/btktextview.c (selection_motion_event_handler) 
	(btk_text_view_start_selection_drag): Keep track of the original
	selection boundaries during a drag selection, in order to correctly
	decide when to extend or shrink the selection.  (#320167,
	reported by Arvind S N, patch by Paolo Borelli)

	* btk/btktextbtree.c (_btk_text_line_char_to_byte_offsets): 
	* btk/btktextiter.c (btk_text_iter_backward_chars): Replace
	manual offset calculations by g_utf8_offset_to_pointer().
	(#320360, Paolo Borelli)

Tue Nov  1 16:18:24 2005  Tim Janik  <timj@imendio.com>

	* btk/btkrbtree.[hc]: get rid of GAllocator usage, allocate and free 
	nodes via the g_slice_*() API.
	_btk_rbtree_new(): fixed wrong node allocation via g_new().

2005-11-01  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkprivate-win32.h
	* bdk/win32/bdkglobals-win32.c
	* bdk/win32/bdkmain-win32.c (_bdk_windowing_init): Add more
	pre-interned BdkAtoms and pre-registered clipboard formats. Sort
	their declarations, definitions and assignments into a more
	logical and consistent order.

	* bdk/win32/bdkmain-win32.c (_bdk_win32_cf_to_string): Include the
	CF_ prefix for the predefined clipboard format names. Put quotes
	around registered format names to distinguish them.
	
	* bdk/win32/bdkproperty-win32.c (bdk_property_change): Return
	immediately with a warning if the property type is STRING, TEXT,
	COMPOUND_TEXT or SAVE_TARGETS, as these are X11-specific that we
	should never pretend to handle on Win32. Handle only UTF8_STRING
	here, other formats with delayed rendering. Use \uc1 instead of
	\uc0 when generating Rich Text Format for easier testability on
	XP, where WordPad misinterprets \uc0 encoded characters. Add more
	BDK_NOTE debugging output for Clipboard operations.

	* bdk/win32/bdkselection-win32.c: Debugging printout improvements.
	(bdk_selection_convert): Don't pretent to handle STRING, just
	UTF8_STRING. Streamline error handling, don't unnecessarily have a
	GError which then isn't used for anything anyway if it gets set.
	(bdk_win32_selection_add_targets): Skip also STRING, TEXT,
	COMPOUND_TEXT and SAVE_TARGETS in addition to UTF8_STRING.

	* config.h.win32.in: Sync with what configure produces.

	* configure.in: Don't look for X_PACKAGES unless building for
	x11. (#313986, John Ehresman)

2005-10-28  Erdal Ronahi  <erdal.ronahi@gmail.com>

	* configure.in: Added ku (Kurdish) to ALL_LINGUAS
			Wondered why there was no ku there before??

2005-10-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c (_btk_entry_completion_popup): Add the popup
	window to the toplevels window group.  (#319912, Christian Persch)

2005-10-28  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_row_deleted): fix
	stupid thinko.

2005-10-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkdnd.c (btk_drag_get_cursor): Fix the anchor of the default
	drag cursors.  (#319200, Federico Mena Quintero)

	* btk/btktreeview.c (btk_tree_view_search_key_press_event): Handle
	Shift-G to go to the previous match, like firefox.  (#320061, Christian 
	Neumair)

	* btk/btktreemodelfilter.c (btk_tree_model_filter_build_level): Fix a
	C99ism.  (#320000, Kazuki Iwamoto)

	* btk/btkaboutdialog.c (btk_about_dialog_init): Add the little 
	stars.  (#319985, Bastien Nocera)

	* btk/btktreeview.c (btk_tree_view_search_entry_flush_timeout): Return
	FALSE, so we don't flush repeatedly.  (#319151, Alexander Larsson)

2005-10-26  Michael Natterer  <mitch@imendio.com>

	Fix bug #319974:

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_set_property):
	make sure that setting any of pixbuf/stock-id/icon-name resets the
	others because they are mutually exclusive, and that unsetting any
	of them only resets the pixbuf and nothing else. Also added
	some missing g_object_notify().

	(btk_cell_renderer_pixbuf_get_property): simplified calls to
	g_value_set_object().

	(btk_cell_renderer_pixbuf_create_stock_pixbuf)
	(btk_cell_renderer_pixbuf_create_named_icon_pixbuf): added
	g_object_notify ("pixbuf").

2005-10-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_button_press): Be more 
	careful about initializing cell_area.  (#319382, Tommi
	Komulainen)

	* btk/btkcombobox.c (btk_combo_box_key_press): Don't eat
	Ctrl-PageUp/PageDown.  (#318670, Christian Neumair)

	* demos/btk-demo/clipboard.c (paste_received): Only set the
	text if it is not NULL.  (#319930, Thomas Klausner)

	* btk/btkselection.c (btk_selection_data_get_pixbuf): Close the
	loader before trying to get the pixbuf.  (#319930, Thomas Klausner)

2005-10-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystem.c (btk_file_system_module_load): 
	* btk/btkthemes.c (btk_theme_engine_load): 
	* btk/btkimmodule.c (btk_im_module_load): Use G_MODULE_BIND_LAZY
	when dlopening modules.  (#319557, Laszlo Peter)

2005-10-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextbtree.c (btk_text_btree_resolve_bidi): Only use text
	segments when determining text direction.  (#319065, Tommi Komulainen)

	* btk/btktreeview.c (btk_tree_view_destroy): Don't crash
	on duplicate destroy.  (#318953, Gustavo Carneiro)

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_new_with_dialog): 
	Point out that destroy-with-parent is a bad idea for the dialog
	passed to this function.  (#318943, Christian Persch)

	* */Makefile.am: use $(BUNNYLIB_MKENUMS) instead of 
	bunnylib-mkenums.  (#318582, Damien Carbery)

	* btk/btktreemodel.c (btk_tree_model_rows_reordered): Clarify
	docs.  (#317682, Christian Neumair)

	* bdk/x11/bdkdnd-x11.c: Remove an extra const which doesn't
	seem to affect the placement of the data in the readonly 
	section, and causes problems with some compilers.  (#317844)

2005-10-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_process_action):
	Fix some issues with background drawing in RTL.  (#318781,
	Eric Cazeaux)

	* tests/Makefile.am:
	* tests/testentrycompletion.c: Apply a patch by Christian
	Persch to add property editors.

	* btk/btkstatusicon.c: Emit activate on single-click,
	not on double-click, change proposed by Milosz Derezynski.

2005-10-25  Kristian Rietveld  <kris@btk.org>

	Fixes #311955, reported by Markku Vire; and a lot more.

	* btk/btktreemodelfilter.c: Made this thing work correctly.
	Levels can now have invisible nodes cached, functions have been
	rewritten/refactored to take this into account; also the logic in
	some functions has been corrected.
	
	Each referenced node now references all visible children or a single
	invisible child, in order to be able to monitor all changes in the
	child model required for correct operation.

	When a virtual root is set, all nodes on the virtual root level are
	referenced.

	At last, a bunch of random bug fixes and comment updates.

2005-10-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktexttagtable.c (btk_text_tag_table_foreach): Add some
	more docs.  (#319722, Paolo Borelli)

	* bdk/x11/bdkxftdefaults.c (init_xft_settings): Make the 
	initialization of screen_x11->xft_rgba more explicit.  (#319627,
	Bogdan Nicula)

	* btk/btkfilechooser.c (btk_file_chooser_class_init): Fix whitespace
	in a blurb.  (#319499, Francisco Javier F. Serrador)

2005-10-24  Matthias Clasen  <mclasen@redhat.com>

	Add settings to hide the input method and Unicode control character
	submenus in the context menus of BtkEntry and BtkTextView.  
	
	* bdk/x11/bdkevents-x11.c: Map BTK+ settings to X settings.
	
	* btk/btksettings.c (btk_settings_class_init): Declare BTK+ settings here.

	* btk/btktextview.c (popup_targets_received): 
	* btk/btkentry.c (popup_targets_received): Use the settings here.

2005-10-24  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelsort.c (btk_tree_model_sort_row_inserted): emitting
	row-has-child-toggled when the level is not in the cache does not
	make sense.  (This bug probably crept in during the early stages
	of BtkTreeModelSort when there wasn't a correct row-has-child-toggled
	implementation yet),
	(btk_tree_model_sort_real_unref_node): only get the child iter
	when we will actually also use it.

2005-10-22  Michael Natterer  <mitch@imendio.com>

	* btk/btktreeview.c (btk_tree_view_scroll_to_cell): check for the
	widget being realized, in addition to being visible, to avoid
	running into precondition check in btk_tree_view_get_cell_area().
	(approved by Kris).

2005-10-22  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/msw_style.c (setup_msw_rc_style): 
	Experimentally, scrollbar steppers can shrink to 8 pixels on 
	Win32. Reflect that in the theme.
	* modules/engines/ms-windows/Theme/btk-2.0/btkrc: Experimentally,
	there is a 1-pixel border between a scrollbar and its child
	in ScrolledWindows on Win32. Reflect that in the theme.
	
2005-10-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c (btk_label_create_window): Use BDK_WINDOW_CHILD
	for the selection window.  (#318806, Alex Larsson)

2005-10-18  Federico Mena Quintero  <federico@ximian.com>

	Fixes bug #317999:

	* tests/autotestfilechooser.c
	(test_button_folder_states_for_action): Test that we have either
	$cwd or the explicitly-set folder.
	(test_reload_sequence): Likewise.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_get_current_folder): If our reload_state
	is RELOAD_EMPTY, return a BtkFilePath corresponding to $cwd.

2005-10-14  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkdisplay-win32.c: Remove the clipboard viewer code.
	It didn't really do anything useful, and was just confusing and
	incomplete. Comments claimed we don't do delayed rendering, but in
	fact we do, for images. (The delayed rendering code has other
	problems, though, see #168173.) The clipboard viewer code was
	probably even buggy (the WM_CHANGECBCHAIN handled didn't propagate
	the message when necessary). It was just test code, it said so in
	a comment. Add something similar back later if necessary.

	(_win32_on_clipboard_change,
	_bdk_win32_register_clipboard_notification): Remove.

	(bdk_display_supports_selection_notification,
	bdk_display_request_selection_notification): Always just return
	FALSE. We didn't generate any BDK_OWNER_CHANGE events anywhere.

2005-10-13  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): Don't treat
	Alt-Enter specially. It does not have any special meaning and
	should be passed on to the application. (#318378, Tim Evans)

2005-10-13  Tor Lillqvist  <tml@novell.com>

	Set visual depth to 24 for 32 bits-per-pixel devices on
	Win32. This allows bdk_drawable_real_draw_pixbuf() to use the
	optimized composite_0888() function rather than the slower image
	dithering functions to draw pixbufs (#313993, John Ehresman)

	* bdk/win32/bdkimage-win32.c (_bdk_win32_new_image): Use
	_bdk_windowing_get_bits_for_depth() to initialize
	BdkImage::bits_per_pixel.
	(_bdk_windowing_get_bits_for_depth): Return 32 bits for depth 24.

	* bdk/win32/bdkpixmap-win32.c (bdk_pixmap_new): Use
	_bdk_windowing_get_bits_for_depth() to initialize
	BITMAPINFOHEADER::biBitCount.

	* bdk/win32/bdkvisual-win32.c (_bdk_visual_init): Set
	BdkVisual::depth to 24 even if GetDeviceCaps(BITSPIXEL) returns
	32.

2005-10-12  Stefan Kost  <ensonic@users.sf.net>

	* demos/btk-demo/appwindow.c: (about_cb):
	  use PACKAGE_VERSION,bump year (#318654)

2005-10-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextbtree.c (_btk_text_btree_delete): Try to match an off 
	toggle here with the matching on toggle if it immediately follows. 
	This is a common case, and handling it here prevents quadratic blowup 
	in cleanup_line() below.  (#317125)

	* btk/btktextsegment.h: 
	* btk/btktextsegment.c (_btk_char_segment_new_from_two_strings): Pass
	the character counts into this function instead of computing them
	again.

2005-10-10  Tommi Komulainen  <tommi.komulainen@iki.fi>

	* btk/btkfilechooser.h (BtkFileChooserError): Add ALREADY_EXISTS error
	code.
	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_add_shortcut_folder): Return an error code
	when the shortcut already exists in the sidebar.  (#147521)

2005-10-09  Matthias Clasen  <mclasen@redhat.com>

	* tests/testcombo.c: Demonstrate how to use custom widgets in
	a BtkComboBox.  

2005-10-07  Federico Mena Quintero  <federico@ximian.com>

	Fixes bug #317999:

	* tests/autotestfilechooser.c (test_reload_sequence): Ensure that
	the the result of btk_file_chooser_get_folder() is NULL or
	non-NULL at the right times.  Log the tests.
	(test_button_folder_states): New test for the initial states of
	the current folder in BtkFileChooserButton.
	(main): Test that the number of warnings/errors/critical errors is
	zero.

	* btk/btkfilechooser.c (btk_file_chooser_get_current_folder):
	Clarify the documentation on when this can return NULL.
	(btk_file_chooser_get_current_folder_uri): Likewise.

	* btk/btkfilechooserbutton.c (struct
	_BtkFileChooserButtonPrivate): Added a folder_has_been_set flag;
	we use it to keep track of whether a folder has been set.
	(btk_file_chooser_button_map):  Implement.  If no folder has been
	loaded before, we at least try to load $cwd here.
	(btk_file_chooser_button_constructor): If the construct-time
	dialog already has a folder set, turn on our folder_has_been_set
	flag.
	(dialog_current_folder_changed_cb): Turn on our
	folder_has_been_set flag.

2005-10-07  Michael Natterer  <mitch@gimp.org>

	* btk/btkfilechooserdefault.c: remove some explicit #defines of
	PROFILE_FILE_CHOOSER because they break compilation after the
	removal of <unistd.h>.

2005-10-07   Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c: Properly fix the unistd.h include
	by moving it out of the profiling ifdef.

	* btk/btkfilechooserdefault.c: Remove a redundant (and
	unconditional) include of unistd.h  (#318211, Kazuki Iwamoto)

	* btk/btktexttag.c (btk_text_attributes_ref): Use
	g_return_val_if_fail(), not g_return_if_fail().  (#318412,
	Kazuki Iwamoto)

2005-10-06  Matthias Clasen  <mclasen@redhat.com> 
		
	* btk/btk.symbols:
	* btk/btktextbuffer.h:
	* btk/btktextbuffer.c: Add a readonly has-selection property
	with a getter.  (#318161, Paolo Borelli)

2005-10-05  Matthias Clasen  <mclasen@redhat.com>

	* README.in: Start collecting release notes for 2.10.

	* btk/btkrc.c (btk_rc_clear_realized_style): Readd the memory
	leak fix, since the assertion failures were traced to 
	an xchat bug.  (#314696)
	
	* btk/btkstyle.c (btk_style_detach):
	(btk_style_attach):  Documentation improvements.
	(btk_style_detach): Assert that the attach_count is > 0.

2005-10-04  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (switch_to_shortcut): Take a
	shortcut position, not a ShortcutsIndex, to make the function more
	generic.
	(home_folder_handler): Pass the resolved index to
	switch_to_shortcut(), rather than just SHORTCUTS_HOME.
	(desktop_folder_handler): Likewise for SHORTCUTS_DESKTOP.
	(btk_file_chooser_default_class_init): Add a "quick-bookmark"
	binding signal, and bind it to Alt-1, Alt-2. ..., Alt-0.  These
	make the respective key switch to the first, second, ..., tenth
	bookmark.
	(quick_bookmark_handler): Implement.

2005-10-04  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkpathbar.c (get_dir_name): Don't special-case Home and
	Desktop; just use their real names on the file system for the
	user-visible names.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_class_init): Add a "desktop-folder"
	binding signal, and bind it to M-d by default.
	(desktop_folder_handler): Implement the default handler.
	(home_folder_handler): Use a helper function.
	(switch_to_shortcut): New helper function.
	(shortcuts_append_home): Don't special-case the name of "Home";
	just use the folder name.

2005-10-04  Tor Lillqvist  <tml@novell.com>

	* btk/btkcalendar.c (btk_calendar_init): Make it compile without
	HAVE__NL_TIME_FIRST_WEEKDAY. (#317910, Mathias Hasselmann)

2005-10-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrc.c (btk_rc_clear_realized_style): Revert the change
	from yesterday, since it leads to assertion failures.  (#317879,
	Sebastian Bacher)

2005-10-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcalendar.c (btk_calendar_init): Call 
	calendar_compute_days() after setting priv->week_start.

2005-10-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrc.c (btk_rc_clear_realized_style): Unref the style when
	removing it from the hash table.  (#314696, Benjamin Berg)

2005-10-01  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkdrawable-win32.c (blit_from_pixmap): In case
	BitBlt() fails with ERROR_INVALID_HANDLE, the most probable cause
	is that the the desktop isn't visible because the session has been
	switched, the screen is locked, or a terminal server session
	disconnected, so no error message necessary. (#137796)

	It is of course remotely possible that BitBlt() failing with
	ERROR_INVALID_HANDLE might also be caused by some other
	problem. We could strive for perfection and track whether the
	desktop is visible by using WTSRegisterSessionNotification() and
	handling WM_WTSESSION_CHANGE. I think that's overdoing it just for
	this issue, though. If we would track desktop visibility, we
	should then avoid even trying to update the display at all while
	the desktop isn't visible.

2005-09-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcalendar.c (btk_calendar_init): Another attempt
	to correct the calculations for the first week day. We may
	just have to remove this code if too many locales turn out 
	to have broken data. 

	* btk/btkimage.c (btk_image_expose): Don't leak pixbuf in
	some cases.  (#317611, Tommi Komulainen)

	* btk/btksocket-x11.c (_btk_socket_windowing_size_request):
	Prevent overflow when storing size hints in an unsigned
	short variable. Tracked down by Ray Strode and SÃ¸ren Sandmann.

2005-09-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbutton.c (btk_button_set_image): Check arguments.  (#317491,
	Paolo Borelli)

	* btk/btkpaned.c (btk_paned_grab_notify): Stop drags when being
	grab shadowed.  (#317332)

2005-09-29  Tor Lillqvist  <tml@novell.com>

	* btk-zip.sh.in: DLLs are always in bin nowadays, no need to test.

2005-09-28  Federico Mena Quintero  <federico@ximian.com>

	* tests/autotestfilechooser.c (test_reload_sequence): Oops, return
	if the unmap test fails.
	(test_reload_sequence): Use btk_widget_show_now() instead of
	btk_widget_show() for the dialog.
	Thanks to Tim Janik for noticing these.

2005-09-28  Federico Mena Quintero  <federico@ximian.com>

	* tests/testcellrenderertext.c: New file with a set of tests for
	BtkCellRendererText.  The idea is to run a text renderer through
	most of its interesting property values to see that it works
	correctly.

	* tests/Makefile.am: Added testcellrenderertext.

	* btk/btkfilechooserdefault.c (load_set_model): Mark the
	entry/exit of this function for profiling.
	(btk_file_chooser_default_style_set): Mark the start/end of the
	calls to the parent class and the the signal emission for profiling.

2005-09-29  Tor Lillqvist  <tml@novell.com>

	* btk/btkmain.c (_btk_get_localedir): The locale directory is
	passed to bindtextdomain() which isn't UTF-8-aware, so convert to
	system codepage using g_win32_locale_filename_from_utf8().
	(#317457, Kazuki Iwamoto)

2005-09-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkselection.c (_btk_selection_request): Free mult_atoms 
	here. (#317039, Paolo Borelli)

	* btk/btktexttag.h: 
	* btk/btktexttag.c (btk_text_attributes_ref): Return the attributes
	to make this function work as boxed copy function.  (#317455,
	Gustavo Carneiro)

	* btk/btkclipboard.c (request_image_received_func): Don't unref
	NULL.  (#316828, Tor Lillqvist)

2005-09-28  Tor Lillqvist  <tml@novell.com>

	* modules/input/imime.c: Include <config.h>. (#317444, Kazuki
	Iwamoto)

2005-09-27  Federico Mena Quintero  <federico@ximian.com>

	Don't reload the current folder unnecessarily on ::map().

	* btk/btkfilechooserprivate.h (ReloadState): New enum to represent
	the reloading state.
	(struct _BtkFileChooserDefault): Added a "reload_state" field.

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_init):
	Initialize impl->reload_state.
	(btk_file_chooser_default_map): Check the impl->reload_state; load
	a default folder if no folder has been set, or reload the current
	one only if we had been unmapped first.
	(btk_file_chooser_default_update_current_folder): Set the
	reload_state to RELOAD_HAS_FOLDER.
	(btk_file_chooser_default_unmap): Implement, and set the
	reload_state to RELOAD_WAS_UNMAPPED.
	(shortcuts_model_create): Don't call shortcuts_add_bookmarks()
	here; they'll get (re)loaded on ::map() anyway.

	* btk/btkfilechooserwidget.c
	(btk_file_chooser_widget_constructor): Don't set a default folder here.

	* tests/autotestfilechooser.c (test_action_widgets): Don't take in
	a dialog; build it ourselves.
	(test_reload): New test to ensure that we don't load the default
	folder more than once, and that we reload it when
	unmapping/remapping.
	(get_impl_from_dialog): New utility function.
	(test_widgets_for_current_action): Use get_impl_from_dialog().

2005-09-27  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_constructor): Mark the entry/exit of
	this function for profiling.
	(check_icon_theme): Likewise.
	(change_icon_theme): Likewise.
	(settings_notify_cb): Likewise.
	(btk_file_chooser_default_screen_changed): Likewise.
	(update_chooser_entry): If the selection is empty, clear the file
	name entry only if we are in CREATE_FOLDER mode.  In SAVE mode,
	nothing will be selected when the user starts typeahead in the
	treeview, and we don't want to clear the file name entry in that
	case --- the user could be typing-ahead to look for a folder name.
	Fixes bug #308332, patch by JÃ¼rg Billeter.

2005-09-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup):
	Pop below the entry if there's more free space below the entry
	than above.  (#316948, Tommi Komulainen)

2005-09-26  Federico Mena Quintero  <federico@ximian.com>

	Do not create the save mode-specific widgets in the open modes, so
	that we don't carry their baggage around.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_constructor): Don't create the
	save_widgets here.
	(save_widgets_create): Set the impl->save_widgets directly here,
	instead of passing the widgets back to the caller.  Also, pack
	them into the impl's box.
	(update_appearance): Create or destroy the save widgets as
	appropriate.  Set the action of the save_file_name_entry here.
	(shortcuts_add_current_folder): Set the active item in the
	save_folder_combo only if it exists.
	(btk_file_chooser_default_set_property): Don't set the action of
	the save_file_name_entry here.
	(btk_file_chooser_default_update_current_folder): Set the base
	folder of the save_file_name_entry only if the entry exists.
	(shortcuts_drag_data_received_cb): Cast the selection_data->data
	to (const char *) since that's what shortcuts_drop_uris() expects.
	(file_list_drag_data_received_cb): Likewise, for
	g_uri_list_extract_uris().

2005-09-26  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkwindow-win32.c (bdk_window_shape_combine_mask): Set
	the shaped flag here, too. (#316871)
	(bdk_window_shape_combine_rebunnyion): Currently unimplemented, so
	don't do anything to the shaped flag here.

2005-09-26  Matthias Clasen  <mclasen@redhat.com>

	Fix #316871, reported by Dan Winship:
	
	* bdk/bdkwindow.h (struct _BdkWindowObject): Add a shaped flag.

	* bdk/x11/bdkwindow-x11.c (bdk_window_shape_combine_mask) 
	(bdk_window_shape_combine_rebunnyion): Set it here.

	* bdk/bdkwindow.c (bdk_window_invalidate_maybe_recurse): Don't
	remove the child area for shaped windows.

2005-09-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_finalize):
	Don't leak expander pixbufs.  (#316946, Tommi Komulainen)

2005-09-22  Michael Natterer  <mitch@imendio.com>

	Renamed BtkCellRendererKeys to BtkCellRendererAccel to be
	consistent with BTK+ terminology:

	* btk/btkcellrendererkeys.[ch]
	* tests/testkeys.c: removed...

	* btk/btkcellrendereraccel.[ch]
	* tests/testaccel.c: ...and added.

	* btk/Makefile.am
	* btk/btk.h
	* btk/btk.symbols
	* tests/Makefile.am: changed accordingly.

2005-09-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwidget.c (btk_widget_class_init): Fix the documentation
	for the grab-broken-event signal, noticed by Damon Chaplin.

2005-09-21  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkselection-win32.c (bdk_selection_convert,
	bdk_text_property_to_text_list_for_display,
	bdk_text_property_to_utf8_list_for_display,
	bdk_win32_selection_add_targets,
	_bdk_win32_selection_convert_to_dib): Free return value from
	bdk_atom_name().
	(bdk_text_property_to_text_list_for_display): Drop GError variable
	that isn't actually used after being set.

2005-09-20  Johan Dahlin  <jdahlin@async.com.br>

	* btk/btkentry.c (btk_entry_set_completion): Mention NULL in 
	documentation.

2005-09-20  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkselection-win32.c
	(bdk_selection_owner_get_for_display): Do return the correct owner
	for CLIPBOARD (i.e., the owner of the Windows Clipboard, if it is
	a window BDK knows about). The reason to return NULL seems to have
	gone when in the fix for bug #163702 the artificial
	BDK_SELECTION_CLEAR event generation was removed from
	bdk_selection_send_notify_for_display(). Fixes bug #316552.

2005-09-20  Matthias Clasen  <mclasen@redhat.com>

	Avoid unnecessary XkbGetState() calls and XkbStateNotify
	events.  (#151555, SÃ¸ren Sandmann)

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Use 
	XkbSelectEventDetails() to select XkbStateNotify events
	for only the state we care about.

	* bdk/x11/bdkprivate-x11.h:
	* bdk/x11/bdkkeys-x11.c (_bdk_keymap_state_changed): Pass
	the event into the function and update the keymap state from
	the state information contained in the event. Adjust all callers.
	
2005-09-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c: Use g_list_nth_data() instead of g_list_nth()->data
	in multiple places to avoid segfaults if the index is out of range.  
	(#316422, Guillaume Cottenceau)
	(btk_icon_view_set_drag_dest_item): 
	(btk_icon_view_scroll_to_path): Fix a typo in the docs.  (#316419,
	#316424, Guillaume Cottenceau)

2005-09-18  Hans Breuer  <hans@breuer.org>

	* btk/btktrayicon-win32.c : now handling events by hard-coded 
	g_signal_emit_by_name() - will break when btkstatusicon.c changes.

2005-09-18  Hans Breuer  <hans@breuer.org>

	* bdk/bdk.symbols bdk/win32/bdkwin32.h bdk/win32/bdkcursorwin32.c : export
	_bdk_win32_pixbuf_to_hicon() as bdk_win32_pixbuf_to_hicon_libbtk_only()
	* btk/btktrayicon-win32.c : a lot of debug spew but it has started to show
	the icon and is blinking with teststatusicon. More to come ...

2005-09-18  Hans Breuer  <hans@breuer.org>

	* btk/makefile.msc.in : fix typo for BTK_VER; define HAVE_CONFIG_H
	cause btkprogressbar.c has #include <config.h> conditionally; less
	noise from generated btk.def
	* btk/stock-icons/makefile.msc bdk/makefile.msc tests/makefile.msc : updated
	
	* btk/btktrayicon-win32.c : dummy implmentation to make btk compile.
	For me it works as well as the *NIX implemenation, that is not at all.

	* bdk/win32/bdkproperty-win32.c : implement bdk_atom_intern_static_string()

	* bdk/win32/bdkwindow-win32.c(bdk_window_set_urgency_hint) : only use
	only use (WINVER >= 0x0500) when available from the SDK. Otherwise fall
	back to true dynamic linking of FlashWindowEx. Makes btk+ work on NT4.0
	again - if compiled properly.

	* tests/teststatusicon.c : don't use BUNNY icons for testing, but icons
	already coming with Btk+. Makes it compile on win32.

2005-09-18  Guilherme de S. Pastore  <gpastore@cvs.bunny.org>

	* README.cvs-commits: fixed some tiny typos

2005-09-16  Tor Lillqvist  <tml@novell.com>

	* modules/engines/ms-windows/msw_style.c (draw_extension,
	draw_box_gap): Check whether the widget actually is a BtkNotebook
	before treating it as such. Drop some unneeded local variables,
	use parameter with same information instead. (#316412)

2005-09-15  Federico Mena Quintero  <federico@ximian.com>

	* tests/autotestfilechooser.c: Start a set of automated tests for
	the file chooser.  The only test in there right now doesn't pass
	yet.  It specifies the intended behavior of the first optimization
	of a series which I'll do on the file chooser (see
	http://primates.ximian.com/~federico/news-2005-09.html#14 for the
	details of this optimization).

	* tests/Makefile.am: Added autotestfilechooser.c.

	* btk/btkfilechooserprivate.h (struct
	_BtkFileChooserDialogPrivate): Move all the file chooser's private
	structures to here, so that they can be accessed by
	tests/autotestfilechooser.c:  _BtkFileChooserDialogPrivate,
	_BtkFileChooserWidgetPrivate, LoadState, _BtkFileChooserDefault.

	* btk/btkfilechooserdialog.c: See above.

	* btk/btkfilechooserwidget.c: See above.

	* btk/btkfilechooserdefault.c: See above.

Thu Sep 15 15:27:55 2005  Tim Janik  <timj@imendio.com>

	* btk/btkwindow.c: 
	btk_window_map_event(): new function to work around lost unmap requests.
	fixes bug #316180.

2005-09-14  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_init): Add
	an easy-to-find profiling marker when starting to create a file
	chooser.
	(browse_files_model_finished_loading_cb): Likewise, for when the
	chooser is finished loading.

2005-09-14  Tristan Van Berkom <tvb@cvs.bunny.org>

	* btk/btkcolorbutton.c: Check "color" argument in 
	btk_color_button_set_color ()

2005-09-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c (btk_label_get_type): 
	* btk/btkbutton.c (btk_button_get_type): 
	* btk/btkwindow.c (btk_window_group_get_type): No point in 
	using a mem chunk for window groups, buttons, labels.

	* btk/updateiconcache.c (foreach_remove_func): Fix
	a use-after-free bug.  (#316256, Alexander Nedotsukov)

2005-09-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/*.c: Various cleanups.  (#315360, Kjartan Maraas)

	* bdk/*.c: Various cleanups.  (#315359, Kjartan Maraas)
	
2005-09-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkimcontextsimple.c (btk_im_context_simple_filter_keypress): 
	Let BDK_Return pass through in some more cases.

	* btk/btkentry.c (btk_entry_key_press): Reset the im context before
	activating the entry. 

	* btk/btkiconview.c (btk_icon_view_class_init):
	(btk_icon_view_get_dest_item_at_pos):  Fix typos in the 
	docs.  (#316008, #316027, #316121, Guillaume Cottenceau)

	* btk/btkfilechooser.c (btk_file_chooser_class_init): Add some docs.
	(#316001, Guillaume Cottenceau)

	* btk/btkdnd.c (btk_drag_set_icon_name): Fix a copy-and-paste
	mistake in the docs.  (#315993, Guillaume Cottenceau)

	* tests/testentrycompletion.c (create_simple_completion_model): Add
	some strings containing multibyte characters.

	* btk/btkentrycompletion.c (btk_entry_completion_real_insert_prefix): 
	Fix prefix insertion for multibyte characters.  (#316095,
	Tommi Komulainen)

	* btk/btktreeview.c (btk_tree_view_create_row_drag_icon): 
	* btk/btkiconview.c (btk_icon_view_create_drag_icon): Silently
	return NULL if the widget is not realized.  (#316023,
	Guillaume Cottenceau)

2005-09-11  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdk.symbols: 
	* bdk/bdkproperty.h: 
	* bdk/x11/bdkproperty-x11.c (bdk_atom_intern_static_string): 
	New function to avoid pointless strdups when creating atoms
	from static strings.  

	* bdk/x11/*.c:
	* btk/*.c:  Use bdk_atom_intern_static_string() where 
	appropriate.

2005-09-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrendererkeys.h: 
	* btk/btkcellrendererkeys.c: Add a cell renderer for displaying
	and editing accelerators, a port of EggCellRendererKeys .

	* btk/btk.symbols:
	* btk/btk.h:
	* btk/Makefile.am: Add the keys cell renderer.

	* tests/Makefile.am: 
	* tests/testkeys.c: Test BtkCellRendererKeys

2005-09-09  Matthias Clasen  <mclasen@redhat.com>

	Make it possible to determine if a key event is for a
	modifier key:
	
 	* bdk/x11/bdkprivate-x11.h: 
	* bdk/x11/bdkkeys-x11.c (_bdk_keymap_key_is_modifier): 
	New function to determine if a keycode is mapped to a modifier.
	(get_xkb): Get the modmap.

	* bdk/x11/bdkevents-x11.c (translate_key_event): Set the 
	is_modifier bit by calling _bdk_keymap_key_is_modifier().

	* bdk/bdkevents.h (struct _BdkEventKey): Add an is_modifier
	bit.

2005-09-09  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkpixbuf-drawable.c (convert_real_slow): Remove an 
	unused variable, noticed by Kjartan Maraas.

2005-09-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_button_event): 
	Make drag reordering work properly for columns other than the
	first.  (#315054, Dan Winship)
	
	* btk/btkfontsel.c (btk_font_selection_set_font_name): Handle 
	invalid fontnames better. (#136926, Michael R. Walton)
	
	Stop cursor blinking in non-editable rebunnyions of a text view.
	(#311508, TorbjÃ¶rn Andersson)
	
	* btk/btktextview.c (btk_text_view_check_cursor_blink): 
	(cursor_blinks): Take editability into account when deciding
	whether the cursor blinks.
	(btk_text_view_button_release_event): 
	(btk_text_view_move_cursor_internal): Update cursor blinking here.

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_start_editing): 
	Use connect_after to connect to the focus_out event. This
	ensures that the entry has already stopped blinking by the time
	we emit the edited signal.  (#315229, Thomas Leonard)

	* tests/testbtk.c: Use BDK_MOD1_MASK, not BDK_ALT_MASK.

	* btk/btkwindow.c (btk_window_parse_geometry): Don't set
	unsigned ints to -1.  (#315481, Kjartan Maraas)

	* btk/btkcalendar.c (btk_calendar_init): first_weekday is relative
	to week_1stday, not to Sunday. Gotta love the ISO 14652 guys...
	(#314473, Stanislav Brabec)

2005-09-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_get_visible_range): Document
	memory handling.  (#314975, Torsten Schoenfeld)

	* btk/btkiconview.c (btk_icon_view_class_init): 
	* btk/btkfilesel.c (btk_file_selection_class_init): 
	* btk/btkcombobox.c (btk_combo_box_class_init): 
	* btk/btklabel.c (btk_label_class_init): 
	* btk/btkcellrenderertext.c (btk_cell_renderer_text_class_init): 
	Stylistic improvements and clarifications for some blurbs. 
	(#315520, Clytie Siddall)

2005-09-09  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkdisplay-win32.c (bdk_display_get_name): Cache the
	display name. There is only one BdkDisplay on Win32, and
	constructing the display name isn't entirely trivial, so cacheing
	is probably worth it. For instance GIMP calls this function a lot.
	(bdk_display_open): Call bdk_display_get_name() to prime the
	cached name.
	(bdk_display_get_n_screens, bdk_display_get_screen,
	bdk_display_get_default_screen): Verify parameter correctness like
	the X11 backend does.

	* bdk/win32/bdkscreen-win32.c (bdk_screen_make_display_name):
	Return a freshly allocated string, as the API specifies. Fixes a
	heap corruption problem that caused random errors and crashes in
	GIMP, for instance.

2005-09-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkimcontextsimple.c (btk_im_context_simple_filter_keypress): 
	Make C-u commit and restart hex input if we are already in a
	hex sequence.

2005-09-06  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkkeys-x11.c (update_modmap): Make the modmap reflexive.
	(_bdk_keymap_add_virtual_modifiers): Don't add both Alt and Meta
	if they are mapped to the same modifier.

	* btk/Makefile.am: Rename btkstatusicon-x11.c and btktrayicon.c
	to btkstatusicon.c and btktrayicon-x11.c

	* btk/btkaccelgroup.c: Include Super, Hyper and Meta in the
	default accel mod mask.

	* btk/btkaccelgroup.c (btk_accelerator_parse): 
	* btk/btkaccellabel.c (_btk_accel_label_class_get_accelerator_label): 
	Don't use BDK_ALT_MASK.

	* bdk/bdktypes.h: No need to introduce BDK_ALT_MASK

2005-09-06  Matthias Clasen  <mclasen@redhat.com>

	Add support for extra virtual modifiers:  (#85780, Owen Taylor)
	
	* tests/testbtk.c (create_key_lookup): Add tests for extra virtual
	modifiers.

	* btk/btkkeyhash.c (_btk_key_hash_lookup): Try to match both against
	Mod2 - Mod5 and against Super, Hyper, Meta.

	* btk/btkaccellabel.c (_btk_accel_label_class_get_accelerator_label): 
	* btk/btkaccelgroup.c (btk_accelerator_parse) 
	(btk_accelerator_name): Support Super, Hyper Meta and Mod2 - Mod5.

	* bdk/x11/bdkkeys-x11.c (struct _BdkKeymapX11): Add a 
	modmap to maintain the information which X modifiers map to
	virtual modifiers.
	(get_xkb): Set up the modmap from the XKB tables.
	(update_keymaps): Set up the modmap from the information returned
	by XGetModifierMapping in the non-XKB case.

	* bdk/x11/bdkprivate-x11.h: 
	* bdk/x11/bdkkeys-x11.c (_bdk_keymap_add_virtual_modifiers): New 
	function to set the virtual modifiers in the state.

	* bdk/x11/bdkevents-x11.c (translate_key_event): Call 
	_bdk_keymap_add_virtual_modifiers here.

	* bdk/bdktypes.h (BdkModifierType): Add bits for virtual Super, 
	Hyper and Meta modifiers. Also add BDK_ALT_MASK as an alias
	for BDK_MOD1_MASK.

2005-09-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaction.c (connect_proxy): Set the label of a button
	if it has no child.  (#315253, John Finlay)

2005-09-02  Matthias Clasen  <mclasen@redhat.com>

	* btkimcontextsimple.h: Add a modifiers_dropped bit

2005-09-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (btk_entry_destroy): Disconnect idle handlers
	on destroy to avoid problems when they are called on a destroyed
	widget.  (#315135, John Cupitt)
	
	* btk/btkentry.c (btk_entry_class_init):
	* btk/btktextview.c (btk_text_view_class_init): Add bindings
	for Ctrl-Shift-A to unselect all.  (#309301, Kathy Fernandes)

	* btk/btkimcontextsimple.c: Rework the Unicode hex input
	code. Now we only steal a single key combination, Ctrl-Shift-U,
	instead of sixteen. 
	A hex Unicode sequence must be started with Ctrl-Shift-U, followed
	by a sequence of hex digits entered with Ctrl-Shift still held.
	Releasing one of the modifiers or pressing space while the modifiers
	are still held commits the character. It is possible to erase
	digits using backspace.
	As an extension to the above, we also allow to start the sequence
	with Ctrl-Shift-U, then release the modifiers before typing any
	digits, and enter the digits without modifiers.
	(#82011, Owen Taylor)
	
2005-09-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmain.c (btk_get_event_widget): If the window is destroyed,
	we still need to deliver the destroy event.  (#314980, Chris Lahey)

	* btk/btktextview.c (btk_text_view_key_press_event): Reset 
	im context before committing \n or \t.

2005-09-02  Alexander Larsson  <alexl@redhat.com>

	* btk/btkfilechooserdefault.c: (shortcuts_add_volumes),
	(shortcuts_activate_volume):
	Handle base_path being null in the rest of the cases (#310270)

2005-09-02  Tor Lillqvist  <tml@novell.com>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): Keep track of
	cursor position also in root window coordinates. Prune out
	superfluous WM_MOUSEMOVE events even earlier, based on root window
	coordinates. Windows sends WM_MOUSEMOVE messages after a new
	window has ben mapped below the cursor even if the mouse doesn't
	move. We used to generate BDK_MOTION_NOTIFY in these cases. This
	confused at least btk_menu_motion_notify(). (#314995)

	* btk/btkintl.h: No need to include config.h here. It caused
	warnings about BTK_LOCALEDIR being redefined on Win32 when
	compiling files where btkintl.h is included after btkprivate.h
	(which #undefines and re-#defines BTK_LOCALEDIR on Win32).

	* btk/btkplug.c: Include config.h.

2005-09-01  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystemunix.c: Pass statbufs down to 
	xdg_mime_get_mime_type_for_file() where possible, to avoid
	useless re-stating.  
	
	* btk/btkaction.c (btk_action_get_accel_closure): Fix doc
	typo.  (#314921, Guillaume Cottenceau)

	* bdk/*.c: Intern some more strings.
	* btk/btkintl.h: 
	* btk/*.c: Define an I_() macro and use it instead of the 
	bulky g_intern_static_string().

2005-08-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbindings.c (binding_signal_new): Intern the signal name
	instead of copying it.

	* btk/btktypeutils.c (btk_identifier_get_type): Some more string interning.

	* btk/*.c: Also intern static strings passed to 
	g_object_set_data().

	* bdk/Makefile.am: 
	* btk/Makefile.am: Intern type names in code generated by 
	bunnylib-mkenums, too.

	* btk/*.c: 
	* bdk/x11/*.c: 
	* bdk/*.c: Intern type names before registering the type to avoid 
	unnecessary copies.

	* configure.in: Require GLib 2.9.0

2005-08-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktoolbar.c: Undeprecate btk_toolbar_set_icon_size(),
	and add icon-size and icon-size-set properties.  (#314172)	

	* btk/btkwindow.c (btk_window_set_transient_for): Inherit window
	groups across transient parents.  (#312918, Christian Persch)

	* btk/btktreemodel.c: Some documentation fixes.  (#314882,
	Guillaume Cottenceau)

	* btk/btktextiter.c (btk_text_iter_backward_visible_cursor_positions): 
	Fix a typo in the docs.  (#314878, Guillaume Cottenceau)

2005-08-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (btk_entry_class_init): Add key bindings to
	make C-/ select all and C-\ unselect all.  (#309301,
	Kathy Fernandez)

	* btk/btkimcontextsimple.c: Change the compose sequence for
	soft hyphen to be multi_key-minus-minus-space, and add
	compose sequences multi_key-minus-minus-period and 
	multi_key-minus-minus-minus for en dash and em dash.
	(#172653, Christian Lohmaier)

	* btk/btkentry.c (btk_entry_draw_frame): Fix some unused
	code.  (#313946, Christian Persch)

	* btk/btkuimanager.c (btk_ui_manager_class_init): Another
	fix for the default value of the "ui" property.

2005-08-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols: 
	* btk/btkselection.h:
	* btk/btkselection.c: Add functions which look for text, image
	or uri targets in an array of atoms.   (#314089, Mark Wielaard)

	* btk/btk.symbols: 
	* btk/btkselection.h:
	* btk/btkselection.c (btk_selection_data_targets_include_uri): 
	Add a function to check wether targets include uri.  
	(#314092, Mark Wielaard)
	
	* btk/btk.symbols: 
	* btk/btkwindow.h: 
	* btk/btkwindow.c: Add a deletable property with getter
	and setter, to control the close button in the window 
	frame.  (#59718, Havoc Pennington)

2005-08-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrc.key.emacs: Add C-n/C-p/C-f/C-b as alternatives
	to the arrow keys for menu navigation.  (#162825, Carl Worth)

	* btk/btkentry.c, btk/btktextview.c: More typo fixes

	* btk/btksocket-x11.c, btk/btkstatusicon-x11.c: Fix typos.

	* btk/btkstatusicon-x11.c (btk_status_icon_new_from_stock): 
	* btk/btkimage.c (btk_image_new_from_stock): Don't
	refer to nonexisting stock ids.

	* btk/btktextview.c (popup_targets_received): 
	* btk/btkentry.c (popup_targets_received): Construct
	the "Select All" menuitem from stock.

	* btk/stock-icons/stock_select_all_{16,24}.png:
	* btk/stock-icons/Makefile.am: 
	* btk/btkiconfactory.c:
	* btk/btkstock.h: 
	* btk/btkstock.c: Add a "Select All" stock item.  (#78545,
	Calum Benson)

	* btk/btktrayicon.c: Add a pointer to the spec.

	* btk/btkstatusicon-x11.c: Add docs.

	* btk/btkstatusicon.h: Fix a typo.

	Add a cross-platform "tray icon" API, by
	porting EggStatusIcon/EggTrayIcon (#105101)
	
	* btk/btkstatusicon.h: A BtkStatusIcon is an object which
	displays an icon in a notification area.

	* btk/btkstatusicon-x11.c: BtkStatusIcon implementation for
	X11, using BtkTrayIcon.

	* btk/btktrayicon.h: 
	* btk/btktrayicon.c: An implementation of the freedesktop.org
	system tray specification, not public API.

	* btk/btk.symbols: Add new exported functions.

	* btk/btk.h: Include btkstatusicon.h.

	* btk/Makefile.am: Add new files.

	* tests/Makefile.am:
	* tests/teststatusicon.c: Test for BtkStatusIcon.

2005-08-29  Christopher Aillon  <caillon@redhat.com>

	* btk/btkstock.c: Add builtin BtkStockItems for BTK_STOCK_CONNECT
	and BTK_STOCK_DISCONNECT
	
2005-08-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksocket-x11.c (_btk_socket_windowing_embed_notify): 
	Use XFixesChangeSaveSet if available.  (#314682)

	* btk/btkmenu.c (btk_menu_grab_notify):  Only cancel if the menu
	was active.  (#314298, Christian Persch, analysis by Mark McLoughlin)

2005-08-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconcache.c (_btk_icon_cache_get_icon): Remove an
	accidentally leftover duplicate pixbuf creation.  (#314700,
	Kjartan Maraas)

	* btk/btksettings.c (settings_update_cursor_theme): Don't 
	leak the cursor theme name.  (#314693, Kjartan Maraas)

	* bdk/x11/bdkasync.c (_bdk_x11_get_window_child_info): Free 
	state.children in all cases.  (#313862, Kjartan Maraas)

2005-08-28  Matthias Clasen  <mclasen@redhat.com>

	* po/POTFILES.in, po-properties/POTFILES.in:
	Add bdk/bdkscreen.c

2005-08-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (btk_ui_manager_class_init): Fix the default
	value of the ui property. (#314532, Yong Wang)

	* bdk/x11/bdkproperty-x11.c (bdk_property_get): Don't warn
	when G_MAXLONG is passed as length.  

2005-08-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/updateiconcache.c: Add a separate --ignore-theme-index option
	to avoid overloading --force.  (JP Rosevaar)

2005-08-26  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version to 2.9.0

	* bdk/bdk.symbols: 
	* bdk/bdkscreen.h: 
	* bdk/bdkscreen.c: Make the BdkScreen font options api
	public, and add properties BdkScreen::font-options and
	BdkScreen::resolution.  (#314004)

	* bdk/bdkbango.c:
	* btk/btksettings.c:
	* btk/btkwidget.c: Adjust all callers.
	
	* bdk/bdkintl.h: Simplify and use bunnylib/gi18n-lib.h.
	* bdk/bdkbango.c: Include bdkintl.h, not btkintl.h.
	* bdk/bdkscreen.c: Include bdkintl.h.

	* btk/btkicontheme.c (theme_lookup_icon): Avoid an uninitialized
	variable warning, pointed out by Colin Walters. (#314585)

2005-08-26  Tor Lillqvist  <tml@novell.com>

	* btk/btkfilesystemwin32.c: Remove some ifdeffed out debugging
	printouts.
	(btk_file_system_win32_parse): Don't mishandle UNC paths. (#314519)

2005-08-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcalendar.c (btk_calendar_init): Fix the calculation
	of week_start.  (#314473, JP Rosevaar)

2005-08-25  Thomas Fitzsimmons  <fitzsim@redhat.com>

	* btk/btkfilesystemmodel.c (idle_finished_loading_cb): Acquire BDK
	lock.  (#314533, Thomas Fitzsimmons)

2005-08-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktoolbar.c (_btk_toolbar_elide_underscores): Handle
	NULL gracefully.  (#314523, Ed Catmur)

2005-08-25  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkcursor-x11.c (bdk_x11_display_set_cursor_theme): 
	Handle theme == NULL.

2005-08-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmenutoolbutton.c (menu_position_func): Take widget
	y offset into account when positioning the popup.  (#314470,
	Christian Persch)

2005-08-25  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkscreen.c (bdk_screen_get_type): Use bdk_screen_init
	as instance_init, not base_init! (#314452, Fix from Frederic
	Crozat,	reported by Joe Marcus Clarke). Trivial cleanup: use -1.
	rather than 1 for a negative flag value.

2005-08-24  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkbango.c (draw_error_underline): Add a note about
	cut-and-paste between here and Bango.

2005-08-24  Matthias Clasen  <mclasen@redhat.com>

	* === Released 2.8.2 ===

	* btk/btkclipboard.c (request_image_received_func): Use the correct
	callback for image/gif, and also try image/bmp.  (#314086,  Mark 
	Wielaard)

	* btk/btkfilesystemunix.c (btk_file_system_unix_volume_render_icon): 
	Use bunny-dev-harddisk for volumes, not bunny-fs-blockdev.  (#314382,
	Sebastien Bacher)
	
	* NEWS: Updates

	* btk/btksettings.c (btk_settings_get_for_screen): Make sure font
	and cursor settings get propagated down to the screen initially.
	Pointed out by Frederic Crozat.

	* btk/btkicontheme.c (ensure_valid_themes): Don't try to send a client
	message if the screen is NULL. Noticed by Kjartan Maraas.

2005-08-24  Matthias Clasen  <mclasen@redhat.com>

	* Bump version

	* === Released 2.8.1 ===

	* NEWS: Updates
	
2005-08-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_visible): Protect
	against lazy filterers which return values other than TRUE or
	FALSE from their visible func.  (#314335)

2005-08-23  Owen Taylor  <otaylor@redhat.com>

	Fix for #314004, reported by Michael Reinsch:

	* bdk/bdk.symbols:
	* bdk/bdkscreen.[ch]: Add bdk_screen_get/set_font_options_libbtk_only()
	Add bdk_screen_get/set_resolution_libbtk_only()

	* bdk/bdkbango.c (bdk_bango_context_get_for_screen): Set
	the options for the screen on the newly created context.

	* btk/btksettings.c (settings_update_font_options/dpi) btkwidget.c: 
	Move font options and dpi code from btkwidget.c to btksettings.c, set
	the font options on the screen.

	* btk/btkwidget.c (btk_widget_update_bango_context): Just get
	the font options from the screen and set them on the context.

2005-08-23  Kristian Rietveld  <kris@btk.org>

	* btk/btktreemodelsort.c (btk_tree_model_sort_row_inserted): don't
	bother inserting new rows in a level with a zero refcount and
	immediately free the level. (Fixes #312350, reported by Markku Vire).

2005-08-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/updateiconcache.c: Complain when there is no index.theme file
	in the specified directory, unless --force is used. Also add an
	--index-only option to create caches without image data.

	* btk/btkfilechooserdefault.c (shortcuts_append_desktop): Fix a
	C99ism.  (#314262, Robert Jeff Mitchell)
	
2005-08-22  Manish Singh  <yosh@gimp.org>

	* btk/btkicontheme.h: add declaration for _btk_icon_theme_check_reload.

	* btk/btkwindow.c: remove declaration of btk_window_read_rcfiles.

2005-08-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwindow.c (btk_window_client_event): 
	* btk/btkicontheme.c (ensure_valid_themes) 
	(_btk_icon_theme_check_reload): Implement a clientmessage based
	scheme for makeing sure that all BTK+ applications notice if an
	icon theme has been updated. This should prevent multiple versions
	of an icon theme cache to be mapped in memory at the same time,
	which can cause excessive memory consumption.  (#313156, Chris 
	Lahey)

2005-08-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c (btk_icon_theme_load_icon): Add a note
	regarding icon theme changes.

	* btk/btkiconcache.c (_btk_icon_cache_get_icon): When returning
	pixbufs which are backed by the mmapped memory of an icon cache,
	increase the refcount of the icon cache, so that the memory is not
	munmapped away underneath the pixbuf upon icon theme changes.  
	(#314170, Kjartan Maraas)

	* docs/tools/Makefile.am (LDADDS): Add BTK_DEP_LIBS, in order 
	to link against Xext.  (#314062)

	* btk/btkhsv.c (paint_triangle): One more fix to prevent buffer
	overruns.  (#314081, Hans Breuer)

2005-08-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (btk_entry_get_layout): Clarify that the
	returned layout must not be modified.

Sat Aug 20 16:12:14 2005  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeview.c (btk_tree_view_set_model): clear
	scroll_to_path if the model changes.

	* btk/btkiconview.c: (btk_icon_view_destroy),
	(btk_icon_view_size_allocate), (btk_icon_view_set_cursor),
	(btk_icon_view_scroll_to_path): Handle scrolling to a path before
	we're realized, #312798
	(btk_icon_view_set_model): clear scroll_to_path if the model
	changes.

2005-08-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrange.c (btk_range_adjustment_changed) 
	(btk_range_adjustment_value_changed):  Don't queue a draw
	if the layout has not changed.  (#313991, Benjamin Berg)

2005-08-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeitem.c: Remove duplicate lines.  (#313344,
	Benoit Carpentier)

	* modules/engines/ms-windows/msw_style.c (setup_system_styles): 
	Fix a typo. 

	* btk/btkfilechooserbutton.c (change_icon_theme) 
	(model_add_special, model_add_special, model_add_volumes):
	Handle pixbuf being NULL without warnings. Also, don't
	leak pixbuf references when the icon theme is changed.

	* btk/btkmain.c (btk_get_event_widget): Don't access
	the user data on destroyed windows, since at best
	it can be a stale pointer.  (#313953, Robin Green)	

2005-08-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkhsv.c (paint_triangle): Avoid a buffer overrun.  
	(#313900, Sebastien Bacher)

	* btk/btktreeview.c (btk_tree_view_get_visible_range): Return
	FALSE if the tree is empty.  (#313891, Guillaume Cottenceau)

	* bdk/x11/bdkdnd-x11.c (_bdk_drag_get_protocol_for_display) 
	(xdnd_read_actions, get_client_window_at_coords_recurse): 
	Free data returned from XGetWindowProperty. 

	* bdk/x11/bdkevents-x11.c (fetch_net_wm_check_window) 
	Free data returned from XGetWindowProperty.  (313867, Kjartan
	Maraas)
	
	* bdk/x11/bdkdnd-x11.c (get_client_window_at_coords_recurse): Free
	children in all cases.  (#313862, Kjartan Maraas)

	* btk/btkicontheme.c (theme_lookup_icon): Store BtkIconData structs 
	in the per-directory hash, even if they come from the icon cache. 
	We tried to avoid that before, but as a result leaked icon data
	structs.  (#313852, Kjartan Maraas)

2005-08-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmenutoolbutton.c (btk_menu_tool_button_destroy): Disconnect
	signal handlers on destroy, not on finalize.  (#313759, Brett Atoms)

2005-08-15  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Add -lXext to BDK_EXTRA_LIBS in absence of pkg-config
	files for x11/xext. (Jonas Bonn)

2005-08-15  Tor Lillqvist  <tml@novell.com>

	* btk/btkicontheme.c (theme_lookup_icon): Put debugging printout
	inside BTK_NOTE.

2005-08-15  Owen Taylor  <otaylor@redhat.com>

	* configure.in: Fix have_base_pc / have_base_x_pc typo.

	* bdk/x11/bdkdrawable-x11.c btk/btksettings.c: Remove panoxft.h includes.
	(#313417, James Andrewartha)

	* configure.in: Add fontconfig to X_PACKAGES, since we use it for
	FcNameConstant(). (More of #313417)

2005-08-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c: When using btk_dialog_run() for
	modal dialogs, make sure to inherit the window group from 
	the parent, since we don't inherit window groups across
	transient parents currently.  (#312918, Christian Persch)

	* btk/btkmessagedialog.c (btk_message_dialog_new): 
	* btk/btkdialog.c (btk_dialog_run): Slight update to the docs. 

	* btk/btkiconview.c (btk_icon_view_select_path) 
	(btk_icon_view_scroll_to_path): Handle paths of depth 0
	gracefully.  (#312796, Jonathan Blandford)

	* tests/testtoolbar.c: Add some more tests for menu placement.

	* btk/btkmenutoolbutton.c (menu_position_func): 
	* btk/btktoolbar.c (menu_position_func): Improve positioning
	of toolbutton menus and of the overflow menu.  (#312937, 
	#153870, Christian Persch, Paolo Borelli)

2005-08-15  Tor Lillqvist  <tml@novell.com>

	* btk/updateiconcache.c: Use g_path_get_dirname() instead of
	the nonportable <libgen.h> and dirname().

2005-08-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksizegroup.c: Use object data to mark widgets and
	groups as visited, so that we avoid constant extra list
	traversals. Also allocate quarks in class_init.  (#311618,
	Michael Natterer)

	* btk/btkicontheme.c (btk_icon_theme_lookup_icon): Correct the 
	download location for the hicolor icon theme. (#313475, Olexiy 
	Avramchenko)

	* btk/btkicontheme.c: Remove debug spew. 

2005-08-15  Owen Taylor  <otaylor@redhat.com>

	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_set_back_pixmap): 
	* bdk/win32/bdkwindow-win32.c (bdk_window_set_back_pixmap): 
	* bdk/x11/bdkwindow-x11.c (bdk_window_set_back_pixmap):
	Handle pixmap == NULL when checking for a colormap.
	(Allin Cottrell).

2005-08-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/updateiconcache.c: Store only one copy of the pixel data
	for symlinked icons. To achieve this, maintain a hashtable 
	mapping pathnames to pixel data, and share the pixel data for
	all symlinks resolving to the same pathname. When writing out
	the image data, write out the pixel data only the first time
	it is met, and store the offset pointing to the first copy
	for use in all later cases.
	This reduces the size of the Bluecurve icon cache from 40
	to 13MB. (#312972)


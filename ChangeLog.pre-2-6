2004-12-16  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version

	* === Released 2.6.0 ===

	* btk/btkmenuitem.c: Add a forgotten cast.  (Morten Welinder) 

	* btk/btkfilechooserbutton.c: Add another forgotten include. (Morten
	Welinder)

2004-12-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c (dialog_response_cb): Only unblock the handlers
	if they are blocked.

	* btk/btktreeview.c (btk_tree_view_real_start_interactive_search): Don't
	crash if enable_search is FALSE.  (#161267, Jorn Baayen)

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_mnemonic_activate): 
	Re-fix #152925, reported by Dennis Cranston.

2004-12-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c: Add missing includes.

	* configure.in: Require bunnylib 2.6.0 for 
	g_filename_display_basename.

	* btk/btkentrycompletion.[hc]: Make the prefix parameter 
	to the insert-prefix signal a const bchar* instead of a 
	bchar*.  (#161415, Murray Cumming)
	Also remove an unused static function.

2004-12-15  Alexander Larsson  <alexl@redhat.com>

	* btk/btkfilesystemunix.c (btk_file_folder_unix_get_info):
	Use g_filename_display_basename to calculate display name.

2004-12-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/abicheck.sh: Strip out PRIVATE

	* NEWS: Updates

	* btk/btkmenushell.c (btk_menu_shell_select_submenu_first) 
	(btk_real_menu_shell_activate_current): Use 
	_btk_menu_item_popup_submenu() to make keynav into submenus work
	instantaneously, independent of the popup delay.  (#161140)

	* btk/btkmenuitem.[hc]: _-prefix btk_menu_item_popup_submenu() and
	make it non-static.

	* btk/btkmenuitem.c (btk_menu_item_paint): Remove unused variables.

2004-12-15  James M. Cape  <jcape@ignore-your.tv>

	* btk/btkfilechooserbutton.c (struct _BtkFileChooserButtonPrivate)
	(btk_file_chooser_button_init)
	(btk_file_chooser_button_file_chooser_iface_init)
	(btk_file_chooser_button_add_shortcut_folder)
	(btk_file_chooser_button_remove_shortcut_folder) 
	(btk_file_chooser_button_constructor)
	(btk_file_chooser_button_set_property)
	(btk_file_chooser_button_destroy)
	(btk_file_chooser_button_finalize)
	(get_icon_theme) (get_display_name_for_path) (model_get_type_position)
	(model_free_row_data) (model_add_special) (model_add_other)
	(model_add_volumes) (model_add_bookmarks)
	(model_update_current_folder) (model_remove_rows)
	(filter_model_visible_func) (combo_box_row_separator_func)
	(name_cell_data_func) (update_combo_box) (fs_volumes_changed_cb)
	(fs_bookmarks_changed_cb) (combo_box_changed_cb)
	(change_icon_size): Use a BtkComboBox in SELECT_FOLDER mode (#157726).

	* btk/btkfilechooserbutton.c:
	* btk/btkfilechooserbutton.h (btk_file_chooser_button_new)
	(btk_file_chooser_button_new_with_backend): Add @action to constructors
	to match other BtkFileChooser impls. API CHANGE.

	* docs/tools/widgets.c (create_file_button):
	* tests/testfilechooserbutton.c (main): Update callers.

	* docs/reference/btk/tmpl/btkfilechooserbutton.sgml: Reflect API
	change.

	* tests/testfilechooserbutton.c: Add LGPL license.
	(main): Added GOption parser for --backend and --right-to-left cmd line
	args.
	(add_pwds_parent_as_shortcut_clicked_cb)
	(del_pwds_parent_as_shortcut_clicked_cb) (tests_button_clicked_cb):
	Add shortcut_folders test.
	(chooser_current_folder_changed_cb) (chooser_selection_changed_cb)
	(chooser_file_activated_cb) (chooser_update_preview_cb): Print URIS,
	not filenames.

2004-12-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (get_is_file_filtered): Don't 
	try to filter if impl->current_filter is NULL.  (#161329, 
	R. McFarland) 

2004-12-14  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	Fix #145470:

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_initial_focus): Queue a pending
	operation to select the first row if we are not finished loading
	yet.
	(btk_file_chooser_default_class_init): Override BtkWidget::map().
	(btk_file_chooser_default_map): New ::map() handler; refresh the
	file and bookmark lists.

	* btk/btkfilechooserdialog.c (btk_file_chooser_dialog_class_init):
	Override BtkWidget::map() and BtkWidget::unmap().
	(btk_file_chooser_dialog_constructor): Don't call initial_focus()
	here.
	(btk_file_chooser_dialog_map): Map the file chooser widget if
	needed.  Call initial_focus() here.
	(btk_file_chooser_dialog_unmap): Unmap the file chooser widget.
	When we are re-mapped, the widget will get mapped as well and it
	will have a chance to refresh.

2004-12-14  Matthias Clasen  <mclasen@redhat.com>

	* README.win32: Fix a typo

	* README.in: Updates

	* tests/testcombo.c (main): Don't use btk_cell_renderer_set_values().

	* btk/btk.symbols: 
	* btk/btkcellview.[hc]: Remove btk_cell_renderer_set_value[s]
	for now.

	* configure.in: Bump version to 2.6.0

	* NEWS: Updates

	* tests/testiconview.c: Test oversized items.

	* btk/btk.symbols: Add new symbols.

	* btk/btkiconview.[hc]: Make the icon view lay out its
	items in a grid, allocating multiple grid cells to oversized
	items. Also convert hardwired spacing constants into 
	properties.  (#152483)

2004-12-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c: s/maximal/maximum/g  (#161195, David Lodge)

	* btk/btkmenuitem.c (btk_real_menu_item_select): Reintroduce
	the reverted change, since it is necessary to prevent lost
	submenus. But make it work for torn-off menus as well.

	* btk/btktearoffmenuitem.c (tearoff_state_changed): Fix the signature
	to avoid overwriting a pspec.  

	* btk/btkmenuitem.c (btk_real_menu_item_select): Revert a change
	which prevented torn-off menus from being shown normally.

	* btk/btkmenu.c (btk_menu_scroll): Implement scroll wheel scrolling
	for menus. (#88532)

	* btk/btkwindow.c (btk_window_real_set_focus): Compare only
	the HAS_DEFAULT flags.  (#160711, Tommi Komulainen)

	* btk/btkimage.c (btk_image_set_property): Add a missing break
	statement.  (#161172, Damon Chaplin)

	* btk/btkcellrenderertext.c: Add a width-chars property like
	BtkLabel has.  (#160496, James M. Cape)

	* NEWS: Updates

	* btk/btkwidget.c (btk_widget_class_init): Add some docs for
	BtkWidget::delete-event and BtkWidget::destroy-event.  (#161142,
	Paolo Borelli)

2004-12-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.[hc]: Add a max-width-chars property, which can
	be used to specify the width of the label in characters, while
	still allowing it to fall short of this length if the text
	is shorter.  (#155944, Christian Persch)

	* btk/btk.symbols: Add new symbols.

	* btk/btkuimanager.c (update_smart_separators): Don't let the
	empty menu filler affect visibility of separators.  (#160500,
	Christian Persch)

2004-12-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_menu_row_changed): Pass a 
	last item to btk_combo_box_relayout_item.  (#161050, John Finlay)

	* tests/testfilechooserbutton.c (tests_button_clicked_cb): Rename
	a local variable to avoid a conflict.  (#161109, Robert Ögren)

2004-12-12  Tor Lillqvist  <tml@iki.fi>

	* btk/btkaccelmap.[ch]
	* btk/btkfilechooser.[ch]
	* btk/btkfilesel.c
	* btk/btkfilesystemwin32.c
	* btk/btkiconfactory.[ch]
	* btk/btkicontheme.[ch]
	* btk/btkimage.[ch]
	* btk/btkimmodule.c
	* btk/btkmodules.c
	* btk/btkrc.[ch]
	* btk/btkuimanager.[ch]
	* btk/btkwindow.[ch]	
	* btk/updateiconcache.c
	* btk/btk.symbols: Use gstdio wrappers. On Windows, convert
	environment variables referring to pathnames from locale encoding
	to UTF-8. As in GLib, in order to preserve Windows DLL ABI
	stability, add binary compatibility versions of functions that
	take file names as arguments, or return file names. Add a _utf8
	suffix to the "real" such functions on Windows. The ABI
	compatibility versions keep the old name.

	* btk/Makefile.am: Strip PRIVATE symbols from the GNU import
	library.

	* btk/btkiconcache.c (_btk_icon_cache_new_for_path): Implement
	file mapping on Win32.

	* btk/updateiconcache.c: Don't crash if invoked without
	argument. Use binary mode when opening file.

	* modules/engines/ms-windows/Theme/btk-2.0/Makefile.am: Install
	btkrc in correct place, in <datadir>/themes/MS-Windows/btk-2.0.

2004-12-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c (btk_label_setup_mnemonic): Fix a 
	copy-and-paste error, noticed by Robert Ögren.

2004-12-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_menu_fill_level) 
	(btk_combo_box_menu_row_changed): Only wrap if we are in the
	topmost menu.  (#160936, John Finlay)

2004-12-10  Matthias Clasen  <mclasen@redhat.com>

	Support no-Alt mnemnonics in menu bars  (#101309, Owen Taylor)
	
	* btk/btkwindow.c: Factor out mnemonic hash code into
	a separate file.

	* btk/btkmnemonichash.[hc]: Factored out mnemonic hash
	code from btkwindow.c.

	* btk/Makefile.am (btk_c_sources): Add btkmnemonichash.[hc].

	* btk/btkmenushell.c (struct _BtkMenuShellPrivate): Give 
	menu shells their own mnemonic hash.

	* btk/btkmenushell.h: Add private api to support mnemonics.

	* btk/btklabel.c (btk_label_setup_mnemonic): Add mnemonic to
	the menushell mnemonic hash when inside a menu.
	
Fri Dec 10 13:59:32 2004  Manish Singh  <yosh@gimp.org>

	* btk/btk.symbols: add recent new functions.

2004-12-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwindow.c: Revert the patch which added no-alt 
	mnemonics, since it interfers badly with menus.  (#160911,
	Jonathan Blandford)

2004-12-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c (btk_label_class_init): Fix a property
	nick typo. 

	* btk/btkfilechooserdefault.c: Apply a patch to reset the 
	filter if an otherwise invisible file is selected via the 
	location popup.  (#159896, Carlos Garnacho Parro)

	Fix #145463, reported by Michael Natterer.
	
	* btk/btkcellrenderer.h (struct _BtkCellRenderer): Add an
	editing flag to keep track of when editing is done.
	
	* btk/btkcellrenderer.h:
	* btk/btkcellrenderer.c (btk_cell_renderer_stop_editing): New
	function to replace btk_cell_renderer_editing_canceled(). 
	Deprecate btk_cell_renderer_editing_canceled(). 

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_editing_done): 
	* btk/btkcellrenderercombo.c (btk_cell_renderer_combo_editing_done): 
	* btk/btktreeview.c (btk_tree_view_stop_editing):
	Use btk_cell_renderer_stop_editing().
	
2004-12-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkliststore.h: 
	* btk/btkliststore.c (btk_list_store_insert_with_values): 
	(btk_list_store_insert_with_valuesv): Add functions which allow
	faster insertion of rows in sorted list stores.  (#160063)

2004-12-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_set_wrap_width): Fix a typo
	in the docs.  (#160826, Jay Camp)

2004-12-08  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	* btk/btkfilechooserdefault.c (pending_op_process): Center the
	selected row so that it's easily visible.

2004-12-08  Matthias Clasen  <mclasen@redhat.com>

	Fix #111031, reported by Padraig O'Briain:
	
	* btk/btktextlayout.h: 
	* btk/btktextlayout.c (btk_text_layout_get_iter_at_position): 
	Add a variant of btk_text_layout_get_iter_at_pixel() which
	returns the character at the position, not the closest
	cursor position.

	* btk/btktextview.h: 
	* btk/btktextview.c (btk_text_view_get_iter_at_position): 
	Add a variant of btk_text_view_get_iter_at_location() which
	returns the character at the position, not the closest
	cursor position.

2004-12-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaccelmap.c (internal_change_entry): Remove all 
	entries for the same key, not just the first one.  (#159498, 
	Christian Persch)

2004-12-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (_btk_tree_view_column_start_drag): Use
	button->event_window for the fake leave event, otherwise
	the button ignores it.  

2004-12-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_rows_reordered): Make this
	work, no need to invert the array. 

	* btk/btkliststore.c (btk_list_store_sort_iter_changed): Emit
	rows_reordered if the row has been moved.  (#160063)

	* btk/btktreeviewcolumn.c (btk_tree_view_column_button_event): 
	Don't mess up the column header state if the button release
	event is missed.  (#159640)

2004-12-07  Marco Pesenti Gritti  <marco@bunny.org>

	* btk/btkcellview.c (btk_cell_view_set_background_color):
	Fix a typo in last commit

2004-12-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellview.c (btk_cell_view_set_background_color): Queue
	a redraw.  (#160679, Damon Chaplin)

2004-12-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeviewcolumn.c (btk_tree_view_column_button_event): 
	Don't mess up the column header state if the button release
	event is missed.  (#159640)

	* docs/tools/widgets.h (enum): Add an ASIS widget size.

	* docs/tools/widgets.c (get_all_widgets): Add file chooser,
	font selection and color selection dialogs.

2004-12-06  Matthias Clasen  <mclasen@redhat.com>

	* modules/input/btkimcontextime.c: Prevent double commits,
	don't commit when Ctrl is present.  (#160376, Kazuki IWAMOTO)

2004-12-06  Hans Breuer  <hans@breuer.org>

	* btk/btkcolorsel.c (key_press): Implement keynav for the color
	picker - win32 too. Fixes bug #160437.

2004-12-05  Tor Lillqvist  <tml@iki.fi>

	* demos/btk-demo/main.c (load_file): Use g_fopen().

	* demos/btk-demo/images.c (progressive_timeout): Use
	g_fopen(). Open png file in binary mode.

2004-12-02  Matthias Clasen  <mclasen@redhat.com>
	
	* configure.in: Bump version

	* === Released 2.5.6 ===

	* NEWS: Updates

2004-12-03  Tor Lillqvist  <tml@iki.fi>

	* bdk-pixbuf/Makefile.am (bdk_pixbuf.def)
	* bdk/Makefile.am (bdk.def)
	* btk/Makefile.am (btk.def): Work around gcc misfeature. At least
	gcc 3.3.1 doesn't like to do -E on files that it thinks aren't
	source files. Use redirection and '-' instead.

2004-12-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_should_respond): 	Reinstate the previous behavior for clicking Ok after
	activating a bookmark or path bar button in folder 
	modes.  (#160044, Dennis Cranston)

2004-12-02  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	Fix #159656:

	* btk/btkfilechooserdefault.c (PendingOp): New enumeration for the
	pending operation to perform when finishing loading a folder.
	(struct _BtkFileChooserDefault): New fields 'pending_op' and
	'pending_select_path'.
	(pending_op_queue): New utility function.
	(pending_op_process): New utility function.
	(btk_file_chooser_default_select_path): Don't select the path
	immediately; delay it until the folder is finished loading.
	(browse_files_model_finished_loading_cb): Process the pending
	operation.
	(browse_files_select_first_row): New utility function.
	(btk_file_chooser_default_initial_focus): Use
	browse_files_select_first_row().
	(btk_file_chooser_default_should_respond): Queue an operation to
	select the first row once we load the child folder.
	(up_folder_handler): Queue an operation to select the current
	folder once we load the parent folder.
	(btk_file_chooser_default_finalize): Free the pending_select_path.

Thu Dec  2 13:18:34 2004  Manish Singh  <yosh@gimp.org>

	* bdk/x11/bdkgc-x11.c (make_fg_tile_picture): Make sure we always
	return a value. Return None in the fallthrough case.

2004-12-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmessagedialog.c: (setup_primary_label_font):
	Don't leak bango_font_description object (#160214, Frederic Crozat).

2004-12-01  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_row_changed): Handle the
	fact the the changed row may also be moved.  (#159387, Olivier 
	Andrieu)

2004-12-01  Tor Lillqvist  <tml@iki.fi>

	* modules/input/imime.c (im_module_create): Use the module's
	correct name in test. (#160122)

2004-12-01  Michael Natterer  <mitch@gimp.org>

	* btk/btkuimanager.[ch]: added virtual functions
	BtkUIManager::get_widget() and ::get_action(). Moved the code from
	btk_ui_manager_get_widget() and get_action() to the default
	implementations. Fixes bug #160096.

	(btk_ui_manager_get_toplevels): added missing precondition check
	for BTK_IS_UI_MANAGER(self).

2004-12-01  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/Theme/btk-2.0/btkrc: use MS Windows button order, not Bunny HIG order
	* modules/engines/ms-windows/msw_style.c (draw_handle): Draw XP toolbar grippie handle properly
	(draw_resize_grip): Draw XP status bar grippie handle properly
	(draw_arrow): XP theme combo box arrows on toolbars

2004-11-30  Dom Lachowicz <cinamod@hotmail.com>

	* modules/engines/ms-windows/Theme/btk-2.0/btkrc: MS Windows menus should not have tearoffs

Tue Nov 30 17:53:37 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btksequence.c (node_compare): Assign an arbitrary, but
	consistent, order to nodes that the user function compares as
	equal. Better fix for bug #157670 and a better way to make sorting
	stable.

2004-11-30  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkpixmap-win32.c : remove the disputable memset at 
	the end of bdk_pixmap_new() - on X11 the bits are not initialized 
	either - fixes bug #145107

	* btk/btkfilesystemwin32.c : add an idle handler to emit "volumes-changed"
	when drives are plugged in or removed. Fixes bug #137815

2004-11-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreesortable.c (btk_tree_sortable_get_sort_column_id): Update 
	the documentation to specify a more useful behaviour, which can be
	implemented with the multiple special values we have now.  (#159984,
	Nicholas Rahn)

	* btk/btktreemodelsort.c (btk_tree_model_sort_get_sort_column_id): 
	* btk/btktreestore.c (btk_tree_store_get_sort_column_id): 
	* btk/btkliststore.c (btk_list_store_get_sort_column_id): Update the
	implementations.

Tue Nov 30 16:25:29 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextdisplay.c (render_para): Don't paint in the
	trailing end of a wrapped line when the selection 
	starts after the line. (#160000, Matthias Clasen)

	* btk/btktextdisplay.c (btk_text_layout_draw): pass in byte_count + 1 
	for selection_end index when the selection end is past the end of the 
	line so that render_para() can distinguish it from selection-end
	*at* the end of the line. Fixes newlines not being selected.

2004-11-30  James M. Cape  <jcape@ignore-your.tv>

	* btk/btkfilechooserbutton.h (btk_file_chooser_button_get_active)
	(btk_file_chooser_button_set_active):
	* btk/btkfilechooserbutton.c (btk_file_chooser_button_class_init)
	(btk_file_chooser_button_get_active)
	(btk_file_chooser_button_set_active):
	* docs/reference/btk/btk-sections.txt:
	* docs/reference/btk/tmpl/btkfilechooserbutton.sgml:
	* btk/btk.symbols: removed "BtkFileChooserButton:active" property and
	getter/setter.

	* btk/btkfilechooserbutton.c (struct _BtkFileChooserButtonPrivate)
	(button_toggled_cb) (dialog_response_cb) (button_notify_active_cb)
	(btk_file_chooser_button_init) (button_clicked_cb)
	(btk_file_chooser_button_show): Use a BtkButton instead of a
	BtkToggleButton.
	(struct _BtkFileChooserButtonPrivate)
	(btk_file_chooser_button_destroy) (btk_file_chooser_button_style_set)
	(btk_file_chooser_button_screen_changed): Don't bother with the
	(remove_settings_signal) (settings_notify_cb) (check_icon_theme):
	Don't use BtkSettings at all, just call change_icon_theme() directly.
	(struct _BtkFileChooserButtonPrivate)
	(btk_file_chooser_button_init)
	(btk_file_chooser_button_drag_data_received)
	(btk_file_chooser_button_mnemonic_activate)
	(btk_file_chooser_button_set_width_chars)
	(btk_file_chooser_button_get_width_chars)
	(entry_changed_cb) (update_idler) (update_entry) (update_dialog)
	(dialog_selection_changed_cb) (dialog_response_cb)
	(entry_size_allocate_cb): Remove all references to the now-defunct
	entry, store the old path (to support "Cancel") in an instance member.
	(update_label_and_image) (update_label) (update_image)
	(btk_file_chooser_button_init) (dialog_response_cb)
	(dialog_selection_changed_cb): Merge label/image updates, only display
	the filename (not the whole path, fixes #157725).
	(struct _BtkFileChooserButtonPrivate)
	(dialog_selection_changed_cb)
	(dialog_selection_changed_proxy_cb): Merge "selection-changed"
	handlers, block while dialog is visible (fixes #158482).

	* tests/testfilechooserbutton.c (delete_event_cb)
	(properties_button_clicked_cb) (print_selected_path_clicked_cb)
	(tests_button_clicked_cb) (main): Add per-chooser "tests" window,
	don't delete on WM close, update properties_button_clicked_cb()
	"delete-event" callback.

2004-11-30  Dwayne Bailey  <dwayne@translate.org.za>

	* configure.in: Added "nso" to ALL_LINGUAS.

Tue Nov 30 09:46:49 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdrawable-x11.c (_bdk_x11_drawable_draw_xtrapezoids)
	* bdk/x11/bdkdrawable-x11.c (_bdk_x11_drawable_draw_xft_glyphs):
	Call bdk_x11_drawable_update_xft_clip (part of #159929,
	James Henstridge)

	* bdk/x11/bdkdrawable-x11.c (bdk_x11_draw_glyphs_transformed): 
	Remove unused variables.

Tue Nov 23 19:37:34 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkgc-x11.c (_bdk_x11_gc_flush): A little bit
	of microoptimization of repeated BDK_GC_XDISPLAY()/XGC().

2004-11-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreemodelsort.c (btk_tree_model_sort_get_sort_column_id): 
	* btk/btktreestore.c (btk_tree_store_get_sort_column_id): 
	* btk/btktreesortable.c (btk_tree_sortable_get_sort_column_id): 
	* btk/btkliststore.c (btk_list_store_get_sort_column_id): 

	* NEWS: Updates.

2004-11-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmenushell.c (btk_menu_shell_button_release): Don't
	do the popup-on-click handling for menubars.  (#159931, 
	Søren Sandmann)
	
	* btk/btkmenuitem.c (btk_real_menu_item_select): Don't 
	handle popup delay if the submenu is already mapped.	

Mon Nov 29 16:56:33 2004  Manish Singh  <yosh@gimp.org>

	* btk/btkcellview.h: remove btk_cell_view_set_cell_data() declaration.

2004-11-29  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	* btk/btkfilechooserdefault.c (trap_activate_cb): Don't handle
	Enter if we are in SELECT_FOLDER or CREATE_FOLDER actions.  This
	lets us navigate the file system more easily.
	(btk_file_chooser_default_should_respond): If we are in
	SELECT_FOLDER or CREATE_FOLDER modes, return TRUE if something is
	selected.

Mon Nov 29 17:51:51 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btksequence.c (_btk_sequence_sort_changed): If the item is
	already in the right place, don't move it. Bug #157670.
	
	* btk/btksequence.c (already_in_place): New function

Mon Nov 29 17:28:53 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btksequence.c (_btk_sequence_sort): Take nodes in reverse
	order to make sure sort is stable.

2004-11-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (cell_view_is_sensitive): Don't call
	btk_cell_view_set_cell_data() from here.

	* btk/btk.symbols: Remove btk_cell_view_set_cell_data()

	* btk/btkcellview.c (btk_cell_view_get_cell_renderers): Call 
	btk_cell_view_set_cell_data() from here.
	(btk_cell_view_set_cell_data): Make static.

	* btk/btkcombobox.c (btk_combo_box_menu_popup): Make menu mode
	work better when resizing the combo box.

	Determine the direction of XKB groups from their content, 
	not by looking for hardcoded keymap names.  (#116626, patch by 
	Behdad Esfahbod, based on an earlier patch by Ilya Konstantinov)
	
	* bdk/x11/bdkkeys-x11.c (struct _BdkKeymapX11): Cache directions
	for XKB groups.
	(get_direction): Determine direction of group by looking at 
	directions of keysyms.
	(update_direction): Maintain the cache of group directions.
	(bdk_keymap_get_direction): Use update_direction().

	* bdk/bdkkeynames.c: Add dead_hook and dead_horn.

	* bdk/bdkkeysyms.h (BDK_dead_hook, BDK_dead_horn): Define
	these keysyms.  (#159739, Samuel Thibault)

2004-11-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/Makefile.am (btkalias.h): 
	* bdk/Makefile.am (bdkalias.h): Use the perl found by 
	configure.  (#149826, Morten Welinder)

2004-11-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwidget.h (btk_requisition_get_type): 
	* btk/btktypeutils.h (btk_identifier_get_type): 
	* btk/btktexttag.h (btk_text_attributes_get_type): 
	* btk/btkstyle.h (btk_border_get_type): 
	* btk/btkfilesystemmodel.h (_btk_file_system_model_get_type): 
	* btk/btkfilechooserentry.h (_btk_file_chooser_entry_get_type): 
	* btk/btkfilechooserembed.h (_btk_file_chooser_embed_get_type):
	* btk/btkfilechooserdefault.h (_btk_file_chooser_default_get_type): 
	* btk/btkaccelmap.h (btk_accel_map_get_type): Mark as const.

	* btk/btk.symbols: 
	* btk/Makefile.am: Mark get_type() functions
	generated by bunnylib-mkenums as const.

	* bdk/bdkvisual.h (bdk_visual_get_type): 
	* bdk/bdkscreen.h (bdk_screen_get_type): 
	* bdk/bdkinput.h (bdk_device_get_type): 
	* bdk/bdk.h (bdk_rectangle_get_type): 
	* bdk/bdkfont.h (bdk_font_get_type): 
	* bdk/bdkevents.h (bdk_event_get_type): 
	* bdk/bdkdrawable.h (bdk_drawable_get_type): 
	* bdk/bdkdisplay.h (bdk_display_get_type): 
	* bdk/bdkcursor.h (bdk_cursor_get_type): 
	* bdk/bdkcolor.h (bdk_color_get_type): Mark as const.

	* bdk/bdk.symbols: 
	* bdk/Makefile.am (stamp-bdkenumtypes.h): Mark get_type() functions
	generated by bunnylib-mkenums as const.

	* btk/btktextview.c (btk_text_view_move_iter_by_lines): Return
	a boolean indicating whether we could do the requested move.
	(btk_text_view_move_cursor_internal): For BTK_MOVEMENT_DISPLAY_LINES,
	move to the beginning/end of the line if we're on the first/last
	line.  (#155891, Paolo Borelli)

	* btk/btktextlayout.c (btk_text_layout_move_iter_to_previous_line): 
	Don't move the iter and return FALSE if trying to move up from
	the first line.

2004-11-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaction.c (closure_accel_activate): Don't claim to have
	handled the accelerator if the action is insensitive.  (#151541,
	Jody Goldberg)

	* docs/tools/widgets.c: Add a combo box.

2004-11-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcolorsel.c (key_press): Implement keynav for the color
	picker (only on X11 currently, since BDK doesn't support pointer 
	warping). Space and Return pick a color, Esc cancels the picking, 
	arrow keys move the pointer by single pixels, Alt-arrow combinations 
	move the pointer by 20 pixels.  (#135385, Frances Keenan)

Sat Nov 27 15:18:14 2004  Manish Singh  <yosh@gimp.org>

	* contrib/bdk-pixbuf-xlib/bdk-pixbuf-xlib-drawable.c
	(rgb565amsb, rgb555msb): make proper casts in big endian cases.

2004-11-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_set_model): Check column types on the
	new model, and check them all.  (#159389, Olivier Andrieu)
	(btk_icon_view_set_model): Queue a layout. (#159436, Olivier Andrieu)

	* bdk/x11/bdkselection-x11.c (bdk_text_property_to_utf8_list_for_display): 
	Don't crash if Xlib fails to return UTF-8. (#159373, Kristian Høgsberg) 

Thu Nov 25 14:32:35 2004  Manish Singh  <yosh@gimp.org>

	* bdk/abicheck.sh
	* btk/abicheck.sh: filter out G_GNUC stuff when doing the compare.

	* btk/btkmenuitem.c (btk_menu_shell_button_release): add
	BTK_MENU_ITEM() cast.

2004-11-25  Kjartan Maraas  <kmaraas@bunny.org>

	* configure.in: Add forgotten «nb» to ALL_LINGUAS.
	* po-properties/nb.po: Update
	* po/nb.po: Update

2004-11-24  Matthias Clasen  <mclasen@redhat.com>

	Open submenus on click.  (#128968, Martin Jeppesen)
	
	* btk/btkmenushell.c (btk_menu_shell_button_release): Don't
	activate items with submenus after the timeout, just select 
	them.

	* btk/btkmenuitem.c (btk_real_menu_item_select): Make
	submenus popup immediately on click, regardless of popup 
	delay.

2004-11-23  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Rework confusing error message.  (#151742,
	Stepan Kasal)

2004-11-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.h (btk_ui_manager_get_type): 
	* btk/btktreeview.h (btk_tree_view_get_type): 
	* btk/btktreeviewcolumn.h (btk_tree_view_column_get_type): 
	* btk/btktreestore.h (btk_tree_store_get_type): 
	* btk/btktreeselection.h (btk_tree_selection_get_type): 
	* btk/btktreemodelfilter.h (btk_tree_model_filter_get_type): 
	* btk/btktreemodel.h (btk_tree_iter_get_type): 
	(btk_tree_path_get_type):
	(btk_tree_row_reference_get_type):
	* btk/btktoolitem.h (btk_tool_item_get_type): 
	* btk/btktoolbutton.h (btk_tool_button_get_type): 
	* btk/btktoggleaction.h (btk_toggle_action_get_type): 
	* btk/btkthemes.h (btk_theme_engine_get_type): 
	* btk/btktextiter.h (btk_text_iter_get_type): 
	* btk/btksettings.h (btk_settings_get_type): 
	* btk/btkselection.h (btk_selection_data_get_type): 
	* btk/btkradioaction.h (btk_radio_action_get_type): 
	* btk/btkmenutoolbutton.h (btk_menu_tool_button_get_type): 
	* btk/btkliststore.h (btk_list_store_get_type): 
	* btk/btkiconview.h (btk_icon_view_get_type): 
	* btk/btkicontheme.h (btk_icon_info_get_type): 
	* btk/btkiconfactory.h (btk_icon_factory_get_type): 
	(btk_icon_set_get_type):
	(btk_icon_source_get_type):
	* btk/btkfilesystemwin32.h (btk_file_system_win32_get_type): 
	* btk/btkfilesystemunix.h (btk_file_system_unix_get_type): 
	* btk/btkfilesystem.h (btk_file_folder_get_type):
	(btk_file_info_get_type, btk_file_path_get_type):
	(btk_file_system_get_type):
	* btk/btkfilefilter.h (btk_file_filter_get_type): 
	* btk/btkfilechooserwidget.h (btk_file_chooser_widget_get_type): 
	* btk/btkfilechooser.h (btk_file_chooser_get_type): 
	* btk/btkfilechooserdialog.h (btk_file_chooser_dialog_get_type): 
	* btk/btkexpander.h (btk_expander_get_type): 
	* btk/btkentrycompletion.h (btk_entry_completion_get_type): 
	* btk/btkcombobox.h (btk_combo_box_get_type): 
	* btk/btkcomboboxentry.h (btk_combo_box_entry_get_type): 
	* btk/btkclipboard.h (btk_clipboard_get_type): 
	* btk/btkcellview.h (btk_cell_view_get_type): 
	* btk/btkcellrenderertoggle.h (btk_cell_renderer_toggle_get_type): 
	* btk/btkcellrenderertext.h (btk_cell_renderer_text_get_type): 
	* btk/btkcellrendererprogress.h (btk_cell_renderer_progress_get_type): 
	* btk/btkcellrendererpixbuf.h (btk_cell_renderer_pixbuf_get_type): 
	* btk/btkcellrenderercombo.h (btk_cell_renderer_combo_get_type): 
	* btk/btkcelllayout.h (btk_cell_layout_get_type):
	* btk/btkactiongroup.h (btk_action_group_get_type): 
	* btk/btkaction.h (btk_action_get_type): 
	* btk/btkaccessible.h (btk_accessible_get_type): 
	* btk/btkaccelmap.h (btk_accel_map_get_type): 
	* btk/btkaccelgroup.h (btk_accel_group_get_type): 
	* btk/btkmessagedialog.h (btk_message_dialog_get_type): Mark as const.  

	* btk/btkicontheme.h:  Don't mark btk_icon_theme_error_quark() 
	as const, to be consistent with all the other error_quark 
	functions. (technically they are const, but since these are 
	called only in error paths, giving the compiler better 
	optimization opportunities doesn't matter much)

	* btk/btk.symbols:
	* bdk/bdk.symbols: Add attribute annotations.

	* btk/makebtkalias.pl: 
	* bdk/makebdkalias.pl: Keep attribute annotations, but strip PRIVATE.
	
	* btk/Makefile.am (btk.def): 
	* bdk/Makefile.am (bdk.def): Strip attribute annotations, but keep 
	PRIVATE.

2004-11-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktoolbar.c (btk_toolbar_set_icon_size): Add a deprecation
	note.

	* bdk/bdkevents.c (bdk_event_get_root_coords): Handle scroll
	events.  (#159098, Felipe Heidrich)

2004-11-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmenuitem.c (btk_menu_item_paint): Make the size of 
	the arrow depend only on the font size, not on the child 
	allocation.  (#131345, Morten Welinder)

	* configure.in: Require Bango 1.7.0 for BangoRenderer (#159061,
	Crispin Flowerday)
	
2004-11-21  Sven Neumann  <sven@gimp.org>

	* btk/btkwidget.c (btk_widget_create_bango_context): removed call
	to bdk_bango_context_set_colormap() which isn't needed any longer.

2004-11-21  Hans Breuer  <hans@breuer.org>

	* bdk/makefile.msc.in btk/stock-icons/makefile.msc 
	  btk/makefile.msc.in demos/btk-demo/makefile.msc.in : updated

	* bdk/win32/bdkdrawable-win32.c : implement bdk_win32_draw_glyphs_transformed()
	* bdk/win32/bdkgc-win32.c : implement _bdk_windowing_gc_get_foreground()

	* demos/btk-demo/rotated_text.c : use G_PI

Sat Nov 20 15:13:51 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/bdkbango.[ch]: Add BdkBangoRenderer, a subclass of 
	BangoRenderer targeting BDK drawables. Use to implement the old
	bdk_draw_layout() and friends.

	* bdk/bdkdraw.c bdk/bdkdrawable.h bdk/bdkwindow.c bdk/bdkpixmap.c:
	Add bdk_draw_glyphs_transformed() bdk_draw_trapezoids() and
	the corresponding members of BdkDrawableClass. Add a fallback
	implementation of bdk_draw_trapezoids() in terms of pixbufs.

	* bdk/bdkwindowing.h bdk/x11/bdkg-x11.h: Add 
	_bdk_windowing_gc_get_foreground() to enable the fallback 
	trapezoid implementation.

	* bdk/x11/bdkdrawable-x11.c bdk/x11/bdkdisplay-x11.h: Implement 
	draw_glyph_transformed,	draw_trapezoids.

	* bdk/x11/bdkdrawable-x11.[ch]: Add 
	_bdk_x11_drawable_draw_xtrapezoids, _bdk_x11_drawable_draw_xft_glyphs
	for use of BdkX11Renderer.

	* bdk/x11/bdkgc-x11.c bdk/x11/bdkprivate-x11.h: Implement
	BDK_TILED, BDK_STIPPLED, BDK_OPAQUE_STIPPLED in the RENDER codepath.

	* bdk/bdkbango-x11.c: Add BdkX11Renderer... a subclass of 
	BangoXftRenderer that does tiles/stipples and fallback rendering
	of trapezoids without the RENDER extension.

	* bdk/bdkbango-x11.c bdk/x11/bdkscreen-x11.[ch] _bdk_x11_renderer_get:
	Add _bdk_x11_renderer_get() to get a singleton BdkX11Renderer
	for the screen.

	* bdk/x11/bdkdrawable-x11.c (get_impl_drawable): Fix a None/NULL
	confusion.

	* btk/btklabel.[ch] btk/btk.symbols: Add btk_label_set/get_angle(),
	and an ::angle property.

	* btk/btklabel.c: Remove #if 0'd dead code btk_label_paint_word().

	* btk/btktextdisplay.c: Switch to using a BtkTextRenderer subclass
	of BdkBangoRenderer for drawing.

	* btk/btktextlayout.[ch] btk/btktextdisplay.c: Switch to using
	btk_attr_shape_new_with_data() to store backreferences to 
	embedded pixmaps and widgets. Leave line_display->shaped_objects
	around for backwords compatibility.

	* bdk/bdkbango.[ch] (bdk_bango_context_set_colormap): Describe
	as deprecated, remove implementation.

	* btk/btkwidget.c (btk_widget_create_bango_context): Remove
	call to bdk_bango_context_set_colormap.

	* demos/btk-demo/Makefile.am demos/btk-demo/rotated_text.c: Add
	a demo showing drawing rotated text.

	* tests/testbtk.c: Add a rotated-label test, and also a rotated
	drawing test (differs from demos/btk-demo/rotated_text by also
	using a tile)
	
2004-11-21  Sven Neumann  <sven@gimp.org>

	* configure.in: talk about TIFF loader, not TIFF plug-in.

2004-11-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btk.symbols: 
	* btk/btkdialog.h: 
	* btk/btkdialog.c (btk_dialog_set_alternative_button_order_from_array): 
	Provide a non-varargs variant of btk_dialog_set_alternative_button_order()
	for language bindings.  (#158798, John Finlay)
	
2004-11-20  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	* btk/btkfilechooserdefault.c (list_icon_data_func): Set an empty
	icon if we are on the editable row:  if we don't set the cell
	renderer at all, it will reuse the last thing it painted.

2004-11-19  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	Fix #158475:

	* btk/btkpathbar.c (make_directory_button): Make the button a drag
	source.
	(button_drag_data_get_cb): New callback to let us drag the
	button's path as a text/uri-list.

2004-11-19  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	Fix #141077.  Based on a patch by Christian Neumair <chris@bunny-de.org>:

	* btk/btkfilechooserdefault.c (new_folder_button_clicked):
	Desensitize the "new folder" button.
	(edited_idle_cb): Sensitize the button back.

2004-11-19  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	Fix #158477:

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	Remove the "save_extra_align" and "browse_extra_align" fields; use
	a single "extra_align" field.
	(save_widgets_create): Don't create the save_extra_align.
	(browse_widgets_create): Don't create the browse_extra_align.
	(btk_file_chooser_default_constructor): Create the extra_align
	here.
	(set_extra_widget): Add the extra widget to the alignment here,
	and remove the old one if necessary.
	(update_appearance): No need to frob the extra widget's alignments
	anymore.
	(btk_file_chooser_default_set_property): No need to call
	update_appearance() anymore when we set the extra widget.

2004-11-19  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_initial_focus): Don't set the cursor if
	we are still loading.

2004-11-18  Federico Mena Quintero  <federico@ximian.com>

	Merged from btk-2-4:

	Fixes #155744:

	Try to load the whole file system model within a specified time.

	* btk/btkfilechooserdefault.c (set_list_model): Don't create and
	set the sort model here.  Instead, set up a timer in which we'll
	try to load the file system model.
	(load_set_model): Create and set the sort model here.
	(load_setup_timer): New function to set up a timer and switch to
	the LOAD_LOADING state.
	(load_remove_timer): New function to unset the timer and switch to
	the LOAD_FINISHED state.
	(browse_files_model_finished_loading_cb): Remove the timer if
	needed and set the file system and sort model; switch to the
	LOAD_FINISHED state.
	(btk_file_chooser_default_finalize): Remove the load timer.
	(btk_file_chooser_default_init): Start in the LOAD_FINISHED state.

Fri Nov 19 15:18:51 2004  Manish Singh  <yosh@gimp.org>

	* modules/engines/ms-windows/msw_rc_style.c
	* modules/engines/ms-windows/msw_style.c
	* modules/engines/ms-windows/msw_theme_main.c
	* modules/engines/pixbuf/pixbuf-main.c
	* modules/engines/pixbuf/pixbuf-rc-style.c
	* modules/input/btkimcontextime.c
	* modules/input/btkimcontextxim.c
	* modules/input/imam-et.c
	* modules/input/imcedilla.c
	* modules/input/imcyrillic-translit.c
	* modules/input/iminuktitut.c
	* modules/input/imipa.c
	* modules/input/imthai-broken.c
	* modules/input/imti-er.c
	* modules/input/imti-et.c
	* modules/input/imviqr.c
	* tests/prop-editor.c
	* tests/testentrycompletion.c
	* tests/testfilechooser.c
	* tests/testmerge.c
	* tests/testtoolbar.c
	* tests/testtreecolumns.c
	* tests/testtreeview.c: get rid of unnecessary casts.

	* tests/testbtk.c (create_labels): add BTK_LABEL() casts for
	btk_label_set_ellipsize() calls.

	* tests/testicontheme.c (main): remove unused pixbuf variable.

Fri Nov 19 14:54:09 2004  Manish Singh  <yosh@gimp.org>

	* bdk/linux-fb/bdkgc-fb.c
	* bdk/win32/bdkgc-win32.c
	* bdk/win32/bdkwindow-win32.c
	* btk/btkaboutdialog.c
	* btk/btkaction.c
	* btk/btkactiongroup.c
	* btk/btkcellrendererprogress.c
	* btk/btkcellview.c
	* btk/btkcolorbutton.c
	* btk/btkcombobox.c
	* btk/btkcomboboxentry.c
	* btk/btkentrycompletion.c
	* btk/btkfilechooserbutton.c
	* btk/btkmenutoolbutton.c
	* btk/btkrc.c
	* btk/btksettings.c
	* btk/btkstyle.c
	* btk/btktoggletoolbutton.c
	* btk/btktoolbutton.c
	* btk/btktoolitem.c
	* btk/btktreemodelfilter.c
	* btk/btktreeselection.c
	* btk/btktreeviewcolumn.c
	* btk/btkuimanager.c: get rid of unnecessary casts.

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_set_property):
	cast away the const for b_value_set_enum. This is after the g_warning,
	so this is a hack to begin with.

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_set_property):
	add a cast to BTK_FILE_CHOOSER for impl here.

Fri Nov 19 14:52:42 2004  Manish Singh  <yosh@gimp.org>

	* autogen.sh: rm autom4te.cache, since it might interfere with
	differing autoconf versions.

2004-11-19  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "rw" to ALL_LINGUAS.

2004-11-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaboutdialog.c (btk_about_dialog_set_email_hook) 
	(btk_about_dialog_set_url_hook): Destroy the correct 
	data.  (#158522, John Finlay)

2004-11-16  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Use bmodule-no-export-2.0.pc, require bunnylib 2.5.7
	(#125627, Owen Taylor)

2004-11-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbutton.c: Don't return a relief when a 
	widget is expected.  (#158470, Kazuki IWAMOTO)

Tue Nov 16 19:44:26 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkevents-x11.c bdk/x11/bdkim-x11.c bdk/x11/bdkwindow-x11.c: 
	More strict aliasing warning suppressage.

Tue Nov 16 19:26:30 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkdnd-x11.c (_bdk_drag_get_protocol_for_display): 
	Squash strict aliasing warnings. 

2004-11-17  Davyd Madeley  <davyd@madeley.id.au>

	* btk/btkfilechooserdefault.c: Allow backspace to move up the
	FileChooser tree to make it consistent with Nautilus and others.

2004-11-16  Matthias Clasen  <mclasen@redhat.com>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): Fix a 
	copy-and-paste error.  (#158459) 

	* demos/btk-demo/*.c: Don't include config.h in the examples.

Tue Nov 16 00:08:07 2004  Jonathan Blandford  <jrb@redhat.com>

	* docs/tools/widgets.c: Update so that toplevel windows accomodate
	for the titlebar when sizing.  Also clean up statusbar

	* docs/reference/btk/images/*png: update

2004-11-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrenderertext.c (get_layout): Don't use the foreground
	color for selected cells, Don't use the background color
	in unfocused selected cells. Also avoid creating two BangoLayouts
	per render call.  (#154615, #154611, Billy Biggs)

Mon Nov 15 19:02:07 2004  Manish Singh  <yosh@gimp.org>

	* bdk/abicheck.sh
	* btk/abicheck.sh: don't hardcode lengths for cut, instead split on
	the third field.

2004-11-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkselection.c: Reduce the clipboard timeout from 300
	seconds to 30 seconds.  (#155428, Billy Biggs)

	* btk/btkimagemenuitem.c (btk_image_menu_item_setting_changed): 
	* btk/btkbutton.c (btk_button_setting_changed): Really free the
	list.  (#158422, Morten Welinder)

2004-11-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkimagemenuitem.c (btk_image_menu_item_screen_changed) 
	* btk/btkbutton.c (btk_button_screen_changed): Use 
	BPOINTER_TO_UINT()/BUINT_TO_POINTER() for buints.  (#158420,
	Morten Welinder)

Mon Nov 15 17:17:17 2004  Manish Singh  <yosh@gimp.org>

	* configure.in: Output Makefile for the pixbuf engine directory.

	* btk/btk.symbols: Add btk_button_{get,set}_image.

	* modules/engines/pixbuf/pixbuf-render.c: Replace usage of deprecated
	functions.

	* modules/engines/pixbuf/pixbuf-draw.c: undef BDK_DISABLE_DEPRECATED
	for bdk_draw_string (ick).

2004-11-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbutton.[hc]: Add a BtkButton::image property with setter 
	and getter, which allows to construct stock-like buttons with 
	custom images and/or text.  (#62466, Jonathan Blandford, patch by
	Matthias Clasen)

	* btk/btkimagemenuitem.c (btk_image_menu_item_set_image): Add 
	some more docs.

Mon Nov 15 14:25:21 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeviewcolumn.c (_btk_tree_view_column_cell_set_dirty):
	Patch from Gavin Romig-Koch <gavin@redhat.com> to no longer reset
	the resized_width when marking a column dirty.

2004-11-15  Matthias Clasen  <mclasen@redhat.com>

	* modules/engines/Makefile.am (SUBDIRS): Add pixbuf.

	* btk/btkbutton.c: 
	* btk/btkimagemenuitem.c: Don't use one signal handler per
	instance to track changes to the btk-menu-images and
	btk-button-images settings. Instead use a single handler which 
	iterates over the widget hierarchy. (#143668)

	* btk/btktreemodel.c (btk_tree_path_prev): Return FALSE if
	depth is 0 (noticed by Tim Janik)

2004-11-15 Erwann Chenede - <erwann.chenede@sun.com>

	* btk/btkfilesel.c: fix unselect in multiple selection (#156805)

2004-11-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c: Include btkdnd.h  (#158243, Kazuki IWAMOTO)

2004-11-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkspinbutton.c (btk_spin_button_new_with_range): Allow
	min == max.  (#158225, Vasco Alexandre da Silva Costa)

2004-11-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_class_init): Add more docs.

	* btk/btkfilefilter.c (btk_file_filter_filter): Fix typo in
	docs.

	* btk/btklabel.c (btk_label_do_popup): Adjust to the current
	entry popup menu.
	(btk_label_button_press, btk_label_button_release) 
	(btk_label_drag_data_get): Implement DND for selectable labels.

	Make BDK+ compile with X11R5 (#148032)
	
	* bdk/x11/xsettings-client.c (xsettings_client_new): 
	* bdk/x11/bdkproperty-x11.c (_bdk_x11_precache_atoms): Only
	use XInternAtoms if it is available.

	* bdk/x11/bdkasync.c: Include XIproto.h if necessary.

	* configure.in: Check for XInternAtoms and X headers needed for
	xReply.
	
	* configure.in: Bump version.

	* === Released 2.5.5 ===
	
	* btk/btkwindow.c (btk_window_activate_key_after): Add parentheses 
	around comparison in operand of &.

	* btk/btkcalendar.c: Replace a non-ASCII character in a comment.

2004-11-12  Matthias Clasen  <mclasen@redhat.com>

	* tests/Makefile.am (pixbuf_threads_LDADD): Make pixbuf-threads
	link.

	* NEWS: Updates

2004-11-12  Matthias Clasen  <mclasen@redhat.com>

	* tests/Makefile.am: Add pixbuf-threads

	* tests/pixbuf-threads.c: Test loading images in multiple
	threads.

2004-11-11  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Check for uxtheme.h  (#157967, J. Ali Harlow)

	* modules/engines/ms-windows/xp_theme.c: Use HAVE_UXTHEME_H
	to protect the #include <uxtheme.h> 

	* docs/tools/Makefile.am: Don't try to build doc-shooter on 
	Windows.  (#157979, J. Ali Harlow) 

	* btk/btkfilefilter.c: Don't try to use xdgmime on 
	Windows where we don't build it.   (#157944, J. Ali Harlow)

	* btk/btkstatusbar.c (btk_statusbar_size_allocate): Also
	reserve space for the resize grip if the grip_window is not
	realized yet.  (#158010, Christian Persch)
	(btk_statusbar_button_press): Only start a resize if the
	button press comes from the grip_window.  (#158011, Christian Persch)

2004-11-11  Tor Lillqvist  <tml@iki.fi>

	Fix for #137551, by Robert Ögren:

	* bdk/win32/bdkevents-win32.c (generate_focus_event): New function.

	(bdk_keyboard_grab, bdk_keyboard_ungrab): Generate focus change
	events.
	
	(bdk_event_translate): Check for keyboard grabs and not pointer
	grabs when handling WM_{SET,KILL}FOCUS. Use generate_focus_event().

2004-11-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (update_node): Remove two more places
	where we were unconditionally setting "visible", causing
	unnecessary notifications.
	(update_node): Fix some C99isms.

	* btk/btkclipboard.c (btk_clipboard_get_for_display): 
	(btk_clipboard_get): Clarify the docs.  (#156638, Torsten 
	Schoenfeld)
	(btk_clipboard_finalize): Warn if the clipboard is still in
	its displays clipboard list.

	Considerably speed up BtkUIManager, by changing the semantics
	of the dirty flag. It is now propagated up the tree, and
	update_node() doesn't descend into clean subtrees.  (#143668,
	Dave Neary, Michael Natterer, Sven Neumann, fix proposed
	by Soeren Sandmann)
	
	* btk/btkuimanager.c (node_prepend_ui_reference): Only prepend 
	a new node reference if the merge_id is different. Take a GNode,
	so we can walk up the tree, adjust all callers. 
	(node_remove_ui_reference): Only mark a node dirty if the first 
	ui reference is removed. Take a GNode here as well for 
	consistency. 
	(update_node): Don't descend into clean subtrees.
	(mark_node_dirty): New function to mark a node and its 
	predecessors dirty.

Thu Nov 11 11:34:32 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkfilechooserbutton.c (update_idler): return FALSE instead
	of TRUE.  This is just a quick fix to prevent the idle from
	looping indefinitely.

2004-11-11  J. Ali Harlow  <ali@juiblex.co.uk>

	* bdk/Makefile.am:
	* bdk-pixbuf/Makefile.am:
	* btk/Makefile.am (btk.def): Use embedded tab rather than '\t'
	escape sequence. (#157949)

2004-11-10  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (_bdk_win32_get_next_tick): 
	Event timestamps don't have to be unique. As long as they are
	nondecreasing we should be fine. Solves problems with for instance
	long menus not staying up on first click. (#152035, Robert Ögren)

2004-11-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkstatusbar.c (btk_statusbar_size_allocate): Only
	shorten the label if it actually overlaps the resize grip.
	(btk_statusbar_size_allocate): Handle extra children
	by leaving room for the resize grip.  (#157778, Christian Persch)

	* bdk/linux-fb/*: Fix many sparse warnings.  (#157253,
	Kjartan Maraas).
	
	* NEWS: Updates

2004-11-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrange.c (btk_range_real_change_value): Make 
	power a double.
	(btk_range_class_init): s/digits/decimal digits/ in doc 
	comment.

	* btk/btkfilechooserbutton.c (update_idler): Remove debugging
	printfs. 

	* btk/btkicontheme.[ch]: Improve the docs.  (#157785,
	Torsten Schoenfeld)

	* bdk/x11/bdkwindow-x11.c (bdk_window_get_geometry): Add
	a hint about using bdk_drawable_get_size() instead.

	* btk/btk.symbols: Add new symbols.

	* btk/btkiconview.c (btk_icon_view_scroll_to_item): Make
	it work with *big* icon views.  (#154466)

	* tests/testiconview.c: Add a real "Add many" button.

	* btk/btkaction.[hc]: 
	* btk/btkactiongroup.[hc]: Make return types G_CONST_RETURN
	instead of const.

	* btk/btk.symbols: 
	* btk/btkaction.h: 
	* btk/btkaction.c (btk_action_get_accel_path): Add
	a function to obtain the accel path of an action. (#148106,
	Michael Natterer)

	* tests/testiconview.c: Fix double-click activation.

	* btk/btkstatusbar.c (btk_statusbar_init): Raise the grip
	window when appropriate.
	(btk_statusbar_init): Instead of cutting the text off, make
	ellipsize the label.
	(btk_statusbar_size_allocate): Don't let the label extend
	under the resize grip.

	* btk/btkcombobox.c (find_menu_by_path) 
	(btk_combo_box_menu_fill_level, btk_combo_box_menu_row_inserted): 
	Use a row reference, not a path, to associate separators
	with their tree row.  
	
	* btk/btkstatusbar.c (btk_statusbar_set_has_resize_grip): 
	Show the grip_window if necessary.  

	* btk/btkstyle.c (btk_default_draw_resize_grip): Only
	clear the triangle below the grip to the background,
	not the full area. 

	* btk/btklabel.c (draw_insertion_cursor, btk_label_expose): 
	Clip when drawing the cursor. This prevents bits of a
	selectable label leaking out from underneath the resize
	grip in a statusbar.  (#73359)

	* btk/btkstatusbar.c: Apply a patch by Owen Taylor to
	get reasonable allocations for the statusbar and its
	children.  (#73359)

	* tests/testbtk.c: Apply a patch by Soeren Sandmann to 
	test long statusbar texts.

	* btk/btk.symbols: Add new symbols.

	Avoid resizing BtkStatusbar if the text of the label 
	changes  (#90955, He Qiangqiang, fix proposed by 
	Owen Taylor, patch by Christian Persch)
	
	* btk/btklabel.[hc]: Add a boolean single-line-mode property 
	which causes the label height not to depend on the actual
	text, but only on the font.

	* btk/btkstatusbar.c (btk_statusbar_init): Turn on
	single-line-mode for the label.

2004-11-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilefilter.c (btk_file_filter_filter): Use 
	xdg_mime_mime_type_subclass() to match mime types. This
	also gives use wildcard matching. (#143760, #141224, 
	Tommi Komulainen, David A Knight)

	* btk/btkaction.c (_btk_action_sync_menu_visible): Use 
	btk_widget_{hide,show} instead of g_object_set (..."visible"...).

	* tests/testfilechooserbutton.c (main): Disable the SAVE 
	and CREATE_FOLDER modes.  (#157675, Christian Persch)

	* btk/btkaboutdialog.c (btk_about_dialog_set_website): Hide the
	website button if the url is unset.  (#157630, John Finlay)

	* btk/btkaboutdialog.[hc]: Change the return types of the 
	bchar ** getters to be more const correct.  (#157566, Mariano 
	Suárez-Alvarez)

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_init): Add
	uri targets before text targets, to make file dnd work 
	better.  (#157651, Christian Persch)

	* btk/btktreedatalist.c: Support columns whose declared type is
	an interface better, by treating them like B_TYPE_OBJECT if
	the interface types requires B_TYPE_OBJECT.

2004-11-08  Bastien Nocera  <hadess@hadess.net>

	* btk/stock-icons/stock_media_play_rtl_16.png:
	* btk/stock-icons/stock_media_play_rtl_24.png: add the icons again
	with the binary flag (Closes: #157665)

2004-11-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilefilter.h:
	* btk/btkfilefilter.c (btk_file_filter_add_pixbuf_formats): 
	New convenience function to add a filter for image files
	which can be loaded by BdkPixbuf. (#145388, Anders Carlsson)

	* tests/testfilechooser.c: Test the image filter.
	
	* btk/btkmenu.c (menu_change_screen): Remove some warnings.

	Show files in folder modes. (#157013, Nickolay V. Shmyrev)
	
	* btk/btkfilechooserdefault.c (create_file_list): Use a selection
	function to determine which rows can be selected.
	(update_appearance): Always show files. Also queue a redraw.
	(set_list_model): Always show files.
	(list_select_func): The selection function used for the file list.
	Don't allow to select files when in select/create folder mode.
	(list_row_activated): Don't activate files in folder modes.
	(list_icon_data_func, list_mtime_data_func, list_size_data_func): 
	Render files insensitive in folder modes.

2004-11-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_set_property): 
	Don't support CREATE_FOLDER and SAVE for now. UI authorities
	object to it.  (#157384, Seth Nickell)

	* btk/btkfilechooserdefault.c (file_pane_create): Jump through
	a few hoops to make the tooltip on the filter combo box work
	a bit better. This fixes #157273 and #157074.

	* btk/btkcombobox.c (btk_combo_box_cell_layout_pack_end): 
	Add the ComboCellInfo to the list.  (#157528, Carlos Garnacho
	Parro)

2004-11-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_menu_button_state_changed):
	Remove this unneeded function, as it breaks state propagation.

	* btk/btktearoffmenuitem.c (btk_tearoff_menu_item_activate): 
	Queue the resize before setting the tearoff state, to 
	make sure the torn-off menu picks up the size increase due
	to the arrow in the torn off menu item.  (#157286, Adam
	Hooper, fix proposed by Owen Taylor)

	* btk/btkmenu.c (menu_change_screen): Don't unnecessarily
	call btk_menu_position(), since that function has issues
	when called on a menu whose parent is unrealized.  (#157354,
	Adam Hooper)

	* btk/btkmain.c: Document new functions.

2004-11-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/stock-icons/Makefile.am: Typo fix.

	* btk/btkaboutdialog.c: Documentation updates.

2004-11-04  Bastien Nocera  <hadess@hadess.net>

	* btk/btkiconfactory.c: (get_default_icons): Make sure the RTL
	variants are used for media icons
	* btk/stock-icons/Makefile.am: update following the addition of
	the 2 Play icon RTL variants
	* btk/stock-icons/stock_media_play_rtl_16.png: added
	* btk/stock-icons/stock_media_play_rtl_24.png: added

2004-11-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (new_folder_button_clicked): 
	Don't leak the path.  (#157301, Carlos Garnacho Parro)

	* bdk/x11/bdkdnd-x11.c (bdk_drag_motion): Handle the 
	case that the protocol version in the context is not 
	set yet.  (#157123, James Henstridge)

	* btk/btktreeview.c (btk_tree_view_search_activate): Don't
	try to activate a node if the cursor is not valid.  

2004-11-03  James M. Cape  <jcape@ignore-your.tv>

	* btk/btkfilechooserbutton.c (update_dialog), (dialog_response_cb):
	Don't mysteriously go to the parent dir when hitting "Cancel" in
	folder mode (fixes #156971).

2004-11-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaccellabel.c (btk_accel_label_expose_event): Don't
	access label->layout directly.  (#157080, Adam Hooper)

	* btk/btklabel.c (btk_label_set_pattern_internal): Allow
	unsetting a pattern by passing NULL.  (#156720, Tristan Van Berkom)

	* btk/btkcombobox.c (btk_combo_box_get_active): Don't crash 
	if the active_row reference has become invalid.  (#157156,
	Christophe Fergeau)
	
2004-11-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwindow.c (btk_window_activate_key_after): As
	a last stage in BtkWindow key press handing, try adding
	window->mnemonic_modifier to event->state and see if it
	matches a mnemonic. (#53709, based on a patch by
	Pasupathi Duraisamy, patch by Owen Taylor)

	* btk/btkcellrenderercombo.c (btk_cell_renderer_combo_class_init): 
	Doc additions.

	* btk/btkfilechooserbutton.h: Fix trigraphs in private markers.

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_class_init): 
	Fix a doc comment.

2004-11-01  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Remove a debug printf().  (#157087, Christian Persch)

	* btk/btkicontheme.c: Actually commit the "stat less" patch
	which appeared in the ChangeLog a few days ago.

	* btk/btkfilechooserbutton.c: Move some docs inline.

	* btk/btkaboutdialog.c (btk_show_about_dialog): Doc update.

	* btk/btktextbuffer.c (btk_text_buffer_backspace): Revalidate the
	iter.  (#156924, Murray Cumming)

	* bdk/x11/bdkevents-x11.c (bdk_wm_protocols_filter): Don't crash on
	broken ClientMessage events.  (#157056, Owen Taylor)

	* btk/btkactiongroup.c (btk_action_group_get_visible): Fix a typo in
	the docs.  (#157044, Masao Mutoh)

2004-10-31  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_button_state_changed): Update the
	state of the cell view when the state of the button changes (to 
	get prelighted drawing right).  (#138650, Frances Keenan, 
	Christian Persch)

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Don't force the height of the action area, we don't scroll 
	it anyway, and the current way of calculating the height can lead
	to broken display.  (#156573, Christian Persch)

	* tests/testentrycompletion.c (animation_timer): Don't try to
	remove stuff from an empty model.  (#156575, Christian Persch)

	* btk/btkentrycompletion.c (btk_entry_completion_class_init): 
	* btk/btkcellrenderercombo.c (btk_cell_renderer_combo_class_init): 
	Update doc comments.

2004-10-31  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkprivate-win32.h
	* bdk/win32/bdkglobals-win32.c
	* bdk/win32/bdkmain-win32.c: Remove _windows_version and the
	IS_WIN_NT() macro.

	* bdk/win32/*.c: Use G_WIN32_IS_NT_BASED() from GLib instead.

2004-10-31  Matthias Clasen  <mclasen@redhat.com>

	Add api for image transfer via copy-and-paste (#156408)
	
	* btk/btkclipboard.c (btk_clipboard_set_image) 
	(btk_clipboard_request_image, btk_clipboard_wait_for_image) 
	(btk_clipboard_wait_is_image_available): New functions for image
	transfer.

	* btk/btkselection.h:
	* btk/btkselection.c (btk_selection_data_targets_include_image): 
	New function, similar to btk_selection_data_targets_include_text().

	* btk/btkprogressbar.[hc]: Add an ellipsize property with 
	getter and setter.  (#156845, Morten Welinder)

2004-10-29  Robert Ögren  <btk@roboros.com>

	* bdk/win32/bdkwindow-win32.c (bdk_window_begin_resize_drag),
	(bdk_window_begin_move_drag): Implement these on win32, currently
	only for button 1. Fixes the resize grip of BtkStatusbar on 
	win32. (#143285)

2004-10-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextbtree.c (_btk_text_btree_select_range): Redisplay
	the new selection.

	* btk/btktextview.c (btk_text_view_select_all): Use 
	btk_text_buffer_select_range().

	* tests/testtext.c: Add a "Select All" menuitem.  (#156792,
	Paolo Borelli)

	* btk/btkicontheme.c (insert_theme): Sort the dir_mtimes 
	list in the same way as the search path.
	(theme_subdir_load): Avoid stat()ing subdirs if the theme 
	directory doesn't exist.  (#156866)

2004-10-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_finalize): 
	Drop the reference to the pixbuf, regardless whether it is
	a stock pixbuf.  (#156863, Philip Langdale)

2004-10-29  Hans Breuer  <hans@breuer.org>

	* bdk/makefile.msc btk/makefile.msc.in : updated

	* bdk/win32/bdkdisplay-win32.c : dummy implementations for
	bdk_display_supports_clipboard_persistence, bdk_display_store_clipboard

	* btk/btkmodules.c : #include "btkprivate.h" for BTK_LIBDIR

2004-10-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkclipboard.c (btk_clipboard_set_text): Don't hardwire
	the supported text targets here, use 
	btk_target_list_add_text_targets().  (#156404)

	* btk/btkliststore.c (btk_list_store_reorder): Don't
	loop over the sentinel node.  (#156298, Torsten Schoenfeld)

2004-10-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_start_editing): Use
	g_signal_connect_object() to prevent premature finalization
	of the cell_editable while the key_press_event signal is
	handled.  (#156325, Olivier Andrieu)

	* *: Clean up many sparse warnings.  (#156698, Kjartan Maraas)
	
	* btk/btktreeview.c (btk_tree_view_remove_widget): Disconnect
	from the remove-widget signal after removing the signal.

	* btk/btkaboutdialog.c (btk_show_about_dialog): Destroy
	the dialog with the parent.  (#156557, Paolo Borelli)

2004-10-27  Matthias Clasen  <mclasen@redhat.com>

	* Bump version

	* === Released 2.5.4 ===

	* Makefile.am (EXTRA_DIST): Remove po/makefile.mingw

2004-10-28  Anders Carlsson  <andersca@bunny.org>

	* btk/btkclipboard.c: (btk_clipboard_set_can_store):
	* btk/btkclipboard.h:
	Make targets const.

2004-10-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/Makefile.am (btkalias.h): 
	* bdk/Makefile.am (bdkalias.h): Fix srcdir != builddir build.
	(#156547, Thomas Fitzsimmons)
	
	* NEWS: Updates.

	* btk/btkclipboard.c (btk_clipboard_set_can_store): Silently
	ignore non-CLIPBOARD clipboards.  (#156610, Christian Persch)

	* btk/btksettings.c: Make it build on windows. (#156618,
	Kazuki IWAMOTO)

2004-10-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkimcontextsimple.c (check_hex): Stop preediting if strtoul 
	couldn't parse the complete preedit string.  (#156434)

	* btk/btkmessagedialog.c: 
	* btk/btkfilechooserbutton.c: Add missing includes.  (#156503, 
	Kazuki IWAMOTO)

	* btk/btkimage.h: 
	* btk/btkimage.c (btk_image_get_icon_name): Make the icon_name 
	parameter G_CONST_RETURN.
	
	* btk/btkimage.c: It is enough to listen for screen changes and 
	style-set to catch all icon theme changes.
	(btk_image_set_property): Reset the image size if the pixel size 
	property is changed.

	* btk/btk.symbols: Add new symbols.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_store_clipboard): Fix the 
	doc comment.

2004-10-26  Anders Carlsson  <andersca@imendio.com>

	* btk/btktextbuffer.c: (btk_text_buffer_finalize),
	(create_clipboard_contents_buffer), (clipboard_get_contents_cb),
	(clipboard_clear_contents_cb), (cut_or_copy):
	Rewrite clipboard handling so that the clipboard contents 
	won't be freed when the text buffer is finalized. Also add 
	clipboard manager support. Fixes #95496.

2004-10-25  Anders Carlsson  <andersca@bunny.org>

	* btk/btkentry.c: (btk_entry_completion_timeout):
	* btk/btkentrycompletion.c: (btk_entry_completion_set_model),
	(btk_entry_completion_get_model), (btk_entry_completion_complete):
	Really handle a NULL model, fixes #137211 for real.

	* btk/btkfilechooserentry.c:
	(btk_file_chooser_entry_maybe_update_directory):
	Remove _clear, #137211 is fixed.

	* tests/testentrycompletion.c: (main):
	Add completion with an empty model.
	
2004-10-25  Carlos Garnacho Parro  <carlosg@bunny.org>

	Fix for #118764, David Bordoley:
	
	* btk/btkmessagedialog.[ch]
	(btk_message_dialog_format_secondary_text),
	(btk_message_dialog_format_secondary_format): API additions to
	create HIG-like dialogs

	* demos/btk-demo/dialog.c: Use the new API in the example

	* docs/reference/btk/btk-sections.txt:
	* docs/reference/btk/tmpl/btkmessagedialog.sgml: documented API
	additions

2004-10-25  James M. Cape  <jcape@ignore-your.tv>

	Rework of BtkFileChooserButton, some cleanups. Fixes #154388,
	#154390, #154390, #156272.

	* docs/reference/btk/btk-docs.sgml: Moved BtkFileChooserButton
	below BtkFileChooser.
	* docs/reference/btk/btk-sections.txt: Added
	btk_file_chooser_button_get_width_chars(),
	btk_file_chooser_button_set_width_chars(),
	btk_label_set_width_chars(), btk_label_get_width_chars().
	* docs/reference/btk/btk.types: Added
	btk_cell_renderer_combo_get_type,
	btk_cell_view_get_type,
	btk_text_iter_get_type.
	* docs/reference/btk/tmpl/btkaboutdialog.sgml: Add
	"logo-icon-name" property.
	* docs/reference/btk/tmpl/btkcellview.sgml: Updates for properties
	(b/c of get_type() inclusion above).
	* docs/reference/btk/tmpl/btkfilechooserbutton.sgml:
	* docs/reference/btk/tmpl/btklabel.sgml: Add "width-chars" property,
	getters/setters.
	* docs/reference/btk/tmpl/btkcellrenderercombo.sgml: Added.
	* btk/btkentrycompletion.c:
	(_btk_entry_completion_popdown): Don't show if the entry isn't
	mapped.
	* btk/btkfilechooserbutton.[c,h]: (*): About 45%
	rewritten, adds "width-chars" property, icons, working save modes,
	volume/Home/Desktop friendly-naming support.
	* btk/btklabel.[c,h]:
	(btk_label_class_init), (btk_label_init),
	(btk_label_get_property), (btk_label_set_property),
	(btk_label_get_width_chars), (btk_label_set_width_chars),
	(btk_label_size_request): Add "width-chars" property.
	* tests/testfilechooserbutton.c: Update, use 4 different buttons for
	the different ACTIONs.
	* btk/.cvsignore: Ignore btk-update-icon-cache.
	* tests/.cvsignore: Ignore testimage.

2004-10-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrenderercombo.c (find_text): Don't leak text. (#156325,
	Olivier Andrieu)

2004-10-25  Anders Carlsson  <andersca@imendio.com>

	* bdk/bdk.symbols: 
	* bdk/bdkdisplay.h:
	* bdk/x11/bdkdisplay-x11.c:
	(bdk_display_supports_clipboard_persistence), 
	(bdk_display_store_clipboard):
	New API to handle the clipboard manager.

	* btk/btk.symbols:
	* btk/btkclipboard.c: (btk_clipboard_class_init),
	(btk_clipboard_finalize), (selection_clear_event_cb),
	(clipboard_unset), (btk_clipboard_set_text),
	(btk_clipboard_request_targets), (btk_clipboard_wait_for_targets),
	(clipboard_peek), (btk_clipboard_owner_change),
	(btk_clipboard_wait_is_target_available),
	(btk_clipboard_store_timeout), (btk_clipboard_set_can_store),
	(btk_clipboard_selection_notify), (btk_clipboard_store),
	(_btk_clipboard_store_all):
	* btk/btkclipboard.h:
	Add API for clipboard persistence and implement it, also add
	btk_clipboard_wait_is_target_available.
	
	* btk/btkmain.c: (btk_main):
	Call _btk_clipboard_store_all before exiting.
	
2004-10-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaboutdialog.h: 
	* btk/btkaboutdialog.c (btk_about_dialog_set_logo_icon_name)
	(btk_about_dialog_get_logo_icon_name): Support named icons as 
	logos.  (#156378, James Henstridge)

	* btk/btkdialog.c (btk_dialog_set_alternative_button_order): Fix the 
	doc formatting.

	* btk/btkcellview.[hc]: Make function parameter names consistent.

	* tests/Makefile.am (noinst_PROGRAMS): Add testimage.

	* tests/testicontheme.c (main): Use btk_image_new_from_icon_name().

2004-10-25  Matthias Clasen  <mclasen@redhat.com>

	Add a public setting for button ordering (#74669, Owen Taylor)
	
	* btk/btksettings.c (btk_settings_class_init): Add a 
	btk-alternative-button-order setting.

	* btk/btkdialog.h: 
	* btk/btkdialog.c (btk_alternative_dialog_button_order): A 
	getter for the alternative button order setting.
	* btk/btkdialog.c (btk_dialog_set_alternative_button_order): 
	New function to install an alternative button order for a 
	dialog.

	* btk/btkfilesel.c (btk_file_selection_init): 
	* btk/btkfontsel.c (btk_font_selection_dialog_init): 
	* btk/btkmessagedialog.c (btk_message_dialog_add_buttons): 
	* btk/btkcolorseldialog.c (btk_color_selection_dialog_init): 
	* btk/btkfilechooserdefault.c (location_popup_handler): 
	Set up an alternative button order.
	
2004-10-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkimage.h: 
	* btk/btkimage.c (btk_image_new_from_icon_name)
	(btk_image_set_from_icon_name, btk_image_get_icon_name)
	(btk_image_set_pixel_size, btk_image_get_pixel_size):  Add a
	new type BTK_IMAGE_ICON_NAME for named icons, update the size
	and content of stock, icon set and named icon images upon style
	changes, and allow to set a fixed pixel size for named icon
	images.  (#155688, James Henstridge)

	* tests/testimage.c: Test application for theming behaviour of
	different image types and for image dnd.

2004-10-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrenderercombo.c: Use G_DEFINE_TYPE, initialize the
	has_entry property, ref the model and add a finalizer.  (#156325,
	Olivier Andrieu)
	
Sun Oct 24 02:56:43 2004  Jonathan Blandford  <jrb@redhat.com>

	* docs/tools/widgets.c: Update BtkFileChooserButton doc shot.

2004-10-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c: Use the new g_key_file api in GLib.

	* btk/Makefile.am (btk_c_sources): Remove btkiconthemeparser.[hc]

	* btk/btkiconthemeparser.[hc]: Removed.

	* btk/btkfilechooserdefault.c (location_popup_handler): If the
	location dialog is brought up by typing '/', insert the slash
	in the entry.  (#155370, Warren Togami)

2004-10-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (tree_view_keybinding_cb) 
	(trap_activate_cb): Accept shift-/ for bringing up the location
	popup, since German and French keyboards generate such 
	events.  (#154163, Frederic Crozat)

	* btk/btktreeview.c (btk_tree_view_size_allocate): Invalidate 
	the window if the tree is empty, to avoid resizing artifacts
	from the focus rectangle.  (#155881, Vincent Noel, patch by
	Billy Biggs)	

Sat Oct 23 16:14:37 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btksequence.c (_btk_sequence_node_insert_sorted): Remove
	assertion that can get triggered by broken sort functions.

Sat Oct 23 16:07:46 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btksequence.c (_btk_sequence_swap): Replace broken, overly
	clever implementation with one that works.
	
	* btk/btkliststore.c (btk_list_store_swap): emit "rows_reordered"
	instead of "changed" twice.

	Bug 153479

Sat Oct 23 15:17:55 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btkmenutoolbutton.c (button_state_changed_cb): Remove check
	for previous state being ACTIVE. Bug 153876.

2004-10-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_drag_data_received) 
	(btk_file_chooser_button_init): Use the new file DND api.

	* btk/btkdnd.h:
	* btk/btkdnd.c (btk_drag_dest_add_uri_targets) 
	(btk_drag_source_add_uri_targets): 

	* btk/btkselection.h:
	* btk/btkselection.c (btk_target_list_add_uri_targets):
	(btk_selection_data_set_uris):  
	(btk_selection_data_get_uris): New functions to allow
	handling file DND "without knowing jack shit".

	* configure.in: Bump bunnylib requirement to 2.5.4.

	* btk/btkfilechooserdefault.c (shortcuts_drop_uris): Use
	g_uri_list_extract_uris().

Fri Oct 22 13:25:25 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktextbuffer.c (btk_text_buffer_backspace): Fix 
	backspacing on the empty last line of a buffer 
	(https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=136840,
	Dan Williams)

2004-10-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkdnd.c: Document how to use info with text/image 
	targets.

	* btk/btkselection.h: 
	* btk/btkselection.c (btk_target_list_add_text_targets): 
	(btk_target_list_add_image_targets): Add info argument.
	
	* btk/btkcalendar.c (btk_calendar_motion_notify): 
	* btk/btkentry.c (btk_entry_init): 
	* btk/btktextview.c (btk_text_view_init): Adjust all callers.

2004-10-22  Anders Carlsson  <andersca@bunny.org>

	* btk/btktexttag.c: (btk_text_tag_get_property):
	BdkBitmap is a BObject, not a boxed type.
	
Thu Oct 21 15:01:09 2004  Owen Taylor  <otaylor@redhat.com>

	#155952

	* btk/btkentry.c: Fix checking the wrong position for
	the backspace_deletes_character BangoLogAttr.

	* btk/btktextbuffer.[ch] btk/btk.symbols (btk_text_buffer_backspace): 
	Move backspace logic from BtkTextView to here, check 
	backspace_deletes_char.	

	* btk/btktextview.c: Use btk_text_buffer_backspace().

2004-10-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconcache.c: Include io.h on windows.  (#156075,
	Kazuki IWAMOTO)
	(_btk_icon_cache_new_for_path): Don't use MAP_FAILED if we don't
	have mmap.

	* btk/btkicontheme.c (btk_icon_theme_has_icon): Implement for
	cached themes.

	* btk/btkiconcache.h: 
	* btk/btkiconcache.c (_btk_icon_cache_has_icon): New function.

	* btk/updateiconcache.c (scan_directory): Don't skip .icon 
	files which are listed before their images.
	(foreach_remove_func): Instead filter lonely .icon files out
	here.

	* btk/btkicontheme.c (theme_dir_get_icon_suffix): Filter out
	the HAS_ICON_FILE flag.

2004-10-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconcache.c: Make it compile without mmap() and
	add some more checks.  (#155973, Morten Welinder)

	Add convenience api for image dnd (#150165):
	
	* btk/btkselection.h: 
	* btk/btkselection.c (btk_target_list_add_image_targets) 
	(btk_selection_data_set_pixbuf, btk_selection_data_get_pixbuf): 
	New functions to handle the image formats readable/writable 
	by bdk-pixbuf. 
	
	* btk/btkdnd.h: 
	* btk/btkdnd.c (btk_drag_dest_add_image_targets) 
	(btk_drag_source_add_text_targets): New functions to handle
	the image formats readable/writable by bdk-pixbuf. 

2004-10-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreemodelfilter.c (btk_tree_model_filter_new): Make
	the code clearer.  (#155239, Murray Cumming)

	* btk/btkicontheme.c: Small fixes.

	* btk/btkrc.c: Include btkmodules.h.  (#155885, Kazuki IWAMOTO)

	* btk/btktoolbar.h: Add _btk_toolbar_rebuild_menu(). (#155885)

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_class_init): 
	Fix a wrong blurb.  (#155838, Morten Welinder)

2004-10-19  Matthias Clasen  <mclasen@redhat.com>

	Implement icon theme caching.  (#154034, Martijn Vernooij,
	caching schema proposed by Owen Taylor, initial implementation
	by Anders Carlsson)
	
	* btk/btkdebug.h: 
	* btk/btkmain.c: Add a "icontheme" debug flag.

	* btk/Makefile.am (btk_c_sources): Add btkiconcache.c
	(btk_private_h_sources): Add btkiconcache.h
	(bin_PROGRAMS): Add btk-update-icon-cache

	* btk/btkicontheme.c: Use icon caches if they are available.
	Currently, BTK+ uses the cache to get information about the
	available sizes, image file formats and .icon files. The
	actual image data, and the .icon file contents are not 
	cached yet.

	* btk/updateiconcache.c: A cmdline utility for generating
	icon cache files.

	* btk/btkiconcache.h: 
	* btk/btkiconcache.c: The glue code to mmap an icon cache
	file and manage the information it contains.

	* tests/testicontheme.c: Add a "display" option.

2004-10-19  Matthias Clasen  <mclasen@redhat.com>

	* tests/testicontheme.c: Set the locale, tidy up output.

2004-10-18  Matthias Clasen  <mclasen@redhat.com>

	Fix #155658, Sebastien Bacher:
	
	* bdk/x11/bdkwindow-x11.h (struct _BdkToplevelX11): Add a new 
	is_leader flag.

	* bdk/x11/bdkwindow-x11.c (update_wm_hints): Set wm hints on
	leader windows even if they are withdrawn.
	(bdk_window_set_group): Mark the new leader window as such. We 
	never remove the flag again, but that should a) be vanishingly
	rare and b) not a problem, since the flag just turns off an
	optimization.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Mark the default
	leader window as such.

2004-10-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaboutdialog.c (btk_about_dialog_new): Destroy secondary
	dialogs if the main dialog is hidden. (#155084, Paolo Borelli)

2004-10-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaboutdialog.c (btk_about_dialog_destroy): Don't leak
	the secondary dialogs.  (#155084, Paolo Borelli)

	* btk/btkhsv.c (btk_hsv_expose): Fix redraw issues with the
	focus on the ring. 

2004-10-15  Matthias Clasen  <mclasen@redhat.com>

	* bdk/makebdkalias.pl: Include linux-fb/bdkfb.h when building
	the framebuffer backend.  (#155486, Olexiy Avramchenko)

2004-10-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btksizegroup.c (do_size_request): Unset BTK_REQUEST_NEEDED
	before emitting ::size-request, following this weeks discussion
	on btk-devel-list@bunny.org.

	* btk/btkcellview.c (btk_cell_view_get_size_of_row): Restore 
	the size info for the current row after measuring another 
	row.  (#154945, William Jon McCann)

2004-10-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (shortcuts_remove_rows): Don't
	get text unnecessarily.  (#155384, Morten Welinder)
	(btk_file_chooser_default_finalize): Don't forget to
	unref the tooltips.  (#155412, Morten Welinder)
	(shortcuts_add_current_folder): Don't leak volume. (#155400,
	Morten Welinder)

2004-10-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcontainer.c (_btk_container_queue_resize): Acknowledge 
	the fact that invariants are broken and loop all the way up to 
	the resize container.

Tue Oct 12 17:11:02 2004    <timj@birnet.org>

	* btk/btkwidget.c (btk_widget_set_usize_internal): don't queue the
	widget for resize or emit change notification if the usize didn't
	change. this works around a buggy signal connection in #155139.

2004-10-11  Matthias Clasen  <matthias@localhost.localdomain>

	* docs/tools/widgets.c: Create scrolledwindow, statusbar, 
	scale and image images. 

2004-10-10  Matthias Clasen  <matthias@localhost.localdomain>

	* docs/tools/widgets.c: Create a toolbar, menubar, progressbar,
	notebook and messagedialog images.

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_select_all): 
	Avoid a warning.

Sun Oct 10 11:24:56 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkcontainer.h (struct _BtkContainer): add /*< private >*/
	markings.

2004-10-09  Matthias Clasen  <mclasen@redhat.com>

	* docs/tools/widgets.c: Shrink panes and separators images to MEDIUM.

	* btk/btkcellview.c: Add docs.

	* btk/btkmenutoolbutton.c (btk_menu_tool_button_get_menu): Fix
	doc comment.

	* btk/btkactiongroup.h: 
	* btk/btkactiongroup.c: Reinstate the accidentally lost addition 
	of btk_action_group_translate_string().

	* btk/btkaccelgroup.h: Declare btk_accelerator_get_label.

2004-10-08  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkx.h: Declare bdk_x11_window_set_user_time here.

	* btk/btktreeview.c (btk_tree_view_grab_notify): Don't start a 
	drag if we loose the grab.

	* btk/btkfilechooserdefault.c (renderer_edited_cb): Set the cell 
	renderer to inert mode to avoid bug #154921.  This fixes a crash
	which would otherwise occur if the editing is stopped for the second
	time.  (#154767, Manuel Baena García)

	* btk/btkdebug.h: 
	* btk/btkwidget.c (btk_widget_size_allocate): Add a new debug
	flag, geometry, to debug size allocation.

	* btk/btktreeview.c (btk_tree_view_button_press): Set cell data
	unconditionally.  (#152562, Federico Mena Quintero)

2004-10-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (update_node): Also update smart separators 
	if the visibility of a  menuitem with a submenu changes.  (#153791,
	Christian Persch)

2004-10-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.h:
	* btk/btkentry.c: 
	* btk/btkentrycompletion.c: 
	* btk/btkspinbutton.c: Share the three copies of get_borders()
	under the name _btk_entry_get_borders().  (#116368, Owen Taylor)

2004-10-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (check_is_folder): Don't free 
	info too early.  (#154703, Morten Welinder)

	* btk/btkfilechooserdefault.c: Include btkeventbox.h.
	(#154798, Morten Welinder)

2004-10-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpaned.c (btk_paned_compute_position): Reduce rounding 
	error.  (#154658, John Cupitt)

	* btk/btktreeselection.c (btk_tree_selection_get_selected): Clear
	the iter instead of returning it unmodified. (#154186, Jonathan Blandford)

	* btk/btkfilechooserentry.c (btk_file_chooser_entry_focus): Pop up
	the completions again after tab.  (#147700, Jens Bech Madsen)

	* btk/btktreeview.c (btk_tree_view_search_iter): Set the cursor
	before changing the selection to make the file chooser preview
	update work better.  (#143826, Tommi Komulainen)

2004-10-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrange.c (btk_range_real_change_value): Replace a really
	gross way of rounding to a specified number of digits.  (#145232,
	Peter Zelezny, patch by Soeren Sandmann)

Wed Oct  6 00:45:04 2004    <timj@birnet.org>

	* bdk/bdkwindow.c (bdk_window_is_viewable): check the iteration window
	variable, not just the window passed in. fixes #145270.

Tue Oct  5 21:00:54 2004  Tim Janik  <timj@btk.org>

	* btk/btkwidget.c (btk_widget_size_allocate): reverted my last change 
	and applied owen's leaner conditional flag update which should be good
	enough to preserve resizing flag invariants.

2004-10-05  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Updates

Tue Oct  5 19:29:06 2004  Tim Janik  <timj@btk.org>

	* btk/btkentry.h: removed redundant btk_entry_get_layout() decl.

2004-10-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c (icon_info_ensure_scale_and_pixbuf): Go back to
	not scaling up at all. Less magic.

Tue Oct  5 17:06:26 2004  Tim Janik  <timj@btk.org>

	* btk/btkwidget.c (btk_widget_size_allocate): if REQUEST_NEEDED is still
	set on ::size-allocate, another size-request has been queued since
	::size-request and needs to be requeued.

2004-10-05  Paolo Borelli  <pborelli@katamail.com>

	* btk/btkmenutoolbutton.c: rename the activate-menu signal to
	show-menu as discussed in bug #153873.

2004-10-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (btk_ui_manager_add_ui): Set 
	action_name.  (#154526, John Finlay)

	* bdk/x11/bdkwindow-x11.c (bdk_window_foreign_new_for_display): 
	Return a new reference to an existing BdkWindow if one already
	exists.  (#151378, Gustavo Carneiro)

2004-10-05  Matthias Clasen  <mclasen@redhat.com>

	Provide access to the string representation of accelerators used
	in BtkAccelLabel.  (#154068, John Spray)

	* btk/btkaccelgroup.h:
	* btk/btkaccelgroup.c (btk_accelerator_get_label): New function
	to return the accelerator label used in BtkAccelLabel. 
	(btk_accelerator_name): Update docs to point to 
	btk_accelerator_get_label().
	* btk/btkaccellabel.h:
	* btk/btkaccellabel.c (_btk_accel_label_class_get_accelerator_label): 
	New auxiliary function which creates the string representing the
	accelerator.
	
2004-10-05  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_set_model): Resize the
	popup if a new model is set.  (#154129, Bernd Demian)

2004-10-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c (icon_info_ensure_scale_and_pixbuf): 
	Make the code work as intended for unthemed icons; don't scale
	them up too much. Allow to scale them down, and do so 
	exactly.  (#154142, Ross Burton)
	(btk_icon_info_load_icon): Amend docs.

	* btk/btkcelllayout.c (btk_cell_layout_clear): Improve 
	docs.  (#154504, Dave Cook)

	* btk/btkwindow.c (btk_window_set_icon_list): 
	(btk_window_set_default_icon_list): Ref the new icons
	before unreffing the old ones.  (#154468, Morten Welinder)
	(btk_window_realize_icon): Only set using_themed_icon if
	we actually got an icon list from the theme.  (#154472, Morten
	Welinder)

2004-10-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_set_model): Reset pointers
	pointing to the old model.  (#154350)

	* btk/btkwindow.c (icon_list_from_theme): Don't leak the
	sizes array.  (#154310, Christian Persch)

	* btk/btktreeviewcolumn.c 
	(btk_tree_view_column_setup_sort_column_id_callback): 
	Set sort_indicator to FALSE when appropriate.  (#153714, 
	Reinout van Schouwen)

	* btk/btktreeview.c (btk_tree_view_search_position_func): 
	Fix positioning near the monitor boundaries.  (#154341,
	Ken Harris)

2004-10-01  Paolo Borelli  <pborelli@katamail.com>

	* btk/btkmenutoolbutton.c: deactivate the menu before setting it
	to something else. Bug #153887.

2004-10-01  Matthias Clasen  <mclasen@redhat.com>

	Fix bug #150790:
	
	* btk/btkcellrenderertext.c (btk_cell_renderer_text_get_size): Fix the
	calculation of x_offset when ellipsized and in RTL mode.
	(btk_cell_renderer_text_render): Fix the calculation of the layout
	width when ellipsized.  

2004-10-01  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkglobals-win32.c: Set _bdk_input_ignore_wintab to
	FALSE, thus enabling tablet input by default.

	* bdk/win32/bdkmain-win32.c (_bdk_windowing_args): Accept the
	--use-wintab option again (but without effect, as this is now the
	default, see above). (#153788)

	* modules/input/btkimcontextime.c: Numerous changes.

	Remove the ifdef UNICODE conditionals. Always use the
	wide-character Imm* API. It is present also in Windows 98 and
	Me. (Not Windows 95, but I think we don't care about that.) Using
	the multibyte API wouldn't work anyway on systems where the system
	codepage doesn't support the language the user uses an IME for, so
	for instance I wouldn't be able to test this module on my English
	Windows 2000 although I do have C, J and K IMEs available.

	Guard against IMM not being active, always check ImmGetContext()
	returning NULL. Work to some extent even without any IME. Fixes
	#153800 at least partially.

	* modules/input/imime.c (ime_info): Rename to "ime" to match the
	naming pattern of other input modules. Make it default for
	ja:ko:zh only.

2004-10-01  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_set_model): Add a comment regarding
	cell renderers to the docs.

	* btk/btkcellview.c (btk_cell_view_cell_layout_clear_attributes): 
	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_layout_clear_attributes): 
	Silently ignore info being NULL. This is unavoidable with the 
	current design where we have every implementation of layout_clear
	call layout_clear_attributes, and also delegate calls to dependent
	cell layouts.  (#154191, Martyn Russell)

2004-10-01  Matthias Clasen  <mclasen@redhat.com>

	* modules/input/iminuktitut.c: Fix the spelling of Inuktitut
	in several places.  (#154176, John Austin)

2004-09-30  Paolo Borelli  <pborelli@katamail.com>

	* tests/testellipsize.c: exit on close.

2004-09-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmain.c: Make --g-fatal-warnings a G_OPTION_ARG_NONE,
	since it doesn't take an argument.

2004-09-29  Christopher Blizzard  <blizzard@redhat.com>

	* btk/btkmenutoolbutton.h: Remove trailing semicolon on
	B_END_DECLS

2004-09-29  Paolo Borelli  <pborelli@katamail.com>

	* tests/testtoolbar.c: add a BtkMenuToolButton.

2004-09-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkiconview.c (btk_icon_view_move_cursor_left_right) 
	(btk_icon_view_move_cursor_start_end) 
	(btk_icon_view_move_cursor_page_up_down) 
	(btk_icon_view_move_cursor_up_down): Handle an empty icon
	view gracefully.  (#152486)

	Allow keynav to selectable labels (#138085, David Hawthorne):
	
	* btk/btkdialog.c (btk_dialog_map): Skip selectable labels when
	looking for the initial focus widget.

	* btk/btklabel.c (btk_label_focus): Remove to put selectable labels 
	in the regular focus chain again.

2004-09-28  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_render): Don't
	reuse insensitive pixbufs across multiple rows.  (#153984, Milosz
	Derezynski)

	* btk/btkmain.c (btk_parse_args): Use btk_get_option_group() 
	to obtain an option group with correctly set pre- and post-
	parse hooks, instead of manually calling the hooks. This fixes
	a problem with setting the program class in the bdk preparse
	hook.  (#153788, Robert Ögren)

2004-09-27  Matthias Clasen  <mclasen@redhat.com>

	Fix #153082:
	
	* btk/btkmain.c (do_pre_parse_initialization): Don't call bdk_parse_args()
	here, we don't want to parse args twice.
	(btk_init_with_args): Add the ugid check here as well.
	(btk_parse_args): Add the bdk options to the main option group as well.

2004-09-27  Paolo Borelli  <pborelli@katamail.com>

	* btk/Makefile.am:
	* btk/btk.h:
	* btk/btkmenutoolbutton.[ch]: add the BtkMenuToolButton widget
	discussed in bug #151441.

	* docs/reference/btk/btk-docs.sgml:
	* docs/reference/btk/btk-sections.txt:
	* docs/reference/btk/btk.types:
	* docs/reference/btk/tmpl/btkmenutoolbutton.sgml: docs for the
	new widget.

2004-09-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystemunix.c (btk_file_folder_unix_list_children): 
	Emit ::finished-loading.

2004-09-27  Roozbeh Pournader  <roozbeh@farsiweb.info>
 
	* configure.in: Added Iranian Azerbaijani (az_IR) to ALL_LINUGAS.

2004-09-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_append_column): Fix typo in
	docs.  (#153811, Billy Biggs)

	* btk/btkpathbar.h (struct _BtkPathBar): Only need a bit for
	need_timer.

2004-09-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btknotebook.c (btk_notebook_class_init): Add a missing _
	to the name of the has_secondary_backward_stepper property.
	Noticed by Michèle Garoche.

Sun Sep 26 02:06:43 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.h (struct _BtkPathBar): add missing structures.

2004-09-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkpathbar.c (btk_path_bar_check_parent_path): Scroll
	to make the current folder visible.  (#152921)

	* btk/btkbutton.c: Revert the button state to !button_down,
	if we're missing the release event due to grab shadowing
	or insensitivation.

	* btk/btkpathbar.c: Make the slider buttons scroll.

	* btk/btkfilechooserdefault.c (shortcuts_remove_rows): Remove 
	debug spew.
	(bookmarks_check_remove_sensitivity): Don't free an uninitialized
	pointer.

	* btk/btkimcontext.c (btk_im_context_get_preedit_string): 
	cursor_pos is in characters, not bytes.  (#153332, Owen Taylor)

2004-09-25  Robert Ögren  <btk@roboros.com>

	* bdk/win32/bdkinput-win32.c (bdk_input_wintab_init): Set
	lcSysOrgX and lcSysOrgY from device instead of hardcoding to 0,
	a further fix for bug #145467.

2004-09-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextiter.c (inside_word_func): Don't access 
	attr[-1].  (#153628, Padraig O'Briain)

2004-09-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c: Add some tooltips.

2004-09-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkrange.c (btk_range_map, btk_range_unmap): 
	* btk/btkbutton.c (btk_button_map, btk_button_unmap): Remove
	unnecessary g_return_if_fail()s from virtual functions.  (#153469,
	(Tristan Van Berkom) 

	* btk/btkaboutdialog.c (btk_about_dialog_finalize): Don't leak
	cursors.  (#153468, Christian Persch)

	* btk/btktreeview.c (btk_tree_view_key_press): Don't leak old_text.
	(#153467, Christian Persch)

	* btk/btkfilechooserdefault.c (selection_check_foreach_cb): Don't use
	bitops on booleans.
	(btk_file_chooser_default_should_respond): Make it easier to 
	select folders in SELECT_FOLDER mode.

Wed Sep 22 00:54:34 2004  Matthias Clasen  <mclasen@redhat.com>

	* demos/btk-demo/pixbufs.c (do_pixbufs): Don't leak the frame
	pixbuf.

Tue Sep 21 16:55:38 2004  Manish Singh  <yosh@gimp.org>

	* tests/testtreemodel.c: #include <config.h> for HAVE_MALLINFO define,
	other minor cleanups.

Tue Sep 21 16:27:19 2004  Manish Singh  <yosh@gimp.org>

	* bdk/bdk.c: remove now unused arg variables.

	* bdk/bdkinternals.h: declare _bdk_windowing_init ().

	* btk/btkmain.c (do_pre_parse_initialization): call bdk_parse_args ()
	here instead of bdk_pre_parse_libbtk_only (). Should fix #153082.

2004-09-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_should_respond): 
	Don't assert that current_focus != NULL, just return FALSE.

	* btk/btkpathbar.c (btk_path_bar_size_request): Give the path
	bar arrows some more space.

	* configure.in: Check for mallinfo.

	* tests/testtreemodel.c: Only include malloc.h if HAVE_MALLINFO
	is defined.  (#153168, Darren Creutz)

	* btk/btkactiongroup.c: Fix typos in signal docs.  (#153224,
	John Finlay)

Mon Sep 20 19:44:58 2004  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (shortcuts_activate_iter): Don't
	return FALSE from a void function.  (#153185, Joel Fredrikson)

2004-09-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbutton.c (btk_button_class_init): Add a boolean ::displace-focus
	style property and apply child displacement to the focus rectangle 
	if it is TRUE.  (#141170, Soeren Sandmann)

Sun Sep 19 23:56:18 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btkmenu.c (MENU_SCROLL_TIMEOUT2): Change from 50 to 20 to
	make the menus scroll faster.

2004-09-19  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Bump version

	* === Released 2.5.3 ===

2004-09-18  Matthias Clasen  <mclasen@redhat.com>

	Make BtkFileChooserButton activatable via mnemonics.
	(#152925, Dennis Cranston, patch by James M. Cape)

	* btk/btkfilechooserbutton.c: Add a ::mnemonic-activate signal
	and a suitable default handler.

	* tests/testfilechooserbutton.c: Add a mnemonic.

2004-09-18  Matthias Clasen  <mclasen@redhat.com>

	Fix win32 build errors.  (#153032, #153028, Robert Ögren)

	* bdk/win32/bdkmain-win32.c: Make it compile.  

	* btk/btkmain.c: Include bunnylib.h.  

2004-09-18  Federico Mena Quintero  <federico@ximian.com>

	Merged from 2.4:

	* btk/btkfilesystem.h: Removed the BTK_FILE_PATH() and
	BTK_IS_FILE_PATH() macros.  They are not supposed to exist, as
	BtkFilePath is not an object.  And they never worked, anyway.

2004-09-18  Marco Pesenti Gritti  <marco@bunny.org>

	* btk/btkentry.c: (btk_entry_completion_key_press):

	Make numeric pad enter activate the selected completion
	entry. Fix bug 143486 reported by Edd Dumbill.

2004-09-17  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Updates

	* btk/btkfilechooserdefault.c (select_func): Scroll to the selected
	row.  (#143868, Christian Persch)

2004-09-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_render): Remove
	leftover debug code.

	Improve the behaviour of the file chooser in save mode. Fixes bugs
	#151031, #151608, #151994 reported by Owen Taylor and Alexander 
	Larsson.
	
	* btk/btkfilechooserdefault.c (btk_file_chooser_default_set_property): 
	(location_entry_create): Propagate the action to the file 
	chooser entries.
	(btk_file_chooser_default_should_respond): Switch folders if 
	the user enters a directory name in the entry and clear the entry
	after switching folders.
	(btk_file_chooser_default_should_respond, shortcuts_row_activated_cb): 
	Move focus to the file list when activating a shortcut.
	(btk_file_chooser_default_should_respond): Handle the case where the
	user clicks on "Save" after selecting a folder in the file list.

	* btk/btkfilechooserbutton.c (btk_file_chooser_button_set_property): 
	Propagate the action to the file chooser entries.
	
	* btk/btkfilechooserentry.h: 
	* btk/btkfilechooserentry.c (_btk_file_chooser_entry_set_action): 
	(_btk_file_chooser_entry_get_action): New functions to propagate
	the BtkFileChooserAction of the file chooser to the file chooser 
	entry.
	(check_completion_callback): If we are in save mode, only do 
	inline completion for directories. 

Fri Sep 17 11:20:03 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btklabel.c (btk_label_set_markup): Add an example to the
	docs.

Thu Sep 16 23:20:05 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkselection.c (selection_get_text_plain): 
	* bdk/x11/bdkselection-x11.c (make_list): Warn if a UTF8_STRING
	or text/plain;charset=utf-8 roperty contains invalid 
	UTF-8.  (#152845, Owen Taylor)

2004-09-16  Matthias Clasen  <mclasen@redhat.com>

	Fix #152760, Christian Persch:
	
	* btk/btkaboutdialog.c (btk_about_dialog_finalize): Don't free
	private data.
	(btk_about_dialog_set_translator_credits): Recommend the msg
	id translator-credits.
	(display_credits_dialog): Show translator credits if they're
	translated, not if they're untranslated.

Thu Sep 16 02:07:56 2004  Jonathan Blandford  <jrb@bunny.org>

	* docs/tools/widgets.c (create_icon_view): load images at normal
	size.

	* docs/reference/btk/images/*png: Update shots.

Thu Sep 16 00:33:11 2004  Jonathan Blandford  <jrb@bunny.org>

	* docs/tools/widgets.c (new_widget_info): Add constrained sizing
	to the widgets.  This gives us all images running the same size,
	which will make the table layout look better.

2004-09-15  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkwindow-win32.c (bdk_window_get_frame_extents):
	Remove bogus code that tried to do what the X11 backend does in
	its version of this function. There are no "frame windows" (for
	toplevel window decoration) on Windows. The desktop ("root")
	window is not the parent of a toplevel window. (#152481)

2004-09-15  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Update.

Wed Sep 15 00:57:37 2004  Matthias Clasen  <maclas@gmx.de>

	* docs/tools/widgets.c: Add accel label, file button
	and icon view.

Tue Sep 14 22:01:49 2004  Matthias Clasen  <maclas@gmx.de>

	* configure.in: New option --disable-visibility to disable
	the use of ELF visibility attributes for PLT reduction.

	* btk/makebtkalias.pl: 
	* bdk/makebdkalias.pl: Respect the DISABLE_VISIBILITY
	define.

Tue Sep 14 23:20:56 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btkaction.c (connect_proxy): Call
	btk_tool_item_rebuild_menu().

	* btk/btktoolitem.c (btk_tool_item_class_init): Update
	documentation for BtkToolItem::create_menu_proxy.

	* btk/btktoolitem.c (btk_tool_item_rebuild_menu): New
	API to make the toolbar update itself when the proxy menu item
	for a tool item changes.

	* btk/btktoolbutton.c (btk_tool_button_construct_contents): Call
	btk_tool_item_rebuild_menu here()

	* btk/btktoolbutton.c (btk_tool_button_construct_contents):
	Remove redundant check for need_label.

2004-09-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmain.c (do_post_parse_initialization): Remove an unused 
	variable, spotted by Morten Welinder.

	* btk/queryimmodules.c (escape_string): Copy code from queryloaders.c
	which turns backslashes in slashes on win32.  (#152608, Kazuki IWAMOTO)

	* btk/btktreeview.c (btk_tree_view_focus_to_cursor): Set the cursor
	to the first selected row instead of always to the first row if there
	is no cursor.  (#143270, Jean Bréfort)

	* tests/testfilechooser.c (main): Fix a few typos.

2004-09-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkexpander.c: 
	* btk/btktreeview.c: Change the default expander size to 12 to compensate 
	for the recent change to btk_default_draw_expander().

	* btk/btkstyle.c (btk_default_draw_expander): Use a linewidth of one
	for expander sizes up to 16

	* btk/btkentrycompletion.c (btk_entry_completion_get_model): Resize the
	popup if the model is replaced.  (#152333)

Mon Sep 13 09:11:53 2004  Manish Singh  <yosh@gimp.org>

	* btk/btkrange.c: fix btk_range_real_change_value args. Addresses part
	of #152518.

2004-09-13  Matthias Clasen  <mclasen@redhat.com>

	Fix some problems reported by Morten Welinder:
	
	* btk/btkfilesystem.c: Include btkmodules.h, not btkmain.h, since
	the modules stuff moved.

	* btk/btkmain.c (btk_arg_no_debug_cb): Add a missing return

	* btk/btksettings.c: Add missing include. 
	(settings_update_modules): Remove an unused variable.

2004-09-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Improve positioning of entry completion popup.

2004-09-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/makebtkalias.pl: 
	* bdk/makebdkalias.pl: Use the short prefix "IA__" for 
	aliases instead of the long suffix "__internal_alias". 

	* tests/testfilechooser.c (main): Update sensitivity of the "Select all"
	button.

Wed Sep  8 18:38:08 2004  Soeren Sandmann  <sandmann@redhat.com>

	Make dropping of expandable items look nicer.
	
	* btk/btktoolbar.c (btk_toolbar_set_drop_highlight_item): Make
	placeholder expand if highlight item is expanding.

	* btk/btktoolbar.c (toolbar_content_set_expand): New function.

	* btk/btktoolbar.c (toolbar_content_get_expand): Return TRUE only
	if the item is not disappering.

2004-09-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (btk_ui_manager_add_ui): Use the proper node type
	for placeholders in toolbars.  (#151963, Olivier Andrieu)

	* btk/btkstyle.c (btk_default_draw_expander): Draw expanders a bit 
	better.

Sun Sep  5 17:14:16 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmain.c: 
	* bdk/bdk.c: 
	* bdk/x11/bdkmain-x11.c: 
	* bdk/win32/bdkmain-win32.c: Add descriptions for the 
	commandline arguments. The actual descriptions are mostly 
	taken from libbonoboui, so translators should be able to 
	copy existing translations from there.

2004-09-05  Anders Carlsson  <andersca@bunny.org>

	* bdk/bdk.symbols:
	* btk/btk.symbols:
	Add new functions

2004-09-05  Anders Carlsson  <andersca@bunny.org>

	* bdk/bdk.c: (bdk_arg_class_cb), (bdk_arg_name_cb),
	(bdk_add_option_entries_libbtk_only), (bdk_pre_parse_libbtk_only),
	(bdk_parse_args):
	* bdk/bdk.h:
	* bdk/bdkinternals.h:
	* bdk/linux-fb/bdkmain-fb.c: (_bdk_windowing_init):
	* bdk/win32/bdkmain-win32.c: (_bdk_windowing_init):
	* bdk/x11/bdkdisplay-x11.c: (bdk_display_open):
	* bdk/x11/bdkmain-x11.c: (_bdk_windowing_init):
	* btk/btkmain.c: (btk_arg_debug_cb), (btk_arg_no_debug_cb),
	(btk_arg_module_cb), (btk_arg_warnings_cb),
	(do_pre_parse_initialization), (do_post_parse_initialization),
	(pre_parse_hook), (post_parse_hook), (btk_get_option_group),
	(btk_init_with_args), (btk_parse_args):
	* btk/btkmain.h:
	Make btk argument parsing use goption. Add btk_get_option_group and
	btk_init_with_args. 
	
	* tests/testtreemodel.c: (main):
	Use btk_init_with_args.
	
Sun Sep  5 01:04:01 2004  Matthias Clasen  <maclas@gmx.de>

	Allow sorting of tree models to be turned off 
	again.  (#151139, Torsten Schoenfeld)
	
	* btk/btktreesortable.h: 
	Add BTK_TREE_SORTABLE_UNSORTED_SORT_COLUMN_ID.

	* btk/btktreestore.c (btk_tree_store_sort): 
	* btk/btkliststore.c (btk_list_store_sort): Don't sort if
	the list store is not sorted.

Sat Sep  4 23:37:56 2004  Matthias Clasen  <maclas@gmx.de>

	* configure.in: Fix the Solaris Xinerama checks.  (#151754)

Sat Sep  4 22:45:49 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (btk_entry_backspace): Don't refuse to delete
	text in passwords.  (#151723, Owen Taylor)

Sat Sep  4 16:51:00 2004  Søren Sandmann  <sandmann@redhat.com>

	* bdk/x11/bdkevents-x11.c (bdk_event_prepare): Revert accidental
	change from Aug 02 that removed a flush of the X connection from
	bdk_event_prepare() causing applications to get stuck. (#151732,
	Richard Hoelscher).

Fri Sep  3 22:45:03 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (print_node): Don't print out attributes
	for the <ui> root node.  (#151752, Lorenzo Gil Sánchez)

Sat Sep  4 02:38:57 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btktoolbar.c (position): Accelerate the animation when it
	has been running for a while. (#143647).

2004-09-03  Tor Lillqvist  <tml@iki.fi>

	* btk-zip.sh.in: List the three theme btkrc files separately, zip
	doesn't do anything if one of the files on its command line
	doesn't exist.

	Handle changes of screen resolution on Win32. (#151581, reported by
	Arjohn Kampman)
	
	* bdk/win32/bdkwindow-win32.c (_bdk_windowing_window_init,
	_bdk_root_window_size_init): Factor out setting the root window's
	size (as the size of the union of all monitors) to a new function.

	* bdk/win32/bdkdisplay-win32.c (bdk_display_open,
	_bdk_monitor_init): Factor out the monitor query to a new
	function.

	* bdk/win32/bdkprivate-win32.h: Declare above new functions.

	* bdk/win32/bdkevents-win32.c (bdk_event_translate,
	handle_display_change): Handle WM_DISPLAYCHANGE by calling the
	above two functions, and emitting the "size_changed" signal on our
	(only) BdkScreen.

2004-09-01  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_get_popup_accessible): 
	Document the return value.

2004-09-01  Matthias Clasen  <mclasen@redhat.com>

	Make it possible to specify additional modules to load
	via a setting.  (#117236, Alex Graveley)
	
	* btk/btkmodules.h: 
	* btk/btkmodules.c: New files which contain the module
	handling code which was previously in btkmain.[hc]. 
	Additionally, the code now looks for the btk-modules 
	setting, which can specify additional modules to load.

	* btk/btkmain.c: 
	* btk/btkmain.h: Remove all the module handling code.

	* btk/btkdebug.h: Add a debug flag for modules.

	* btk/btk.h: Include btkmodules.h

	* btk/Makefile.am (btk_public_h_sources): Add btkmodules.h
	(btk_c_sources): Add btkmodules.c

	* btk/btksettings.c: Add the btk-modules setting.

	* bdk/x11/bdkevents-x11.c: Add the Btk/Modules XSetting.

Wed Sep  1 19:11:44 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btktoolbar.c (btk_toolbar_size_allocate): Make sure
	children of the toolbar are given positive dimensions. (149540,
	Felipe Heidrich).

2004-09-01  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystemunix.c: 
	* btk/btkfilechooserbutton.c: Protect the unistd.h include
	by HAVE_UNISTD_H.

Wed Sep  1 02:38:48 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaccellabel.c (btk_accel_label_expose_event): Make
	accel labels ellipsize correctly.  (#151559, Christian Persch)

Wed Sep  1 00:55:56 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkimage.c (btk_image_clear): Don't leak the iter
	of a running animation.  (#151542)

Tue Aug 31 23:40:29 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/win32/bdkproperty-win32.c (bdk_screen_get_setting): Make
	"ms-windows" the default theme on Win32.  

Tue Aug 31 23:24:49 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c (btk_calendar_main_button): Only start  
	a drag if the left button is pressed.  (#151490, Frederic Croszat)

Tue Aug 31 23:20:58 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkdnd-x11.c (bdk_drop_finish): Remove debug spew.

Tue Aug 31 17:07:41 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeviewcolumn.c
	(btk_tree_view_column_cell_process_action): constrain cell area to
	passed in cell_area, #147867

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_get_size): if
	ellipsizing, get_size is only 3 chars wide.

	* docs/tree-column-sizing.png: Add Matthias's excellent image.

2004-08-28  Robert Ögren  <btk@roboros.com>

	On Win32, do not produce tablet motion or button events while a
	window is being moved or resized. (#151090, reported by	Shaneyfelt)

	* bdk/win32/bdkprivate-win32.h
	* bdk/win32/bdkglobals-win32.c
	* bdk/win32/bdkevents-win32.c: Rename the variable resizing to
	_sizemove_in_progress and make it extern.

	* bdk/win32/bdkinput-win32.c (_bdk_input_other_event): Ignore
	motion and button events if _sizemove_in_progress is true.

2004-08-30  Tor Lillqvist  <tml@iki.fi>

	Make the ms-windows theme engine build with mingw.

	* configure.in: Expand also modules/engines/ms-windows/Theme/
	Makefile and .../Theme/btk-2.0/Makefile.

	* modules/engines/ms-windows/Makefile.am: Adapt for building
	inside the BTK sources.

	* modules/engines/ms-windows/*.c: Use "foo.h" style includes for
	BTK and BDK headers. Use correct path for bdkwin32.h header.

	* modules/engines/ms-windows/msw_style.c: Don't use deprecated BDK
	API.

	* modules/engines/ms-windows/xp_theme_defs.h
	* modules/engines/ms-windows/xp_theme.c: Move definitions of TMT_*
	to xp_theme.c, as they are neither in mingw's nor Platform
	SDK's tmschema.h.

	* modules/engines/ms-windows/xp_theme.c: Define _WIN32_WINNT as
	0x0501 to get the necesssary stuff from mingw's uxtheme.h.

2004-08-30  Matthias Clasen  <mclasen@redhat.com>

	Integrate the ms-windows theme engine (better known as Wimp)
	into the autotools build. Wimp (http://btk-wimp.sourceforge.net/) 
	was written by Raymond Penners and Dom Lachowicz. The Wimp 0.6.2
	sources have been added to the BTK+ source tree in 
	modules/engines/ms-windows, and there is a ChangeLog detailing 
	the history of Wimp. (#109615, Havoc Pennington)
	
	* configure.in: Generate modules/engines/Makefile and 
	modules/engines/ms-windows/Makefile.

	* modules/Makefile.am (SUBDIRS): Add engines.

	* modules/engines/Makefile.am: Compile ms-windows for win32.

2004-08-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c (btk_text_view_delete_surrounding_handler):
	Make it compile.

2004-08-27  Matthias Clasen  <mclasen@redhat.com>

	Fix #151112, Olexiy Avramchenko:
	
	* btk/btktreeview.c (btk_tree_view_search_entry_flush_timeout): 
	* btk/btkiconview.c (scroll_timeout, layout_callback) 
	(btk_icon_view_item_accessible_idle_do_action): 
	* btk/btkcombobox.c (list_popup_resize_idle, popdown_idle) 
	(popup_idle): Protect idle callbacks and timeouts with 
	BDK_THREADS_ENTER/_LEAVE.

	* btk/btkfilechooserbutton.c (update_dialog_idle): New function to
	call update_dialog() from an idle with the necessary protection.

Mon Aug 30 01:34:42 2004  Matthias Clasen  <maclas@gmx.de>

	Changes to make sure input methods respect the editability
	of entries and text views. #114173, Noah Levitt.
	
	* btk/btkentry.c (popup_targets_received): Make the Input 
	Methods menuitem insensitive if we're not editable.

	* btk/btkentry.c (btk_entry_delete_surrounding_cb): 
	* btk/btkentry.c (btk_entry_preedit_changed_cb): 
	* btk/btkentry.c (btk_entry_commit_cb): Don't change anything 
	if we're not editable.

	* btk/btkentry.c (btk_entry_focus_out): 
	* btk/btkentry.c (btk_entry_focus_in): Only send focus_in and
	focus_out to the im context if we're editable.

	* btk/btkentry.c (btk_entry_set_property): Reset the im context
	if the entry just became non-editable.

	* btk/btktextview.c (btk_text_view_delete_surrounding_handler): 
	Use btk_text_buffer_delete_interactive() to not delete
	non-editable portions of text.

2004-08-30  Tor Lillqvist  <tml@iki.fi>

	* modules/input/Makefile.am (im_ime_la_LIBADD): Link with -limm32.

	* modules/input/btkimcontextime.c: Use quotes in #includes, to
	find headers when building inside BTK+ sources.

2004-08-27  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdnd-win32.c (BdkDragContextPrivateWin32): Add
	drop_failed, like in the X11 backend. Nothing sets it, though.
	(bdk_drag_drop_succeeded): Copy from X11 backend.

Thu Aug 26 23:58:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_key_press): Don't crash
	if model is not set. Noted by Mariano Suarez-Alvarez.

Thu Aug 26 22:44:12 2004  Matthias Clasen  <maclas@gmx.de>

	Provide information about how an adjustment change in a range 
	widget happened. Add a "change-value" signal which reports how 
	a user is interacting with the range, whether they are clicking 
	on a stepper or the trough, or dragging the slider.  (#133263,
	Thomas Fitzsimmons)

	* btk/btkmarshalers.list: Add signal type BOOLEAN:ENUM,DOUBLE.
	* btk/btkrange.c (btk_range_class_init): Add "change-value"
	signal.
	(btk_range_internal_set_value): Rename to
	btk_range_real_change_value.  Add BtkScrollType parameter.  Emit
	the change-value signal when the range's value changes.
	(update_slider_position, btk_range_scroll_event, step_back,
	step_forward, page_back, page_forward, scroll_begin,
	scroll_end): Change btk_range_internal_set_value to
	btk_range_real_change_value.
	* btk/btkrange.h (struct _BtkRangeClass): Declare change_value
	function.

2004-08-26  Matthias Clasen  <mclasen@redhat.com>

	* modules/input/Makefile.am: Build imime.la on Windows.

	* modules/input/btkimcontextime.h: 
	* modules/input/btkimcontextime.c: 
	* modules/input/imime.c: 
	* modules/input/imm-extra.h: Add the IME input method for Win32
	written by Takuro Ashie and Kazuki IWAMOTO. The code was previously
	hosted at http://sourceforge.jp/projects/imime.  (#135195)

2004-08-26  Bill Haneman <billh@bunny.org>

	* btk/btktreeview:
	(btk_tree_view_move_cursor_up_down):
	If a multi-selection list contains only one item,
	select it on cursor_up or cursor_down.
	Fixes bug #131226.
	[patch from Padraig O'Briain]

2004-08-26  Matthias Clasen  <mclasen@redhat.com>

	Make bdk_window_process_[all]_updates() respect 
	update_freeze_counter  (#144272, Soeren Sandmann)
	
	* bdk/bdkwindow.c (bdk_window_schedule_update): New function to
	install an idle for bdk_window_update_idle() if one isn't there
	already.
	(bdk_window_process_all_updates): 
	(bdk_window_process_updates): Only process the updates if the
	window isn't frozen.
	(bdk_window_invalidate_maybe_recurse): Schedule an update when
	necessary.
	(bdk_window_thaw_updates): Use bdk_window_schedule_update() instead
	of directly installing the idle.

2004-08-22  Robert Ögren  <btk@roboros.com>

	On Win32, make graphical tablets work on multi-monitor systems.
	(#145467, reported by buttknock1@ya...)

	* bdk/win32/bdkinput-win32.c (bdk_input_translate_coordinates):
	Use dimensions of _bdk_parent_root as screen size.
	(bdk_input_get_root_relative_geometry): Get coordinates relative
	to BDK root window instead of Win32 coordinates.
	(_bdk_input_other_event): Updated accordingly.

Wed Aug 25 17:24:17 2004  Manish Singh  <yosh@gimp.org>

	* bdk/x11/bdkfont-x11.c: remove unused bdk_font_charset_for_locale()
	function.

	* bdk/x11/bdkinput-x11.c (_bdk_input_common_init): remove unused
	variables num_extensions and extensions.

	* btk/btkhsv.c: remove unused btk_hsv_get_focus_gc() function.

Wed Aug 25 17:14:58 2004  Manish Singh  <yosh@gimp.org>

	* btk/btktreeview.c (btk_tree_view_search_activate): initialize
	path so we don't potentially use an undefined pointer.

	* btk/btkfilechooserdefault.c (shortcuts_list_create): add G_CALLBACK
	cast for tree_view_keybinding_cb.

	* btk/btkfilechooserdefault.c (location_entry_create): cast to
	BTK_FILE_CHOOSER_ENTRY for _btk_file_chooser_entry_set_file_part()
	calls.

	* btk/btkcellrenderercombo.c (btk_cell_renderer_combo_start_editing):
	cast to BTK_COMBO_BOX for btk_combo_box_set_active_iter() call.

	* btk/btkselection.c (selection_get_text_plain): make len a bsize,
	since that's what g_convert_with_fallback() expects.

Wed Aug 25 16:14:34 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeview.c (btk_tree_view_search_activate): activate the
	typeahead entry on enter.

2004-08-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmenu.c (btk_menu_attach_to_widget): Steal ATTACHED_MENUS
	list so its tail isn't freed when we re-set it, noticed
	by Hans Petter Jansson.

	* btk/btksizegroup.c (btk_size_group_add_widget): Fix
	a typo, noticed by Tim Janik.

Wed Aug 25 15:15:56 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkpathbar.c (btk_path_bar_size_allocate): Change the Down
	button to be end-justified, so that clicking on it is a stable
	operation.

Tue Aug 24 02:06:37 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c
	(btk_tree_view_real_expand_collapse_cursor_row): Don't handle the
	event if we have no children.

	* btk/btkfilechooserdefault.c (trap_activate_cb):
	(tree_view_keybinding_cb):Since BtkTreeView has a keybinding
	 attached to '/', we need to catch keypresses before the TreeView
	 gets them.
	(btk_file_chooser_default_class_init): add '/' to be a keybinding
	to the C-l dialog.
	(location_entry_create): Clear the text to "" when loading a file.
	This has a much better feel than putting the currently selected
	in.
	* #include <errno.h>

2004-08-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (check_is_folder): Use get_file_info() rather 
	than trying get_folder() and checking for an error directly because older 
	versions of the bunny-vfs backend don't return an error 
	immediately.  (#150852, Zack Cerza )

2004-08-25  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Post-release version bump.

	* === Released 2.5.2 ===

	* bdk/abicheck.sh:
	* btk/abicheck.sh: Make work during make distcheck.
	
	* docs/RELEASE-HOWTO: Add hint about doing make check 
	before make distcheck.
	
	* btk/btk.symbols: Add some missing symbols.

	* btk/btkiconview.c: Add some missing statics.

2004-08-24  Matthias Clasen  <mclasen@redhat.com>

	* NEWS: Updates for 2.5.2

Wed Aug 25 00:22:48 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btksequence.c: Remove debug spew

Wed Aug 25 00:09:07 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btkliststore.c (btk_list_store_move_after): Fix logical
	errors in btk_list_store_move_before/after(). (#150983, patch by
	Robert Ögren).

Tue Aug 24 21:46:42 2004  Søren Sandmann  <sandmann@redhat.com>

	* btk/btksequence.c (_btk_sequence_move): Just return if the
	parameters are identical. (#150159, Robert Ögren)

2004-08-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaction.c (connect_proxy, disconnect_proxy): Handle 
	action_group being NULL.  (#150869,  Tommi Komulainen)

2004-08-24  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkimage.c (allocate_scratch_images): Use the correct 
	index variable.  (#150941, Tommi Komulainen)

2004-08-24  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_node_queue_redraw): Take header
	height and adjustment into account.  (#136496, Pawek Salek)

Mon Aug 23 17:19:19 2004  Jonathan Blandford  <jrb@redhat.com>

	* configure.in:
	* docs/tools/Makefile.am (clean-local): add the doc shooter to the
	docs dir as an uninstalled helper tool.

2004-08-23  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkwindow-x11.c (show_window_internal): Make it compile.

	* bdk/x11/bdkwindow-x11.h (struct _BdkToplevelX11): Add a 
	user_time field.

	* bdk/x11/bdkwindow-x11.c (bdk_x11_window_set_user_time): Update
	toplevel->user_time.
	(show_window_internal): Update the user time when re-mapping a
	toplevel window.  (#150502, Elijah Newren)

2004-08-23  Matthias Clasen  <mclasen@redhat.com>

	Fix #150822, reported by Christian Persch
	
	* btk/btklabel.c (btk_label_ensure_layout): Set the layout width
	appropriately when ellipsized.
	(btk_label_size_allocate): Only set the layout width if there
	is a layout.

2004-08-23  Matthias Clasen  <mclasen@redhat.com>

	* bdk/x11/bdkwindow-x11.c (bdk_window_focus): Support the latest
	EWMH additions to the _NET_ACTIVE_WINDOW client message 
	format.  (#150668, Elijah Newren)

Mon Aug 23 01:17:59 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkrgb.c (bdk_rgb_xpixel_from_rgb_internal): Set unused
	bits in pixel to 1s in case they are used as alpha; copying
	code from bdk_colormap_alloc_colors().  (#150466, Rich Wareham)

2004-08-22  Philip Langdale  <plangdale@vmware.com>

	* btk/btkaction.c (btk_action_disconnect_proxy): Two signals
	(btk_action_sync_property and btk_action_sync_sensitive) were
	not being correctly disconnected, leading to actions continuing
	to affect disconnected proxies. (#150607)

2004-08-22  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkwindow-win32.c (bdk_window_new_internal,
	bdk_window_new, bdk_window_set_skip_taskbar_hint): Don't show TEMP
	windows in the Task Manager. Implement by calling
	bdk_window_set_skip_taskbar_hint(TRUE) on them. (#145481, Tim
	Evans)

	* bdk/win32/bdkdisplay-win32.c (enum_monitor, bdk_display_open):
	Report whole of (primary) monitor, including any taskbars.
	Excluding the taskbar area from the "root window" reported to BDK
	doesn't seem to be that useful although bdk/win32 had been doing it
	for a very long time. (#149013, see also #145467 and #148526)

Sun Aug 22 16:55:15 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkexpander.c
	* btk/btkalignment.c: 
	* btk/btktexttag.c
	Make enums match property names. Found by a script by Tommi
	Komulainen.

	* btk/btkpaned.c (btk_paned_class_init): fix min/max mixup.

Sun Aug 22 16:09:49 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkliststore.h (struct _BtkListStore): 
	* btk/btkliststore.c (btk_list_store_init): 
	* btk/btkliststore.c (btk_list_store_insert): 
	* btk/btkliststore.c (btk_list_store_remove): 
	Restore length field; PyBTK and maybe others use it directly.

Sun Aug 22 15:46:56 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkpaned.c (btk_paned_class_init):
	s/CYCLE_HANDLE_FOCUS/CYCLE_CHILD_FOCUS/

	* btk/btkfontbutton.c (btk_font_button_class_init):
	s/PROP_SHOW_SIZE/PROP_SHOW_STYLE/

	Both pointed out by Tommi Komulainen.

Sun Aug 22 13:44:53 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkpaned.c (btk_paned_class_init): Use PROP_MAX_POSITION,
	not PROP_MIN_POSITION for the max_position property. Fix pointed
	out by Tommi Komulainen.

Sun Aug 22 13:32:33 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkliststore.c (btk_list_store_insert): Normalize the
	position so we don't create paths with off-list
	indices. (#150320).

Sun Aug 22 12:04:59 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkliststore.c (btk_list_store_sort_iter_changed): Use the
	correct tree path (#150289, Morten Welinder).

Sun Aug 22 00:08:44 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #150406, reported by Fernando San Martín Woerner, patch
	by Gustavo Carneiro.
	
	* btk/btkentrycompletion.c 
	(btk_entry_completion_default_completion_func): Check that 
	column is of type B_TYPE_STRING before proceeding.

Sat Aug 21 23:52:13 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreestore.c (btk_tree_store_swap): Don't use an 
	uninitialized tree iter.  (#150414, Torsten Schoenfeld)

Sat Aug 21 23:29:54 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #150738, Tomislav Jonjic.
	
	* btk/btktoolitem.h (BTK_IS_TOOL_ITEM_CLASS): 
	* btk/btktoolbutton.h (BTK_IS_TOOL_BUTTON_CLASS): 
	* btk/btktoggleaction.h (BTK_IS_TOGGLE_ACTION_CLASS): 
	* btk/btkseparatortoolitem.h (BTK_IS_SEPARATOR_TOOL_ITEM_CLASS): 
	* btk/btkradiotoolbutton.h (BTK_IS_RADIO_TOOL_BUTTON_CLASS): 
	* btk/btkradioaction.h (BTK_IS_RADIO_ACTION_CLASS): 
	* btk/btkuimanager.h (BTK_IS_UI_MANAGER_CLASS): 
	* btk/btkaction.h (BTK_IS_ACTION_CLASS): Fix macro definitions.

Wed Aug 18 17:25:26 2004  Manish Singh  <yosh@gimp.org>

	* demos/testpixbuf-save.c
	* demos/btk-demo/hypertext.c: Get rid of some unnecessary casts.

	* demos/btk-demo/appwindow.c: Make activate_email and activate_url
	match the arguments for BtkAboutDialogActivateLinkFunc.

Wed Aug 18 16:18:00 2004  Manish Singh  <yosh@gimp.org>

	* btk/btktreeview.c (btk_tree_view_row_inserted): Initialize height
	from fixed_height before we do anything, so it always has a valid
	value.

	* btk/btkfilechooserdefault.c (shortcuts_reload_icons): Fix call
	to btk_tree_model_get (missing "," in param list).

2004-08-18  Federico Mena Quintero  <federico@ximian.com>

	Merged from 2.4:

	Fixes #149251:

	* btk/btkfilechooserdefault.c: Renamed SHORTCUTS_COL_PATH to
	SHORTCUTS_COL_DATA.  Add SHORTCUTS_COL_IS_VOLUME, to determine
	easily whether the SHORTCUTS_COL_DATA points to a BtkFilePath or a
	BtkFileSystemVolume.
	(shortcuts_model_create): Create a boolean column for
	SHORTCUTS_COL_IS_VOLUME.
	(shortcuts_reload_icons): Simplify with the use of the
	SHORTCUTS_COL_IS_VOLUME column.  Don't leak the pixbuf.
	(shortcuts_insert_path): Add the SHORTCUTS_COL_IS_VOLUME data.
	(shortcuts_free_row_data): New helper function; frees the data
	columns for an iter.
	(shortcuts_remove_rows): Don't take a callback for freeing the
	data; free everything here instead.  Use
	shortcuts_free_row_data().
	(volume_remove_cb): Removed.
	(remove_bookmark_cb): Removed.
	(remove_row_cb): Make this a single generic function to delete
	rows.
	(shortcuts_add_volumes): Use remove_row_cb().
	(shortcuts_add_bookmarks): Likewise.
	(struct _BtkFileChooserDefault): Removed the
	shortcuts_current_folder_is_volume field.
	(shortcuts_add_current_folder): Oops, don't free the volume.
	(remove_current_folder_cb): Removed.
	(shortcut_find_position): Simplify through the use of the
	SHORTCUTS_COL_IS_VOLUME column.
	(remove_selected_bookmarks): Assert that we don't get a volume.
	(shortcuts_reorder): Likewise; also, plug a leak.
	(btk_file_chooser_default_remove_shortcut_folder): Simplify
	through the use of shortcuts_remove_rows().
	(btk_file_chooser_default_list_shortcut_folders): Assert that we
	don't get a volume.
	(shortcuts_activate_iter): Simplify.
	(home_folder_handler): Simplify by using
	shortcuts_activate_iter().
	(shortcuts_free): New function; frees all the data columns.
	(btk_file_chooser_default_finalize): Unref the
	shortcuts_filter_model and the shortcuts model data first.

Wed Aug 18 08:31:17 2004  Manish Singh  <yosh@gimp.org>

	* btk/btkiconview.c: Applied patch from Olivier Andrieu to fix
	bug #150440.

	* btk/btkicontheme.c (btk_icon_theme_init): xdg_data_dirs should
	match constness attributes of g_get_system_data_dirs ().

2004-08-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkicontheme.c (btk_icon_theme_init): Look up icon themes in the 
	directories specified in the icon theme spec: $HOME/.icons, 
	$XDG_DATA_DIRS/icons, /usr/share/pixmaps. Note that BTK+ used to also look 
	in $BTK_DATA_DIR/icons, $BTK_DATA_DIR/pixmaps and /usr/share/icons.  (#148694)
	

	* btk/btkframe.c (btk_frame_paint): Take widget->state into account when
	painting the shadows.  (#150351, Tim Janik)

2004-08-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/abicheck.sh: No need for INCLUDE_INTERNAL_SYMBOLS anymore.

	* bdk/bdk.symbols: Don't use #if defined().

	* bdk/Makefile.am (bdkalias.h): 
	* btk/Makefile.am (btkalias.h): Don't use cpp to filter btk.symbols.

	* bdk/makebdkalias.pl: 
	* btk/makebtkalias.pl: Move the #ifdef processing into the perl script, and
	keep the #ifdefs which differentiate between platforms.

	* btk/Makefile.am (btk_private_h_sources): Remove btkinternals.h, it is no 
	longer needed.

2004-08-17  Matthias Clasen  <mclasen@redhat.com>

	* tests/testfilechooserbutton.c: Use g_message() throughout, add RTL envar for
	rtl testing.

	* btk/btkfilechooserbutton.c: Get rid of HAVE_CONFIG_H.
	(btk_file_chooser_button_init): Use btk_drag_dest_add_text_targets().
	(btk_file_chooser_button_drag_data_received): Use btk_selection_data_get_text().
	(btk_file_chooser_button_set_dialog): _btk_file_chooser_entry_set_base_folder()
	seems to expect a path, not an uri.
	(update_dialog): Handle g_filename_from_uri() returning NULL, don't free
	info if it is NULL. 

	* btk/btkfilechooserbutton.h: Minor stylistic changes.

2004-08-17  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserbutton.[hc]: New widget to go along with 
	BtkFontButton and BtkColorButton for use in preference dialogs.
	Replaces BunnyFileEntry.  (#148108, James M. Cape)

	* btk/btk.h: Include btkfilechooserbutton.h

	* btk/Makefile.am (btk_public_h_sources): Add btkfilechooserbutton.h
	(btk_c_sources): Add btkfilechooserbutton.c

	* btk/btk.symbols: Add the BtkFileChooserButton symbols.

	* btk/btkfilechooserutils.[hc]: Make the delegate quark available. 

	* btk/btkfilechooserentry.[hc] (_btk_file_chooser_entry_new): Allow
	to suppress tab-eating using the new eat_tabs argument. Adjust all
	callers.

	* tests/testfilechooserbutton.c: Test for BtkFileChooserButton.

	* tests/Makefile.am (noinst_PROGRAMS): Add testfilechooserbutton

2004-08-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwidget.c (btk_widget_render_icon): Doc update.

	* btk/btkiconfactory.c (render_icon_name_pixbuf): When the size is -1,
	use the available size closest to 48.  (#150147)

	* btk/btkicontheme.c (btk_icon_theme_get_icon_sizes): Actually return
	a pointer to the beginning of the sizes array, not the end.

2004-08-16  Morten Welinder  <terra@bunny.org>

	* tests/testtreemodel.c (test_run): Comment out mallinfo stuff.
	Fix g_print %-strings.

	* btk/btksequence.c (_btk_sequence_set): Fix C99ism.

2004-08-16  Christian Rose  <menthos@menthos.com>

	* configure.in: Added "bs" to ALL_LINGUAS.

Mon Aug 16 01:35:25 2004  Matthias Clasen  <maclas@gmx.de>

	
	* btk/btkcombobox.[hc]: Add a ::focus-on-click property and
	change the default behaviour to focus on click.

	* btk/btkbutton.c (btk_button_set_focus_on_click): Typo fix.

Mon Aug 16 01:03:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextiter.c (btk_text_iter_set_visible_line_offset): 
	(btk_text_iter_set_visible_line_index): Count from the 
	beginning of the line, not from the current position.  (#150101,
	Torsten Schoenfeld)

2004-08-15  Tor Lillqvist  <tml@iki.fi>

	* btk-zip.sh.in: Fix typo. The btk.immodules file had never been
	included in my zipfiles...!

	* btk/btkfilesystemwin32.c (extract_icon): Improve handling of
	icon alpha channel (on Windows XP) and mask (older Windows
	versions). (#148641, Tim Evans)

Sun Aug 15 02:31:55 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilesystemunix.c (get_icon_type_from_stat): Make 
	the use of S_ISFIFO and S_ISSOCK conditional.  (#150146,
	Gustavo Carneiro)

2004-08-14  Tor Lillqvist  <tml@iki.fi>

	* btk/btkfilechooserdefault.c (shortcuts_append_home,
	shortcuts_append_desktop, set_local_only)
	* btk/btkfilesystemwin32.c (btk_file_system_win32_render_icon)
	* btk/btkpathbar.c (find_button_type, _btk_path_bar_set_file_system): 
	Guard against g_get_home_dir() returning NULL. (#150007)

Sat Aug 14 17:56:33 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkentry.c (btk_entry_get_pixel_ranges): New function. 

	* btk/btkentry.c (in_selection): New function using
	btk_entry_get_pixel_ranges() to determine whether a click is in
	the selection. Improve entry behavior wrt. dragging and
	selecting. Bug #143249.

Sat Aug 14 17:53:46 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* configure.in: Require bunnylib 2.5.2
	
	* btk/btksequence.[ch]: New internal data structure.

	* btk/btkliststore.[hc]: Reimplement in terms of new data
	structure
	
	* tests/Makefile.am (testtreemodel_SOURCES):
	* tests/testtreemodel.c: New test program written by Matthias.

2004-08-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooserdefault.c (btk_file_chooser_default_style_set): 
	Don't install the settings_notify_cb from here, since it
	may be called before the first screen_changed signal, 
	confusing the logic in btk_file_chooser_screen_changed().
	(#148803, Abel Daniel)

	* btk/btkcombobox.c: Make re-sensitivation work
	in menu mode.

	* btk/btkaction.c (btk_action_new): Fix the docs.

Fri Aug 13 01:06:56 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_row_inserted): 
	Make fixed height mode handle insertions.  (#135955, 
	Michael Vogt, testcase by Tim-Philipp Müller, fix by
	Pawel Salek)

Fri Aug 13 00:40:18 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkhandlebox.c: Add missing include.

Thu Aug 12 23:52:12 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #149547, Markus Lausser:
	
	* btk/btkcombobox.c (btk_combo_box_size_allocate): 
	* btk/btkcombobox.c (btk_combo_box_size_request): Don't 
	crash if size_request or size_allocate are called early.

	* btk/btkcombobox.c (btk_combo_box_size_allocate): Protect
	against being allocated too small.

Thu Aug 12 21:02:57 2004  Matthias Clasen  <maclas@gmx.de>

	* demos/btk-demo/appwindow.c (about_cb): Adjust to BtkAboutDialog 
	API changes.

	* btk/btkaboutdialog.h: 
	* btk/btkaboutdialog.c (btk_about_dialog_set_email_hook): 
	(btk_about_dialog_set_url_hook): Add callback data and destroy notify 
	for language bindings.  (#149999, Olivier Andrieu)

2004-08-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilesystem.c: Underscore-prefix btk_file_system_module_get_type().
	* btk/btkfilechooserdefault.c: Underscore-prefix shortcuts_model_filter_get_type().

	* btk/btkimmodule.c: Make btk_im_module_get_type() static.
	* btk/btk.symbols:
	* btk/btkinternals.h: Remove the no longer exported get_type functions.

Thu Aug 12 01:35:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconview.c: Make the icon view accessible by
	implementing the necessary BATK interfaces.  (#149728,
	Padraig O'Briain)

Thu Aug 12 00:02:29 2004  Matthias Clasen  <maclas@gmx.de

	* btk/btkaction.c (btk_action_new): Link to information about
	allowed action names.  (#149620, David Malcolm)

Wed Aug 11 23:14:25 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btk.symbols: 
	* btk/btkaction.h:
	* btk/btkaction.c (btk_action_set_sensitive): 
	(btk_action_set_visible): Add setters for the ::sensitive
	and ::visible properties of BtkAction.  (#149622, David Malcolm)

2004-08-11  Federico Mena Quintero  <federico@ximian.com>

	Fix #149422, #143457:

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_should_respond): Rewrite to take the
	current focus into account, the contents of the save entry, and
	the last focus for the shortcuts list.
	(switch_to_selected_folder): We don't need an assertion on the
	action here.

Wed Aug 11 20:56:00 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkinternals.h: 
	* btk/btk.symbols: Add shortcuts_model_filter_get_type.

	* btk/abicheck.sh: Check all symbols.

Wed Aug 11 19:20:34 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_maybe_begin_dragging_row): 
	Don't start a drag if the treeview is only a 
	drag destination.  (#149836, Pawel Salek)

2004-08-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreedatalist.[hc]: 
	* btk/btkliststore.c:
	* btk/btktreestore.c: Underscore-prefix 
	btk_tree_data_list_compare_func. 

	* btk/btk.symbols: Remove btk_tree_data_list_compare_func.

	* btk/makebtkalias.pl: No need to include btktreedatalist.h 
	any more.

2004-08-10  Matthias Clasen  <mclasen@redhat.com>

	* bdk/Makefile.am: 
	* btk/Makefile.am: Define TESTS, not TEST, so that make check
	actually triggers abicheck.sh.

	* bdk/makebdkalias.pl: 
	* btk/makebtkalias.pl: Include bunnylib.h before using bunnylib symbols. D'oh.

	* bdk/makebdkalias.pl: 
	* btk/makebtkalias.pl: Protect btkalias.h by B_HAVE_GNUC_VISIBILITY.
	
	* btk/Makefile.am: Include btkalias.h in the generated
	sources btkmarhalers.c and btkmarshal.c.

	* btk/makebtkalias.pl: Cosmetic fix.

	* bdk/Makefile.am: Remove the . which was accidentally added
	to SUBDIRS. Include bdkalias.h in the generated sources 
	bdkenumtypes.c and bdkmarshalers.c.

	* bdk/makebdkalias.pl: Cosmetic fix.

	* bdk/Makefile.am: Add bdkalias.h to BUILT_SOURCES.

2004-08-09  Hans Breuer  <hans@breuer.org>

	* btk/makefile.msc.in : autogenerate btk.def, cleanup

	* bdk/win32/bdkwindow-win32.c bdk/win32/bdkevents-win32.c : 
	removed long time unused ifdef/ed code (WITHOUT_WM_CREATE), 
	removed duplicated call to bdk_window_set_cursor()

Mon Aug  9 15:41:17 2004  Matthias Clasen  <maclas@gmx.de>

	Add hidden aliases for exported symbols which are
	used internally in order to get rid of many PLT 
	entries.  (#145519, Arjan van de Ven)
	
	* bdk/Makefile.am: Add rules to generate bdk.def and 
	bdkalias.h from bdk.symbols, and make make check check 
	the abi with abicheck.sh.

	* bdk/bdk.symbols: New file. Definition of the BDK ABI.
	The file can be processed by cpp to filter out certain 
	subsets of symbols.

	* bdk/abicheck.sh: New file. Script to check the actually 
	symbols exported from libbdk-x11.2.0.so against the symbols
	found in bdk.symbols.

	* bdk/makebdkalias.pl: New file. Perl script to generate the 
	header containing the alias definitions for internally used 
	exported symbols from a list of symbols.

	* bdk/*.c, bdk/x11/*.c: Include bdkalias.h
	
2004-08-09  Morten Welinder  <terra@bunny.org>

	* bdk/x11/bdkdnd-x11.c (bdk_drag_drop_succeeded): Fix C99ism.

Mon Aug  9 15:27:01 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/makebtkalias.pl: Also revert 
	BTK_TEXT_USE_INTERNAL_UNSUPPORTED_API to its old status.

Mon Aug  9 15:19:34 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdk.h: 
	* bdk/bdkrgb.h: Add the exported functions 
	bdk_rgb_colormap_ditherable(), bdk_pointer_grab_info_libbtk_only(),
	bdk_keyboard_grab_info_libbtk_only() to the appropriate
	headers.

Mon Aug  9 14:24:46 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkevents-x11.c (bdk_event_send_client_message_to_all_recurse): 
	Make static.

Mon Aug  9 12:48:04 2004  Matthias Clasen  <maclas@gmx.de>

	Add hidden aliases for exported symbols which are
	used internally in order to get rid of many PLT 
	entries.  (#145519, Arjan van de Ven)
	
	* btk/Makefile.am: Add rules to generate btk.def and 
	btkalias.h from btk.symbols, and make make check check 
	the abi with abicheck.sh.
	(btk_private_h_sources): Add btkinternals.h
	(btk_built_private_headers): Add btkalias.h
	(btk_extra_sources): Add btk.symbols
	(EXTRA_DIST): Add makebtkalias.pl and abicheck.sh

	* btk/btk.symbols: New file. Definition of the BTK+ ABI.
	The file can be processed by cpp to filter out certain 
	subsets of symbols.

	* btk/abicheck.sh: New file. Script to check the actually 
	symbols exported from libbtk-x11.2.0.so against the symbols
	found in btk.symbols.

	* btk/makebtkalias.pl: New file. Perl script to generate the 
	header containing the alias definitions for internally used 
	exported symbols from a list of symbols.

	* btk/btkinternals.h: New file. An uninstalled header listing
	symbols which must be exported for some reason and do not appear
	in any other header.

	* btk/*.c: Include btkalias.h
	
Mon Aug  9 11:49:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmain.c: Only undef btk_init_check and btk_init on win32.

Mon Aug  9 10:50:05 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.h: Add btk_entry_layout_index_to_text_index() 
	and its inverse. The have always been exported and are meant
	to be public.
	
Mon Aug  9 00:28:34 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c (load_svg_at_size): Don't leak the 
	file contents.

Mon Aug  9 00:13:03 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaboutdialog.c (icon_set_new_from_pixbufs): Don't
	leak the icon source.

Sun Aug  8 23:46:20 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserdefault.c (shortcuts_reload_icons): Don't
	leak a reference to the pixbufs.

Sun Aug  8 23:36:55 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_setup): Ref
	and sink the column.
	(btk_combo_box_menu_destroy): Unref the column.

Sun Aug  8 23:35:00 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkdnd.c (btk_drag_source_add_text_targets): 
	(btk_drag_dest_add_text_targets): Don't leak a reference 
	to the target list.

Sun Aug  8 22:52:26 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (find_menu_by_path): Don't stumble over
	separators which are not backed by model rows.

Sun Aug  8 11:01:23 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_set_active): Don't leak
	the path.

2004-08-08  Hans Breuer  <hans@breuer.org>

	* btk/btkdnd.c (btk_drag_dest_set) : take targets into
	account again to allow dnd of other things than text

	* bdk/win32/bdkselection-win32.c : offer windows bitmap to
	be pasted from clipboard (makes The GIMP 2.1's 
	"File/Acquire/Paste as New" work, only using btk+ API) 

Sun Aug  8 01:32:36 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btk.def: Add btk_cell_renderer_progress_get_type.

Sun Aug  8 01:29:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btk.def: Replace duplicate btk_tree_view_get_hover_expand
	by btk_tree_view_set_hover_expand.

Sun Aug  8 01:23:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btk.def: Remove the static function btk_menu_get_private.

2004-08-07  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkkeys-win32.c (update_keymap): Don't hardcode
	mapping of VK_DECIMAL to BDK_KP_Decimal. Instead, let ToAsciiEx()
	map it to what's printed on the keypad decimal key for the current
	input locale (keyboard layout). (#149404)

Sat Aug  7 18:19:03 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserdefault.c (save_folder_combo_create): 
	(shortcuts_list_create): Use BtkTreeViewRowSeparatorFunc 
	instead of BtkCellRendererSepText.  (#147864)

	* btk/btkcellrendererseptext.[hc]: Removed.

	* btk/Makefile.am: Remove btkcellrendererseptext.[hc]
	
Sat Aug  7 18:15:15 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_row_deleted): 
	(btk_combo_box_menu_row_inserted): 
	(btk_combo_box_menu_row_changed): Correctly handle
	insertion and deletion of separators in menu mode.

2004-08-07  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkevents-win32.c (handle_configure_event,
	bdk_event_translate:WM_WINDOWPOSCHANGED): Add _bdk_offset_{x,y} to
	top-level window coordinates, not just in generated
	events. (#148526, Robert Ögren)

Sat Aug  7 01:26:08 2004  Matthias Clasen  <maclas@gmx.de>

	Make the column drag code a bit more robust (still scary, 
	though).  (#106992, Christian Biere)
	
	* btk/btktreeview.c (_btk_tree_view_column_start_drag): Assert
	that cur_reorder is NULL here.

	* btk/btktreeview.c (btk_tree_view_button_release_drag_column): 
	Reset cur_reorder to NULL, and only hide drag_highlight_window 
	if it exists.  

2004-08-06  Federico Mena Quintero  <federico@ximian.com>

	Fix #144232:

	* btk/btkfilechooserdefault.c (save_widgets_create): Use a
	BtkFileChooserEntry for the file name, rather than a BtkEntry.
	(update_chooser_entry): Set the contents of the file chooser entry
	rather than the plain entry's.
	(btk_file_chooser_default_set_current_folder): Set the new folder
	on the save entry.
	(btk_file_chooser_default_set_current_name): Set the name on the
	file chooser entry.
	(check_save_entry): Use the file chooser entry rather than the
	plain entry.

	* btk/btkfilechooserentry.c
	(_btk_file_chooser_entry_set_base_folder): Call
	btk_file_chooser_entry_changed() so that we recompute the current
	folder based on the new base folder.

2004-08-06  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkwindow-win32.c : make it compile and more
	similar to the X11 implementation [backward compatibility
	for BDK_WINDOW_TEMP, BDK_INPUT_ONLY (fixes bug #148702), 
	use the *screen* function variants, dont reparent already 
	destroyed]
	(get_visible_rebunnyion) : take the win32 part into account
	(_bdk_windowing_window_destroy) : remove from handle table

	* bdk/win32/bdkdisplay-win32.c : added 
	bdk_display_(request|supports)_selection_notification ()
	with a currently mostly pointless implementation ;-)

	* btk/btkfilesystemwin32.c (*_to_path) : same changes as on *NIX,
	plugs memory leak
	(btk_file_system_win32_render_icon) : use new BTK_STOCK_DIRECTORY

	* btk/makefile.msc.in demos/btk-demo/makefile.msc.in 
	  btk/stock-icons/makefile.msc tests/makefile.msc : updated

	* bdk/bdk.def btk/btk.def : updated externals

	* tests/testiconview.c : remove unneeded dirent.h inclusion

2004-08-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_move_cursor_page_up_down): Fix
	an off-by-one error.  (#141809, Markku Vire)

	* btk/btkdnd.c (btk_drag_dest_set, btk_drag_source_set): Really
	fix the initialization of the target list.

	Support XDND v5. (#10220, Owen Taylor)
	
	* bdk/x11/bdkdnd-x11.c: Record the XDND version and whether the
	drop was successful in the BdkDragContextPrivateX11 struct.
	(xdnd_finished_filter): Store the success status of the drop
	for an XDND version 5 interaction. For other versions, always
	assume the drop was successful.
	(xdnd_check_dest): Return the protocol version.
	(_bdk_drag_get_protocol_for_display): Return the protocol version.
	(bdk_drag_find_window_for_screen): Store the used protocol version
	in the BdkDragContext.
	(xdnd_send_enter): Send the used protocol version from the context,
	instead of hardwiring 3.
	(xdnd_enter_filter): Accept protocol versions >= 3 and store the
	used protocol version in the context.

	* bdk/bdkdnd.h: 
	* bdk/x11/bdkdnd-x11.c (bdk_drag_drop_succeeded): New function
	to find out whether a drop was successful.

2004-07-28  Robert Ögren  <btk@roboros.com>

	* bdk/win32/bdkinput-win32.c (_bdk_input_other_event): Set x_root
	and y_root in button and motion events from the tablet. (#148715)

Thu Aug  5 19:58:08 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkplug.c (btk_plug_realize): Call
	bdk_window_enable_synchronized_configure()

	* bdk/x11/bdkwindow-x11.c (bdk_window_configure_finished): Make
	noop if bdk_window_enable_synchronized_configure() has not been
	called.

2004-08-04  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfilechooser.[hc]: Add setter and getter for the 
	::show-hidden property.  (#145610, Jeff Franks)

	* tests/testiconview.c: Add buttons to select and unselect all
	nodes, make the popup menu actually work.

	* btk/btkiconview.c: Make BTK_SELECTION_BROWSE work as intended,
	let button 3 presses through to the app, to make popup menus
	work.

	* tests/Makefile.am: Add testiconview.
	* tests/testiconview.c: A test for BtkIconView
	* tests/bunny-textfile.png: ...which uses this image.

Wed Aug  4 01:37:57 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c: 
	* btk/btktreestore.c: 
	* btk/btktreemodelfilter.c: 
	* btk/btknotebook.c: s/childs/children/g.

Wed Aug  4 01:04:48 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #133446, noticed by Christian Persch:
	
	* btk/btkaction.c (btk_action_class_init): Add a new boolean 
	property ::visible-overflown. 
	* btk/btkaction.c (btk_action_create_menu_proxy): Don't create 
	a menu proxy if visible_overflown is FALSE.  

Tue Aug  3 20:16:26 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.[hc]: Make the the BtkAction{Toggle,Radio,}Entry*
	arguments to the btk_action_group_add_..._actions() functions const, 
	since the most common use case is to use a static array.  (142334, 
	Mariano Suarez-Alvarez)

Tue Aug  3 20:03:33 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (get_node): Make btk_ui_manager_add_ui()
	accept paths with a leading "/ui".  (#149077, David Malcolm)

Tue Aug  3 19:59:29 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconview.c: Fix some warnings.

Tue Aug  3 18:38:40 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreemodelfilter.c: Correct the return type
	of btk_tree_model_filter_get_flags().  (#149195, Morten Welinder)

Tue Aug  3 18:16:55 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #149191, reported by Morten Welinder:
	
	* btk/btkmain.c: Include btkclipboard.h,
	* btk/btkwidget.h: Declare _btk_widget_grab_notify, not
	_btk_widget_emit_grab_notify.  

Tue Aug  3 14:50:14 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c (add_size): Add missing parens.
	(#149190, Morten Welinder)

Tue Aug  3 14:29:49 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_fill): Remove 
	accidentally committed debug code.

Tue Aug  3 01:19:12 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_relayout_item): Optimize 
	for the case that row_column and col_column are unset.  
	(#148868, Lorenzo Gil Sánchez)

Mon Aug  2 21:52:45 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/x11/bdkwindow-x11.c (ensure_sync_counter): New
	function. Make sure the sync counter is recreated when a window is
	reparented to become a toplevel. (#148358)

2004-08-02  Matthias Clasen  <mclasen@redhat.com>

	* tests/testcombo.c: Some trees in combo boxes.

	* btk/btkcombobox.c: Rework the combo box to handle 
	tree models.  (#139582, Matt Walton)
	
	* btk/btktreeview.h: 
	* btk/btktreeview.c: 
	* btk/btktreeprivate.h: Add a new boolean property 
	::hover-expand and make the treeview expand/collapse rows
	on mouseover if it is set.

	* btk/btkiconview.h: Remove some erroneous declarations.

	* btk/btkcellview.c (btk_cell_view_set_cell_data): Don't
	crash if the displayed row is gone.

2004-08-02  Morten Welinder  <terra@bunny.org>

	* btk/btkentry.c (btk_entry_motion_notify): C99ism.

Mon Aug  2 01:30:03 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.[hc]: 
	* btk/btkentry.[hc]: Add a new binding signal ::backspace,
	bind it to the backspace key, and make it pay attention 
	to the Bango backspace_deletes_character 
	attribute.  (#119891, Noah Levitt, patch by Theppitak 
	Karoonboonyanan)

Mon Aug  2 01:02:57 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkevents-x11.c (bdk_check_wm_state_changed): 
	(bdk_check_wm_desktop_changed): Add missing error 
	traps.  (#149011, Thomas Leonard)

Mon Aug  2 00:21:26 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextview.c (blink_cb): Add the same warning
	that the blink_cb() in BtkEntry already has.  (#148733)

Mon Aug  2 00:12:16 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (btk_entry_class_init):
	(btk_entry_get_alignment): 
	(btk_entry_set_alignment): Document the xalign property
	and its getter and setter as 2.4 additions.  (#148978,
	Axel Simon)

Mon Aug  2 00:11:31 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (btk_ui_manager_class_init): 
	* btk/btkactiongroup.c (btk_action_group_class_init): Use
	canonical signal names in doc comments, since btk-doc won't
	pick up signal docs with underscores.  

2004-08-01  Matthias Clasen  <mclasen@redhat.com>
	
	* configure.in: Post-release version bump

	* === Released 2.5.1 ===
 
Thu Jul 29 16:36:42 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeprivate.h: New arguments

	* btk/btktreeview.c:
	(btk_tree_view_class_init): Add key_release callback
	(btk_tree_view_init): Initialize timeout handler
	(btk_tree_view_unrealize): clear timeout if needed
	(btk_tree_view_key_press): Typeahead support
	(btk_tree_view_key_release): Not used yet -- will be needed for
	typeahead.
	(btk_tree_view_search_entry_flush_timeout): Remove typeahead entry
	in a timeout.
	(btk_tree_view_ensure_interactive_directory):
	(btk_tree_view_real_start_interactive_search):
	(btk_tree_view_search_init):
	(btk_tree_view_start_interactive_search): Typeahead support added.
	(btk_tree_view_search_dialog_hide): Clear timeout and text when we
	hide.

Sat Jul 31 23:17:44 2004  Matthias Clasen  <maclas@gmx.de>

	* NEWS: Updates

Sat Jul 31 01:13:01 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c: 
	* btk/btkentry.c: 
	* btk/btkaction.c: Use the canonical form of signal names 
	after "notify::". Otherwise, no notification arrives. 
	BObject should have a warning for that, really.  (#148879, 
	Lorenzo Gil Sánchez)

Sat Jul 31 00:42:08 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkwindow-x11.c (bdk_window_set_keep_below): 
	* bdk/x11/bdkwindow-x11.c (bdk_window_set_keep_above): Don't
	set both states at once.  (#148789, Matthew Garrett)

2004-07-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c: Don't forget to destroy the row separator
	function user data when the combo box is destroyed.

2004-07-30  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.h: 
	* btk/btkcombobox.c: Change the api for separators to use a 
	separator function instead of a boolean column.

	* tests/testcombo.c: Update to match the api change.

Fri Jul 30 02:21:41 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Fix the positioning of the popup. 

Fri Jul 30 00:56:31 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcomboboxentry.c (btk_combo_box_entry_active_changed): 
	Implement this in terms of btk_combo_box_get_active_iter(),
	instead of btk_combo_box_get_active().

2004-07-29  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault): Add
	a field for an "add to shortcuts" menu item.
	(popup_menu_detach_cb): Clear out the field.
	(file_list_build_popup_menu): Only build the menu here.
	(file_list_update_popup_menu): Build the menu, then update the
	sensitivity of its items.
	(file_list_popup_menu): Use file_list_update_popup_menu().
	(bookmarks_check_add_sensitivity): Also set the sensitivity of the
	popup menu item.  Correctly handle the case for a *single* file.
	Simplify a bit.
	(bookmarks_add_selected_folder): New helper function; code moved
	over from add_bookmark_button_clicked_cb().
	(add_bookmark_button_clicked_cb): Use the function above.
	(selection_check): Rather than returning a boolean value for
	emptiness, actually return the number of selected rows.  Also,
	simplify a bit.
	(get_selected_path): New helper function.

2004-07-29  Anders Carlsson  <andersca@bunny.org>

	* demos/btk-demo/Makefile.am:
	* demos/btk-demo/clipboard.c: (copy_button_clicked),
	(paste_received), (paste_button_clicked), (do_clipboard):
	Add clipboard demo.
	
2004-07-28  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	Store signal IDs in bulongs, not buints!
	(btk_file_chooser_default_hierarchy_changed): We now monitor the
	focus widget on our toplevel to know which widget was last focused
	at the time our "should_respond" method gets called.
	(shortcuts_activate_selected): New helper function.
	(shortcuts_get_selected): New helper function.
	(remove_selected_bookmarks): Use shortcuts_get_selected().
	(bookmarks_check_remove_sensitivity): Likewise.
	(shortcuts_reorder): Likewise.
	(shortcuts_activate_iter): Renamed from shortcuts_activate_item().
	Activate by iter, not by item number.
	(save_folder_combo_changed_cb): Use shortcuts_activate_iter().
	(shortcuts_row_activated_cb): Likewise.
	(btk_file_chooser_default_should_respond): If the last focused
	widget on the toplevel was the shortcuts list, activate the
	selected shortcut.

2004-07-28  Matthias Clasen  <mclasen@redhat.com>

	* bdk/linux-fb/bdkprivate-fb.h: Make the fb backend compile against
	current freetype.  (#148558, Nicolas Deves)

	* btk/btktreeview.c: Replace the EXPANDER_MAX macro by 
	ROW_HEIGHT.  (#145528)

	* btk/btkuimanager.c: Warning fixes.

	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_set_background): Fix
	prototype mismatch.  (#148589, Nicolas Deves)

2004-07-28  Anders Carlsson  <andersca@bunny.org>

	* bdk/x11/bdkdrawable-x11.c (bdk_draw_rectangle_alpha_libbtk_only): 
	Cast to 32-bit integers when premultiplying, suggested by Keith Packard.

2004-07-27  Anders Carlsson  <andersca@bunny.org>

	* demos/btk-demo/iconview.c: (do_iconview):
	Change selection mode to multiple.
	
	* bdk/bdkdrawable.h:
	* bdk/linux-fb/bdkdrawable-fb2.c:
	(bdk_draw_rectangle_alpha_libbtk_only):
	* bdk/win32/bdkdrawable-win32.c:
	(bdk_draw_rectangle_alpha_libbtk_only):
	* bdk/x11/bdkdrawable-x11.c: (bdk_x11_draw_image),
	(get_impl_drawable), (bdk_x11_draw_pixbuf),
	(bdk_draw_rectangle_alpha_libbtk_only):
	Add bdk_draw_rectangle_alpha_libbtk_only which uses 
	XRenderFillRectangle on X11. It's stubbed out on the 
	Win32 and fb backends.
	
	* btk/btkiconview.c: 
	(btk_icon_view_paint_rubberband):
	Use bdk_draw_rectangle_alpha_libbtk_only here.

2004-07-27  Anders Carlsson  <andersca@bunny.org>

	* btk/btkaboutdialog.c: (btk_about_dialog_init),
	(text_view_style_set), (add_credits_page),
	(display_credits_dialog), (display_license_dialog):
	Remove dialog separators, fix text view background setting,
	use Close buttons instead of OK buttons.
	
2004-07-27  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_ensure_interactive_directory): 
	Add a frame around the C-f popup to stop it from merging visually
	in whatever is underneath.

	* btk/btkcombobox.h: 
	* btk/btkcombobox.c (btk_combo_box_get_popup_accessible): New 
	function necessary to make BtkComboBox accessible.  (#132847, 
	Padraig O'Briain)

Tue Jul 27 02:34:06 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c (btk_widget_dispose): Hide parentless
	windows when disposing them.  (#133231, Michael Natterer)

2004-07-26  Matthias Clasen  <mclasen@redhat.com>

	* btk/btklabel.c (btk_label_class_init): Expand the documentation
	for BtkLabel::ellipsize.

Mon Jul 26 00:38:27 2004  Matthias Clasen  <maclas@gmx.de>

	Make the BtkComboBox in list mode scroll if the list is too
	large to fit in the popup.  (#135543)

	* btk/btkcombobox.c (btk_combo_box_set_popup_widget): Add a 
o	scrolled window to the popup in list mode.
	(btk_combo_box_list_position): Calculate the height of the
	popup so that it fits on the screen, set the scrollbar policy
	of the scrolled window appropriately.
	(btk_combo_box_popup): Use the height calculated by 
	btk_combo_box_list_position().
	(btk_combo_box_remeasure): Don't add unnecessary padding.
	(btk_combo_box_size_request): But add the focus with here.
	(btk_combo_box_list_setup): Connect to enter notify on the 
	popup window to activate auto scrolling.
	(btk_combo_box_list_enter_notify): Activate auto scrolling.
	(btk_combo_box_list_button_pressed): Setup a timeout for
	auto scrolling. 
	(btk_combo_box_list_scroll_timeout): Timeout function for
	auto scrolling.
	(btk_combo_box_list_auto_scroll): Scroll the list when the 
	pointer leaves the window.
	
Sun Jul 25 19:51:17 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btknotebook.c (btk_notebook_scroll): Ignore scroll
	events from the content of the page.  (#148409, Gabriel 
	de Perthuis)

Sat Jul 24 21:38:12 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbar.c (internal_insert_element): Warn if you try to
	add a tool item to a toolbar using the deprecated API.

Fri Jul 23 13:04:10 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkdnd.c (btk_drag_dest_set): Revert the change to
	initialize target_list to an empty list instead of NULL,
	since it broke tree dnd.  (#148215, Ernst Persson)

	* btk/btkdnd.c (btk_drag_dest_add_text_targets): 
	* btk/btkdnd.c (btk_drag_source_add_text_targets): Instead 
	handle target list being NULL here.

2004-07-23  Dafydd Harries  <daf@muse.19inch.net>

	* btk/btkradioaction.c:
	* btk/btkradiobutton.c:
	* btk/btkentry.c:
	* btk/btkmisc.c:
	Improve various translatable messages. (#137616)

Fri Jul 23 11:11:10 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_start_editing): 
	Align the entry in the same way as the cell.  (#136749)

Fri Jul 23 11:01:00 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextbtree.c (_btk_text_line_previous_could_contain_tag): 
	Don't iterate too far up. (#147965, Olivier Sessink)

Fri Jul 23 10:28:43 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_finalize): 
	* btk/btkradioaction.c (btk_radio_action_finalize): 
	* btk/btkfontsel.c (btk_font_selection_finalize): 
	* btk/btkcellview.c (btk_cell_view_finalize): 
	* btk/btkcalendar.c (btk_calendar_finalize): 
	* btk/btkactiongroup.c (btk_action_group_finalize): Remove
	unnecessary checks.  (#148175, Morten Welinder)

Thu Jul 22 01:42:16 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_class_init): 
	Add a new :ellipsize property which controls ellipsization of the 
	rendered text.  (#144835, Vincent Untz, patch by Jonathan Blandford
	and Anders Carlsson)
	
	* btk/btkfilechooserdefault.c (create_file_list): Use ellipsization
	for the name column.

Thu Jul 22 01:21:28 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfontsel.c (btk_font_selection_init): Add additional
	accessability relations.  (#141804,  Padraig O'Briain)

Thu Jul 22 01:16:23 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c: Avoid some warnings.

Thu Jul 22 01:05:16 2004  Matthias Clasen  <maclas@gmx.de>

	* configure.in: Require Bango 1.5.1 (for ellipsisation).

	* btk/btklabel.h: 
	* btk/btklabel.c (btk_label_class_init): Add a new :ellipsize
	property which controls ellipsization of the label.  (#125250, 
	Tim Van Wassenhove, patch by James M. Cape)

	* tests/testellipsise.c: Simple test for ellipsizsation.

Wed Jul 21 22:46:27 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_new_text): Don't leak the
	list store.  (#148134, Crispin Flowerday)

Wed Jul 21 22:35:47 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_destroy): Don't leak the
	menu.  (#148110, Tommi Komulainen)

Wed Jul 21 22:24:10 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellview.c (btk_cell_view_finalize): Don't leak
	tree model and tree row reference.  (#148125, Crispin Flowerday)

Wed Jul 21 22:17:06 2004  Matthias Clasen  <maclas@gmx.de>

	* tests/testcombo.c (main): Don't leak models.  (#148128,
	Tommi Komulainen)

Wed Jul 21 21:26:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkviewport.c (viewport_set_adjustment): Don't leak
	the adjustments.  (#148089, Tommi Komulainen)

Wed Jul 21 21:20:21 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_destroy): Don't leak
	the adjustments.  (#148073, Tommi Komulainen)

Wed Jul 21 21:04:50 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktoolbar.c (btk_toolbar_finalize): Don't leak the 
	arrow.  (#148064, Tommi Komulainen)

2004-07-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcalendar.c: Use the new text target functionality
	in BtkTargetList instead of hardcoding a subset of text targets.

Tue Jul 20 23:11:23 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkevents-x11.c: Hook up btk-menu-bar-accel to
	an XSetting, Btk/MenuBarAccel.  (#120859, Scott James Remnant)

Tue Jul 20 22:26:29 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserutils.h: 
	* btk/btktoolbutton.c: 
	* btk/btktoolbar.c: 
	* btk/btkicontheme.c: 
	* btk/btkcalendar.c: 
	* demos/btk-demo/ui_manager.c: 
	* demos/btk-demo/appwindow.c: Remove trailing commas
	from enumerations.  (#148035)

2004-07-20  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkcellrenderer.c (btk_cell_renderer_class_init): Fix the
	documentation comment for the editing-started signal.

	* btk/btkmarshalers.list: Added VOID:OBJECT,STRING for
	BtkCellRenderer::editing-started.

2004-07-20  Matthias Clasen  <mclasen@redhat.com>

	* tests/testactions.c (main): 
	* tests/testmerge.c (main): Add some refcount debugging.

	* btk/btkuimanager.c (update_node, free_node): Ref an sink
	all proxies, so that we can properly clean up floating proxies
	which the app didn't adopt.  (#147926, Tommi Komulainen)

2004-07-20  Matthias Clasen  <mclasen@redhat.com>

	Allow custom initialization of cell editables.  (#147221)
	
	* btk/btkcellrenderer.h (struct _BtkCellRendererClass): 
	* btk/btkcellrenderer.c (btk_cell_renderer_class_init): Add a 
	::editing-started signal as a hook for setting up the 
	BtkCellEditable.
	(btk_cell_renderer_start_editing): ...and emit it here.

Mon Jul 19 23:51:50 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_button_press): Set drag_pos
	before grabbing the focus, since we may reenter into 
	btk_tree_view_motion_resize_column() which requires drag_pos
	to be set.  (#147913, Guilherme Salgado, patch by John Finlay) 

Mon Jul 19 23:51:50 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_enter_notify): Don't
	use uninitialized node pointer.  (#147911, Peter Zelezny)

Tue Jul 20 04:34:56 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* configure.in: Bump version number

Sun Jul 18 17:21:10 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* === Released 2.5.0 ===

	* NEWS: updates

	* tests/testcombo.c: Fix compilation

2004-07-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentrycompletion.c (btk_entry_completion_set_popup_completion):
	Fix doc comment.
	
2004-07-19  Matthias Clasen  <mclasen@redhat.com>

	Make BtkCellView public, since people seem to have uses for it, 
	it is clean API and we were just conservative in not making it 
	public initially. At the same time, get rid of BtkCellViewMenuItem,
	which doesn't have any function which can't be served by a
	BtkMenuItem with a BtkCellView child.  (#136637, Padraig O'Briain)

	* btk/btk.h: Include btkcellview.h

	* btk/Makefile.am (btk_public_h_sources): 

	* btk/Makefile.am (btk_private_h_sources): 
	(btk_c_sources): Remove btkcellviewmenuitem.[hc]
	* btk/btkcombobox.c: Replace all uses of BtkCellViewMenuItem by
	BtkMenuItem with a BtkCellView child.

	* btk/btkcellviewmenuitem.[hc]: Removed.

2004-07-19  Matthias Clasen  <mclasen@redhat.com>

	Support inline autocompletion in entries  (#135953)
	
	* btk/btkentryprivate.h: 
	* btk/btkentrycompletion.h: 
	* btk/btkentrycompletion.c (btk_entry_completion_class_init): 
	Add a new signal ::insert-prefix which can be used to override 
	the default inline-completion behaviour. Add two new boolean
	properties, :popup_completion and :inline_completion which
	determine how the possible completions should be presented.
	(btk_entry_completion_insert_prefix): New function to request
	a prefix insertion. 

	* btk/btkentry.c: Add the necessary glue for inline completion. 

Sun Jul 18 15:28:24 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkdnd.c (btk_drag_source_set, btk_drag_dest_set): Create an
	empty target list if targets is NULL.

	* configure.in: Add check for X11/extensions/sync.h. (#147416,
	Morten Welinder)

Sun Jul 18 01:24:31 2004  Matthias Clasen  <maclas@gmx.de>

	* NEWS: Updates for 2.5.0

Sat Jul 17 23:11:04 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconview.h:
	* btk/btkiconview.c (btk_icon_view_class_init): 
	* btk/btkiconview.c (btk_icon_view_set_orientation): 
	* btk/btkiconview.c (btk_icon_view_get_orientation): 
	* btk/btkiconview.c (btk_icon_view_calculate_item_size): 
	* btk/btkiconview.c (btk_icon_view_layout_single_row): 
	Add a new :orientation property to determine whether text
	is positioned below or beside icons.  (#147463)

Sat Jul 17 23:03:30 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconview.c (btk_icon_view_paint_item): 
	* btk/btkiconview.c (btk_icon_view_calculate_item_size): 
	* btk/btkiconview.c (btk_icon_view_layout_single_row): Draw 
	focus indicator outside the selection, respect focus 
	line width.  (#147460) 

Sat Jul 17 01:17:33 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkdnd-x11.c (xdnd_check_dest): Fix a warning
	message.

Sat Jul 17 00:48:27 2004  Matthias Clasen  <maclas@gmx.de>

	Support text/plain selection target  (#55117, Owen Taylor)
	
	* btk/btkselection.h: 
	* btk/btkdnd.h: 
	* btk/btkselection.c (btk_target_list_add_text_targets): 
	* btk/btkdnd.c (btk_drag_dest_add_text_targets): 
	* btk/btkdnd.c (btk_drag_source_add_text_targets): New
	functions to facilitate handling of text targets.

	* btk/btkentry.c: 
	* btk/btktextview.c: Use the new text target handling 
	functions instead of hardwiring the list of supported
	text targets everywhere.

	* btk/btkselection.c (btk_selection_data_get_text): 
	(btk_selection_data_set_text): 
	Support the targets text/plain, text/plain?charset=utf-8
	and text/plain?charset=<LOCALE-CHARSET> as outlined in
	#55117: 
	For text/plain send only ASCII, but accept 8-bit text 
	and treat it as ISO-8859-1 as specified by the Xdnd spec.
	Always send CRLF terminators. Accept either and convert
	into the native terminator for the platform.
	
Fri Jul 16 23:20:34 2004  Matthias Clasen  <maclas@gmx.de>

	Support themed window icons.  (#92346, Calum Benson)
	
	* btk/btkicontheme.c (btk_icon_theme_get_icon_sizes): New 
	function to obtain information about the sizes in which an
	icon is available.  

	* btk/btkwindow.h: 
	* btk/btkwindow.c (btk_window_class_init): 
	(btk_window_set_icon_name): 
	(btk_window_get_icon_name): Add an "icon_name" property
	(btk_window_set_default_icon_name): ...and a default icon name. 
	(icon_list_from_theme): 
	(update_themed_icon): New auxiliary functions to create a 
	list of all available sizes of a themed icon and update the
	window icon list from it.

2004-07-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_scroll_event): Make 
	scrolling work if no item is selected.
	(btk_cell_editable_key_press): Don't eat space.

	Add a combo box cell renderer (#139347, Lorenzo Gil Sanchez)
	
	* btk/btkcellrenderercombo.[hc]: New Files.

	* btk/btk.h: 
	* btk/Makefile.am (btk_public_h_sources, btk_c_sources): 
	Add the new files.

	* btk/btkcombobox.[hc]: Implement BtkCellEditable, add a 
	:has-frame property for suppressing the frame around 
	the child and redo the size allocation logic to take 
	focus width into account.

	* btk/btkcomboboxentry.c (btk_combo_box_entry_init): 
	Acknowledge the BtkComboBox:has-frame property and make
	the entry fill its allocation vertically.

	* btk/btkmarshalers.list: Add BOOLEAN:STRING.
		
	* btk/btktreeview.c (btk_tree_view_remove_widget): Queue
	a draw here to keep non-widget windows from leaving 
	shadows behind.

2004-07-16  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_forall): Don't iterate
	multiple times over some of the children. 

Thu Jul 15 22:19:40 2004  Matthias Clasen  <maclas@gmx.de>

	Fix #60128, #58307, #144706:
	
	* btk/btkstyle.c (btk_style_real_copy): Handle references
	to bg_pixmaps properly.
	(btk_style_real_unrealize): Don't keep dangling references
	to the bg_pixmaps.  
	(btk_style_attach): Split the loop into two loops, first 
	looking for a matching style, then for an empty one.
	(btk_style_finalize): 
	(btk_style_duplicate): Add comments explaining the handling
	of style->styles.

Thu Jul 15 20:31:28 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkspinbutton.c (start_spinning): Install the timeout
	before changing the value, so that a ::value_changed handler
	has a chance to remove it.  (#122427, Elke Meier)

Thu Jul 15 19:20:05 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkbtk+/im-x11.c (_bdk_x11_initialize_locale): 
	* btk/btkcalendar.c (btk_calendar_class_init): Use 'cannot'
	instead of 'can not' in messages.  (#144226, Morten Welinder)

2004-07-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_class_init): 
	* btk/btkcellrenderer.c (btk_cell_renderer_class_init): 
	Correct the declared default values of several properties
	to be in sync with the actual initial values.

	* btk/btktreeviewcolumn.c (btk_tree_view_column_class_init): 
	Make spacing a property, correct the declared default values 
	of several properties to be in sync with the actual initial 
	values.  (#147654, Matthias Clasen)

	* btk/btkmenu.c (btk_menu_set_tearoff_state): Don't reparent
	back to menu->toplevel if it is already gone because we're
	shutting down.  (#147656, John Cupitt)

2004-07-14  Federico Mena Quintero  <federico@ximian.com>

	Fix #126295:

	* btk/btktreeview.c (btk_tree_view_bin_expose): Draw a focus
	indicator along the edge of the bin_window when the tree is empty.
	(grab_focus_and_unset_draw_keyfocus): New helper function.
	(btk_tree_view_button_press): Remove a bit of superfluous code.
	Use the helper function to save on duplicated code.
	(btk_tree_view_button_press): Grab the focus if the tree is empty.
	(btk_tree_view_focus): Allow focusing into an empty tree.

2004-07-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaboutdialog.c (add_credits_page): Don't use
	gcc extensions for the ternary ?: operator.  (#147590,
	Damien Carbery)

2004-07-14  Federico Mena Quintero  <federico@ximian.com>

	Fix #144405, patch by Padraig O'Briain <padraig.obriain@sun.com>:

	* btk/btkfilechooserdefault.c (shortcuts_list_create): Set the
	accessible object name for the tree view.
	(create_file_list): Likewise.

Tue Jul 13 21:53:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c (free_unthemed_icon): Don't leak
	no_svg_filename.  (#147399, Kjartan Maraas)

2004-07-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeviewcolumn.c (_btk_tree_view_column_get_neighbor_sizes): 
	Make this work in RTL context.

2004-07-13  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (shortcuts_activate_volume): Set a
	busy cursor while mounting the volume.  Also, ref the chooser
	while mounting, as we may re-enter.  Fixes #139376.

2004-07-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_adjustment_changed): 
	Prepare to handle composite implementations of
	BtkCellEditable, but recursively poking at
	allocation->y (hack stolen from BtkCList).
	(check_expander_max): Tweak the warning.

	* btk/btkmain.h: Add btk_parse_args(), its a public 
	function.  (#147476, Owen Taylor)

	* btk/btkcombobox.c (btk_combo_box_popdown): Don't
	crash if unrealized.

Tue Jul 13 01:50:06 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkaboutdialog.c (display_credits_dialog): Don't
	display untranslated translator credits. 

Tue Jul 13 01:15:05 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconview.c: Some documentation updates.

Tue Jul 13 00:40:29 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/bdkwindow.c (bdk_window_process_updates_internal): Do an
	empty begin_paint_rebunnyion()/end_paint() for windows without
	EXPOSURE_MASK.

	* bdk/x11/bdkwindow-x11.c (_bdk_x11_window_tmp_unset_bg,
	_bdk_x11_window_tmp_reset_bg): Remove checks for EXPOSURE_MASK.

2004-07-12  Matthias Clasen  <mclasen@redhat.com>

	* demos/btk-demo/appwindow.c: Use a BtkAboutDialog.

	* btk/btkaboutdialog.h: 
	* btk/btkaboutdialog.c: New widget: BtkAboutDialog.

	* btk/Makefile.am (btk_public_h_sources, btk_c_sources): 
	* btk/btk.h: Add BtkAboutDialog. (#109435, Paolo Borelli,
	patch by Matthias Clasen)

	* btk/btkrc.c (_btk_rc_init): Apply the btk-default-menu-item-style 
	to cell view menu items as well.  (#147405, John Cupitt)

	* btk/btkentrycompletion.c: Warning fixes.  (#147420,
	Morten Welinder)

	* btk/btkcombobox.c (btk_combo_box_destroy): Pop down 
	first. (#147399, John Cupitt)

Mon Jul 12 01:56:26 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkwindow-x11.c (bdk_toplevel_x11_free_contents): 
	Include the update_counter check in the HAVE_XSYNC condition,
	since update_counter isn't present in the !HAVE_XSYNC case.

Mon Jul 12 00:52:04 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/stock-icons/Makefile.am: 
	* btk/stock-icons/stock_about_{16,24}.png: 
	* btk/stock-icons/stock_connect_{16,24}.png: 
	* btk/stock-icons/stock_disconnect_{16,24}.png: 
	* btk/stock-icons/stock_edit_{16,24}.png: 
	* btk/stock-icons/stock_media_forward_{16,24}.png: 
	* btk/stock-icons/stock_media_next_{16,24}.png: 
	* btk/stock-icons/stock_media_pause_{16,24}.png: 
	* btk/stock-icons/stock_media_play_{16,24}.png: 
	* btk/stock-icons/stock_media_previous_{16,24}.png: 
	* btk/stock-icons/stock_media_record_{16,24}.png: 
	* btk/stock-icons/stock_media_rewind_{16,24}.png: 
	* btk/stock-icons/stock_media_stop_{16,24}.png: 
	* btk/btkstock.h (BTK_STOCK_ABOUT): 
	* btk/btkstock.h (BTK_STOCK_CONNECT): 
	* btk/btkstock.h (BTK_STOCK_DISCONNECT): 
	* btk/btkstock.h (BTK_STOCK_EDIT): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_FORWARD): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_NEXT): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_PAUSE): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_PLAY): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_PREVIOUS): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_RECORD): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_REWIND): 
	* btk/btkstock.h (BTK_STOCK_MEDIA_STOP): 
	* btk/btkiconfactory.c (get_default_icons): 
	* btk/btkstock.c (builtin_items): Add a number of new stock 
	items.  (#102530, #68015, #109811, Jordi Mallach, Benjamin Otte,
	Michael Opdenacker)

Sun Jul 11 15:24:03 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Bug 143330, support update counter spec.
	
	* configure.in: Add check for the Sync extension

	* bdk/bdkwindow.h: bdk_window_enable_synchronized_configure() and
	bdk_window_configure_finished()

	* btk/btkwindow.c (btk_window_move_resize): Call bdk_window_finish_configure().
	* btk/btkwindow.c (btk_window_realize): Automatically enable
	synchronized configures.

	* bdk/x11/bdkwindow-x11.h (struct _BdkToplevelX11): Store current
	and pending counter values. 

	* bdk/x11/bdkwindow-x11.c (bdk_window_configure_finished): New function.
	* bdk/x11/bdkwindow-x11.c
	(bdk_window_enable_synchronized_configure): New function.
	* bdk/x11/bdkwindow-x11.c (bdk_toplevel_x11_free_contents):
	Delete update counter.
	* bdk/x11/bdkwindow-x11.c (set_wm_protocols): Advertise
	_NET_WM_SYNC_REQUEST when Sync is available

	* bdk/x11/bdkevents-x11.c (bdk_wm_protocols_filter): Handle
	_NET_WM_SYNC_REQUEST messages
	* bdk/x11/bdkevents-x11.c (bdk_event_translate): Save counter
	value for use by bdk_window_configure_finished() when receiving
	ConfigureNotifies.

	* bdk/x11/bdkdisplay-x11.h (struct _BdkDisplayX11): Add use_sync flag
	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Check if the XSync
	extension is available
	* bdk/x11/bdkdisplay-x11.c: Add _NET_WM_SYNC_REQUEST and
	_NET_WM_SYNC_REQUEST_COUNTER to list of supported atoms.

	* bdk/linux-fb/bdkwindow-fb.c, bdk/win32/bdkwindow-win32.c: Add
	stubs for enable_synchronized_configure() and configure_finished()

Sat Jul 10 23:35:13 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (paste_received): Make middle-button pasting
	work as expected inside the entry.  (#116789, Scott Bronson)

Sat Jul 10 22:13:53 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktextbuffer.c (btk_text_buffer_select_range): Update 
	clipboards.  (#142805, Mikael Hallendal)

Sun Jul 11 01:38:48 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkpaned.c (btk_paned_expose): Remove clip-rebunnyion computing
	code. Just use &paned->handle_pos.

Sun Jul 11 01:12:50 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Bug 144271
	
	* btk/btknotebook.c (btk_notebook_size_allocate): Remove an
	unnecessary redraw..

	* btk/btknotebook.c (btk_notebook_page_allocate): Remove some
	incorrect redraws.

Sat Jul 10 01:33:25 2004  Matthias Clasen  <maclas@gmx.de>

	* docs/RELEASE-HOWTO: Updates.

Sat Jul 10 01:55:29 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/x11/bdkwindow-x11.c (_bdk_x11_window_tmp_{re|un}set_bg):
	Insert checks for root window. The root window is never mapped.

Sat Jul 10 01:06:05 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/x11/bdkwindow-x11.c (post_unmap): Fix a warning
	* bdk/x11/bdkwindow-x11.c (show_window_internal): Actually unset
	bg.

Sat Jul 10 00:37:45 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Bug 113310.
	
	* bdk/x11/bdkwindow-x11.c (_bdk_x11_window_tmp_{un|re}set_bg):
	New functions that can do a recursive unset/reset bg.

	* bdk/x11/bdkgeometry-x11.c: Remove
	bdk_window_tmp_{un|re}set_bg().

	* bdk/x11/bdkwindow-x11.c (pre_unmap, post_unmap): New functions
	called before and after unmapping a window. They unset the
	background of all other windows to prevent flicker from the X
	server repainting the background. post_unmap() also invalidates
	the parent of the unmapped window to draw it without roundtrips.

	* bdk/x11/bdkwindow-x11.c (show_window_internal): Unset
	background of newly mapped windows and all desendants to prevent
	flicker.
	
Fri Jul  9 15:33:55 2004  Manish Singh  <yosh@gimp.org>

	* bdk/bdkevents.c: have a dummy case BDK_OWNER_CHANGE in switch
	statements to avoid gcc warnings about not all enum values handled.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): ignore should live in 
	#ifdef HAVE_XFIXES.

Fri Jul  9 23:26:09 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	(Bug 113340)

	* bdk/x11/bdkwindow-x11.h (struct _BdkWindowImplX11): Add an
	"override_redirect" bit.

	* bdk/x11/bdkwindow-x11.c (bdk_window_new): Set it here.
	
	* bdk/x11/bdkwindow-x11.c (bdk_window_move, bdk_window_resize,
	bdk_window_move_resize): 
	Update the local size/position cache
	immediately for override redirect windows.

	* bdk/x11/bdkwindow-x11.c (show_window_internal): Invalidate
	newly mapped child and override redirect windows.

2004-07-09  Federico Mena Quintero  <federico@ximian.com>

	Fixes #137031:

	* btk/btkfilesystemunix.c (get_fallback_icon): New helper
	function, fetches a stock icon as a fallback.
	(btk_file_system_unix_volume_render_icon): Fall back to a stock
	icon.
	(btk_file_system_unix_render_icon): Fall back to a stock icon.
	Use helper functions rather than being a mega-function.
	(get_icon_name_for_directory): Renamed from
	get_icon_for_directory().
	(get_icon_type_from_path): New helper function; code pulled out
	from btk_file_system_unix_render_icon().
	(get_special_icon): Likewise.
	(get_icon_for_mime_type): Likewise.

2004-07-09  Federico Mena Quintero  <federico@ximian.com>

	* bdk/x11/bdkdnd-x11.c (xdnd_send_xevent): Fix typo; tmp_event ->
	temp_event.

2004-07-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktooltips.c (btk_tooltips_paint_window): Use the 
	requisition of the widget instead of relying on the style
	drawing function to supply the size of the drawable.  (#146531)	

2004-07-09  Matthias Clasen  <mclasen@redhat.com>

 	Make BtkEntry work harder to protect passwords:  (#143955,
	Morten Welinder)
	
	* btk/btkentry.c (btk_entry_destroy): Add a destroy handler
	to clear the password even if the widget is leaked.

	* btk/btkentry.c (btk_entry_real_delete_text): 
	* btk/btkentry.c (btk_entry_finalize): Zero out the memory
	before freeing it.
	
	* btk/btkentry.c (btk_entry_real_insert_text): Zero and free
	the old memory instead of just reallocating it.

	* btk/btkentry.c (btk_entry_create_layout): Don't leak text
	direction information for passwords.

2004-07-09  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkstyle.c: Fix some cases where style functions were 
	not handling widget == NULL properly.  (#146282)

Thu Jul  8 22:38:58 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c: Improve the EXPANDER_MAX warning.

2004-07-08  Federico Mena Quintero  <federico@ximian.com>

	Fix #139290:

	* btk/btkfilesystemmodel.c (_btk_file_system_model_new): Add a
	GError argument.  Do check for errors when getting the
	BtkFileFolder:  get the folder and read the children before
	actually creating the model.  Removed obsolete code that handled
	roots-changed on the file system.
	(file_model_node_get_info): Assert that we don't reach the old
	case to display file system roots.
	(roots_changed_callback): Removed.

	* btk/btkfilechooserdefault.c (set_list_model): Add a GError
	argument, and a boolean return value.  Return an error if we
	cannot create the file system model.  On error, set a NULL model
	on the tree.
	(btk_file_chooser_default_set_current_folder): Use the error value
	from set_list_model().
	(btk_file_chooser_default_set_property): Set the show_hidden
	property only if the browse_files_model exists.
	(btk_file_chooser_default_unselect_path): Only operate if the
	browse_files_model exists.
	(check_preview_change): Check whether we have the sort_model.
	(change_folder_and_display_error): Copy the path we get passed
	before using it.  There's a comment in there that explains why we
	need to copy it; basically, if the passed path belongs to the
	model, the model may go away in the middle of this function and
	we'll be left with a dangling pointer.
	(install_list_model_filter): Assert that the model is not NULL.
	(set_current_filter): Check whether the model exists.

	* btk/btktreeselection.c (btk_tree_selection_get_selected): Don't
	g_return_if_fail if the model is NULL.
	(btk_tree_selection_get_selected_rows): Likewise.
	(btk_tree_selection_count_selected_rows): Likewise.
	(btk_tree_selection_selected_foreach): Likewise.
	(btk_tree_selection_path_is_selected): Likewise; rather just
	return FALSE.
	(btk_tree_selection_select_all): Likewise.
	(btk_tree_selection_unselect_all): Likewise.
	(btk_tree_selection_select_range): Do g_return_if_fail() if the
	model is NULL.
	(btk_tree_selection_unselect_range): Likewise.

	* btk/btkfilesystemunix.c (fill_in_names): Return immediately if
	g_dir_open() fails:  there is no need to set the error ourselves,
	as g_dir_open() already does it.

2004-07-08  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_set_search_equal_func): Allow
	to restore the default search function.  (#145365, John Finlay) 

	* bdk/x11/bdkdnd-x11.c (xdnd_send_xevent): Don't leak 
	references to the drag context.  (#144324, Alex Larsson)

Thu Jul  8 00:31:34 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeview.c (btk_tree_view_set_model): Stop editing
	when a new model is set.  (#145566, Dmitry M. Shatrov)

Wed Jul  7 23:44:32 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkimage.c (btk_image_expose): Make sure that subpixbufs
	are properly aligned for bdk_pixbuf_saturate_and_pixelate(),
	in order to avoid rendering artifacts from misaligned 
	pixelation patterns.  (#145585, Felipe Heidrich, Billy Biggs)

2004-07-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c: 
	* btk/btktreeview.h: Small documentation fixes.

2004-07-07  Matthias Clasen  <mclasen@redhat.com>

	Support separators in combo boxes and more generally in tree 
	views  (#135873):
	
	* btk/btkcombobox.h: 
	* btk/btkcombobox.c (btk_combo_box_get_row_separator_column):
	* btk/btkcombobox.c (btk_combo_box_set_row_separator_column):
	Add a ::row-separator-column property with getter and setter, 
	which can indicate a boolean model column to determine which
	rows are separators. 

	* btk/btkcombobox.c: Display separator rows as separator menu 
	items in menu mode, and by using the new treeview separator 
	functionality in list mode.

	* btk/btktreeview.h: 
	* btk/btktreeprivate.h:
	* btk/btktreeview.c (btk_tree_view_get_row_separator_func): 
	* btk/btktreeview.c (btk_tree_view_set_row_separator_func): 
	Add a callback to determine whether a row is a separator.
	
	* btk/btktreeview.c (btk_tree_view_bin_expose): 
	* btk/btktreeview.c (btk_tree_view_create_row_drag_icon): 
	* btk/btktreeview.c (validate_row): Use the new callback
	to determine whether a row is a separator, and draw it
	as a separator then. Since separators should take up less
	vertical space than regular rows, this requires removing
	the redundant MAX(...,expander_size) calls which appear in
	many places. Instead, the MAX() is now only done in 
	validate_row(), and only if the row is not a separator.
	To catch possible side effects of this intrusive change,
	I have left EXPANDER_MAX() calls in place of the MAX() calls
	which will emit a warning if something breaks. They should
	be removed before 2.6.

	* btk/btktreeselection.c (row_is_selectable): Don't let 
	separator rows be selected.
	
	* tests/testcombo.c (create_blaat): Add a separator column.

Tue Jul  6 22:58:00 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkwindow-x11.c (bdk_x11_window_set_user_time): Fix
	a 64bit alignment issue.  (#144302, Sunil)

2004-07-07  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdrawable-win32.c (bdk_win32_draw_text)
	* bdk/win32/bdkfont-win32.c (bdk_text_extents)
	* bdk/win32/bdkproperty-win32.c (find_common_locale,
	bdk_property_change)
	* bdk/win32/bdkselection-win32.c (bdk_selection_convert): Use
	g_utf8_to_utf16() instead of the removed _bdk_utf8_to_ucs2() (see
	below).

	* bdk/win32/bdkglobals-win32.c
	* bdk/win32/bdkmain-win32.c (_bdk_windowing_init)
	* bdk/win3/bdkprivate-win32.h: Add a variable for the TARGETS
	atom. Initialize it. Declare it. Drop the variable for the
	COMPOUND_TEXT atom.

	* bdk/win32/bdkim-win32.c (bdk_wcstombs): Don't return UTF-8. This
	function is supposed to return the string in the locale's charset
	and encoding. Use g_convert().

	(bdk_mbstowcs): Similarily, don't take an UTF-8 string, but a
	string in the locale's charset. Use g_convert().

	(_bdk_ucs2_to_utf8, _bdk_utf8_to_wcs, _bdk_utf8_to_ucs2):
	Delete. The UCS-2 functions didn't handle surrogates anyway. Use
	GLib's UTF-16 functions instead. Windows uses UTF-16.

	* bdk/win32/bdkprivate-win32.h: Remove declarations of the deleted
	functions mentioned above.

	* bdk/win32/bdkproperty-win32.c (bdk_property_change): Use CF_TEXT
	also if the string is of type STRING, i.e. ISO-8859-1, and the
	current codepage is 1252, and contains no C1 chars. Accept
	also UTF8_STRING.

	* bdk/win32/bdkselection-win32.c (_bdk_selection_property_store):
	Mark as static. When storing STRING data, convert to
	Latin-1. (#140537)
	(bdk_selection_owner_set_for_display): Now that STRING is always
	ISO-8859-1, use UTF8_STRING when sending the selection request
	to ourselves.

	(bdk_selection_convert): Handle also UTF8_STRING. (#140537, John
	Ehresman)

	(bdk_text_property_to_text_list_for_display): Make work more like
	X11 version. Do obey the encoding parameter.

	(bdk_string_to_compound_text_for_display,
	bdk_utf8_to_compound_text_for_display): Don't even pretend
	supporting COMPOUND_TEXT.

	(bdk_utf8_to_string_target): Convert to ISO-8859-1, like on X11.

	(sanitize_utf8): Zero-terminate string.

2004-07-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/stock-icons/Makefile.am: Add stock_file_16.png, 
	stock_file_24.png, stock_directory_16.png and stock_directory_24.png.

	* btk/btkstock.h (BTK_STOCK_FILE, BTK_STOCK_DIRECTORY): 
	* btk/btkiconfactory.c (get_default_icons): New stock icons as 
	fallbacks for btkfilechooser. Currently these are the same images
	as the "new" and "open" items...

Tue Jul  6 10:00:22 2004  Jonathan Blandford  <jrb@redhat.com>

	Fix for #136496, Pawel Salek:
	
	* btk/btktreeview.c (btk_tree_view_row_changed): Queue a redraw on
	a node when it changes in fixed_height mode.

	(btk_tree_view_node_queue_redraw): new function to queue a redraw
	on a node.

2004-07-06  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkmenu.c (btk_menu_position): Make sure 
	private->monitor_num is a valid monitor number before 
	using it.  (#139187, Michael Natterer)

Tue Jul  6 02:00:28 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserdefault.c (popup_position_func): 
	* btk/btkentry.c (popup_position_func): 
	* btk/btktextview.c (popup_position_func): Improve positioning
	of keyboard-activated menus with Xinerama.

Tue Jul  6 00:29:03 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (do_updates): 
	(do_updates_idle): Only call BDK_THREADS_ENTER() / _LEAVE() 
	when called from an idle handler.  (#145429, Jan-Marek Glogowski)

Mon Jul  5 23:47:38 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserutils.c (delegate_notify): Use
	the less efficient g_object_interface_find_property () instead
	of the param_id range check, since the BParamSpecs we're 
	dealing with are the overridden onces on the interface, whose
	param_id is always zero.  (#145312, Alex Roitman, fix proposed
	by Owen Taylor)

2004-07-05  Lorenzo Gil Sanchez  <lgs@sicem.biz>

	* btk/btklayout.c (btk_layout_add): added a default method for the add
	virtual method of BtkContainer.
	(btk_layout_class_init): assign btk_layout_add to the 'add' virtual
	method slot of the container class.

2004-07-05  Anders Carlsson  <andersca@bunny.org>

	* btk/btkiconview.c: (btk_icon_view_set_markup_column):
	* btk/btkiconview.h:
	Use bint, not int in btk_icon_view_set_markup_column,
	(Paolo Maggi)
	
2004-07-05  Anders Carlsson  <andersca@bunny.org>

	* btk/btkiconview.c: (btk_icon_view_class_init),
	(btk_icon_view_real_select_cursor_item),
	(btk_icon_view_real_activate_cursor_item):
	* btk/btkiconview.h:
	Add an "activate_cursor_item" action signal
	and bind it to the return key.
	
2004-07-04  Anders Carlsson  <andersca@bunny.org>

	* demos/btk-demo/Makefile.am:
	* demos/btk-demo/bunny-fs-directory.png:
	* demos/btk-demo/bunny-fs-regular.png:
	* demos/btk-demo/iconview.c: (load_pixbufs), (fill_store),
	(sort_func), (create_store), (item_activated), (up_clicked),
	(home_clicked), (do_iconview):
	Add a simple file browser based on the icon view.
	
	* btk/btk.h:
	Add btk/btkiconview.h
	
	* btk/btkiconview.c: (btk_icon_view_layout),
	(btk_icon_view_item_new), (btk_icon_view_item_activated):
	Fix a few bugs discovered while writing the demo.
	
2004-07-04  Anders Carlsson  <andersca@bunny.org>

	* btk/Makefile.am:
	* btk/btkiconview.c
	* btk/btkiconview.h:
	Add BtkIconView to the build, remove debugging output.
	
Sun Jul  4 01:29:35 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c (btk_calendar_drag_data_get): 
	(btk_calendar_drag_data_received): Fix off-by-one error.  
	GDate month is one-based and BtkCalendar month is zero-based.  
	(#145134, William Jon McCann)

Sun Jul  4 01:11:07 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreestore.c (btk_tree_store_move): Don't crash if
	somebody tries to move a node after itself in a list of 
	length 1.  (#145291, Sampo Nurmentaus)

Sat Jul  3 23:43:23 2004  Matthias Clasen  <maclas@gmx.de>

	* docs/faq/btk-faq.sgml: 
	* btk/btkwindow.c: Fix links to www.freedesktop.org.  (#145210,
	Billy Biggs)

Sat Jul  3 02:09:51 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btksocket.c (btk_socket_end_embedding): Reset current_width
	and current_height to 0 when ending the embedding.  (#143675,
	Nickolay V. Shmyrev)

Sat Jul  3 01:48:19 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (btk_entry_move_visually): Let the cursor move
	to the right end of the entry text, even if it ends in combining
	marks.  (#141728, Theppitak Karoonboonyanan)

Fri Jul  2 23:34:33 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_unset_model): Unset the displayed
	row when unsetting the model.  (#138560, Christian Persch)

Fri Jul  2 23:01:07 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (update_menu_sensitivity): Don't crash if there
	are no items.

Fri Jul  2 22:41:27 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkimage.c (btk_image_expose): Properly align mask and
	pixbuf if a subarea is exposed.  (#135423, fix by John Ehresman)

Fri Jul  2 21:40:21 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btknotebook.c (btk_notebook_realize): Add scroll events
	to the event mask, set a scroll_event handler.
	* btk/btknotebook.c (btk_notebook_scroll): Handle scroll events
	by switching tabs.  (#145244, Gabriel de Perthuis)

2004-07-02  Anders Carlsson  <andersca@bunny.org>

	* btk/btktreeview.c (btk_tree_view_set_model): 
	Make sure we check for a NULL model first.

2004-07-01  J. Ali Harlow  <ali@juiblex.co.uk>

	* bdk/win32/bdkinput-win32.c (_bdk_input_ungrab_pointer): Fix
	win32 build problem w/o wintab.  Fixed #145242

2004-06-30  Anders Carlsson  <andersca@bunny.org>

	* btk/btktreeview.c (btk_tree_view_set_model): Use
	g_return_if_fail to make sure that the model is a BtkTreeModel.

Sat Jun 26 17:41:10 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btk[hv]separator.c (btk_[hv]separator_expose): Draw line with the
	current state, not BTK_STATE_NORMAL

	* btk/btkframe.c (btk_frame_paint): Fix a rounding error

Sat Jun 26 15:07:25 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkstyle.c, btk/btkrc.c: small color tweak. (#141173)

Sat Jun 26 01:15:40 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkwindow-x11.c (set_initial_hints): Handle
	_NET_WM_STATE_ABOVE and _NET_WM_STATE_BELOW.  (#144851, 
	Billy Biggs)

Sat Jun 26 01:04:31 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconfactory.c (clear_cache): Prevent unwanted 
	recursion by resetting icon_set->cache before freeing
	the cache.  (#144947, Tim Janik)

Sat Jun 26 00:40:02 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconfactory.c (render_icon_name_pixbuf): 
	* btk/btkiconfactory.c (btk_icon_set_render_icon): 
	* btk/btkstyle.c (btk_default_render_icon): Accept a NULL 
	style.

Sat Jun 26 00:04:36 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (btk_entry_completion_set_model): 
	* btk/btkcombobox.c (btk_combo_box_set_model): Reflect the 
	last change in the docs.

Fri Jun 25 23:35:42 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (btk_entry_completion_set_model):
	* btk/btkcombobox.c (btk_combo_box_set_model): Allow passing
	NULL to unset the model.  (#137211, patch by  Mariano Suárez-Alvarez)

Fri Jun 25 23:33:05 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_menu_position_below): Fix the
	placement policy for BtkComboBoxEntry to be: if it fits below, 
	place below, if it fits above place above, else place in the 
	larger space and scroll so that the scroll arrow appear at the
	far end.  (#144362, David A. Knight)

Fri Jun 25 22:49:58 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreestore.c (btk_tree_store_move): Avoid uninitialized
	use of &parent_iter. (#145007, John Finlay)

2004-06-25  Bastien Nocera  <hadess@hadess.net>

	reviewed by: Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkkeys-x11.c: (get_symbol), (update_keymaps),
	(bdk_keymap_lookup_key), (translate_keysym): fix keys parsing when
	the number of keysyms per keycode is odd. Fixes #144808.

2004-06-25  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfontbutton.c (btk_font_button_update_font_info): Avoid
	a crash if the font doesn't exist.  (#144967, Yevgen Muntyan) 

Fri Jun 25 00:32:15 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreestore.c (btk_tree_store_swap): Commit the change
	which was mentioned below.

Thu Jun 24 23:35:09 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btknotebook.c (btk_notebook_class_init): Fix a typo,
	string change.  (#139503, Baris Cicek)

2004-06-22  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (location_popup_handler): Use a Save
	or an Open stock button for the C-l dialog depending on the action
	in which the file chooser operates.  Fixes #141753.

2004-06-22  Federico Mena Quintero  <federico@ximian.com>

	Fixes the BTK+ part of #142308:

	* btk/btkfilesystemunix.c (btk_file_system_unix_filename_to_path):
	Use filename_to_path().
	(btk_file_system_unix_uri_to_path): Likewise.
	(filename_to_path): Use remove_trailing_slash().

2004-06-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c (btk_text_view_class_init): Improve docs
	for the ::move_cursor signal.

	* btk/btkaccelmap.c (_btk_accel_path_is_valid): Accept
	"<WINDOWTYPE>" as a valid accel path.  (#144427, Philip 
	Kendall)	

	* btk/btkselection.c (BTK_SELECTION_MAX_SIZE): Make sure 
	this gets defined for all backends, so linux-fb has a 
	chance of compiling.

	* bdk/x11/bdkgc-x11.c: 
	* bdk/bdkgc.c: Move function docs inline, add hints about 
	obtaining rgb colors from gcs.  (#144688, Steve Chaplin)

	* btk/btktreestore.c (btk_tree_store_swap): Make this work
	for children of the root.  (#139785, Jean-François Wauthy,
	patch by John Finlay)

	* btk/btkicontheme.h (BTK_ICON_THEME_GET_CLASS): Typo
	fix.  (#144750, Jeff Franks) 

2004-06-21  Michael Natterer  <mitch@gimp.org>
	Merge from stable:

	* bdk/x11/bdkdrawable-x11.[ch]: made convert_format() utility
	function public as _bdk_x11_convert_to_format().

	* bdk/x11/bdkcursor-x11.c (create_cursor_image): premultiply
	the pixels from the BdkPixbuf when putting them in the
	Xcursor image. Fixes bug #144350.

2004-06-16  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystemmodel.c (do_files_added): When inserting a
	visible node, free the old path before creating the new one.
	Fixes #144356.

Tue Jun 15 01:10:32 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c: Make BtkComboBox work without model.  
	(#144198, Mariano Suárez-Alvarez)
	
Fri Jun 11 22:05:56 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserdefault.c: Don't use
	contractions like "don't" or "isn't" in error messages.
	It isn't nice to use them in log entries either...
	(#137774, Morten Welinder, patch by Alexander Winston)

2004-06-11  Federico Mena Quintero  <federico@ximian.com>

	Fixes #143578:

	* btk/btkfilesystemmodel.c (_btk_file_system_model_add_editable):
	Don't ref the editable node.
	(_btk_file_system_model_remove_editable): Don't unref the editable node.
	(_btk_file_system_model_remove_editable): Ahem, free the node.

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault):
	Added fields for edited_idle and edited_new_text.
	(renderer_edited_cb): Queue the
	creation of the folder in an idle handler.
	(renderer_editing_canceled_cb): Likewise for the cancellation.
	(btk_file_chooser_default_finalize): Free the impl->edited_new_text.

Thu Jun 10 22:12:26 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmain.c (btk_parse_args): Typo fix.

2004-06-10  Federico Mena Quintero  <federico@ximian.com>

	Fixes #144110, patch by Bastien Nocera <hadess@hadess.net>.

	* btk/btkfilechooser.c (btk_file_chooser_list_shortcut_folders):
	Refer to btk_file_chooser_add_shortcut_folder().
	(btk_file_chooser_list_shortcut_folder_uris): Refer to
	btk_file_chooser_add_shortcut_folder_uri().

Thu Jun 10 00:36:15 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c (btk_calendar_main_button): Start 
	the drag before focusing the selected.day.
	* btk/btkcalendar.c (btk_calendar_state_changed): Stop
	a beginning drag if the widget becomes insensitive.

Thu Jun 10 00:09:06 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcalendar.c (btk_calendar_button_press): Start 
	spinning before calling arrow_action(), so that a signal
	handler triggered from arrow_action() has a chance to 
	stop the spinning.  (#143966, Davyd Madeley)

Wed Jun  9 23:11:23 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkstyle.c (_btk_style_init_for_settings): Fix a 
	typo.  (#144070, Kent Sandvik)

Thu Jun 10 00:22:51 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c: Revert the "drag select" part of
	#141169. (#144011).

Mon Jun  7 23:07:40 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_remeasure): Handle
	priv->model being NULL.  (#143856, Mariano Suárez-Alvarez)

2004-06-07  Federico Mena Quintero  <federico@ximian.com>

	* btk/btktreeview.c (btk_tree_view_button_press): Revert the patch
	from 2003/Sep/12.  This kept DnD in tree views within modal
	dialogs from working, which is especially bad for the file
	chooser.  Fixes #135168.

Sun Jun  6 23:57:21 2004  Matthias Clasen  <maclas@gmx.de>

	Make the entry context menu work in editable text cells. The changes
	are based on a patch by Kristian Rietveld, which implemented an 
	approach outlined by Owen Taylor.  (#50075)
	
	* btk/btkcellrenderertext.c (btk_cell_renderer_text_focus_out_event): 
	Ignore focus out if the entry menu is posted.
	(btk_cell_renderer_text_populate_popup): Mark the entry menu as 
	posted, and set up a signal handler to clear the flag if the menu 
	is unmapped.
	(btk_cell_renderer_text_popup_unmap): Clear the in_entry_menu flag, 
	set up a timeout to stop editing if the focus is lost.
	(popdown_timeout): Stop editing if the entry doesn't have focus anymore.
	(btk_cell_renderer_text_start_editing): Connect to the populate_popup 
	signal on the entry and keep a pointer to the entry.
	(btk_cell_renderer_text_editing_done): Disconnect from popuplate_popup, 
	clear the pointer to the entry.

Sun Jun  6 23:24:43 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktexttag.c (btk_text_tag_class_init): Improve the description
	of the ::language property.  (#143802, Owen Taylor)

Sat Jun  5 23:07:30 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c: (btk_entry_completion_init),
	(btk_entry_completion_list_enter_notify),
	(btk_entry_completion_list_motion_notify),
	(_btk_entry_completion_popup), (_btk_entry_completion_popdown):
	* btk/btkentryprivate.h: Add an ignore_enter flag and
	use it as in the menu code to avoid the initial selection if
	the window pops up under the pointer.  (Anders Carlsson)

Sat Jun  5 20:05:39 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* tests/testmerge.c: Add a checkbox to queue an
	merge/unmerge. Patch from Matthias Clasen.

	* btk/btktoolbar.c (struct _BtkToolbarPrivate): Add a new flag
	"need_rebuild"
	(rebuild_menu): New function that rebuilds the overflow menu and
	makes sure it doesn't start or end with a separator.
	(toolbar_content_new_tool_item)
	(toolbar_content_remove)
	(toolbar_content_new_compatibility): Set the rebuild_needed flag
	(btk_toolbar_size_allocate): Only show the overflow arrow when we
	have actually overflown an item with a proxy menu item. Also make
	sure we rebuild the menu if needed.

	Fix #125504, #142377, #143463
	
	* btk/btkseparatortoolitem.c (btk_separator_tool_item_expose):
	Obey the "priv->draw" flag. (#143692)

2004-06-04  Matthias Clasen  <mclasen@redhat.com>

	* docs/widget_geometry.txt: Add a note about the !CAN_FOCUS
	quirk in the button size allocation code.

	* btk/btkbutton.c (btk_button_size_allocate): Give the space
	requested for drawing the focus indicator to the child in the
	!CAN_FOCUS case. This should fix issues which the Gimp has with 
	the button allocation changes in 2.4.2.

Thu Jun  3 21:17:29 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentry.c (btk_entry_completion_timeout): Calculate the
	length of the entry contents in characters, not in bytes.

	* btk/btkentry.c (paste_received): Don't pop up the completion
	window on paste, noticed by Anders Carlsson.

Thu Jun  3 20:56:19 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_class_init): Fix the allowed
	values and default value for the ::active property.  (#143669,
	Olivier Andrieu)

2004-06-03  Michael Natterer  <mitch@gimp.org>

	* btk/btkimagemenuitem.c: use btk_widget_get_child_requisition()
	instead of accessing item->image->allocation.width/height
	directly. Makes widgets which only have a requisition set using
	btk_widget_set_size_request() work and fixes bug #142789.

Thu Jun  3 08:07:59 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c: Revert previous commit. It caused the problem
	of sticky right click menus to return.

Wed Jun  2 01:56:02 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkmenu.c: Fix the stay up algorithm for combo boxes to
	better handle the "click" case. bug  Better fix for #141169.

2004-06-02  Federico Mena Quintero  <federico@ximian.com>

	* btk/btktreeview.c (btk_tree_view_search_init): Bail out if the
	model is empty.  Fixes #143536.

2004-06-02  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkfontsel.c (btk_font_selection_size_focus_out): Don't
	close the dialog on focus out of the size entry.  (#143505, 
	David Hawthorne)

2004-06-02  Federico Mena Quintero  <federico@ximian.com>

	Fix #138807.

	* btk/fnmatch.c (_btk_fnmatch): Take a no_leading_period argument.
	(btk_fnmatch_intern): Likewise; also implement this option.

	* btk/btkprivate.h (_btk_fnmatch): Updated prototype.

	* btk/btkfilesel.c (find_completion_dir): Pass TRUE for the
	no_leading_period argument of _btk_fnmatch().
	(attempt_file_completion): Likewise.

	* btk/btkfilefilter.c (btk_file_filter_filter): Pass FALSE for the
	no_leading_period argument of _btk_fnmatch().

Wed Jun  2 00:47:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkselection.c (_btk_selection_request): Remove leftover
	debug code.

Wed Jun  2 00:13:57 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktreeselection.c (btk_tree_selection_select_range): Don't
	allow unless selection mode is multiple.  (#142634, John Finlay)

Tue Jun  1 23:00:20 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktoolbar.h: 
	* btk/btktoolbar.c: 
	* btk/btkentrycompletion.h: 
	* btk/btkentrycompletion.c: 
	* btk/btkcombobox.h: 
	* btk/btkcombobox.c: Rename function parameters from
	index to index_ to prevent clash with BSD index().  (#143001)

Tue Jun  1 22:45:42 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenu.c (get_accel_path): Handle accel_closure being
	NULL on an accel label. (#139641, Sam Stephenson, patch by 
	Michael Natterer)

Tue Jun  1 22:19:55 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkicontheme.c (theme_subdir_load):  Prevent icon 
	lookup finding icons in the wrong prefix.  (#143328,
	Mark McLoughlin)

Wed Jun  2 00:39:58 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Bug #141169.

	* btk/btkmenushell.c (btk_menu_shell_button_release): Make menus
	only stay up if you release within 500 milliseconds.
	(btk_menu_shell_button_press): Set the activate_time to the event
	time when a button is pressed.

	* btk/btkmenu.c (btk_menu_motion_notify, btk_menu_enter_notify):
	Interprete button releases as activate when we have seen both an
	enter an a motion event.

2004-06-01  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesystemmodel.c (do_files_removed): Don't insert a
	dummy node if there is no parent node.  Fixes #143362.

2004-05-31  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (renderer_edited_cb): Change to the
	newly-created folder.  Fixes #138932.
	(trap_activate_cb): Only return TRUE if we did handle the event.
	Fixes #143359; patch by jylefort@brutele.be.

Mon May 31 02:39:32 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkimage.c (btk_image_new_from_pixmap): Fix typo in 
	docs.  (#142892, Tommi Komulainen)

Mon May 31 02:16:37 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkhandlebox.c: Make detached handleboxes work when their
	parent is minimized, porting the fix from 1.2.  (#1923, #57182)

Mon May 31 02:03:17 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwindow.c (btk_window_show): Make moving realized, 
	unmapped windows work. 

Mon May 31 00:27:33 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooserutils.c (_btk_file_chooser_set_delegate): Fix
	a typo.

Mon May 31 00:23:55 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkfilechooser.c (btk_file_chooser_set_preview_widget): 
	Refer to ::update-preview, not ::selection-changed.

2004-05-29  Christian Rose  <menthos@menthos.com>
 
        * configure.in: Added "tk" to ALL_LINGUAS.
 
Fri May 28 15:00:01 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkwidget.c (btk_widget_set_parent): Add informative
	messages for common problems.  (#137974, Owen Taylor)

Fri May 28 14:20:17 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/x11/bdkevents-x11.c: Fix off-by-one allocation 
	errors. (#143337, Billy Biggs) 

Thu May 27 16:36:22 2004  Owen Taylor  <otaylor@redhat.com>

	* bdk/x11/bdkcolor-x11.c (bdk_colormap_alloc_colors): Set
	bits within visual->depth that aren't used for color to
	1s, in case they are alpha.

2004-05-27  Anders Carlsson  <andersca@bunny.org>

	* btk/btkfilechooserdefault.c (save_folder_combo_create): 
	Make separator rows insensitive.

Thu May 27 00:48:16 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (btk_entry_completion_set_text_column): 
	Add more docs.

Thu May 27 00:45:07 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.h:
	* btk/btkentrycompletion.c (btk_entry_completion_get_text_column): 
	Getter for text_column. Also make ::text_column a property.

Thu May 27 00:11:01 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenuitem.c (btk_menu_item_size_request): Fix a typo.

Thu May 27 00:07:47 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkcombobox.c (btk_combo_box_list_destroy): only remove the
	signal if the box exists.

Wed May 26 23:26:51 2004  Matthias Clasen  <maclas@gmx.de>

	Support insensitive cells in tree views and combo boxes:
	
	* btk/btkcellrenderer.h: 
	* btk/btkcellrenderer.c: Add a ::sensitive property.

	* btk/btkcellrendererpixbuf.c (btk_cell_renderer_pixbuf_render): 
	* btk/btkcellrenderertext.c (btk_cell_renderer_text_render): 
	* btk/btkcellrenderertoggle.c (btk_cell_renderer_toggle_render): 
	Support drawing insensitive.

	* btk/btkcellview.h: 
	* btk/btkcellview.c (btk_cell_view_get_cell_renderers): New 
	function to obtain the cell renderers from a cell view. Also
	export btk_cell_view_set_cell_data().

	* btk/btktreeselection.c (tree_column_is_sensitive):
	* btk/btktreeselection.c (row_is_selectable): Helper functions
	to determine whether all visible cells in a row are insensitive
	and whether a row is selectable. A row is not selectable if the 
	user function says so or if all visible cells are insensitive.
	* btk/btktreeselection.c (_btk_tree_selection_internal_select_node): 
	* btk/btktreeselection.c (btk_tree_selection_real_select_node): 
	Use row_is_selectable().
	
	* btk/btkcombobox.c (row_is_sensitive): 
	* btk/btkcombobox.c (tree_column_row_is_sensitive): 
	* btk/btkcombobox.c (menu_row_is_sensitive): Helper functions
	to determine row sensitivity in menu or list mode.

	* btk/btkcombobox.c (update_menu_sensitivity): Helper function
	to set up sensitivity menu items from the underlying rows.

	* btk/btkcombobox.c (btk_combo_box_popup): 
	* btk/btkcombobox.c (btk_combo_box_menu_button_press): Use
	update_menu_sensitivity().
		
	* btk/btkcombobox.c (btk_combo_box_list_setup): Setup the cell
	data funcs.

	* btk/btkcombobox.c (btk_combo_box_key_press): Skip insensitive
	rows.

	* tests/testcombo.c (main): Make some rows insensitive.

2004-05-26  Robert Ögren  <btk@roboros.com>

	* bdk/win32/bdkinput-win32.c (_bdk_input_other_event): Send key
	modifiers (shift, ctrl etc) in button and motion events from the
	tablet. (#143240)

2004-05-26  Robert Ögren  <btk@roboros.com>

	* bdk/win32/bdkinput-win32.c (bdk_device_get_state): Simple
	implementation for extended input devices using last known 
	device state (#143237)

Tue May 25 21:54:00 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkframe.c: Move docs inline, fixing them on the
	way.  (#143029, Steve Chaplin)

2004-05-11  Robert Ögren  <btk@roboros.com>

	* bdk/win32/bdkevents-win32.c (propagate): Don't propagate mouse
	events to windows that want extended input events. (#142943)
	(bdk_event_translate): Move check for extended input devices to
	propagate, new parameter to propagate.
	(bdk_pointer_grab, bdk_display_pointer_ungrab): Enable calls to
	_bdk_input_(un)grab_pointer. (#142943)

	* bdk/win32/bdkinput-win32.c (_bdk_input_other_event): Check for
	input grab. [Fix missing update of impl in "dijkstra" event
	propagation loop] Drop the parallel "impl" pointer, just use a
	cast. Don't propagate beyond windows that want normal input
	events. (#142943)
	(bdk_input_grab_pointer, bdk_input_ungrab_pointer): Limited
	implementation of input grab. (#142943)

2004-05-22  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkinput-win32.c (print_lc): Remove duplicated
	line. (Spotted by Benoît Carpentier.)

2004-05-18  Matthias Clasen  <mclasen@redhat.com>

	* configure.in: Check for XFIXES extension.

	* bdk/x11/bdkdisplay-x11.h (struct _BdkDisplayX11): Add 
	a bboolean have_xfixes member.

	* bdk/x11/bdkdisplay-x11.c (bdk_display_open): Register
	XFIXES events and set have_xfixes.

	* bdk/bdkevents.h (BdkEventType): Add BDK_OWNER_CHANGE.
	(BdkEventOwnerChange): New event struct for owner change events.
	(BdkOwnerChange): New enum for the reason field of BdkEventOwnerChange.
	
	* bdk/x11/bdkevents-x11.c (bdk_event_translate): Translate 
	XFixesSelectionNotify events into BdkEventOwnerChange events.
	
	* bdk/bdkdisplay.h:
	* bdk/x11/bdkdisplay-x11.c (bdk_display_supports_selection_notification):
	(bdk_display_request_selection_notification): New api 
	to support selection ownership notification.

	* btk/btkclipboard.h:
	* btk/btkclipboard.c (_btk_clipboard_handle_event): New private
	api to handle owner change events.
	(clipboard_peek): Refactored out the body of 
	btk_clipboard_get_for_display() for use in _btk_clipboard_handle_event().

	* btk/btkmain.c (btk_main_do_event): Handle BDK_OWNER_CHANGE events
	by calling _btk_clipboard_handle_event().

2004-05-18  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkintl.h: Include bunnylib/gi18n-lib.h and only define
	the P_() macros ourselves.

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Restrict the width of the popup to be no larger than the
	monitor.  (#142678, DmD Ljungmark)

	* btk/btkbutton.c: Go back to the initial fix for the 
	focus-overdrawing problem, which was actually correct 
	according to docs/widget_geometry.txt.

	* btk/btkarrow.c (btk_arrow_class_init): Bump the initial
	arrow size from 11 to 15 to compensate for that.

	* btk/btktextview.c (btk_text_view_class_init): Document the
	arguments of the ::move-cursor signal.  (#142725)

2004-05-17  Matthias Clasen  <mclasen@redhat.com>

        Merged from 2.4:
	
	* btk/btkbutton.c (btk_button_size_request) 
	(btk_button_size_allocate, _btk_button_paint): Allocate
	space for the focus rectangle only if necessary.  (#142668,
	Michael Natterer)

Sun May 16 23:11:47 2004  Matthias Clasen  <maclas@gmx.de>

	Merged from 2.4:
	
	* btk/btkhruler.c (btk_hruler_draw_ticks): Remove two useless 
	lines.  (#142479, Morten Welinder)

Sun May 16 22:27:17 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkintl.h (Q_): Add a Q_() macro. 

	* btk/btkcellrendererprogress.h: Remove BTK_PROGRESS_CELL_UNKNOWN
	and BTK_PROGRESS_CELL_FAILED. With the ability the set the label,
	they are not really needed.

	* btk/btkcellrendererprogress.c: Use the xpad and ypad properties
	instead of hardwired padding, use Q_() for the default label, 
	compute a reasonable minimal size.  (#142571, #142572, #142573,
	Tommi Komulainen, Christian Persch)
	
2004-05-15  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdnd-win32.c: Put back the ref_count field in the
	BdkDragContextPrivateWin32 struct (but inside ifdef OLE2_DND this
	time). It is used by the OLE2_DND code, which is unfinished and
	presumably horribly broken, but still, let's not make it not
	compile on purpose. Silence some gcc warnings in the OLE2_DND
	code.

2004-05-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktreeview.c (btk_tree_view_tree_window_to_tree_coords): 
	New function to go from tree window to tree coordinates, kept
	static for now until we figure out the multiple coordinate
	system mess in BtkTreeView API-wise.
	(btk_tree_view_scroll_to_cell): Transform the coordinates 
	from tree window to tree coordinates, using the new function.
	Previously, the x coordinate was wrongly transformed. (#142494)

	* bdk/bdktypes.h (BdkModifierType): Add a comment about unused
	bits.

	* btk/btkstock.c (real_add, btk_stock_lookup): Use an unused
	modifier bit to mark stock item which need to be freed 
	eventually.  (#140654, Michal Pasternak, Scott Tsai)

2004-05-11  Robert Ögren  <btk@roboros.com>

	* bdk/win32/bdkevents-win32.c (bdk_event_translate): Add missing
	call to g_object_ref in Wintab code. (#138341)

	* bdk/win32/bdkinput-win32.c: Fix numerous Wintab problems
	including unallocated buffers for event->motion.axes and
	event->button.axes, unsigned wraparound problem in the code for
	detecting missing press/release events and assigning min instead
	of max when setting up axes.

2004-05-12  Matthias Clasen  <mclasen@redhat.com>

	* tests/testtreeedit.c: Add a progress column.

	* btk/Makefile.am: Add btkcellrendererprogress.[hc] in the right
	places.

	* btk/btk.h: Include btkcellrendererprogress.h.

	* btk/btkcellrendererprogress.[hc]: A progress cell renderer,
	based on the one found in Epiphany.

2004-05-11  Michael Natterer  <mitch@gimp.org>

	* btk/btkcombobox.c (btk_combo_box_popup)
	(btk_combo_box_menu_button_press): don't allocate the popup
	smaller than the combobox. Fixes bug #59660.

2004-05-11  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (btk_ui_manager_get_widget): Revert the
	previous change to this function, clarify the docs instead.

	* btk/btkcombobox.c (btk_combo_box_list_setup): Use
	BTK_SELECTION_BROWSE.

	* btk/btktreeview.c: Make hover selection work for 
	BTK_SELECTION_BROWSE as well.

Tue May 11 00:38:25 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcellrenderertoggle.c (btk_cell_renderer_toggle_class_init): 
	Document the ::toggled signal.

Mon May 10 23:04:25 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkwidget.h: Add prototype for _btk_widget_grab_notify()

2004-05-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkwindow.c (get_screen_icon_info): Make static.

	* bdk/bdkdisplay.c (singlehead_...): 
	* bdk/x11/bdkkeys-x11.c (get_effective_keymap): 
	* bdk/x11/bdkgeometry-x11.c (expose_serial_predicate): 
	* bdk/x11/bdkdisplay-x11.c (escape_for_xmessage): Make static.

	* btk/btktreeview.c (btk_tree_view_set_fixed_height_mode): Add a 
	note about COLUMN_FIXED restriction.

	* btk/btkentrycompletion.c (btk_entry_completion_list_button_press): 
	Set the entry in the default handler of the ::match-selected signal.
	(#137226)

	* btk/btkcombobox.c (btk_combo_box_menu_position_below): If we don't
	do the move-selected-item below pointer thingie, do the 
	place-below-or-above one.

	* tests/testentrycompletion.c: Make the second example use the 
	::match-selected signal to make it actually work.

	* btk/btkentrycompletion.c (btk_entry_completion_init): 
	* btk/btkcombobox.c (btk_combo_box_list_setup): Use hover selection
	mode.  (#127648, Dave Bordoley)

	* btk/btktreeview.h:
	* btk/btktreeview.c: Add a new property "hover_selection", which 
	when TRUE makes the selection follow the mouse. Also add setter
	and getter for the fixed_height property.

2004-05-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c (btk_combo_box_popup) 
	(btk_combo_box_menu_button_press): Make sure the menu pops up
	as wide as the combobox.  (#59660, Havoc Pennington)

2004-05-10  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.h: 
	* btk/btkcombobox.c: Support tearoffable combo boxes (in menu 
	mode). Add a new property, add-tearoffs, for this.  (#135956)

	* btk/btkfontsel.c (list_row_activated): Make Return activate the
	default button.  (#118921)

Mon May 10 15:03:50 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btkwidget.c (_btk_widget_grab_notify): New internal function
	that emits the grab notify signal.
	
	* btk/btkmain.c (btk_grab_notify_foreach): Use it here.

Mon May 10 00:48:08 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkmenu.c: Make destruction of a torn off menu work 
	like un-tearing off.

Sun May  9 21:05:38 2004  Matthias Clasen  <maclas@gmx.de>

        Merge from 2.4:

	* btk/btkactiongroup.c (btk_action_group_add_action_with_accel): 
	Allow to suppress the stock accelerator by using "".  (#142196,
	David A Knight)
	
Sun May  9 02:01:13 2004  Matthias Clasen  <maclas@gmx.de>

        Merge from 2.4:
	
	* btk/btkcombobox.c (btk_combo_box_list_button_released): 
	In list mode, accept the same mouse/wheel bindings on 
	the cellview as on the button.  (#136967)

Sun May  9 01:25:37 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkiconfactory.c (add_to_cache): Actually count the
	cached icons.  (#135888, Crispin Flowerday)

Sun May  9 00:03:03 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkuimanager.c (btk_ui_manager_get_widget): Make sure
	that we actually return menus for nodes of type menu, not the
	menuitems they're attached to.

Sat May  8 22:50:55 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.c (btk_action_group_set_translation_domain): 
	Add a note regarding UTF-8 requirements, proposed by 
	Mariano Suárez-Alvarez.

Sat May  8 22:43:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktearoffmenuitem.h: 
	* btk/btktearoffmenuitem.c: Put the torn_off flag back
	into the BtkTearoffMenuItem struct, since it is used
	by the Gimp, and keep it synchronized with the 
	tearoff_state property of the parent menu.

2004-05-08  Hans Breuer  <hans@breuer.org>

	* btk/btkfilesystemwin32.c (extract_icon) : finally also
	create the correct mask for 'pseudo mime' icons

	* bdk/win32/bdkwindow-win32.c(show_window_internal) : also
	take focus_on_map into account

	* btk/btkselection.c : g_message() only with DEBUG_SELECTION

	* btk/btkactiongroup.c btk/btkcombobox.c : 
	... must return a value

	* bdk/bdk.def btk/btk.def demos/btk-demo/makefile.msc.in : updated

2004-05-07  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkbutton.c (btk_button_size_allocate): Don't let the child
	draw over the focus rectangle.

	* btk/btkhsv.c: Draw focus indication in the color wheel using
	standard focus style.  (#63071, Bill Haneman, idea for new
	style by Owen Taylor)

	* btk/btkstyle.c (btk_default_draw_focus): Support drawing on
	focus on the colorwheel via details.

2004-05-06  Matthias Clasen  <mclasen@redhat.com>

        Merge from 2.4:
	
	* btk/btkcombobox.c (btk_combo_box_menu_state_changed): Remove
	this no longer needed signal handler.  (#141817, Paul Pogonyshev)

Fri May  7 00:41:46 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btktearoffmenuitem.h: 
	* btk/btktearoffmenuitem.c: Make the tearoff 
	functionality model/view, the tearoffmenuitem being
	the view and the tearoff_state property of the menu
	being the model.  (#101185, Owen Taylor)

	* btk/btkmenu.c: Add a tearoff_state property.

Thu May  6 23:52:13 2004  Matthias Clasen  <maclas@gmx.de>

	Merge from 2.4:

	* btk/btkmenuitem.c (btk_menu_item_select_timeout): Also 
	popup the submenu for items in torn off menus.  (#122051)

2004-05-06  Sven Neumann  <sven@gimp.org>

	* btk/btkexpander.c (btk_expander_size_allocate): in RTL mode,
	position the title lable next to the arrow just as we do for LTR
	rendering. Fixes bug #141825.

2004-05-06  Matthias Clasen  <mclasen@redhat.com>

	* docs/RELEASE-HOWTO: Document the new policy of
	bumping version numbers after release.

	* configure.in: Bump version number to 2.5.0.

2004-05-06  Padraig O'Briain  <padraig.obriain@sun.com>

	* btk/btkmenu.h:
	* btk/btkmenu.c: Add new function btk_menu_get_for_attach_widget.
	(bug #113112).

Thu May  6 00:24:11 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkactiongroup.h: 
	* btk/btkactiongroup.c (btk_action_group_translate_string): 
	New function to translate a string with translate_func.
	(#135740)

Thu May  6 00:02:21 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.c (btk_combo_box_get_wrap_width): 
	(btk_combo_box_get_row_span_column): 
	(btk_combo_box_get_column_span_column): Add missing getters
	for readwrite properies. (#135649)

Wed May  5 23:42:42 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkcombobox.h: 
	* btk/btkcombobox.c (btk_combo_box_get_active_text): 
	Add btk_combo_box_get_active_text() convenience 
	function. (#136372, Christian Neumeir, patch by Olivier Andrieu) 

2004-05-05  Elijah Newren  <newren@math.utah.edu>

	Changes to support do-not-focus-on-map hint in conjunction with
	_NET_WM_USER_TIME (#115650):

	* bdk/bdkwindow.h (struct _BdkWindowObject): Add a new boolean
	field focus_on_map
	
	* bdk/bdkwindow.h (bdk_window_set_accept_focus): New function to
	set it.

	* btk/btkwindow.[hc]: Add a boolean property "focus_on_map"
	and btk_window_get_focus_on_map() and btk_window_set_focus_on_map().

	* bdk/win32/bdkwindow-win32.c (bdk_window_new): 
	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_new): 
	* bdk/x11/bdkwindow-x11.c (bdk_window_new):
	Initialize the focus_on_map field to TRUE.

	* bdk/win32/bdkwindow-win32.c (bdk_window_set_focus_on_map): 
	* bdk/linux-fb/bdkwindow-fb.c (bdk_window_set_focus_on_map): 
	* bdk/x11/bdkwindow-x11.c (bdk_window_set_focus_on_map): 
	* bdk/x11/bdkwindow-x11.c (setup_toplevel_window):
	Implementations for the various backends. The Win32 and linux-fb
	implementations set the focus_on_map field, but don't use it yet
	to actually implement noinput windows. The X implementation sets
	_NET_WM_USER_TIME to 0 if focus_on_map is FALSE (see the EWMH).

	* bdk/x11/bdkwindow-x11.h: 
	* bdk/x11/bdkevents-x11.c (set_user_time): 
	* bdk/x11/bdkinput-x11.c (_bdk_input_common_other_event): 
	* bdk/x11/bdkwindow-x11.c (bdk_x11_window_set_user_time): 
	s/_bdk_x11_window_set_user_time/bdk_x11_window_set_user_time/,
	since we want that function to be part of the public API.

Wed May  5 22:20:21 2004  Matthias Clasen  <maclas@gmx.de>

	Merge from 2.4:
	
	* btk/btkiconfactory.c (icon_source_clear): Don't
	call g_free() on a pixbuf.  (#141961, Crispin Flowerday) 

2004-05-05  Matthias Clasen  <mclasen@redhat.com>
   
	Merge from 2.4:
	
	* btk/btkuimanager.c (print_node): Make the output 
	parseable.  (#141929, Sven Neumann)

2004-05-05  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkdnd-win32.c (bdk_drag_find_window_for_screen): Add
	multi-monitor offset. (#141842, John Ehresman)

2004-05-04  Federico Mena Quintero  <federico@ximian.com>

	Fixes #139562, based on a patch by Christian Neumair.

	* btk/btkfilechooserdefault.c (struct _BtkFileChooserDefault): Add
	a filter_combo_hbox field to contain the filter combo.
	(show_filters): Show/hide the filter_combo_hbox.
	(create_filename_entry_and_filter_combo): Removed.
	(file_pane_create): Create the filter_combo_hbox here.

2004-05-04  Matthias Clasen  <mclasen@redhat.com>

	* modules/input/btkimcontextxim.c: Fix the recent
	string_conversion_callback change to work on 
	Solaris.  (#141190, Padraig O'Briain)

	* btk/btkselection.c: Disable debug logging again.

2004-05-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkselection.c: Make the chunk size for 
	incremental transfers depend on the maximal request 
	size, capped at 256k. This should allow most selections
	to be transferred nonincrementally, avoiding many
	roundtrips and protocol overhead.

2004-05-03  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkuimanager.c (btk_ui_manager_class_init): Call
	g_signal_new() correctly and initialize the signal fields.  Fixes
	#141749; patch based on Michael Natterer's.

u2004-05-03  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkselection.c (_btk_selection_request): Fix
	a debug message to show correct information.
	(_btk_selection_incr_event): Make INCRemental transfer
	of MULTIPLE targets work. This was broken since 1997!

2004-05-02  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkdrawable-win32.c (draw_segments) : don't
	modify the passed in BdkSegment(s) in place, we may get
	them again to draw at the same place. Fixes bug #129095, 
	bug #137177, ...
	(draw_segments) draw the end pixel again to get the 
	pixmap mask right, fixes bug #126710, #130202

	* bdk/win32/bdkwindow-win32.c : use SetForegroundWindow,
	fixes bug #106013, John Ehresman

	* btk/makefile.msc.in : don't try to link btk.res but
	use btk-win32.res (as supposed to be fixed below :)

2004-05-01  Hans Breuer  <hans@breuer.org>

	* tests/Makefile.am : tests/makefile.msc is in CVS for
	a long time, finally added to EXTRA_DIST : fixes bug 
	#141334, John Ehresman

2004-04-30  Matthias Clasen  <mclasen@redhat.com>

	* === Released 2.4.1 ===

	* configure.in: Version 2.4.1, interface age 1. 

	* NEWS: Updates

2004-04-29  Federico Mena Quintero  <federico@ximian.com>

	Fixes #140412.

	* btk/btkfilechooserdefault.c (remove_selected_bookmarks): New
	function; moved the code over from
	remove_bookmark_button_clicked_cb().
	(remove_selected_bookmarks): Now, getting a non-removable bookmark
	is not an error, as we may be called as a result of hitting the
	Delete key.
	(shortcuts_key_press_event_cb): New handler; delete the bookmark
	if the user presses Backspace, Delete, or KP_Delete.

2004-04-29  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkaction.c (closure_accel_activate): Use
	_btk_action_emit_activate() instead of directly
	emitting the activate signal.  (#141429, Jody Goldberg)

	* btk/btkactiongroup.c (btk_action_group_add_action_with_accel): 
	Warn people when the accelerator can not be 
	parsed.  (#141429, Jody Goldberg)

2004-04-29  Matthias Clasen  <mclasen@redhat.com>

	* tests/testentrycompletion.c (main): Add a missing 
	cat.  (#141070, Chris Sherlock)  

	* btk/btkrc.c (btk_rc_check_pixmap_dir): Remove unused
	variable.  (#141022, Chris Sherlock)
	
	* btk/btkcombo.c (btk_combo_popup_list): Add a missing
	cast.  (#141013, Chris Sherlock)

	* btk/btkcellview.c (btk_cell_view_cell_layout_clear): Remove
	unused variable.  (#141011, Chris Sherlock)

2004-04-29  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkgc-win32.c (bdk_win32_gc_set_dashes): Plug memory
	leak. (#140775, John Ehresman)

Thu Apr 29 01:09:50 2004  Matthias Clasen  <maclas@gmx.de>

	* bdk/bdkdraw.c (_bdk_drawable_get_scratch_gc): Use depth - 1
	to index the cached gcs, not depth.  (#139494)

2004-04-28  Matthias Clasen  <mclasen@redhat.com>

	* bdk/bdkdraw.c (_bdk_drawable_get_scratch_gc): Docs typo fix.

Sun Apr 25 15:36:02 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbutton.c (btk_tool_button_set_label_widget): Fix
	cut'n'paste-o from previous commit. (#141046, Torsten Schoenfeld).

2004-04-24  Theppitak Karoonboonyanan  <thep@linux.thai.net>

	Patch to add support for string conversion callbacks to
	BtkIMContextXIM (#101814)

	* modules/input/btkimcontextxim.c: Set the string conversion callback
	if supported by the XIC.

	(struct _BtkIMContextXIM): Add string_conversion_callback member.

	(struct _BtkXIMInfo, setup_im): Check and keep flag inidicating
	whether string conversion callback is supported.

	(btk_im_context_get_ic, +set_string_conversion_callback,
	+string_conversion_callback): Also initialize string conversion
	callback, if supported, along with the IC initialization.

	* modules/input/imxim.c: Make "xim" module default for Thai as well.

2004-04-23  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkclipboard.c (btk_clipboard_wait_for_targets): Correctly
	initialize targets.  (#139883, John Finlay)

	* bdk/bdkdraw.c (bdk_draw_drawable): Small doc improvement. 

	* btk/btktreeselection.c (btk_tree_selection_get_selected_rows): 
	Don't recommend btk_tree_row_reference_new_proxy().  (#138309,
	Tim-Philipp Müller)

	* btk/btktreeviewcolumn.c (btk_tree_view_column_cell_set_cell_data): 
	Remove an excessive g_return_if_fail().

	* bdk/x11/bdkevents-x11.c (set_user_time): Make set_user_time()
	static.
	* bdk/x11/bdkinput-x11.c (_bdk_input_common_other_event): 
	_-prefix calls of bdk_x11_window_set_user_time().

2004-04-22  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (update_node): Make sure the separators 
	used to demarkate placeholder ends don't show up on 
	show_all().  (#140496, Murray Cumming)

	* btk/btkspinbutton.c (spin_button_at_limit): Make spinbuttons
	work with negative increments.  (#137975, Tim Gerla)

Wed Apr 21 21:38:03 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* btk/btktoolbutton.c (btk_tool_button_set_label_widget,
	btk_tool_button_set_icon_widget): Remove the old widget from the
	tool button before overwriting it with the new widget.

	(#140508, Todd Goyen)
	
2004-04-22  Tor Lillqvist  <tml@iki.fi>

	Fix the file chooser on Windows. I can't make it misbehave or
	crash any more now. But presumably there are still corner cases
	not handled. I haven't really checked behaviour of UNC paths, for
	instance.

	* btk/btkfilesystemwin32.c: Accept both backslash and slash in
	several places. Use G_IS_DIR_SEPARATOR macro (which could be added
	to GLib in 2.6).

	(btk_file_system_win32_get_parent): Like the Unix version, assert
	filename is absolute, and avoid one unnecessary string allocation
	and freeing.
	
	(canonicalize_filename,btk_file_system_win32_parse): Handle drive
	letters more correctly.

	(btk_file_system_win32_render_icon): Assure correct syntax is used
	for root folder of a drive. (#137962, Morten Welinder)

	(filename_is_some_root): New function that accepts also root
	without any drive specified.

	(filename_is_drive_root): Rename from filename_is_root.

	* btk/btkfilechooserentry.c (completion_match_func): Casefold on
	Windows.

2004-04-21  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (btk_entry_completion_timeout): Pop down the 
	completion window if there are no completions anymore.

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Don't call btk_tree_view_scroll_to_cell() on an empty tree view. 
	It doesn't like that.  (#140642, Christian Persch)

	* demos/btk-demo/expander.c (do_expander): A new demo.

	* demos/btk-demo/Makefile.am (demos): Add expander.c.

2004-04-20  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextview.c (btk_text_view_allocate_children): Make
	sure anchored children get size allocated, even if the layout
	is valid.  (#122323, Andrew E. Makeev)
	(btk_text_view_scroll_pages): 
	(btk_text_view_scroll_hpages): Don't scroll to cursor position
	if we already have pending scrolls. Bandaid fix for #78513.

Mon Apr 19 17:59:17 2004  Owen Taylor  <otaylor@redhat.com>

	* INSTALL.in: Update libpng and libjpeg URLs, remove
	note about building without since that's not the normal
	case.

Sun Apr 11 09:45:11 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btkicontheme.c (load_themes): Fix a couple of typos in
	handling of SVG/non-SVG unthemed icons.

2004-04-19  Morten Welinder  <terra@bunny.org>

	* btk/btktoolbar.c (btk_toolbar_focus): Don't leak list of
	children.  (#140523)

2004-04-19  Matthias Clasen  <mclasen@redhat.com>

	* btk/btktextbtree.c (_btk_text_line_previous_could_contain_tag): 
	Don't stop the iteration up to the tag_root too 
	early.  (#109945, Dongho Shin)

Sun Apr 18 17:06:03 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* bdk/x11/bdkkeys-x11.c (get_effective_keymap): Make
	bdk_keymap_translate_keyboard_state() handle NULL
	keymaps. (#139715, Torsten Schoenfeld).

Sun Apr 18 16:59:21 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	* configure.in: Don't erase BDK_EXTRA_CFLAGS. Fixes bug 139586,
	reported by Pedro RODRIGUEZ, about compilation problems when
	Xcursor is installed in a non-standard location.

Sun Apr 18 16:15:15 2004  Soeren Sandmann  <sandmann@daimi.au.dk>

	Support for _NET_WM_USER_TIME (bug 115650). Patch by Elijah
	Newren.
	
	* bdk/x11/bdkwindow-x11.[ch]: Add new internal function
	_bdk_x11_set_user_time() to set the _NET_WM_USER_TIME property.

	* bdk/x11/bdkdisplay-x11.h (struct _BdkDisplayX11): Add user_time field

	* bdk/x11/bdkdisplay-x11.c: Add _NET_WM_USER_TIME to list of
	precached atoms.
	
	* bdk/x11/bdkinput-x11.c, bdk/x11/bdkevents-x11.c: Set the
	property on user interaction.

2004-04-15  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilesel.c (open_new_dir): Tell the user to use
	G_FILENAME_ENCODING, not G_BROKEN_FILENAMES.  Fixes #114065.

	* btk/btkfilechooserdefault.c (split_uris): Use a variant of the
	code from btkfilesel.c to parse a "text/uri-list" blob.  Fixes
	#140126.

2004-04-15  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcellrenderer.c (btk_cell_renderer_class_init): 
	* btk/btkbutton.c (btk_button_class_init): Doc fixes.

2004-04-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcombobox.c: 
	* btk/btkwidget.c: 
	Make all style properties readonly.

2004-04-14  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkcolorsel.c: Add a11y relations between the color
	wheel and the spin buttons.  (#132745, Padraig O'Briain)

	* btk/btkiconfactory.c (btk_icon_set_render_icon): Document
	the meaning of size == -1.

	* btk/btkwidget.c (btk_widget_render_icon): Explicitly accept  
	a size of -1.  (#137436, Brian Cameron)

	* btk/btkcombobox.c: Make the arrow and separator regular
	children of an hbox inside the button, and propagate state
	changes from the button to the cell view.  (part of the fix
	for #138650, should also fix #137535)

	* btk/btkcellview.c (btk_cell_view_expose): Pass the PRELIT
	state to btk_cell_renderer_render() when prelighted. (part 
	of the fix for #138650)

	* btk/btkcellrenderertext.c (btk_cell_renderer_text_render): 
	Use PRELIGHT state when appropriate.  (part of the fix for 
	#138650)

	* btk/btkcombobox.c (btk_combo_box_relayout): Don't spit 
	out warnings if called before the combo box is 
	realized.  (#139742, Philip Langdale)

Wed Apr 14 03:45:39 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeview.c (btk_tree_view_expose): propagate expose
	events to children.

Wed Apr 14 03:32:58 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btkpathbar.c (make_directory_button): remove spurious
	btk_box_pack_start.

Tue Apr 13 16:19:23 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btkpathbar.c (make_directory_button): patch from Owen to
	make the buttons sized by a bold label.  This makes the text
	'swim' a little, but stops the buttons from resizing, #137210

2004-04-13  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkuimanager.c (get_child_node): Don't crash if a node 
	has no name.
	(start_element_handler): Accept separators without unique 
	names.  (#133302, Anders Carlsson)

	* btk/btkactiongroup.c (btk_action_group_add_action): Document
	possible accelerator gotcha when using this function.  (#139641, 
	Christian Persch)

	* btk/btkuimanager.c (node_remove_ui_reference): Don't leak
	list nodes.  (#138862, Morten Welinder)

Tue Apr 13 12:24:49 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeview.c (btk_tree_view_destroy): remove unused
	variable.
	(btk_tree_view_button_press): If we activated the row we don't
	want to grab focus back, as moving focus to another widget is
	pretty common, #138458

2004-04-12  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooser.c (btk_file_chooser_class_init): Added
	documentation to all the signals.

2004-04-12  Matthias Clasen  <mclasen@dhcp64-228.boston.redhat.com>

	* btk/btkcombobox.c (btk_combo_box_unset_model): Don't unref
	model if it is NULL. (#139770)

	* btk/btktreeview.c (btk_tree_view_get_cell_area): Typo fix.

	* btk/btkentrycompletion.c (btk_entry_completion_init): Don't add
	a shadow inside the scrolled window, add it around the vbox.

	* btk/btkentryprivate.h: 
	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Return a boolean indicating whether the popup is positioned above 
	or below. Scroll the completions to the beginning or the end, 
	depending on the positioning.

	* btk/btkentry.c (btk_entry_completion_key_press): Make keynav
	wrap around in the entry completion popup, and allow BDK_UP to 
	enter the popup.  (#137440)

2004-04-12  Matthias Clasen  <mclasen@redhat.com>

	* btk/btkentry.c (btk_entry_size_request): Make sure the style is 
	there before using it.

Sun Apr 11 15:08:45 2004  Jonathan Blandford  <jrb@bunny.org>

	* btk/btktreeprivate.h: Moved search entries into priv data.

	* btk/btktreeview.c: Prep for type-ahead support.

	(btk_tree_view_destroy): Destroy the search window explicitly.
	(btk_tree_view_key_press): Minor change; prep for type-ahead
	(btk_tree_view_ensure_interactive_directory): New function
	(btk_tree_view_focus_out): Rework to handle new entry life-cycle.
	(btk_tree_view_real_start_interactive_search): rework
	(btk_tree_view_search_dialog_hide): ditto
	(btk_tree_view_search_delete_event): ditto
	(btk_tree_view_search_button_press_event): ditto
	(btk_tree_view_search_key_press_event): ditto
	(btk_tree_view_search_move): ditto
	(btk_tree_view_search_init): ditto

	* btk/btktreeviewcolumn.c:
	(btk_tree_view_column_cell_layout_clear): remove unused variable.

	* tests/testfilechooser.c: (main): change

2004-04-11  Hans Breuer  <hans@breuer.org>

	* bdk/win32/bdkspawn-win32.c : workaround for bug #137496,
	the real fix would involve just another small API breakage,
	i.e. bdk_spawn_* using GPid not just bint.

	* btk/makefile.msc.in : build btk-win32.res, not btk.res

2004-04-10  Tor Lillqvist  <tml@iki.fi>

	* bdk/win32/bdkkeys-win32.c (bdk_keymap_translate_keyboard_state):
	If both Shift and CapsLock pressed, ignore the shift only for
	letters (that would have been affected by the CapsLock). (#139095)

	* bdk/win32/bdkglobals-win32.c: Disable tablet support by default,
	seems to be even buggier now than it used to be. (#138341)
	Initialize _bdk_input_ignore_wintab to TRUE.

	* bdk/win32/bdkmain-win32.c: Add --use-wintab switch and
	BDK_USE_WINTAB environment variable to turn on tablet support.

2004-04-09  Christian Persch  <chpe@cvs.bunny.org>

	* btk/btkuimanager.c: (btk_ui_manager_insert_action_group),
	(btk_ui_manager_remove_action_group): Terminate
	g_object_[dis]connect() calls with NULL instead of 0.
	Fixes #138997.

2004-04-09  Guntupalli Karunakar  <karunakar@freedomink.org>

        * configure.in: Added "gu" (Gujarati) to ALL_LINGUAS.

2004-04-07  Federico Mena Quintero  <federico@ximian.com>

	Fix #132500.

	* btk/btkfilesystem.c (btk_file_system_parse): Ensure that the
	passed-in 'str' is not NULL.

	* btk/btkfilesystemunix.c (expand_tilde): New helper function;
	expands "~/" or "~foo/" at the beginning of a filename.
	(btk_file_system_unix_parse): Use expand_tilde() before doing
	anything else.

	* btk/btkfilechooserentry.c
	(btk_file_chooser_entry_maybe_update_directory): Take in a
	force_reload argument.
	(btk_file_chooser_entry_changed): If btk_file_system_parse()
	returns an error, set the file_part_pos to -1.
	(load_directory_callback): Only populate the model if the
	file_part_pos is not -1.

2004-04-06  Pablo Saratxaga  <pablo@mandrakesoft.com>

	* configure.in: Added Icelandic (is) to ALL_LINGUAS

2004-04-05  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (location_popup_handler): Use a
	title for SAVE and CREATE_FOLDER modes.  Fixes #137272.

	* btk/btkfilesystemunix.c (btk_file_system_unix_make_path): Look
	for G_DIR_SEPARATOR in the display_name, and err out if it is
	present; use the same error message as Nautilus.  Fixes #136467.

	* btk/btkfilechooserdefault.c (file_pane_create): Make the
	new-folder button say "Create Fo_lder" rather than "Create
	_Folder", so that the mnemonic doesn't conflict with the "Save in
	_folder" label.  Fixes #136975.

2004-04-05  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkpathbar.c (_btk_path_bar_set_path): Ref/sink the
	buttons.  Also, free them correctly upon failure.  Based on a
	patch by Morten Welinder, fixes #137956.

2004-04-05  Anders Carlsson  <andersca@bunny.org>

	* bdk/bdk.c (bdk_arg_context_parse): Handle '--' correctly.

Fri Apr  2 17:57:33 2004  Jonathan Blandford  <jrb@redhat.com>

	* btk/btktreeview.c (btk_tree_view_row_inserted): set the height
	correctly for fixed height when inserting a node, #138082

2004-04-01  Federico Mena Quintero  <federico@ximian.com>

	Fix #136077.

	* btk/btkpathbar.h (struct _BtkPathBarClass): Add a
	"child_is_hidden" boolean argument to the "path-clicked" signal.

	* btk/btkpathbar.c (struct _ButtonData): Added a file_is_hidden
	field.
	(make_directory_button): Take a file_is_hidden argument; put it in
	the ButtonData.
	(_btk_path_bar_set_path): See whether each path component path is
	a hidden file.
	(btk_path_bar_class_init): Add the file_is_hidden argument to the
	"path-clicked" signal.
	(button_clicked_cb): See if the downwards button represents a
	hidden file for the file_is_hidden argument in the signal
	emission.

	* btk/btkmarshalers.list: Added a signal type VOID:POINTER,BOOLEAN.

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_select_path): If we fail to switch
	folders, don't try to select the path in the file system model.
	Also, return the result from _btk_file_system_model_path_do().
	(btk_file_chooser_default_select_path): Turn on show_hidden in the
	file system model if we are asked to select a hidden file.
	(path_bar_clicked): Show hidden files based on whether the
	immediate downwards folder in the path bar is a hidden file
	itself.
	(struct _BtkFileChooserDefault): Added fields
	browse_files_popup_menu and browse_files_popup_menu_hidden_files_item.
	(create_file_list): Set an object data key of
	"BtkFileChooserDefault" on the tree view so that we can find the
	impl from the popup menu callbacks.  Also, hook up to the
	"button-press-event" and "popup-menu" signals in the file list to
	bring up a popup menu.
	(list_popup_menu_cb): New callback.
	(list_button_press_event_cb): New callback.

	Fix #138763:

	* btk/btkfilesystemmodel.c
	(_btk_file_system_model_new): Oops, connect_object to
	"finished-loading".

2004-03-31  Tor Lillqvist  <tml@iki.fi>

	* configure.in: Move AC_CANONICAL_HOST earlier, before the check
	for native Win32. (#136559, J. Ali Harlow)

	* bdk/win32/bdkdrawable-win32.c (draw_arc): Use X11 semantics for
	angles. Thanks to Tim Newsham.

2004-03-29  Federico Mena Quintero  <federico@ximian.com>

	Fix #137520.

	* btk/btkfilesystem.h (struct _BtkFileFolderIface): Added slots
	for an ::is_finished_loading() method and a ::finished_loading()
	signal at the end of the struct.

	* btk/btkfilesystem.c (btk_file_folder_base_init): Create the
	"finished-loading" signal.
	(btk_file_folder_is_finished_loading): New function.

	* btk/btkfilesystemunix.c
	(btk_file_folder_unix_is_finished_loading): Implement.

	* btk/btkfilesystemmodel.c (struct _BtkFileSystemModelClass): New
	slot for a "finished-loading" signal.
	(btk_file_system_model_class_init): Create the "finished-loading"
	signal.
	(struct _BtkFileSystemModel): New field
	idle_finished_loading_source.  We emit the "finished-loading"
	signal in an idle if the root folder was done loading right in
	_btk_file_system_model_new(), so that the caller has a chance to
	connect to the signal.
	(_btk_file_system_model_new): Connect to the normal signals of the
	folder even if the initial _list_children() fails.  Also, see if
	the folder is finished loading; connect to the "finished-loading"
	signal otherwise.
	(btk_file_system_model_finalize): Remove the idle handler.

	* btk/btkfilechooserdefault.c (set_list_model): Set a busy cursor
	and connect to the model's "finished-loading" signal.
	(get_toplevel): New helper function.
	(error_message): Use get_toplevel().
	(trap_activate_cb): Likewise.
	(location_popup_handler): Likewise.
	(set_busy_cursor): New function.
	(browse_files_model_finished_loading_cb): New callback.

2004-03-25  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (check_preview_change): Just use the
	file under the cursor; we don't need the logic from
	BtkFileSelection after all.  Fixes #132255.

2004-03-25  Federico Mena Quintero  <federico@ximian.com>

	* btk/btkfilechooserdefault.c (location_entry_create): Fill the
	location entry with the display name of the file under the cursor
	for Open mode, or the typed filename in Save mode.

2004-03-24  J. Ali Harlow  <ali@juiblex.co.uk>

	* btk/btkfilesystemwin32.c
	(filename_is_root): Bare drive designators (eg., "c:") are
	no longer considered as root filenames.  Fixed #137942

2004-03-24  J. Ali Harlow  <ali@juiblex.co.uk>

	* btk/btkfilesystemwin32.c
	(btk_file_system_win32_create_folder): Invert test for error in
	mkdir.  Fixes #137945

2004-03-24  J. Ali Harlow  <ali@juiblex.co.uk>

	Fixed #138004 using Federico's code from #132327.

	* btk/btkfilesystemwin32.c (struct _BtkFileSystemWin32): Add a
	folder_hash field to keep a list of live folder objects.
	(btk_file_system_win32_init): Create the folder_hash.
	(btk_file_system_win32_finalize): Destroy the folder_hash.
	(btk_file_system_win32_get_folder): Ref and return an existing
	folder if we have it around, otherwise return a new folder object.
	(struct _BtkFileFolderWin32): Add a field for the parent file system.
	(btk_file_folder_win32_finalize): Remove the folder from the file
	system's hash table.
	(btk_file_system_win32_create_folder):  Emit "files-added" on the
	newly-created folder's parent.  Fixes #138004.

2004-03-24  J. Ali Harlow  <ali@juiblex.co.uk>

	* btk/btkfilesystemwin32.c
	(btk_file_system_win32_get_folder): Test that path is actually
	a directory and throw error if not. Fixed bug #137950

2004-03-22  J. Ali Harlow  <ali@juiblex.co.uk>

	* btk/btkfilesystemwin32.c
	(btk_file_system_win32_volume_get_display_name): Ignore empty
	volume labels; assume that GetVolumeInformation would fail if
	GetVolumeInformationW does; catches a small memory leak;
	pass the buffer size to GetVolumeInformationW in wide
	characters instead of bytes. Fixes bug #137543
	(list_volumes): Cope with the theoretical possibility of
	more than 26 logical drives. Fixes bug #137940
	(bookmarks_serialize): Now actually removes bookmarks.
	Fixes bug #137943

2004-03-22  Guntupalli Karunakar  <karunakar@freedomink.org>

        * configure.in: Added "pa" (Punjabi) to ALL_LINGUAS.

2004-03-21  Tor Lillqvist  <tml@iki.fi>

	* btk/btkfilesystemwin32.c
	(btk_file_system_win32_volume_get_base_path): Include the
	backslash. Otherwise btk_file_system_win32_path_to_uri() returns
	NULL for a volume base path, as g_filename_to_uri() requires an
	absolute path, and just a drive letter and colon isn't. (#137543)

2004-03-20  Hans Breuer  <hans@breuer.org>

	* btk/btkfilesystemwin32.c : applied the undisputable and
	required [due to recent btkfilesystem internal api semantic 
	changes] part of patches to fix bug #137543 (Tor Lillqvist,
	J. Ali Harlow)

	* bdk/bdkevents-win32.c (handle_configure_event) :
             (bdk_event_translate), WM_WINDOWPOSCHANGED : initialize
	BdkWindowObject::x, y with screen coords to make 
	bdk_window_get_position () return the right thing and thus fix
	drag and drop positioning (e.g. Gimp tabs, fixes bug #137192)

2004-03-19  Federico Mena Quintero  <federico@ximian.com>

	* Revert the patch to #137520, as 2.4.1 is for conservative bug
	fixes only.  The patch is attached to the bug report, for
	reference.

2004-03-19  Morten Welinder  <terra@bunny.org>

	* btk/btkfilechooserdefault.c
	(btk_file_chooser_default_set_current_folder): Test existance of
	the path after checking for locality, if needed.

2004-03-19  Federico Mena Quintero  <federico@ximian.com>

	Fix #137520.

	* btk/btkfilesystem.h (struct _BtkFileFolderIface): Added slots
	for an ::is_finished_loading() method and a ::finished_loading()
	signal at the end of the struct.

	* btk/btkfilesystem.c (btk_file_folder_base_init): Create the
	"finished-loading" signal.
	(btk_file_folder_is_finished_loading): New function.

	* btk/btkfilesystemunix.c
	(btk_file_folder_unix_is_finished_loading): Implement.

	* btk/btkfilesystemmodel.c (struct _BtkFileSystemModelClass): New
	slot for a "finished-loading" signal.
	(btk_file_system_model_class_init): Create the "finished-loading"
	signal.
	(struct _BtkFileSystemModel): New field
	idle_finished_loading_source.  We emit the "finished-loading"
	signal in an idle if the root folder was done loading right in
	_btk_file_system_model_new(), so that the caller has a chance to
	connect to the signal.
	(_btk_file_system_model_new): Connect to the normal signals of the
	folder even if the initial _list_children() fails.  Also, see if
	the folder is finished loading; connect to the "finished-loading"
	signal otherwise.
	(btk_file_system_model_finalize): Remove the idle handler.

	* btk/btkfilechooserdefault.c (set_list_model): Set a busy cursor
	and connect to the model's "finished-loading" signal.
	(get_toplevel): New helper function.
	(error_message): Use get_toplevel().
	(trap_activate_cb): Likewise.
	(location_popup_handler): Likewise.
	(set_busy_cursor): New function.
	(browse_files_model_finished_loading_cb): New callback.

Thu Mar 18 12:10:45 2004  Owen Taylor  <otaylor@redhat.com>

	* btk/btktreeitem.c (btk_tree_item_forall): Include 
	eventbox for expander. (#137564, reported by
	Jacques Garrigue)

2004-03-18  Guntupalli Karunakar  <karunakar@freedomink.org>

	* mr.po: Added "mr" for Marathi to ALL_LINGUAS.

2004-03-17  Morten Welinder  <terra@bunny.org>

	* btk/btkfilechooserdefault.c (shortcuts_add_volumes): Free
	volumes not actually put into the shortcut list.

	* tests/prop-editor.c (object_changed): Plug leak.

	* tests/testfilechooser.c (main): Plug some leaks and expose
	others.

	* tests/prop-editor.c (create_prop_editor): Don't leak the tooltip
	object.  Fixed #136652.

	* btk/btkfilechooserdefault.c (check_icon_theme): Do nothing if we
	have no screen.  Fixes #137260.
	(shortcuts_add_bookmark_from_path): Simplify using check_is_folder
	thereby fixing leak.  Fixes #137259.

	* btk/btkpathbar.c (btk_path_bar_forall): Make this work when the
	slider buttons have been destroyed.
	(btk_path_bar_remove): Make this work for slider buttons too.
	Fixes #137257

2004-03-15  Morten Welinder  <terra@bunny.org>

	* btk/btkfilechooserdefault.c (shortcuts_add_bookmark_from_path):
	Sanitize and plug leak.
	(check_icon_theme): Only do something if the widget has a screen.

Wed Mar 17 01:20:28 2004  Matthias Clasen  <maclas@gmx.de>

	* btk/btkentrycompletion.c (_btk_entry_completion_resize_popup): 
	Move the repositioning logic from _btk_entry_completion() popup
	over here. Fixes #137355, reported by Niklas Knutsson.

